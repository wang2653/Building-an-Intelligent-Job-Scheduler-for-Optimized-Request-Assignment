<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Doctor-Patient Management</title>
  <link rel="stylesheet" type="text/css" href="../static/style.css">
</head>
<body>

<div class="doctor-container">
  <!-- Left Sidebar -->
  <div class="sidebar">
    <h2>Scheduler Panel</h2>
    <div class="panel-selection">
      <a href="#doctor">Doctor</a>
      <a href="#patient">Patient</a>
    </div>


    <div id="doctor"></div>
    <div id="patient"></div>

    <div class="panel doctor-panel">
        <form method="post">
        <input type="text" name="name" required>
        <input type="text" name="availability">
        <button>Add/Edit Doctor</button>
        <button>Remove Doctor</button>
      </form>
    </div>

    <div class="panel patient-panel">
      <form method="post">
        <input type="text" name="id" required>
        <input type="text" name="arrival_time">
        <input type="text" name="acuity_level">
        <input type="text" name="treatment_plan">
        <button>Add/Edit Patient</button>
        <button>Remove Patient</button>
      </form>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="main">
    <!-- Header with Buttons -->
    <div class="header">
      <button id="doctorBtn">Doctor</button>
      <button id="patientBtn">Patient</button>
      <button id="searchBtn">Search</button>
    </div>

    <!-- Search Bar (hidden by default) -->
    <div class="search-bar" id="searchBar">
      <input type="text" placeholder="Search..." />
    </div>

    <!-- Content to show Doctor/Patient cards -->
    <div class="content" id="contentArea">
      <!-- Default or initial content can be placed here -->
      <!-- Will be replaced by JavaScript in this demo -->
      <div class="card">
        <img src="https://via.placeholder.com/80" alt="Default Photo">
        <h3>Welcome</h3>
        <p>Select Doctor or Patient</p>
      </div>
    </div>
  </div>
</div>

<!-- Optional JavaScript for toggling content and search bar -->
<script>
  const doctorBtn = document.getElementById('doctorBtn');
  const patientBtn = document.getElementById('patientBtn');
  const searchBtn  = document.getElementById('searchBtn');
  const searchBar  = document.getElementById('searchBar');
  const contentArea= document.getElementById('contentArea');
  let currentView = 'default'; // Track current view
  let patientInterval = null;  // Store interval ID

  // Show doctor cards when "Doctor" button is clicked
  doctorBtn.addEventListener('click', () => {
    console.log("Doctor button clicked. Switching to doctor view.");
    currentView = 'doctor'; // Track current view
    if (patientInterval) {
        console.log("Clearing patient auto-refresh interval.");
        clearInterval(patientInterval); // Stop auto-refresh when switching to doctor
        patientInterval = null;
    }
    // Hide search bar if open
    searchBar.classList.remove('show-search');

    // Replace content with "Doctor" cards (4 per row, scrolled if more)
    contentArea.innerHTML = `
      <div class="card">
        <img src="../static/doc1.jpeg" alt="Doctor Photo">
        <h3>Dr. John</h3>
        <p>Available</p>
      </div>
      <div class="card">
        <img src="../static/doc2.jpeg" alt="Doctor Photo">
        <h3>Dr. Smith</h3>
        <p>On Leave</p>
      </div>
      <div class="card">
        <img src="../static/doc3.jpeg" alt="Doctor Photo">
        <h3>Dr. Jane</h3>
        <p>Busy</p>
      </div>
      <div class="card">
        <img src="../static/doc4.jpeg" alt="Doctor Photo">
        <h3>Dr. Emily</h3>
        <p>Available</p>
      </div>
      <div class="card">
        <img src="../static/doc5.jpeg" alt="Doctor Photo">
        <h3>Dr. Carter</h3>
        <p>Available</p>
      </div>
      <div class="card">
        <img src="../static/doc6.jpeg" alt="Doctor Photo">
        <h3>Dr. Li</h3>
        <p>Available</p>
      </div>
      <div class="card">
        <img src="../static/doc7.jpeg" alt="Doctor Photo">
        <h3>Dr. Helen</h3>
        <p>Available</p>
      </div>
      <div class="card">
        <img src="../static/doc8.jpeg" alt="Doctor Photo">
        <h3>Dr. Virgil</h3>
        <p>Available</p>
      </div>
      <!-- Add more doctor cards as needed -->
    `;
  });

  let currentPatients = []; // Store current patient data to detect changes

function updatePatients() {
    if (currentView !== 'patient') return; // Stop updates if not in patient view

    fetch('/get_patients')
      .then(response => response.json())
      .then(newPatients => {
        // Compare with previous data, update only if changed
        if (JSON.stringify(newPatients) === JSON.stringify(currentPatients)) {
            console.log("No changes in patient data, skipping update.");
            return;
        }

        console.log("New patient data detected, updating view.");
        currentPatients = newPatients; // Store new data

        let patientHTML = '';
        newPatients.forEach(patient => {
          patientHTML += `
            <div class="card">
              <img src="https://via.placeholder.com/80" alt="Patient Photo">
              <h3>Patient ${patient.patient_id}</h3>
              <p>Acuity Level: ${patient.acuity_level}</p>
              <p>Waiting Time: ${patient.waiting_time}</p>
              <p>Current Treatment: ${patient.current_treatment}</p>
              <p>Remaining Time: ${patient.remaining_time}</p>
              <p>Status: ${patient.status}</p>
            </div>
          `;
        });
        contentArea.innerHTML = patientHTML;
      });
}


  // Show patient cards when "Patient" button is clicked
  patientBtn.addEventListener('click', () => {
    console.log("Patient button clicked. Switching to patient view.");
    currentView = 'patient'; // Track current view
    if (patientInterval) {
        console.log("Clearing existing interval before starting a new one.");
        clearInterval(patientInterval);
    }
    searchBar.classList.remove('show-search');
    updatePatients();

    // Fetch new patient data every 1 seconds
    patientInterval = setInterval(updatePatients, 1000);
    console.log("Started auto-refresh interval for patients.");
  });

  // Toggle the search bar visibility when "Search" button is clicked
  searchBtn.addEventListener('click', () => {
    console.log("Search button clicked. Toggling search bar.");
    searchBar.classList.toggle('show-search');
  });
</script>

</body>
</html>

