import{f as Es,g as uL}from"./index-zwPOQhW2.js";import{r as dL}from"./file-url-DgijyRSD.js";/* empty css                                                   */import"./svelte/svelte.js";import"./context-TgWPFwN2.js";function hL(vi,mn){for(var Cn=0;Cn<mn.length;Cn++){const Zn=mn[Cn];if(typeof Zn!="string"&&!Array.isArray(Zn)){for(const L in Zn)if(L!=="default"&&!(L in vi)){const Hn=Object.getOwnPropertyDescriptor(Zn,L);Hn&&Object.defineProperty(vi,L,Hn.get?Hn:{enumerable:!0,get:()=>Zn[L]})}}}return Object.freeze(Object.defineProperty(vi,Symbol.toStringTag,{value:"Module"}))}var DS={exports:{}},G1;function z1(){return G1||(G1=1,function(vi,mn){(function(Cn,Zn){vi.exports=Zn()})(typeof self<"u"?self:typeof Es<"u"?Es:Es,()=>(()=>{var Cn={82966:(r,t,e)=>{e.d(t,{G:()=>i});var n=e(81152),i=function(){function o(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}return Object.defineProperty(o,"HasTriggers",{get:function(){for(var a in o.Triggers)if(Object.prototype.hasOwnProperty.call(o.Triggers,a))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(o,"HasPickTriggers",{get:function(){for(var a in o.Triggers)if(Object.prototype.hasOwnProperty.call(o.Triggers,a)){var s=parseInt(a);if(s>=n.Y.ACTION_OnPickTrigger&&s<=n.Y.ACTION_OnPickUpTrigger)return!0}return!1},enumerable:!1,configurable:!0}),o.HasSpecificTrigger=function(a){for(var s in o.Triggers)if(Object.prototype.hasOwnProperty.call(o.Triggers,s)&&parseInt(s)===a)return!0;return!1},o.Triggers={},o}()},35747:(r,t,e)=>{e.d(t,{X:()=>n});var n=function(){function i(o,a,s,l,c,u){this.source=o,this.pointerX=a,this.pointerY=s,this.meshUnderPointer=l,this.sourceEvent=c,this.additionalData=u}return i.CreateNew=function(o,a,s){var l=o.getScene();return new i(o,l.pointerX,l.pointerY,l.meshUnderPointer||o,a,s)},i.CreateNewFromSprite=function(o,a,s,l){return new i(o,a.pointerX,a.pointerY,a.meshUnderPointer,s,l)},i.CreateNewFromScene=function(o,a){return new i(null,o.pointerX,o.pointerY,o.meshUnderPointer,a)},i.CreateNewFromPrimitive=function(o,a,s,l){return new i(o,a.x,a.y,null,s,l)},i}()},62623:(r,t,e)=>{e.d(t,{R:()=>s,h:()=>a});var n=e(37943),i=e(7164),o=e(81152),a=function(){function l(c,u,d,h,p,m,v,b,E){h===void 0&&(h=0),p===void 0&&(p=!1),m===void 0&&(m=!1),v===void 0&&(v=!1),this._isAlreadyOwned=!1,this._isDisposed=!1,c&&c.getScene?this._engine=c.getScene().getEngine():this._engine=c,this._updatable=d,this._instanced=m,this._divisor=b||1,this._label=E,u instanceof n.n?(this._data=null,this._buffer=u):(this._data=u,this._buffer=null),this.byteStride=v?h:h*Float32Array.BYTES_PER_ELEMENT,p||this.create()}return Object.defineProperty(l.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),l.prototype.createVertexBuffer=function(c,u,d,h,p,m,v){m===void 0&&(m=!1);var b=m?u:u*Float32Array.BYTES_PER_ELEMENT,E=h?m?h:h*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new s(this._engine,this,c,this._updatable,!0,E,p===void 0?this._instanced:p,b,d,void 0,void 0,!0,this._divisor||v)},l.prototype.isUpdatable=function(){return this._updatable},l.prototype.getData=function(){return this._data},l.prototype.getBuffer=function(){return this._buffer},l.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},l.prototype.create=function(c){c===void 0&&(c=null),!c&&this._buffer||(c=c||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,c),this._data=c):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(c,this._label),this._data=c):this._buffer=this._engine.createVertexBuffer(c,void 0,this._label))},l.prototype._rebuild=function(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.capacity>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.capacity,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.capacity,void 0,this._label));i.V.Warn('Missing data for buffer "'.concat(this._label,'" ').concat(this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":"",". Buffer reconstruction failed.")),this._buffer=null}},l.prototype.update=function(c){this.create(c)},l.prototype.updateDirectly=function(c,u,d,h){h===void 0&&(h=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,c,h?u:u*Float32Array.BYTES_PER_ELEMENT,d?d*this.byteStride:void 0),this._data=u===0&&d===void 0?c:null)},l.prototype._increaseReferences=function(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)},l.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)},l}(),s=function(){function l(c,u,d,h,p,m,v,b,E,C,T,f,g,S){var y,x,R,I,M;T===void 0&&(T=!1),f===void 0&&(f=!1),g===void 0&&(g=1),S===void 0&&(S=!1),this._isDisposed=!1;var D=!1;if(this.engine=c,typeof h=="object"&&h!==null?(D=(y=h.updatable)!==null&&y!==void 0&&y,p=h.postponeInternalCreation,m=h.stride,v=h.instanced,b=h.offset,E=h.size,C=h.type,T=(x=h.normalized)!==null&&x!==void 0&&x,f=(R=h.useBytes)!==null&&R!==void 0&&R,g=(I=h.divisor)!==null&&I!==void 0?I:1,S=(M=h.takeBufferOwnership)!==null&&M!==void 0&&M,this._label=h.label):D=!!h,u instanceof a?(this._buffer=u,this._ownsBuffer=S):(this._buffer=new a(c,u,D,m,p,v,f,g,this._label),this._ownsBuffer=!0),this.uniqueId=l._Counter++,this._kind=d,C===void 0){var B=this.getData();this.type=B?l.GetDataType(B):l.FLOAT}else this.type=C;var F=l.GetTypeByteLength(this.type);f?(this._size=E||(m?m/F:l.DeduceStride(d)),this.byteStride=m||this._buffer.byteStride||this._size*F,this.byteOffset=b||0):(this._size=E||m||l.DeduceStride(d),this.byteStride=m?m*F:this._buffer.byteStride||this._size*F,this.byteOffset=(b||0)*F),this.normalized=T,this._instanced=v!==void 0&&v,this._instanceDivisor=v?g:0,this._alignBuffer(),this._computeHashCode()}return Object.defineProperty(l.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(c){var u=c!=0;this._instanceDivisor=c,u!==this._instanced&&(this._instanced=u,this._computeHashCode())},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"_maxVerticesCount",{get:function(){var c=this.getData();return c?Array.isArray(c)?c.length/(this.byteStride/4)-this.byteOffset/4:(c.byteLength-this.byteOffset)/this.byteStride:0},enumerable:!1,configurable:!0}),l.prototype._computeHashCode=function(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},l.prototype._rebuild=function(){var c;(c=this._buffer)===null||c===void 0||c._rebuild()},l.prototype.getKind=function(){return this._kind},l.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},l.prototype.getData=function(){return this._buffer.getData()},l.prototype.getFloatData=function(c,u){var d=this.getData();return d?l.GetFloatData(d,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,c,u):null},l.prototype.getBuffer=function(){return this._buffer.getBuffer()},l.prototype.getWrapperBuffer=function(){return this._buffer},l.prototype.getStrideSize=function(){return this.byteStride/l.GetTypeByteLength(this.type)},l.prototype.getOffset=function(){return this.byteOffset/l.GetTypeByteLength(this.type)},l.prototype.getSize=function(c){return c===void 0&&(c=!1),c?this._size*l.GetTypeByteLength(this.type):this._size},l.prototype.getIsInstanced=function(){return this._instanced},l.prototype.getInstanceDivisor=function(){return this._instanceDivisor},l.prototype.create=function(c){this._buffer.create(c),this._alignBuffer()},l.prototype.update=function(c){this._buffer.update(c),this._alignBuffer()},l.prototype.updateDirectly=function(c,u,d){d===void 0&&(d=!1),this._buffer.updateDirectly(c,u,void 0,d),this._alignBuffer()},l.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0},l.prototype.forEach=function(c,u){l.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,c,this.normalized,u)},l.prototype._alignBuffer=function(){},l.DeduceStride=function(c){switch(c){case l.UVKind:case l.UV2Kind:case l.UV3Kind:case l.UV4Kind:case l.UV5Kind:case l.UV6Kind:return 2;case l.NormalKind:case l.PositionKind:return 3;case l.ColorKind:case l.ColorInstanceKind:case l.MatricesIndicesKind:case l.MatricesIndicesExtraKind:case l.MatricesWeightsKind:case l.MatricesWeightsExtraKind:case l.TangentKind:return 4;default:throw new Error("Invalid kind '"+c+"'")}},l.GetDataType=function(c){return c instanceof Int8Array?l.BYTE:c instanceof Uint8Array?l.UNSIGNED_BYTE:c instanceof Int16Array?l.SHORT:c instanceof Uint16Array?l.UNSIGNED_SHORT:c instanceof Int32Array?l.INT:c instanceof Uint32Array?l.UNSIGNED_INT:l.FLOAT},l.GetTypeByteLength=function(c){switch(c){case l.BYTE:case l.UNSIGNED_BYTE:return 1;case l.SHORT:case l.UNSIGNED_SHORT:return 2;case l.INT:case l.UNSIGNED_INT:case l.FLOAT:return 4;default:throw new Error("Invalid type '".concat(c,"'"))}},l.ForEach=function(c,u,d,h,p,m,v,b){if(c instanceof Array)for(var E=u/4,C=d/4,T=0;T<m;T+=h){for(var f=0;f<h;f++)b(c[E+f],T+f);E+=C}else{var g=c instanceof ArrayBuffer?new DataView(c):new DataView(c.buffer,c.byteOffset,c.byteLength),S=l.GetTypeByteLength(p);for(T=0;T<m;T+=h){var y=u;for(f=0;f<h;f++)b(l._GetFloatValue(g,p,y,v),T+f),y+=S;u+=d}}},l._GetFloatValue=function(c,u,d,h){switch(u){case l.BYTE:var p=c.getInt8(d);return h&&(p=Math.max(p/127,-1)),p;case l.UNSIGNED_BYTE:return p=c.getUint8(d),h&&(p/=255),p;case l.SHORT:return p=c.getInt16(d,!0),h&&(p=Math.max(p/32767,-1)),p;case l.UNSIGNED_SHORT:return p=c.getUint16(d,!0),h&&(p/=65535),p;case l.INT:return c.getInt32(d,!0);case l.UNSIGNED_INT:return c.getUint32(d,!0);case l.FLOAT:return c.getFloat32(d,!0);default:throw new Error("Invalid component type ".concat(u))}},l.GetFloatData=function(c,u,d,h,p,m,v,b){var E=u*l.GetTypeByteLength(d),C=v*u;if(d!==l.FLOAT||p!==E){var T=new Float32Array(C);return l.ForEach(c,h,p,u,d,C,m,function(y,x){return T[x]=y}),T}if(!(c instanceof Array||c instanceof Float32Array)||h!==0||c.length!==C){if(c instanceof Array){var f=h/4;return c.slice(f,f+C)}if(c instanceof ArrayBuffer)return new Float32Array(c,h,C);if(3&(f=c.byteOffset+h)&&(i.V.Warn("Float array must be aligned to 4-bytes border"),b=!0),b){var g=new Uint8Array(C*Float32Array.BYTES_PER_ELEMENT),S=new Uint8Array(c.buffer,f,g.length);return g.set(S),new Float32Array(g.buffer)}return new Float32Array(c.buffer,f,C)}return b?c.slice():c},l._Counter=0,l.BYTE=o.Y.BYTE,l.UNSIGNED_BYTE=o.Y.UNSIGNED_BYTE,l.SHORT=o.Y.SHORT,l.UNSIGNED_SHORT=o.Y.UNSIGNED_SHORT,l.INT=o.Y.INT,l.UNSIGNED_INT=o.Y.UNSIGNED_INT,l.FLOAT=o.Y.FLOAT,l.PositionKind=o.Y.PositionKind,l.NormalKind=o.Y.NormalKind,l.TangentKind=o.Y.TangentKind,l.UVKind=o.Y.UVKind,l.UV2Kind=o.Y.UV2Kind,l.UV3Kind=o.Y.UV3Kind,l.UV4Kind=o.Y.UV4Kind,l.UV5Kind=o.Y.UV5Kind,l.UV6Kind=o.Y.UV6Kind,l.ColorKind=o.Y.ColorKind,l.ColorInstanceKind=o.Y.ColorInstanceKind,l.MatricesIndicesKind=o.Y.MatricesIndicesKind,l.MatricesWeightsKind=o.Y.MatricesWeightsKind,l.MatricesIndicesExtraKind=o.Y.MatricesIndicesExtraKind,l.MatricesWeightsExtraKind=o.Y.MatricesWeightsExtraKind,l}()},37943:(r,t,e)=>{e.d(t,{n:()=>n});var n=function(){function i(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=i._Counter++}return Object.defineProperty(i.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),i._Counter=0,i}()},1554:(r,t,e)=>{e.d(t,{K:()=>i});var n=e(81152),i=function(){function o(a,s,l,c){l===void 0&&(l=n.Y.BUFFER_CREATIONFLAG_READWRITE),this._engine=a,this._label=c,this._engine._storageBuffers.push(this),this._create(s,l)}return o.prototype._create=function(a,s){this._bufferSize=a,this._creationFlags=s,this._buffer=this._engine.createStorageBuffer(a,s,this._label)},o.prototype._rebuild=function(){this._create(this._bufferSize,this._creationFlags)},o.prototype.getBuffer=function(){return this._buffer},o.prototype.update=function(a,s,l){this._buffer&&this._engine.updateStorageBuffer(this._buffer,a,s,l)},o.prototype.read=function(a,s,l,c){return this._engine.readFromStorageBuffer(this._buffer,a,s,l,c)},o.prototype.dispose=function(){var a=this._engine._storageBuffers,s=a.indexOf(this);s!==-1&&(a[s]=a[a.length-1],a.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null},o}()},8004:(r,t,e)=>{e.d(t,{G:()=>o});var n=e(8046),i=e(62623),o=function(){function a(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}return a.prototype.getNormal=function(s,l){if(s===void 0&&(s=!1),l===void 0&&(l=!0),!this.pickedMesh||l&&!this.pickedMesh.isVerticesDataPresent(i.R.NormalKind))return null;var c,u=this.pickedMesh.getIndices();u?.length===0&&(u=null);var d=n.AA.Vector3[0],h=n.AA.Vector3[1],p=n.AA.Vector3[2];if(l){var m=this.pickedMesh.getVerticesData(i.R.NormalKind),v=u?n.Pq.FromArrayToRef(m,3*u[3*this.faceId],d):d.copyFromFloats(m[3*this.faceId*3],m[3*this.faceId*3+1],m[3*this.faceId*3+2]),b=u?n.Pq.FromArrayToRef(m,3*u[3*this.faceId+1],h):h.copyFromFloats(m[3*(3*this.faceId+1)],m[3*(3*this.faceId+1)+1],m[3*(3*this.faceId+1)+2]),E=u?n.Pq.FromArrayToRef(m,3*u[3*this.faceId+2],p):p.copyFromFloats(m[3*(3*this.faceId+2)],m[3*(3*this.faceId+2)+1],m[3*(3*this.faceId+2)+2]);v=v.scale(this.bu),b=b.scale(this.bv),E=E.scale(1-this.bu-this.bv),c=new n.Pq(v.x+b.x+E.x,v.y+b.y+E.y,v.z+b.z+E.z)}else{var C=this.pickedMesh.getVerticesData(i.R.PositionKind),T=u?n.Pq.FromArrayToRef(C,3*u[3*this.faceId],d):d.copyFromFloats(C[3*this.faceId*3],C[3*this.faceId*3+1],C[3*this.faceId*3+2]),f=u?n.Pq.FromArrayToRef(C,3*u[3*this.faceId+1],h):h.copyFromFloats(C[3*(3*this.faceId+1)],C[3*(3*this.faceId+1)+1],C[3*(3*this.faceId+1)+2]),g=u?n.Pq.FromArrayToRef(C,3*u[3*this.faceId+2],p):p.copyFromFloats(C[3*(3*this.faceId+2)],C[3*(3*this.faceId+2)+1],C[3*(3*this.faceId+2)+2]),S=T.subtract(f),y=g.subtract(f);c=n.Pq.Cross(S,y)}var x=function(I,M){var D=I.getWorldMatrix();I.nonUniformScaling&&(n.AA.Matrix[0].copyFrom(D),(D=n.AA.Matrix[0]).setTranslationFromFloats(0,0,0),D.invert(),D.transposeToRef(n.AA.Matrix[1]),D=n.AA.Matrix[1]),n.Pq.TransformNormalToRef(M,D,M)};if(s&&x(this.pickedMesh,c),this.ray){var R=n.AA.Vector3[0].copyFrom(c);s||x(this.pickedMesh,R),n.Pq.Dot(R,this.ray.direction)>0&&c.negateInPlace()}return c.normalize(),c},a.prototype.getTextureCoordinates=function(s){if(s===void 0&&(s=i.R.UVKind),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(s))return null;var l=this.pickedMesh.getIndices();if(!l)return null;var c=this.pickedMesh.getVerticesData(s);if(!c)return null;var u=n.I9.FromArray(c,2*l[3*this.faceId]),d=n.I9.FromArray(c,2*l[3*this.faceId+1]),h=n.I9.FromArray(c,2*l[3*this.faceId+2]);return u=u.scale(this.bu),d=d.scale(this.bv),h=h.scale(1-this.bu-this.bv),new n.I9(u.x+d.x+h.x,u.y+d.y+h.y)},a}()},51956:(r,t,e)=>{e.d(t,{p9:()=>i,rX:()=>n});var n=!1,i={get UseOpenGLOrientationForUV(){return n},set UseOpenGLOrientationForUV(o){n=o}}},75227:(r,t,e)=>{e.d(t,{H:()=>h});var n=e(78322),i=e(6174),o=e(12028),a=e(34623),s=e(50582),l=e(62273),c=e(7164),u=e(55204),d=e(37411),h=function(){function p(m,v,b,E){E===void 0&&(E={}),this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=m,this._engine=v,this.uniqueId=l.K.UniqueId,v.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new d.e),this._engine.getCaps().supportComputeShaders?E.bindingsMapping?(this._context=v.createComputeContext(),this._shaderPath=b,this._options=(0,n.Cl)({bindingsMapping:{},defines:[]},E)):c.V.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):c.V.Error("This engine does not support compute shaders!")}return Object.defineProperty(p.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"shaderPath",{get:function(){return this._shaderPath},enumerable:!1,configurable:!0}),p.prototype.getClassName=function(){return"ComputeShader"},p.prototype.setTexture=function(m,v,b){b===void 0&&(b=!0);var E=this._bindings[m];this._bindings[m]={type:b?0:4,object:v,indexInGroupEntries:E?.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!E||E.object!==v||E.type!==this._bindings[m].type)},p.prototype.setStorageTexture=function(m,v){var b=this._bindings[m];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==v),this._bindings[m]={type:1,object:v,indexInGroupEntries:b?.indexInGroupEntries}},p.prototype.setExternalTexture=function(m,v){var b=this._bindings[m];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==v),this._bindings[m]={type:6,object:v,indexInGroupEntries:b?.indexInGroupEntries}},p.prototype.setVideoTexture=function(m,v){return!!v.externalTexture&&(this.setExternalTexture(m,v.externalTexture),!0)},p.prototype.setUniformBuffer=function(m,v){var b=this._bindings[m];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==v),this._bindings[m]={type:p._BufferIsDataBuffer(v)?7:2,object:v,indexInGroupEntries:b?.indexInGroupEntries}},p.prototype.setStorageBuffer=function(m,v){var b=this._bindings[m];this._contextIsDirty||(this._contextIsDirty=!b||b.object!==v),this._bindings[m]={type:p._BufferIsDataBuffer(v)?7:3,object:v,indexInGroupEntries:b?.indexInGroupEntries}},p.prototype.setTextureSampler=function(m,v){var b=this._bindings[m];this._contextIsDirty||(this._contextIsDirty=!b||!v.compareSampler(b.object)),this._bindings[m]={type:5,object:v,indexInGroupEntries:b?.indexInGroupEntries}},p.prototype.isReady=function(){var m=this._effect;for(var v in this._bindings){var b=this._bindings[v],E=b.type,C=b.object;switch(E){case 0:case 4:case 1:case 6:if(!C.isReady())return!1}}var T=[],f=this._shaderPath;if(this._options.defines)for(var g=0;g<this._options.defines.length;g++)T.push(this._options.defines[g]);var S=T.join(`
`);return this._cachedDefines!==S&&(this._cachedDefines=S,m=this._engine.createComputeEffect(f,{defines:S,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=m),!!m.isReady()},p.prototype.dispatch=function(m,v,b){return!(!this.fastMode&&!this._checkContext()||(this._engine.computeDispatch(this._effect,this._context,this._bindings,m,v,b,this._options.bindingsMapping,this.gpuTimeInFrame),0))},p.prototype.dispatchIndirect=function(m,v){if(v===void 0&&(v=0),!this.fastMode&&!this._checkContext())return!1;var b=p._BufferIsDataBuffer(m)?m:m.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,b,v,this._options.bindingsMapping,this.gpuTimeInFrame),!0},p.prototype._checkContext=function(){var m;if(!this.isReady())return!1;for(var v in this._bindings){var b=this._bindings[v];if(!this._options.bindingsMapping[v])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+v+"'");switch(b.type){case 0:var E=this._samplers[v],C=b.object;E&&C._texture&&E.compareSampler(C._texture)||(this._samplers[v]=new u.u().setParameters(C.wrapU,C.wrapV,C.wrapR,C.anisotropicFilteringLevel,C._texture.samplingMode,(m=C._texture)===null||m===void 0?void 0:m._comparisonFunction),this._contextIsDirty=!0);break;case 6:this._contextIsDirty=!0;break;case 2:var T=b.object;T.getBuffer()!==b.buffer&&(b.buffer=T.getBuffer(),this._contextIsDirty=!0)}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0},p.prototype.dispatchWhenReady=function(m,v,b,E){var C=this;return E===void 0&&(E=10),new Promise(function(T){var f=function(){C.dispatch(m,v,b)?T():setTimeout(f,E)};f()})},p.prototype.serialize=function(){var m=o.p.Serialize(this);for(var v in m.options=this._options,m.shaderPath=this._shaderPath,m.bindings={},m.textures={},this._bindings){var b=this._bindings[v],E=b.object;switch(b.type){case 0:case 4:case 1:var C=E.serialize();C&&(m.textures[v]=C,m.bindings[v]={type:b.type})}}return m},p.Parse=function(m,v,b){var E=o.p.Parse(function(){return new p(m.name,v.getEngine(),m.shaderPath,m.options)},m,v,b);for(var C in m.textures){var T=m.bindings[C],f=s.g.Parse(m.textures[C],v,b);T.type===0?E.setTexture(C,f):T.type===4?E.setTexture(C,f,!1):E.setStorageTexture(C,f)}return E},p._BufferIsDataBuffer=function(m){return m.underlyingResource!==void 0},(0,n.Cg)([(0,i.lK)()],p.prototype,"name",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"fastMode",void 0),p}();(0,a.Y5)("BABYLON.ComputeShader",h)},18149:(r,t,e)=>{e.r(t),e.d(t,{ComputeShaderBoundingHelper:()=>c});var n=e(78322),i=e(75227),o=e(1554),a=e(62623),s=e(8046),l=e(75482);e(98519).l.ShadersStoreWGSL.boundingInfoComputeShader=`struct Results {minX : atomic<i32>,
minY : atomic<i32>,
minZ : atomic<i32>,
maxX : atomic<i32>,
maxY : atomic<i32>,
maxZ : atomic<i32>,
dummy1 : i32,
dummy2 : i32,};fn floatToBits(value: f32)->i32 {return bitcast<i32>(value);}
fn bitsToFloat(value: i32)->f32 {return bitcast<f32>(value);}
fn atomicMinFloat(atomicVar: ptr<storage,atomic<i32>,read_write>,value: f32) {let intValue=floatToBits(value);loop {let oldIntValue=atomicLoad(atomicVar);let oldValue=bitsToFloat(oldIntValue);if (value>=oldValue) {break;}
if (atomicCompareExchangeWeak(atomicVar,oldIntValue,intValue).old_value==oldIntValue) {break;}}}
fn atomicMaxFloat(atomicVar: ptr<storage,atomic<i32>,read_write>,value: f32) {let intValue=floatToBits(value);loop {let oldIntValue=atomicLoad(atomicVar);let oldValue=bitsToFloat(oldIntValue);if (value<=oldValue) {break;}
if (atomicCompareExchangeWeak(atomicVar,oldIntValue,intValue).old_value==oldIntValue) {break;}}}
fn readMatrixFromRawSampler(smp : texture_2d<f32>,index : f32)->mat4x4<f32>
{let offset=i32(index) *4; 
let m0=textureLoad(smp,vec2<i32>(offset+0,0),0);let m1=textureLoad(smp,vec2<i32>(offset+1,0),0);let m2=textureLoad(smp,vec2<i32>(offset+2,0),0);let m3=textureLoad(smp,vec2<i32>(offset+3,0),0);return mat4x4<f32>(m0,m1,m2,m3);}
const identity=mat4x4f(
vec4f(1.0,0.0,0.0,0.0),
vec4f(0.0,1.0,0.0,0.0),
vec4f(0.0,0.0,1.0,0.0),
vec4f(0.0,0.0,0.0,1.0)
);struct Settings {morphTargetTextureInfo: vec3f,
morphTargetCount: i32,
indexResult : u32,};@group(0) @binding(0) var<storage,read> positionBuffer : array<f32>;@group(0) @binding(1) var<storage,read_write> resultBuffer : array<Results>;@group(0) @binding(7) var<uniform> settings : Settings;
#if NUM_BONE_INFLUENCERS>0
@group(0) @binding(2) var boneSampler : texture_2d<f32>;@group(0) @binding(3) var<storage,read> indexBuffer : array<vec4f>;@group(0) @binding(4) var<storage,read> weightBuffer : array<vec4f>;
#if NUM_BONE_INFLUENCERS>4
@group(0) @binding(5) var<storage,read> indexExtraBuffer : array<vec4f>;@group(0) @binding(6) var<storage,read> weightExtraBuffer : array<vec4f>;
#endif
#endif
#ifdef MORPHTARGETS
@group(0) @binding(8) var morphTargets : texture_2d_array<f32>;@group(0) @binding(9) var<storage,read> morphTargetInfluences : array<f32>;@group(0) @binding(10) var<storage,read> morphTargetTextureIndices : array<f32>;
#endif
#ifdef MORPHTARGETS
fn readVector3FromRawSampler(targetIndex : i32,vertexIndex : u32)->vec3f
{ 
let vertexID=f32(vertexIndex)*settings.morphTargetTextureInfo.x;let y=floor(vertexID/settings.morphTargetTextureInfo.y);let x=vertexID-y*settings.morphTargetTextureInfo.y;let textureUV=vec2<i32>(i32(x),i32(y));return textureLoad(morphTargets,textureUV,i32(morphTargetTextureIndices[targetIndex]),0).xyz;}
#endif
@compute @workgroup_size(256,1,1)
fn main(@builtin(global_invocation_id) global_id : vec3<u32>) {let index=global_id.x;if (index>=arrayLength(&positionBuffer)/3) {return;}
let position=vec3f(positionBuffer[index*3],positionBuffer[index*3+1],positionBuffer[index*3+2]);var finalWorld=identity;var positionUpdated=position;
#if NUM_BONE_INFLUENCERS>0
var influence : mat4x4<f32>;let matricesIndices=indexBuffer[index];let matricesWeights=weightBuffer[index];influence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence=influence+readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];
#endif 
#if NUM_BONE_INFLUENCERS>2
influence=influence+readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];
#endif 
#if NUM_BONE_INFLUENCERS>3
influence=influence+readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];
#endif 
#if NUM_BONE_INFLUENCERS>4
let matricesIndicesExtra=indexExtraBuffer[index];let matricesWeightsExtra=weightExtraBuffer[index];influence=influence+readMatrixFromRawSampler(boneSampler,matricesIndicesExtra.x)*matricesWeightsExtra.x;
#if NUM_BONE_INFLUENCERS>5
influence=influence+readMatrixFromRawSampler(boneSampler,matricesIndicesExtra.y)*matricesWeightsExtra.y;
#endif 
#if NUM_BONE_INFLUENCERS>6
influence=influence+readMatrixFromRawSampler(boneSampler,matricesIndicesExtra.z)*matricesWeightsExtra.z;
#endif 
#if NUM_BONE_INFLUENCERS>7
influence=influence+readMatrixFromRawSampler(boneSampler,matricesIndicesExtra.w)*matricesWeightsExtra.w;
#endif 
#endif 
finalWorld=finalWorld*influence;
#endif
#ifdef MORPHTARGETS
for (var i=0; i<NUM_MORPH_INFLUENCERS; i=i+1) {if (i>=settings.morphTargetCount) {break;}
positionUpdated=positionUpdated+(readVector3FromRawSampler(i,index)-position)*morphTargetInfluences[i];}
#endif
var worldPos=finalWorld*vec4f(positionUpdated.x,positionUpdated.y,positionUpdated.z,1.0);atomicMinFloat(&resultBuffer[settings.indexResult].minX,worldPos.x);atomicMinFloat(&resultBuffer[settings.indexResult].minY,worldPos.y);atomicMinFloat(&resultBuffer[settings.indexResult].minZ,worldPos.z);atomicMaxFloat(&resultBuffer[settings.indexResult].maxX,worldPos.x);atomicMaxFloat(&resultBuffer[settings.indexResult].maxY,worldPos.y);atomicMaxFloat(&resultBuffer[settings.indexResult].maxZ,worldPos.z);}
`;var c=function(){function u(d){this._computeShadersCache={},this._positionBuffers={},this._indexBuffers={},this._weightBuffers={},this._indexExtraBuffers={},this._weightExtraBuffers={},this._morphTargetInfluenceBuffers={},this._morphTargetTextureIndexBuffers={},this._ubos=[],this._uboIndex=0,this._processedMeshes=[],this._computeShaders=[],this._uniqueComputeShaders=new Set,this._resultBuffers=[],this._engine=d}return u.prototype._getComputeShader=function(d,h,p){var m,v=d.join(`
`);if(this._computeShadersCache[v])m=this._computeShadersCache[v];else{var b={positionBuffer:{group:0,binding:0},resultBuffer:{group:0,binding:1},settings:{group:0,binding:7}};h&&(b.boneSampler={group:0,binding:2},b.indexBuffer={group:0,binding:3},b.weightBuffer={group:0,binding:4},b.indexExtraBuffer={group:0,binding:5},b.weightExtraBuffer={group:0,binding:6}),p&&(b.morphTargets={group:0,binding:8},b.morphTargetInfluences={group:0,binding:9},b.morphTargetTextureIndices={group:0,binding:10}),m=new i.H("boundingInfoCompute".concat(h?"_bones":"").concat(p?"_morphs":""),this._engine,"boundingInfo",{bindingsMapping:b,defines:d}),this._computeShadersCache[v]=m}return m},u.prototype._getUBO=function(){if(this._uboIndex>=this._ubos.length){var d=new l.D(this._engine);d.addFloat3("morphTargetTextureInfo",0,0,0),d.addUniform("morphTargetCount",1),d.addUniform("indexResult",1),this._ubos.push(d)}return this._ubos[this._uboIndex++]},u.prototype._extractDataAndLink=function(d,h,p,m,v,b){var E,C,T=h.getTotalVertices();if(b[h.uniqueId])C=b[h.uniqueId];else{var f=(E=h.getVertexBuffer(p))===null||E===void 0?void 0:E.getFloatData(T);(C=new o.K(this._engine,Float32Array.BYTES_PER_ELEMENT*T*m)).update(f),b[h.uniqueId]=C}d.setStorageBuffer(v,C)},u.prototype._prepareStorage=function(d,h,p,m,v,b){var E;m[p]?E=m[p]:(E=new o.K(this._engine,Float32Array.BYTES_PER_ELEMENT*v),m[p]=E),E.update(b),d.setStorageBuffer(h,E)},u.prototype.processAsync=function(d){return(0,n.sH)(this,void 0,void 0,function(){return(0,n.YH)(this,function(h){switch(h.label){case 0:return[4,this.registerMeshListAsync(d)];case 1:return h.sent(),this.processMeshList(),[4,this.fetchResultsForMeshListAsync()];case 2:return h.sent(),[2]}})})},u.prototype.registerMeshListAsync=function(d){var h=this;this._disposeForMeshList(),Array.isArray(d)||(d=[d]);for(var p=0,m=0;m<d.length;m++)(v=d[m]).getTotalVertices()!==0&&v.getVertexBuffer&&v.getVertexBuffer(a.R.PositionKind)&&(this._processedMeshes.push(v),(C=v.morphTargetManager)&&(p=Math.max(p,C.numTargets)));for(m=0;m<this._processedMeshes.length;m++){var v,b=[""],E=!1;(v=this._processedMeshes[m])&&v.useBones&&v.computeBonesUsingShaders&&v.skeleton&&(b.push("#define NUM_BONE_INFLUENCERS "+v.numBoneInfluencers),E=!0);var C,T=this._getComputeShader(b,E,!1);if(this._uniqueComputeShaders.add(T),C=v.morphTargetManager){(b=b.slice()).push("#define MORPHTARGETS"),b.push("#define NUM_MORPH_INFLUENCERS "+p);var f=this._getComputeShader(b,E,!0);this._uniqueComputeShaders.add(f),this._computeShaders.push([T,f])}else this._computeShaders.push([T,T]);var g=this._getUBO();g.updateUInt("indexResult",m),g.update()}return new Promise(function(S){var y=function(){for(var x=h._uniqueComputeShaders.keys(),R=x.next();R.done!==!0;R=x.next())if(!R.value.isReady())return void setTimeout(y,10);S()};y()})},u.prototype.processMeshList=function(){if(this._processedMeshes.length!==0){this._uboIndex=0;var d=8*this._processedMeshes.length,h=new Float32Array(d),p=new o.K(this._engine,Float32Array.BYTES_PER_ELEMENT*d);this._resultBuffers.push(p);for(var m=0;m<this._processedMeshes.length;m++)h[8*m+0]=Number.POSITIVE_INFINITY,h[8*m+1]=Number.POSITIVE_INFINITY,h[8*m+2]=Number.POSITIVE_INFINITY,h[8*m+3]=Number.NEGATIVE_INFINITY,h[8*m+4]=Number.NEGATIVE_INFINITY,h[8*m+5]=Number.NEGATIVE_INFINITY;for(p.update(h),m=0;m<this._processedMeshes.length;m++){var v=this._processedMeshes[m],b=v.getTotalVertices(),E=this._computeShaders[m],C=E[0],T=E[1],f=v.morphTargetManager,g=f&&f.numInfluencers>0,S=g?T:C;if(this._extractDataAndLink(S,v,a.R.PositionKind,3,"positionBuffer",this._positionBuffers),v&&v.useBones&&v.computeBonesUsingShaders&&v.skeleton&&v.skeleton.useTextureToStoreBoneMatrices){this._extractDataAndLink(S,v,a.R.MatricesIndicesKind,4,"indexBuffer",this._indexBuffers),this._extractDataAndLink(S,v,a.R.MatricesWeightsKind,4,"weightBuffer",this._weightBuffers);var y=v.skeleton.getTransformMatrixTexture(v);S.setTexture("boneSampler",y,!1),v.numBoneInfluencers>4&&(this._extractDataAndLink(S,v,a.R.MatricesIndicesExtraKind,4,"indexExtraBuffer",this._indexExtraBuffers),this._extractDataAndLink(S,v,a.R.MatricesWeightsExtraKind,4,"weightExtraBuffer",this._weightExtraBuffers))}var x=this._getUBO();if(g){var R=f._targetStoreTexture;S.setTexture("morphTargets",R,!1),this._prepareStorage(S,"morphTargetInfluences",v.uniqueId,this._morphTargetInfluenceBuffers,f.numInfluencers,f.influences),this._prepareStorage(S,"morphTargetTextureIndices",v.uniqueId,this._morphTargetTextureIndexBuffers,f.numInfluencers,f._morphTargetTextureIndices),x.updateFloat3("morphTargetTextureInfo",f._textureVertexStride,f._textureWidth,f._textureHeight),x.updateInt("morphTargetCount",f.numInfluencers),x.update()}S.setStorageBuffer("resultBuffer",p),S.setUniformBuffer("settings",x),S.dispatch(Math.ceil(b/256)),this._engine.flushFramebuffer()}}},u.prototype.fetchResultsForMeshListAsync=function(){var d=this;return new Promise(function(h){for(var p=[],m=0,v=0;v<d._resultBuffers.length;v++){var b=d._resultBuffers[v].getBuffer();p.push(b),m+=b.capacity}var E=new Float32Array(m/Float32Array.BYTES_PER_ELEMENT),C=s.Pq.Zero(),T=s.Pq.Zero(),f={minimum:C,maximum:T};d._engine.readFromMultipleStorageBuffers(p,0,void 0,E,!0).then(function(){for(var g=0,S=0;S<d._resultBuffers.length;S++){for(var y=0;y<d._processedMeshes.length;y++){var x=d._processedMeshes[y];s.Pq.FromArrayToRef(E,g+8*y,C),s.Pq.FromArrayToRef(E,g+8*y+3,T),S>0&&(C.minimizeInPlace(x.getBoundingInfo().minimum),T.maximizeInPlace(x.getBoundingInfo().maximum)),x._refreshBoundingInfoDirect(f)}g+=8*d._processedMeshes.length}for(var R=0,I=d._resultBuffers;R<I.length;R++)I[R].dispose();d._resultBuffers=[],d._uboIndex=0,h()})})},u.prototype._disposeCache=function(d){for(var h in d)d[h].dispose()},u.prototype._disposeForMeshList=function(){for(var d=0,h=this._resultBuffers;d<h.length;d++)h[d].dispose();this._resultBuffers=[],this._processedMeshes=[],this._computeShaders=[],this._uniqueComputeShaders=new Set},u.prototype.dispose=function(){this._disposeCache(this._positionBuffers),this._positionBuffers={},this._disposeCache(this._indexBuffers),this._indexBuffers={},this._disposeCache(this._weightBuffers),this._weightBuffers={},this._disposeCache(this._morphTargetInfluenceBuffers),this._morphTargetInfluenceBuffers={},this._disposeCache(this._morphTargetTextureIndexBuffers),this._morphTargetTextureIndexBuffers={};for(var d=0,h=this._ubos;d<h.length;d++)h[d].dispose();this._ubos=[],this._computeShadersCache={},this._engine=void 0,this._disposeForMeshList()},u}()},37904:(r,t,e)=>{e.r(t),e.d(t,{TransformFeedbackBoundingHelper:()=>u});var n=e(62623),i=e(81152),o=e(85096),a=e(47424),s=e(8046),l=e(98519),c=(e(36470),e(64400),e(24444),e(67369),e(58266),e(84589),e(76898),e(49334),"gpuTransformVertexShader");l.l.ShadersStore[c]=`attribute vec3 position;
#include<bonesDeclaration>
#include<bakedVertexAnimationDeclaration>
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
out vec3 outPosition;const mat4 identity=mat4(
vec4(1.0,0.0,0.0,0.0),
vec4(0.0,1.0,0.0,0.0),
vec4(0.0,0.0,1.0,0.0),
vec4(0.0,0.0,0.0,1.0)
);void main(void) {vec3 positionUpdated=position;
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
mat4 finalWorld=identity;
#include<bonesVertex>
#include<bakedVertexAnimation>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);outPosition=worldPos.xyz;}`,l.l.ShadersStore.gpuTransformPixelShader=`#version 300 es
void main() {discard;}
`;var u=function(){function d(h){this._buffers={},this._effects={},this._meshListCounter=0,this._engine=h}return d.prototype.processAsync=function(h){return Array.isArray(h)||(h=[h]),this._meshListCounter=0,this._processMeshList(h),Promise.resolve()},d.prototype._processMeshList=function(h){var p=this._engine.getCaps().parallelShaderCompile;this._engine.getCaps().parallelShaderCompile=void 0;for(var m=0;m<h.length;++m){var v=h[m];if(v.getTotalVertices()!==0&&v.getVertexBuffer&&v.getVertexBuffer(n.R.PositionKind)){var b=void 0,E=0,C=[],T=[],f=[n.R.PositionKind],g=[];if(v&&v.useBones&&v.computeBonesUsingShaders&&v.skeleton){f.push(n.R.MatricesIndicesKind),f.push(n.R.MatricesWeightsKind),v.numBoneInfluencers>4&&(f.push(n.R.MatricesIndicesExtraKind),f.push(n.R.MatricesWeightsExtraKind));var S=v.skeleton;C.push("#define NUM_BONE_INFLUENCERS "+v.numBoneInfluencers),S.isUsingTextureForMatrices?(C.push("#define BONETEXTURE"),T.indexOf("boneTextureWidth")===-1&&T.push("boneTextureWidth"),g.indexOf("boneSampler")===-1&&g.push("boneSampler")):(C.push("#define BonesPerMesh "+(S.bones.length+1)),T.indexOf("mBones")===-1&&T.push("mBones"))}else C.push("#define NUM_BONE_INFLUENCERS 0");var y=v?v.morphTargetManager:null;if(y){(E=y.numMaxInfluencers||y.numInfluencers)>0&&C.push("#define MORPHTARGETS"),y.isUsingTextureForTargets&&(C.push("#define MORPHTARGETS_TEXTURE"),T.indexOf("morphTargetTextureIndices")===-1&&T.push("morphTargetTextureIndices"),g.indexOf("morphTargets")===-1&&g.push("morphTargets")),C.push("#define NUM_MORPH_INFLUENCERS "+E);for(var x=0;x<E;x++)f.push(n.R.PositionKind+x);E>0&&((T=T.slice()).push("morphTargetInfluences"),T.push("morphTargetCount"),T.push("morphTargetTextureInfo"),T.push("morphTargetTextureIndices"))}var R=v.bakedVertexAnimationManager;R&&R.isEnabled&&(C.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),T.indexOf("bakedVertexAnimationSettings")===-1&&T.push("bakedVertexAnimationSettings"),T.indexOf("bakedVertexAnimationTextureSizeInverted")===-1&&T.push("bakedVertexAnimationTextureSizeInverted"),T.indexOf("bakedVertexAnimationTime")===-1&&T.push("bakedVertexAnimationTime"),g.indexOf("bakedVertexAnimationTexture")===-1&&g.push("bakedVertexAnimationTexture"),(0,o.J2)(f,v,C));var I=C.join(`
`);if(this._effects[I])b=this._effects[I];else{var M={attributes:f,uniformsNames:T,uniformBuffersNames:[],samplers:g,defines:I,fallbacks:null,onCompiled:null,onError:null,indexParameters:{maxSimultaneousMorphTargets:E},maxSimultaneousLights:0,transformFeedbackVaryings:["outPosition"]};b=this._engine.createEffect("gpuTransform",M,this._engine),this._effects[I]=b}this._compute(v,b)}}this._engine.getCaps().parallelShaderCompile=p},d.prototype._compute=function(h,p){var m,v,b=this._engine,E=h.getTotalVertices();if(this._buffers[h.uniqueId])v=this._buffers[h.uniqueId];else{var C=new Float32Array(3*E);v=new n.h(h.getEngine(),C,!0,3),this._buffers[h.uniqueId]=v}p.getEngine().enableEffect(p),h._bindDirect(p,null,!0),(0,o.f$)(h,p);var T=h.morphTargetManager;T&&T.numInfluencers>0&&(0,o.nR)(h,p);var f=h.bakedVertexAnimationManager;f&&f.isEnabled&&((m=h.bakedVertexAnimationManager)===null||m===void 0||m.bind(p,!1));var g=v.getData();if(b.bindTransformFeedbackBuffer(v.getBuffer()),b.setRasterizerState(!1),b.beginTransformFeedback(!0),b.drawArraysType(i.Y.MATERIAL_PointFillMode,0,E),b.endTransformFeedback(),b.setRasterizerState(!0),b.readTransformFeedbackBuffer(g),b.bindTransformFeedbackBuffer(null),this._meshListCounter===0)h._refreshBoundingInfo(g,null);else{var S=h.getBoundingInfo().boundingBox,y=(0,a.b)(g,0,E);d._Min.copyFrom(S.minimum).minimizeInPlace(y.minimum),d._Max.copyFrom(S.maximum).maximizeInPlace(y.maximum),h._refreshBoundingInfoDirect({minimum:d._Min,maximum:d._Max})}},d.prototype.registerMeshListAsync=function(h){return Array.isArray(h)||(h=[h]),this._meshList=h,this._meshListCounter=0,Promise.resolve()},d.prototype.processMeshList=function(){this._meshList.length!==0&&(this._processMeshList(this._meshList),this._meshListCounter++)},d.prototype.fetchResultsForMeshListAsync=function(){return this._meshListCounter=0,Promise.resolve()},d.prototype.dispose=function(){for(var h in this._buffers)this._buffers[h].dispose();this._buffers={},this._effects={},this._engine=null},d._Min=new s.Pq,d._Max=new s.Pq,d}()},45158:(r,t,e)=>{var n,i,o,a,s,l,c;e.d(t,{ST:()=>i,Ze:()=>o,bq:()=>n,dR:()=>c,h8:()=>a,pI:()=>s,sZ:()=>l}),function(u){u[u.Generic=0]="Generic",u[u.Keyboard=1]="Keyboard",u[u.Mouse=2]="Mouse",u[u.Touch=3]="Touch",u[u.DualShock=4]="DualShock",u[u.Xbox=5]="Xbox",u[u.Switch=6]="Switch",u[u.DualSense=7]="DualSense"}(n||(n={})),function(u){u[u.Horizontal=0]="Horizontal",u[u.Vertical=1]="Vertical",u[u.LeftClick=2]="LeftClick",u[u.MiddleClick=3]="MiddleClick",u[u.RightClick=4]="RightClick",u[u.BrowserBack=5]="BrowserBack",u[u.BrowserForward=6]="BrowserForward",u[u.MouseWheelX=7]="MouseWheelX",u[u.MouseWheelY=8]="MouseWheelY",u[u.MouseWheelZ=9]="MouseWheelZ",u[u.Move=12]="Move"}(i||(i={})),function(u){u[u.Horizontal=0]="Horizontal",u[u.Vertical=1]="Vertical",u[u.LeftClick=2]="LeftClick",u[u.MiddleClick=3]="MiddleClick",u[u.RightClick=4]="RightClick",u[u.BrowserBack=5]="BrowserBack",u[u.BrowserForward=6]="BrowserForward",u[u.MouseWheelX=7]="MouseWheelX",u[u.MouseWheelY=8]="MouseWheelY",u[u.MouseWheelZ=9]="MouseWheelZ",u[u.DeltaHorizontal=10]="DeltaHorizontal",u[u.DeltaVertical=11]="DeltaVertical"}(o||(o={})),function(u){u[u.Cross=0]="Cross",u[u.Circle=1]="Circle",u[u.Square=2]="Square",u[u.Triangle=3]="Triangle",u[u.L1=4]="L1",u[u.R1=5]="R1",u[u.L2=6]="L2",u[u.R2=7]="R2",u[u.Share=8]="Share",u[u.Options=9]="Options",u[u.L3=10]="L3",u[u.R3=11]="R3",u[u.DPadUp=12]="DPadUp",u[u.DPadDown=13]="DPadDown",u[u.DPadLeft=14]="DPadLeft",u[u.DPadRight=15]="DPadRight",u[u.Home=16]="Home",u[u.TouchPad=17]="TouchPad",u[u.LStickXAxis=18]="LStickXAxis",u[u.LStickYAxis=19]="LStickYAxis",u[u.RStickXAxis=20]="RStickXAxis",u[u.RStickYAxis=21]="RStickYAxis"}(a||(a={})),function(u){u[u.Cross=0]="Cross",u[u.Circle=1]="Circle",u[u.Square=2]="Square",u[u.Triangle=3]="Triangle",u[u.L1=4]="L1",u[u.R1=5]="R1",u[u.L2=6]="L2",u[u.R2=7]="R2",u[u.Create=8]="Create",u[u.Options=9]="Options",u[u.L3=10]="L3",u[u.R3=11]="R3",u[u.DPadUp=12]="DPadUp",u[u.DPadDown=13]="DPadDown",u[u.DPadLeft=14]="DPadLeft",u[u.DPadRight=15]="DPadRight",u[u.Home=16]="Home",u[u.TouchPad=17]="TouchPad",u[u.LStickXAxis=18]="LStickXAxis",u[u.LStickYAxis=19]="LStickYAxis",u[u.RStickXAxis=20]="RStickXAxis",u[u.RStickYAxis=21]="RStickYAxis"}(s||(s={})),function(u){u[u.A=0]="A",u[u.B=1]="B",u[u.X=2]="X",u[u.Y=3]="Y",u[u.LB=4]="LB",u[u.RB=5]="RB",u[u.LT=6]="LT",u[u.RT=7]="RT",u[u.Back=8]="Back",u[u.Start=9]="Start",u[u.LS=10]="LS",u[u.RS=11]="RS",u[u.DPadUp=12]="DPadUp",u[u.DPadDown=13]="DPadDown",u[u.DPadLeft=14]="DPadLeft",u[u.DPadRight=15]="DPadRight",u[u.Home=16]="Home",u[u.LStickXAxis=17]="LStickXAxis",u[u.LStickYAxis=18]="LStickYAxis",u[u.RStickXAxis=19]="RStickXAxis",u[u.RStickYAxis=20]="RStickYAxis"}(l||(l={})),function(u){u[u.B=0]="B",u[u.A=1]="A",u[u.Y=2]="Y",u[u.X=3]="X",u[u.L=4]="L",u[u.R=5]="R",u[u.ZL=6]="ZL",u[u.ZR=7]="ZR",u[u.Minus=8]="Minus",u[u.Plus=9]="Plus",u[u.LS=10]="LS",u[u.RS=11]="RS",u[u.DPadUp=12]="DPadUp",u[u.DPadDown=13]="DPadDown",u[u.DPadLeft=14]="DPadLeft",u[u.DPadRight=15]="DPadRight",u[u.Home=16]="Home",u[u.Capture=17]="Capture",u[u.LStickXAxis=18]="LStickXAxis",u[u.LStickYAxis=19]="LStickYAxis",u[u.RStickXAxis=20]="RStickXAxis",u[u.RStickYAxis=21]="RStickYAxis"}(c||(c={}))},84163:(r,t,e)=>{e.d(t,{c:()=>i});var n=e(66377),i=function(){function o(a,s,l){l===void 0&&(l=0),this.deviceType=s,this.deviceSlot=l,this.onInputChangedObservable=new n.cP,this._deviceInputSystem=a}return o.prototype.getInput=function(a){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,a)},o}()},67925:(r,t,e)=>{e.d(t,{Z:()=>v});var n=e(45158),i=e(66377),o=e(81152),a=e(50712),s=function(){function b(){}return b.CreateDeviceEvent=function(E,C,T,f,g,S,y){switch(E){case n.bq.Keyboard:return this._CreateKeyboardEvent(T,f,g,S);case n.bq.Mouse:if(T===n.ST.MouseWheelX||T===n.ST.MouseWheelY||T===n.ST.MouseWheelZ)return this._CreateWheelEvent(E,C,T,f,g,S);case n.bq.Touch:return this._CreatePointerEvent(E,C,T,f,g,S,y);default:throw"Unable to generate event for device ".concat(n.bq[E])}},b._CreatePointerEvent=function(E,C,T,f,g,S,y){var x=this._CreateMouseEvent(E,C,T,f,g,S);E===n.bq.Mouse?(x.deviceType=n.bq.Mouse,x.pointerId=1,x.pointerType="mouse"):(x.deviceType=n.bq.Touch,x.pointerId=y??C,x.pointerType="touch");var R=0;return R+=g.pollInput(E,C,n.ST.LeftClick),R+=2*g.pollInput(E,C,n.ST.RightClick),R+=4*g.pollInput(E,C,n.ST.MiddleClick),x.buttons=R,T===n.ST.Move?x.type="pointermove":T>=n.ST.LeftClick&&T<=n.ST.RightClick&&(x.type=f===1?"pointerdown":"pointerup",x.button=T-2),x},b._CreateWheelEvent=function(E,C,T,f,g,S){var y=this._CreateMouseEvent(E,C,T,f,g,S);switch(y.pointerId=1,y.type="wheel",y.deltaMode=a.s.DOM_DELTA_PIXEL,y.deltaX=0,y.deltaY=0,y.deltaZ=0,T){case n.ST.MouseWheelX:y.deltaX=f;break;case n.ST.MouseWheelY:y.deltaY=f;break;case n.ST.MouseWheelZ:y.deltaZ=f}return y},b._CreateMouseEvent=function(E,C,T,f,g,S){var y=this._CreateEvent(S),x=g.pollInput(E,C,n.ST.Horizontal),R=g.pollInput(E,C,n.ST.Vertical);return S?(y.movementX=0,y.movementY=0,y.offsetX=y.movementX-S.getBoundingClientRect().x,y.offsetY=y.movementY-S.getBoundingClientRect().y):(y.movementX=g.pollInput(E,C,10),y.movementY=g.pollInput(E,C,11),y.offsetX=0,y.offsetY=0),this._CheckNonCharacterKeys(y,g),y.clientX=x,y.clientY=R,y.x=x,y.y=R,y.deviceType=E,y.deviceSlot=C,y.inputIndex=T,y},b._CreateKeyboardEvent=function(E,C,T,f){var g=this._CreateEvent(f);return this._CheckNonCharacterKeys(g,T),g.deviceType=n.bq.Keyboard,g.deviceSlot=0,g.inputIndex=E,g.type=C===1?"keydown":"keyup",g.key=String.fromCharCode(E),g.keyCode=E,g},b._CheckNonCharacterKeys=function(E,C){var T=C.isDeviceAvailable(n.bq.Keyboard),f=T&&C.pollInput(n.bq.Keyboard,0,o.Y.INPUT_ALT_KEY)===1,g=T&&C.pollInput(n.bq.Keyboard,0,o.Y.INPUT_CTRL_KEY)===1,S=T&&(C.pollInput(n.bq.Keyboard,0,o.Y.INPUT_META_KEY1)===1||C.pollInput(n.bq.Keyboard,0,o.Y.INPUT_META_KEY2)===1||C.pollInput(n.bq.Keyboard,0,o.Y.INPUT_META_KEY3)===1),y=T&&C.pollInput(n.bq.Keyboard,0,o.Y.INPUT_SHIFT_KEY)===1;E.altKey=f,E.ctrlKey=g,E.metaKey=S,E.shiftKey=y},b._CreateEvent=function(E){var C={preventDefault:function(){}};return C.target=E,C},b}(),l=function(){function b(E,C,T){var f=this;this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(E,C,function(g,S,y,x){var R=s.CreateDeviceEvent(g,S,y,x,f);T(g,S,R)}):this._createDummyNativeInput()}return b.prototype.pollInput=function(E,C,T){return this._nativeInput.pollInput(E,C,T)},b.prototype.isDeviceAvailable=function(E){return E===n.bq.Mouse||E===n.bq.Touch},b.prototype.dispose=function(){this._nativeInput.dispose()},b.prototype._createDummyNativeInput=function(){return{pollInput:function(){return 0},isDeviceAvailable:function(){return!1},dispose:function(){}}},b}(),c=e(5153),u=e(44957),d=Object.keys(n.ST).length/2,h=function(){function b(E,C,T,f){var g=this;this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=u.S0.IsSafari(),this._usingMacOS=(0,c.XD)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=function(S){},this._keyboardUpEvent=function(S){},this._keyboardBlurEvent=function(S){},this._pointerMoveEvent=function(S){},this._pointerDownEvent=function(S){},this._pointerUpEvent=function(S){},this._pointerCancelEvent=function(S){},this._pointerWheelEvent=function(S){},this._pointerBlurEvent=function(S){},this._pointerMacOSChromeOutEvent=function(S){},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,c.XD)()&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!==-1,this._isUsingChromium=(0,c.XD)()&&navigator.userAgent&&navigator.userAgent.indexOf("Chrome")!==-1,this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=function(S){},this._gamepadDisconnectedEvent=function(S){},this._eventPrefix=u.S0.GetPointerPrefix(E),this._engine=E,this._onDeviceConnected=C,this._onDeviceDisconnected=T,this._onInputChanged=f,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=function(){g._enableEvents()})}return b.prototype.pollInput=function(E,C,T){var f=this._inputs[E][C];if(!f)throw"Unable to find device ".concat(n.bq[E]);E>=n.bq.DualShock&&E<=n.bq.DualSense&&this._updateDevice(E,C,T);var g=f[T];if(g===void 0)throw"Unable to find input ".concat(T," for device ").concat(n.bq[E]," in slot ").concat(C);return T===n.ST.Move&&u.S0.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),g},b.prototype.isDeviceAvailable=function(E){return this._inputs[E]!==void 0},b.prototype.dispose=function(){this._onDeviceConnected=function(){},this._onDeviceDisconnected=function(){},this._onInputChanged=function(){},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()},b.prototype._enableEvents=function(){var E=this==null?void 0:this._engine.getInputElement();if(E&&(!this._eventsAttached||this._elementToAttachTo!==E)){if(this._disableEvents(),this._inputs)for(var C=0,T=this._inputs;C<T.length;C++){var f=T[C];if(f)for(var g in f){var S=f[+g];if(S)for(var y=0;y<S.length;y++)S[y]=0}}this._elementToAttachTo=E,this._elementToAttachTo.tabIndex=this._elementToAttachTo.tabIndex!==-1?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}},b.prototype._disableEvents=function(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1},b.prototype._checkForConnectedDevices=function(){if(navigator.getGamepads)for(var E=0,C=navigator.getGamepads();E<C.length;E++){var T=C[E];T&&this._addGamePad(T)}typeof matchMedia=="function"&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(n.bq.Mouse,0,0,0)},b.prototype._addGamePad=function(E){var C=this._getGamepadDeviceType(E.id),T=E.index;this._gamepads=this._gamepads||new Array(E.index+1),this._registerDevice(C,T,E.buttons.length+E.axes.length),this._gamepads[T]=C},b.prototype._addPointerDevice=function(E,C,T,f){this._pointerActive||(this._pointerActive=!0),this._registerDevice(E,C,d);var g=this._inputs[E][C];g[0]=T,g[1]=f},b.prototype._registerDevice=function(E,C,T){if(C===void 0)throw"Unable to register device ".concat(n.bq[E]," to undefined slot.");if(this._inputs[E]||(this._inputs[E]={}),!this._inputs[E][C]){var f=new Array(T);f.fill(0),this._inputs[E][C]=f,this._onDeviceConnected(E,C)}},b.prototype._unregisterDevice=function(E,C){this._inputs[E][C]&&(delete this._inputs[E][C],this._onDeviceDisconnected(E,C))},b.prototype._handleKeyActions=function(){var E=this;this._keyboardDownEvent=function(C){E._keyboardActive||(E._keyboardActive=!0,E._registerDevice(n.bq.Keyboard,0,255));var T=E._inputs[n.bq.Keyboard][0];if(T){T[C.keyCode]=1;var f=C;f.inputIndex=C.keyCode,E._usingMacOS&&C.metaKey&&C.key!=="Meta"&&(E._metaKeys.includes(C.keyCode)||E._metaKeys.push(C.keyCode)),E._onInputChanged(n.bq.Keyboard,0,f)}},this._keyboardUpEvent=function(C){E._keyboardActive||(E._keyboardActive=!0,E._registerDevice(n.bq.Keyboard,0,255));var T=E._inputs[n.bq.Keyboard][0];if(T){T[C.keyCode]=0;var f=C;if(f.inputIndex=C.keyCode,E._usingMacOS&&C.key==="Meta"&&E._metaKeys.length>0){for(var g=0,S=E._metaKeys;g<S.length;g++){var y=S[g],x=s.CreateDeviceEvent(n.bq.Keyboard,0,y,0,E,E._elementToAttachTo);T[y]=0,E._onInputChanged(n.bq.Keyboard,0,x)}E._metaKeys.splice(0,E._metaKeys.length)}E._onInputChanged(n.bq.Keyboard,0,f)}},this._keyboardBlurEvent=function(){if(E._keyboardActive){for(var C=E._inputs[n.bq.Keyboard][0],T=0;T<C.length;T++)if(C[T]!==0){C[T]=0;var f=s.CreateDeviceEvent(n.bq.Keyboard,0,T,0,E,E._elementToAttachTo);E._onInputChanged(n.bq.Keyboard,0,f)}E._usingMacOS&&E._metaKeys.splice(0,E._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)},b.prototype._handlePointerActions=function(){var E=this;this._maxTouchPoints=(0,c.XD)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(var C=0;C<this._maxTouchPoints;C++)this._activeTouchIds[C]=-1;this._pointerMoveEvent=function(S){var y=E._getPointerType(S),x=y===n.bq.Mouse?0:E._activeTouchIds.indexOf(S.pointerId);if(y===n.bq.Touch&&x===-1){var R=E._activeTouchIds.indexOf(-1);if(!(R>=0))return void u.S0.Warn("Max number of touches exceeded.  Ignoring touches in excess of ".concat(E._maxTouchPoints));x=R,E._activeTouchIds[R]=S.pointerId,E._onDeviceConnected(y,x)}E._inputs[y]||(E._inputs[y]={}),E._inputs[y][x]||E._addPointerDevice(y,x,S.clientX,S.clientY);var I=E._inputs[y][x];if(I){var M=S;M.inputIndex=n.ST.Move,I[n.ST.Horizontal]=S.clientX,I[n.ST.Vertical]=S.clientY,y===n.bq.Touch&&I[n.ST.LeftClick]===0&&(I[n.ST.LeftClick]=1),S.pointerId===void 0&&(S.pointerId=E._mouseId),E._onInputChanged(y,x,M),E._usingSafari||S.button===-1||(M.inputIndex=S.button+2,I[S.button+2]=I[S.button+2]?0:1,E._onInputChanged(y,x,M))}},this._pointerDownEvent=function(S){var y=E._getPointerType(S),x=y===n.bq.Mouse?0:S.pointerId;if(y===n.bq.Touch){var R=E._activeTouchIds.indexOf(S.pointerId);if(R===-1&&(R=E._activeTouchIds.indexOf(-1)),!(R>=0))return void u.S0.Warn("Max number of touches exceeded.  Ignoring touches in excess of ".concat(E._maxTouchPoints));x=R,E._activeTouchIds[R]=S.pointerId}E._inputs[y]||(E._inputs[y]={}),E._inputs[y][x]?y===n.bq.Touch&&E._onDeviceConnected(y,x):E._addPointerDevice(y,x,S.clientX,S.clientY);var I=E._inputs[y][x];if(I){var M=I[n.ST.Horizontal],D=I[n.ST.Vertical];if(y===n.bq.Mouse){if(S.pointerId===void 0&&(S.pointerId=E._mouseId),!document.pointerLockElement)try{E._elementToAttachTo.setPointerCapture(E._mouseId)}catch{}}else if(S.pointerId&&!document.pointerLockElement)try{E._elementToAttachTo.setPointerCapture(S.pointerId)}catch{}I[n.ST.Horizontal]=S.clientX,I[n.ST.Vertical]=S.clientY,I[S.button+2]=1;var B=S;B.inputIndex=S.button+2,E._onInputChanged(y,x,B),M===S.clientX&&D===S.clientY||(B.inputIndex=n.ST.Move,E._onInputChanged(y,x,B))}},this._pointerUpEvent=function(S){var y,x,R,I,M,D=E._getPointerType(S),B=D===n.bq.Mouse?0:E._activeTouchIds.indexOf(S.pointerId);if(D===n.bq.Touch){if(B===-1)return;E._activeTouchIds[B]=-1}var F=(y=E._inputs[D])===null||y===void 0?void 0:y[B];if(F&&F[S.button+2]!==0){var X=F[n.ST.Horizontal],$=F[n.ST.Vertical];F[n.ST.Horizontal]=S.clientX,F[n.ST.Vertical]=S.clientY,F[S.button+2]=0;var Q=S;S.pointerId===void 0&&(S.pointerId=E._mouseId),X===S.clientX&&$===S.clientY||(Q.inputIndex=n.ST.Move,E._onInputChanged(D,B,Q)),Q.inputIndex=S.button+2,D===n.bq.Mouse&&E._mouseId>=0&&(!((R=(x=E._elementToAttachTo).hasPointerCapture)===null||R===void 0)&&R.call(x,E._mouseId))?E._elementToAttachTo.releasePointerCapture(E._mouseId):S.pointerId&&(!((M=(I=E._elementToAttachTo).hasPointerCapture)===null||M===void 0)&&M.call(I,S.pointerId))&&E._elementToAttachTo.releasePointerCapture(S.pointerId),E._onInputChanged(D,B,Q),D===n.bq.Touch&&E._onDeviceDisconnected(D,B)}},this._pointerCancelEvent=function(S){var y,x,R,I;if(S.pointerType==="mouse"){var M=E._inputs[n.bq.Mouse][0];E._mouseId>=0&&(!((x=(y=E._elementToAttachTo).hasPointerCapture)===null||x===void 0)&&x.call(y,E._mouseId))&&E._elementToAttachTo.releasePointerCapture(E._mouseId);for(var D=n.ST.LeftClick;D<=n.ST.BrowserForward;D++)if(M[D]===1){M[D]=0;var B=s.CreateDeviceEvent(n.bq.Mouse,0,D,0,E,E._elementToAttachTo);E._onInputChanged(n.bq.Mouse,0,B)}}else{var F=E._activeTouchIds.indexOf(S.pointerId);if(F===-1)return;!((I=(R=E._elementToAttachTo).hasPointerCapture)===null||I===void 0)&&I.call(R,S.pointerId)&&E._elementToAttachTo.releasePointerCapture(S.pointerId),E._inputs[n.bq.Touch][F][n.ST.LeftClick]=0,B=s.CreateDeviceEvent(n.bq.Touch,F,n.ST.LeftClick,0,E,E._elementToAttachTo,S.pointerId),E._onInputChanged(n.bq.Touch,F,B),E._activeTouchIds[F]=-1,E._onDeviceDisconnected(n.bq.Touch,F)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";var T=!1,f=function(){};try{var g=Object.defineProperty({},"passive",{get:function(){T=!0}});this._elementToAttachTo.addEventListener("test",f,g),this._elementToAttachTo.removeEventListener("test",f,g)}catch{}this._pointerBlurEvent=function(){var S,y,x,R,I;if(E.isDeviceAvailable(n.bq.Mouse)){var M=E._inputs[n.bq.Mouse][0];E._mouseId>=0&&(!((y=(S=E._elementToAttachTo).hasPointerCapture)===null||y===void 0)&&y.call(S,E._mouseId))&&E._elementToAttachTo.releasePointerCapture(E._mouseId);for(var D=n.ST.LeftClick;D<=n.ST.BrowserForward;D++)if(M[D]===1){M[D]=0;var B=s.CreateDeviceEvent(n.bq.Mouse,0,D,0,E,E._elementToAttachTo);E._onInputChanged(n.bq.Mouse,0,B)}}if(E.isDeviceAvailable(n.bq.Touch)){M=E._inputs[n.bq.Touch];for(var F=0;F<E._activeTouchIds.length;F++){var X=E._activeTouchIds[F];!((R=(x=E._elementToAttachTo).hasPointerCapture)===null||R===void 0)&&R.call(x,X)&&E._elementToAttachTo.releasePointerCapture(X),X!==-1&&((I=M[F])===null||I===void 0?void 0:I[n.ST.LeftClick])===1&&(M[F][n.ST.LeftClick]=0,B=s.CreateDeviceEvent(n.bq.Touch,F,n.ST.LeftClick,0,E,E._elementToAttachTo,X),E._onInputChanged(n.bq.Touch,F,B),E._activeTouchIds[F]=-1,E._onDeviceDisconnected(n.bq.Touch,F))}}},this._pointerWheelEvent=function(S){var y=n.bq.Mouse;E._inputs[y]||(E._inputs[y]=[]),E._inputs[y][0]||(E._pointerActive=!0,E._registerDevice(y,0,d));var x=E._inputs[y][0];if(x){x[n.ST.MouseWheelX]=S.deltaX||0,x[n.ST.MouseWheelY]=S.deltaY||S.wheelDelta||0,x[n.ST.MouseWheelZ]=S.deltaZ||0;var R=S;S.pointerId===void 0&&(S.pointerId=E._mouseId),x[n.ST.MouseWheelX]!==0&&(R.inputIndex=n.ST.MouseWheelX,E._onInputChanged(y,0,R)),x[n.ST.MouseWheelY]!==0&&(R.inputIndex=n.ST.MouseWheelY,E._onInputChanged(y,0,R)),x[n.ST.MouseWheelZ]!==0&&(R.inputIndex=n.ST.MouseWheelZ,E._onInputChanged(y,0,R))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=function(S){S.buttons>1&&E._pointerCancelEvent(S)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!T&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add(function(){if(E.isDeviceAvailable(n.bq.Mouse)){var S=E._inputs[n.bq.Mouse][0];S[n.ST.MouseWheelX]=0,S[n.ST.MouseWheelY]=0,S[n.ST.MouseWheelZ]=0}})},b.prototype._handleGamepadActions=function(){var E=this;this._gamepadConnectedEvent=function(C){E._addGamePad(C.gamepad)},this._gamepadDisconnectedEvent=function(C){if(E._gamepads){var T=E._getGamepadDeviceType(C.gamepad.id),f=C.gamepad.index;E._unregisterDevice(T,f),delete E._gamepads[f]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},b.prototype._updateDevice=function(E,C,T){var f=navigator.getGamepads()[C];if(f&&E===this._gamepads[C]){var g=this._inputs[E][C];T>=f.buttons.length?g[T]=f.axes[T-f.buttons.length].valueOf():g[T]=f.buttons[T].value}},b.prototype._getGamepadDeviceType=function(E){return E.indexOf("054c")!==-1?E.indexOf("0ce6")!==-1?n.bq.DualSense:n.bq.DualShock:E.indexOf("Xbox One")!==-1||E.search("Xbox 360")!==-1||E.search("xinput")!==-1?n.bq.Xbox:E.indexOf("057e")!==-1?n.bq.Switch:n.bq.Generic},b.prototype._getPointerType=function(E){var C=n.bq.Mouse;return(E.pointerType==="touch"||E.pointerType==="pen"||E.touches)&&(C=n.bq.Touch),C},b}(),p=e(84163),m=function(){function b(E){var C=this;this._registeredManagers=new Array,this._refCount=0,this.registerManager=function(y){for(var x=0;x<C._devices.length;x++){var R=C._devices[x];for(var I in R){var M=+I;y._addDevice(new p.c(C._deviceInputSystem,x,M))}}C._registeredManagers.push(y)},this.unregisterManager=function(y){var x=C._registeredManagers.indexOf(y);x>-1&&C._registeredManagers.splice(x,1)};var T=Object.keys(n.bq).length/2;this._devices=new Array(T);var f=function(y,x){C._devices[y]||(C._devices[y]=new Array),C._devices[y][x]||(C._devices[y][x]=x);for(var R=0,I=C._registeredManagers;R<I.length;R++){var M=I[R],D=new p.c(C._deviceInputSystem,y,x);M._addDevice(D)}},g=function(y,x){var R;!((R=C._devices[y])===null||R===void 0)&&R[x]&&delete C._devices[y][x];for(var I=0,M=C._registeredManagers;I<M.length;I++)M[I]._removeDevice(y,x)},S=function(y,x,R){if(R)for(var I=0,M=C._registeredManagers;I<M.length;I++)M[I]._onInputChanged(y,x,R)};typeof _native<"u"?this._deviceInputSystem=new l(f,g,S):this._deviceInputSystem=new h(E,f,g,S)}return b.prototype.dispose=function(){this._deviceInputSystem.dispose()},b}(),v=function(){function b(E){var C=this,T=Object.keys(n.bq).length/2;this._devices=new Array(T),this._firstDevice=new Array(T),this._engine=E,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new m(E)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new i.cP(function(f){for(var g=0,S=C._devices;g<S.length;g++){var y=S[g];if(y)for(var x=0,R=y;x<R.length;x++){var I=R[x];I&&C.onDeviceConnectedObservable.notifyObserver(f,I)}}}),this.onDeviceDisconnectedObservable=new i.cP,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=E.onDisposeObservable.add(function(){C.dispose()})}return b.prototype.getDeviceSource=function(E,C){if(C===void 0){if(this._firstDevice[E]===void 0)return null;C=this._firstDevice[E]}return this._devices[E]&&this._devices[E][C]!==void 0?this._devices[E][C]:null},b.prototype.getDeviceSources=function(E){return this._devices[E]?this._devices[E].filter(function(C){return!!C}):[]},b.prototype.dispose=function(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)},b.prototype._addDevice=function(E){this._devices[E.deviceType]||(this._devices[E.deviceType]=new Array),this._devices[E.deviceType][E.deviceSlot]||(this._devices[E.deviceType][E.deviceSlot]=E,this._updateFirstDevices(E.deviceType)),this.onDeviceConnectedObservable.notifyObservers(E)},b.prototype._removeDevice=function(E,C){var T,f,g=(T=this._devices[E])===null||T===void 0?void 0:T[C];this.onDeviceDisconnectedObservable.notifyObservers(g),!((f=this._devices[E])===null||f===void 0)&&f[C]&&delete this._devices[E][C],this._updateFirstDevices(E)},b.prototype._onInputChanged=function(E,C,T){var f,g;(g=(f=this._devices[E])===null||f===void 0?void 0:f[C])===null||g===void 0||g.onInputChangedObservable.notifyObservers(T)},b.prototype._updateFirstDevices=function(E){switch(E){case n.bq.Keyboard:case n.bq.Mouse:this._firstDevice[E]=0;break;case n.bq.Touch:case n.bq.DualSense:case n.bq.DualShock:case n.bq.Xbox:case n.bq.Switch:case n.bq.Generic:delete this._firstDevice[E];var C=this._devices[E];if(C){for(var T=0;T<C.length;T++)if(C[T]){this._firstDevice[E]=T;break}}}},b}()},19966:(r,t,e)=>{var n=e(19133),i=e(7164),o=e(17347),a=e(23885),s=e(82673),l=e(1235);s.$.prototype._partialLoadFile=function(c,u,d,h,p){p===void 0&&(p=null),this._loadFile(c,function(m){d[u]=m,d._internalCount++,d._internalCount===6&&h(d)},void 0,void 0,!0,function(m,v){p&&m&&p(m.status+" "+m.statusText,v)})},s.$.prototype._cascadeLoadFiles=function(c,u,d,h){h===void 0&&(h=null);var p=[];p._internalCount=0;for(var m=0;m<6;m++)this._partialLoadFile(d[m],m,p,u,h)},s.$.prototype._cascadeLoadImgs=function(c,u,d,h,p,m){p===void 0&&(p=null);var v=[];v._internalCount=0;for(var b=0;b<6;b++)this._partialLoadImg(h[b],b,v,c,u,d,p,m)},s.$.prototype._partialLoadImg=function(c,u,d,h,p,m,v,b){v===void 0&&(v=null);var E=(0,a.z)();(0,o.W$)(c,function(C){d[u]=C,d._internalCount++,h&&h.removePendingData(E),d._internalCount===6&&m&&m(p,d)},function(C,T){h&&h.removePendingData(E),v&&v(C,T)},h?h.offlineProvider:null,b),h&&h.addPendingData(E)},s.$.prototype.createCubeTextureBase=function(c,u,d,h,p,m,v,b,E,C,T,f,g,S,y,x){var R=this;p===void 0&&(p=null),m===void 0&&(m=null),b===void 0&&(b=null),E===void 0&&(E=!1),C===void 0&&(C=0),T===void 0&&(T=0),f===void 0&&(f=null),g===void 0&&(g=null),S===void 0&&(S=null),y===void 0&&(y=!1),x===void 0&&(x=null);var I=f||new n.h(this,7);I.isCube=!0,I.url=c,I.generateMipMaps=!h,I._lodGenerationScale=C,I._lodGenerationOffset=T,I._useSRGBBuffer=!!y&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!h),I!==f&&(I.label=c.substring(0,60)),this._doNotHandleContextLost||(I._extension=b,I._files=d,I._buffer=x);var M=c;this._transformTextureUrl&&!f&&(c=this._transformTextureUrl(c));var D=c.split("?")[0],B=D.lastIndexOf("."),F=b||(B>-1?D.substring(B).toLowerCase():""),X=(0,l.gT)(F),$=function(Q,ie){c===M?m&&Q&&m(Q.status+" "+Q.statusText,ie):(i.V.Warn("Failed to load ".concat(c,", falling back to the ").concat(M)),R.createCubeTextureBase(M,u,d,!!h,p,m,v,b,E,C,T,I,g,S,y,x))};if(X)X.then(function(Q){var ie=function(q){g&&g(I,q),Q.loadCubeData(q,I,E,p,m)};x?ie(x):d&&d.length===6?Q.supportCascades?R._cascadeLoadFiles(u,function(q){return ie(q.map(function(ee){return new Uint8Array(ee)}))},d,m):m?m("Textures type does not support cascades."):i.V.Warn("Texture loader does not support cascades."):R._loadFile(c,function(q){return ie(new Uint8Array(q))},void 0,void 0,!0,$)});else{if(!d||d.length===0)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(u,I,function(Q,ie){S&&S(Q,ie)},d,m)}return this._internalTexturesCache.push(I),I}},20833:(r,t,e)=>{e(82673).$.prototype.createDepthStencilTexture=function(n,i,o){if(i.isCube){var a=n.width||n;return this._createDepthStencilCubeTexture(a,i)}return this._createDepthStencilTexture(n,i,o)}},71974:(r,t,e)=>{var n=e(78322),i=e(96352),o=e(19133),a=e(7164),s=e(81152),l=e(87074);i.w.prototype._createDepthStencilCubeTexture=function(c,u){var d=new o.h(this,12);if(d.isCube=!0,this.webGLVersion===1)return a.V.Error("Depth cube texture is not supported by WebGL 1."),d;var h=(0,n.Cl)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},u),p=this._gl;this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,d,!0),this._setupDepthStencilTexture(d,c,h.bilinearFiltering,h.comparisonFunction);for(var m=0;m<6;m++)h.generateStencil?p.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,p.DEPTH24_STENCIL8,c,c,0,p.DEPTH_STENCIL,p.UNSIGNED_INT_24_8,null):p.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,p.DEPTH_COMPONENT24,c,c,0,p.DEPTH_COMPONENT,p.UNSIGNED_INT,null);return this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(d),d},i.w.prototype._setCubeMapTextureParams=function(c,u,d){var h=this._gl;h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,u?h.LINEAR_MIPMAP_LINEAR:h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),c.samplingMode=u?s.Y.TEXTURE_TRILINEAR_SAMPLINGMODE:s.Y.TEXTURE_LINEAR_LINEAR,u&&this.getCaps().textureMaxLevel&&d!==void 0&&d>0&&(h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAX_LEVEL,d),c._maxLodLevel=d),this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,null)},i.w.prototype.createCubeTexture=function(c,u,d,h,p,m,v,b,E,C,T,f,g,S,y){var x=this;p===void 0&&(p=null),m===void 0&&(m=null),b===void 0&&(b=null),E===void 0&&(E=!1),C===void 0&&(C=0),T===void 0&&(T=0),f===void 0&&(f=null),S===void 0&&(S=!1),y===void 0&&(y=null);var R=this._gl;return this.createCubeTextureBase(c,u,d,!!h,p,m,v,b,E,C,T,f,function(I){return x._bindTextureDirectly(R.TEXTURE_CUBE_MAP,I,!0)},function(I,M){var D=x.needPOTTextures?(0,l.R)(M[0].width,x._caps.maxCubemapTextureSize):M[0].width,B=D,F=[R.TEXTURE_CUBE_MAP_POSITIVE_X,R.TEXTURE_CUBE_MAP_POSITIVE_Y,R.TEXTURE_CUBE_MAP_POSITIVE_Z,R.TEXTURE_CUBE_MAP_NEGATIVE_X,R.TEXTURE_CUBE_MAP_NEGATIVE_Y,R.TEXTURE_CUBE_MAP_NEGATIVE_Z];x._bindTextureDirectly(R.TEXTURE_CUBE_MAP,I,!0),x._unpackFlipY(!1);var X=v?x._getInternalFormat(v,I._useSRGBBuffer):I._useSRGBBuffer?x._glSRGBExtensionValues.SRGB8_ALPHA8:R.RGBA,$=v?x._getInternalFormat(v):R.RGBA;I._useSRGBBuffer&&x.webGLVersion===1&&($=X);for(var Q=0;Q<F.length;Q++)if(M[Q].width!==D||M[Q].height!==B){if(x._prepareWorkingCanvas(),!x._workingCanvas||!x._workingContext)return void a.V.Warn("Cannot create canvas to resize texture.");x._workingCanvas.width=D,x._workingCanvas.height=B,x._workingContext.drawImage(M[Q],0,0,M[Q].width,M[Q].height,0,0,D,B),R.texImage2D(F[Q],0,X,$,R.UNSIGNED_BYTE,x._workingCanvas)}else R.texImage2D(F[Q],0,X,$,R.UNSIGNED_BYTE,M[Q]);h||R.generateMipmap(R.TEXTURE_CUBE_MAP),x._setCubeMapTextureParams(I,!h),I.width=D,I.height=B,I.isReady=!0,v&&(I.format=v),I.onLoadedObservable.notifyObservers(I),I.onLoadedObservable.clear(),p&&p()},!!S,y)},i.w.prototype.generateMipMapsForCubemap=function(c,u){if(u===void 0&&(u=!0),c.generateMipMaps){var d=this._gl;this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,c,!0),d.generateMipmap(d.TEXTURE_CUBE_MAP),u&&this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null)}}},82345:(r,t,e)=>{e.d(t,{k:()=>o});var n=e(96352),i=e(81152);function o(a,s,l,c){switch(l===void 0&&(l=!1),a){case i.Y.TEXTURETYPE_BYTE:var u=new Int8Array(s);return c&&u.set(new Int8Array(c)),u;case i.Y.TEXTURETYPE_UNSIGNED_BYTE:var d=new Uint8Array(s);return c&&d.set(new Uint8Array(c)),d;case i.Y.TEXTURETYPE_SHORT:var h=s instanceof ArrayBuffer?new Int16Array(s):new Int16Array(l?s/2:s);return c&&h.set(new Int16Array(c)),h;case i.Y.TEXTURETYPE_UNSIGNED_SHORT:case i.Y.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:case i.Y.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:case i.Y.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:case i.Y.TEXTURETYPE_HALF_FLOAT:var p=s instanceof ArrayBuffer?new Uint16Array(s):new Uint16Array(l?s/2:s);return c&&p.set(new Uint16Array(c)),p;case i.Y.TEXTURETYPE_INT:var m=s instanceof ArrayBuffer?new Int32Array(s):new Int32Array(l?s/4:s);return c&&m.set(new Int32Array(c)),m;case i.Y.TEXTURETYPE_UNSIGNED_INTEGER:case i.Y.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:case i.Y.TEXTURETYPE_UNSIGNED_INT_24_8:case i.Y.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:case i.Y.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:case i.Y.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:var v=s instanceof ArrayBuffer?new Uint32Array(s):new Uint32Array(l?s/4:s);return c&&v.set(new Uint32Array(c)),v;case i.Y.TEXTURETYPE_FLOAT:var b=s instanceof ArrayBuffer?new Float32Array(s):new Float32Array(l?s/4:s);return c&&b.set(new Float32Array(c)),b}var E=new Uint8Array(s);return c&&E.set(new Uint8Array(c)),E}n.w.prototype._readTexturePixelsSync=function(a,s,l,c,u,d,h,p,m,v){var b,E;c===void 0&&(c=-1),u===void 0&&(u=0),d===void 0&&(d=null),h===void 0&&(h=!0),p===void 0&&(p=!1),m===void 0&&(m=0),v===void 0&&(v=0);var C=this._gl;if(!C)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var T=C.createFramebuffer();if(!T)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=T}C.bindFramebuffer(C.FRAMEBUFFER,this._dummyFramebuffer),c>-1?C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+c,(b=a._hardwareTexture)===null||b===void 0?void 0:b.underlyingResource,u):C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_2D,(E=a._hardwareTexture)===null||E===void 0?void 0:E.underlyingResource,u);var f=a.type!==void 0?this._getWebGLTextureType(a.type):C.UNSIGNED_BYTE;return p?d||(d=o(a.type,4*s*l)):f===C.UNSIGNED_BYTE?(d||(d=new Uint8Array(4*s*l)),f=C.UNSIGNED_BYTE):(d||(d=new Float32Array(4*s*l)),f=C.FLOAT),h&&this.flushFramebuffer(),C.readPixels(m,v,s,l,C.RGBA,f,d),C.bindFramebuffer(C.FRAMEBUFFER,this._currentFramebuffer),d},n.w.prototype._readTexturePixels=function(a,s,l,c,u,d,h,p,m,v){return c===void 0&&(c=-1),u===void 0&&(u=0),d===void 0&&(d=null),h===void 0&&(h=!0),p===void 0&&(p=!1),m===void 0&&(m=0),v===void 0&&(v=0),Promise.resolve(this._readTexturePixelsSync(a,s,l,c,u,d,h,p,m,v))}},71073:(r,t,e)=>{var n=e(78322),i=e(19133),o=e(7164),a=e(96352),s=e(81152),l=function(c){function u(d,h,p,m,v){var b=c.call(this,d,h,p,m)||this;return b._framebuffer=null,b._depthStencilBuffer=null,b._MSAAFramebuffer=null,b._colorTextureArray=null,b._depthStencilTextureArray=null,b._disposeOnlyFramebuffers=!1,b._currentLOD=0,b._context=v,b}return(0,n.C6)(u,c),u.prototype._cloneRenderTargetWrapper=function(){var d=null;return this._colorTextureArray&&this._depthStencilTextureArray?(d=this._engine.createMultiviewRenderTargetTexture(this.width,this.height)).texture.isReady=!0:d=c.prototype._cloneRenderTargetWrapper.call(this),d},u.prototype._swapRenderTargetWrapper=function(d){c.prototype._swapRenderTargetWrapper.call(this,d),d._framebuffer=this._framebuffer,d._depthStencilBuffer=this._depthStencilBuffer,d._MSAAFramebuffer=this._MSAAFramebuffer,d._colorTextureArray=this._colorTextureArray,d._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null},u.prototype.createDepthStencilTexture=function(d,h,p,m,v,b){if(d===void 0&&(d=0),h===void 0&&(h=!0),p===void 0&&(p=!1),m===void 0&&(m=1),v===void 0&&(v=s.Y.TEXTUREFORMAT_DEPTH32_FLOAT),this._depthStencilBuffer){var E=this._engine,C=E._currentFramebuffer,T=this._context;E._bindUnboundFramebuffer(this._framebuffer),T.framebufferRenderbuffer(T.FRAMEBUFFER,T.DEPTH_STENCIL_ATTACHMENT,T.RENDERBUFFER,null),T.framebufferRenderbuffer(T.FRAMEBUFFER,T.DEPTH_ATTACHMENT,T.RENDERBUFFER,null),T.framebufferRenderbuffer(T.FRAMEBUFFER,T.STENCIL_ATTACHMENT,T.RENDERBUFFER,null),E._bindUnboundFramebuffer(C),T.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return c.prototype.createDepthStencilTexture.call(this,d,h,p,m,v,b)},u.prototype.shareDepth=function(d){c.prototype.shareDepth.call(this,d);var h=this._context,p=this._depthStencilBuffer,m=d._MSAAFramebuffer||d._framebuffer,v=this._engine;d._depthStencilBuffer&&d._depthStencilBuffer!==p&&h.deleteRenderbuffer(d._depthStencilBuffer),d._depthStencilBuffer=p;var b=d._generateStencilBuffer?h.DEPTH_STENCIL_ATTACHMENT:h.DEPTH_ATTACHMENT;v._bindUnboundFramebuffer(m),h.framebufferRenderbuffer(h.FRAMEBUFFER,b,h.RENDERBUFFER,p),v._bindUnboundFramebuffer(null)},u.prototype._bindTextureRenderTarget=function(d,h,p,m){var v,b,E,C;if(h===void 0&&(h=0),m===void 0&&(m=0),d._hardwareTexture){var T=this._framebuffer,f=this._engine,g=f._currentFramebuffer;if(f._bindUnboundFramebuffer(T),f.webGLVersion>1){var S=(y=this._context)["COLOR_ATTACHMENT"+h];d.is2DArray||d.is3D?(p=(b=p??((v=this.layerIndices)===null||v===void 0?void 0:v[h]))!==null&&b!==void 0?b:0,y.framebufferTextureLayer(y.FRAMEBUFFER,S,d._hardwareTexture.underlyingResource,m,p)):d.isCube?(p=(C=p??((E=this.faceIndices)===null||E===void 0?void 0:E[h]))!==null&&C!==void 0?C:0,y.framebufferTexture2D(y.FRAMEBUFFER,S,y.TEXTURE_CUBE_MAP_POSITIVE_X+p,d._hardwareTexture.underlyingResource,m)):y.framebufferTexture2D(y.FRAMEBUFFER,S,y.TEXTURE_2D,d._hardwareTexture.underlyingResource,m)}else{S=(y=this._context)["COLOR_ATTACHMENT"+h+"_WEBGL"];var y,x=p!==void 0?y.TEXTURE_CUBE_MAP_POSITIVE_X+p:y.TEXTURE_2D;y.framebufferTexture2D(y.FRAMEBUFFER,S,x,d._hardwareTexture.underlyingResource,m)}f._bindUnboundFramebuffer(g)}},u.prototype.setTexture=function(d,h,p){h===void 0&&(h=0),p===void 0&&(p=!0),c.prototype.setTexture.call(this,d,h,p),this._bindTextureRenderTarget(d,h)},u.prototype.setLayerAndFaceIndices=function(d,h){var p,m;if(c.prototype.setLayerAndFaceIndices.call(this,d,h),this.textures&&this.layerIndices&&this.faceIndices)for(var v=(m=(p=this._attachments)===null||p===void 0?void 0:p.length)!==null&&m!==void 0?m:this.textures.length,b=0;b<v;b++){var E=this.textures[b];E&&(E.is2DArray||E.is3D?this._bindTextureRenderTarget(E,b,this.layerIndices[b]):E.isCube?this._bindTextureRenderTarget(E,b,this.faceIndices[b]):this._bindTextureRenderTarget(E,b))}},u.prototype.setLayerAndFaceIndex=function(d,h,p){if(d===void 0&&(d=0),c.prototype.setLayerAndFaceIndex.call(this,d,h,p),this.textures&&this.layerIndices&&this.faceIndices){var m=this.textures[d];m.is2DArray||m.is3D?this._bindTextureRenderTarget(this.textures[d],d,this.layerIndices[d]):m.isCube&&this._bindTextureRenderTarget(this.textures[d],d,this.faceIndices[d])}},u.prototype.dispose=function(d){d===void 0&&(d=this._disposeOnlyFramebuffers);var h=this._context;d||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(h.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(h.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(h.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),c.prototype.dispose.call(this,d)},u}(e(96925).v);e(20833),a.w.prototype._createHardwareRenderTargetWrapper=function(c,u,d){var h=new l(c,u,d,this,this._gl);return this._renderTargetWrapperCache.push(h),h},a.w.prototype.createRenderTargetTexture=function(c,u){var d,h,p=this._createHardwareRenderTargetWrapper(!1,!1,c),m=!0,v=!1,b=!1,E=void 0,C=1,T=void 0;u!==void 0&&typeof u=="object"&&(m=(d=u.generateDepthBuffer)===null||d===void 0||d,v=!!u.generateStencilBuffer,b=!!u.noColorAttachment,E=u.colorAttachment,C=(h=u.samples)!==null&&h!==void 0?h:1,T=u.label);var f=E||(b?null:this._createInternalTexture(c,u,!0,5)),g=c.width||c,S=c.height||c,y=this._currentFramebuffer,x=this._gl,R=x.createFramebuffer();return this._bindUnboundFramebuffer(R),p._depthStencilBuffer=this._setupFramebufferDepthAttachments(v,m,g,S),!f||f.is2DArray||f.is3D||x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,f._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(y),p.label=T??"RenderTargetWrapper",p._framebuffer=R,p._generateDepthBuffer=m,p._generateStencilBuffer=v,p.setTextures(f),this.updateRenderTargetTextureSampleCount(p,C),p},a.w.prototype._createDepthStencilTexture=function(c,u,d){var h,p=this._gl,m=c.layers||0,v=c.depth||0,b=p.TEXTURE_2D;m!==0?b=p.TEXTURE_2D_ARRAY:v!==0&&(b=p.TEXTURE_3D);var E=new i.h(this,12);if(E.label=u.label,!this._caps.depthTextureExtension)return o.V.Error("Depth texture is not supported by your browser or hardware."),E;var C=(0,n.Cl)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},u);if(this._bindTextureDirectly(b,E,!0),this._setupDepthStencilTexture(E,c,C.comparisonFunction!==0&&C.bilinearFiltering,C.comparisonFunction,C.samples),C.depthTextureFormat!==void 0){if(C.depthTextureFormat!==s.Y.TEXTUREFORMAT_DEPTH16&&C.depthTextureFormat!==s.Y.TEXTUREFORMAT_DEPTH24&&C.depthTextureFormat!==s.Y.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8&&C.depthTextureFormat!==s.Y.TEXTUREFORMAT_DEPTH24_STENCIL8&&C.depthTextureFormat!==s.Y.TEXTUREFORMAT_DEPTH32_FLOAT&&C.depthTextureFormat!==s.Y.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8)return o.V.Error("Depth texture ".concat(C.depthTextureFormat," format is not supported.")),E;E.format=C.depthTextureFormat}else E.format=C.generateStencil?s.Y.TEXTUREFORMAT_DEPTH24_STENCIL8:s.Y.TEXTUREFORMAT_DEPTH24;var T=E.format===s.Y.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8||E.format===s.Y.TEXTUREFORMAT_DEPTH24_STENCIL8||E.format===s.Y.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8,f=p.UNSIGNED_INT;E.format===s.Y.TEXTUREFORMAT_DEPTH16?f=p.UNSIGNED_SHORT:E.format===s.Y.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8||E.format===s.Y.TEXTUREFORMAT_DEPTH24_STENCIL8?f=p.UNSIGNED_INT_24_8:E.format===s.Y.TEXTUREFORMAT_DEPTH32_FLOAT?f=p.FLOAT:E.format===s.Y.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8&&(f=p.FLOAT_32_UNSIGNED_INT_24_8_REV);var g=T?p.DEPTH_STENCIL:p.DEPTH_COMPONENT,S=this._getInternalFormatFromDepthTextureFormat(E.format,!0,T);return E.is2DArray?p.texImage3D(b,0,S,E.width,E.height,m,0,g,f,null):E.is3D?p.texImage3D(b,0,S,E.width,E.height,v,0,g,f,null):p.texImage2D(b,0,S,E.width,E.height,0,g,f,null),this._bindTextureDirectly(b,null),this._internalTexturesCache.push(E),d._depthStencilBuffer&&(p.deleteRenderbuffer(d._depthStencilBuffer),d._depthStencilBuffer=null),this._bindUnboundFramebuffer((h=d._MSAAFramebuffer)!==null&&h!==void 0?h:d._framebuffer),d._generateStencilBuffer=T,d._depthStencilTextureWithStencil=T,d._depthStencilBuffer=this._setupFramebufferDepthAttachments(d._generateStencilBuffer,d._generateDepthBuffer,d.width,d.height,d.samples,E.format),this._bindUnboundFramebuffer(null),E},a.w.prototype.updateRenderTargetTextureSampleCount=function(c,u){var d,h;if(this.webGLVersion<2||!c)return 1;if(c.samples===u)return u;var p=this._gl;u=Math.min(u,this.getCaps().maxMSAASamples),c._depthStencilBuffer&&(p.deleteRenderbuffer(c._depthStencilBuffer),c._depthStencilBuffer=null),c._MSAAFramebuffer&&(p.deleteFramebuffer(c._MSAAFramebuffer),c._MSAAFramebuffer=null);var m=(d=c.texture)===null||d===void 0?void 0:d._hardwareTexture;m?.releaseMSAARenderBuffers();var v=p.createFramebuffer();if(!v)throw new Error("Unable to create multi sampled framebuffer");if(c._MSAAFramebuffer=v,c.texture&&u>1&&typeof p.renderbufferStorageMultisample=="function"){this._bindUnboundFramebuffer(c._MSAAFramebuffer);var b=this._createRenderBuffer(c.texture.width,c.texture.height,u,-1,this._getRGBABufferInternalSizedFormat(c.texture.type,c.texture.format,c.texture._useSRGBBuffer),p.COLOR_ATTACHMENT0,!1);if(!b)throw new Error("Unable to create multi sampled framebuffer");m?.addMSAARenderBuffer(b)}this._bindUnboundFramebuffer((h=c._MSAAFramebuffer)!==null&&h!==void 0?h:c._framebuffer),c.texture&&(c.texture.samples=u),c._samples=u;var E=c._depthStencilTexture?c._depthStencilTexture.format:void 0;return c._depthStencilBuffer=this._setupFramebufferDepthAttachments(c._generateStencilBuffer,c._generateDepthBuffer,c.width,c.height,u,E),this._bindUnboundFramebuffer(null),u},a.w.prototype._setupDepthStencilTexture=function(c,u,d,h,p){p===void 0&&(p=1);var m=u.width||u,v=u.height||u,b=u.layers||0,E=u.depth||0;c.baseWidth=m,c.baseHeight=v,c.width=m,c.height=v,c.is2DArray=b>0,c.depth=b||E,c.isReady=!0,c.samples=p,c.generateMipMaps=!1,c.samplingMode=d?s.Y.TEXTURE_BILINEAR_SAMPLINGMODE:s.Y.TEXTURE_NEAREST_SAMPLINGMODE,c.type=s.Y.TEXTURETYPE_UNSIGNED_INT,c._comparisonFunction=h;var C=this._gl,T=this._getTextureTarget(c),f=this._getSamplingParameters(c.samplingMode,!1);C.texParameteri(T,C.TEXTURE_MAG_FILTER,f.mag),C.texParameteri(T,C.TEXTURE_MIN_FILTER,f.min),C.texParameteri(T,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(T,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),this.webGLVersion>1&&(h===0?(C.texParameteri(T,C.TEXTURE_COMPARE_FUNC,s.Y.LEQUAL),C.texParameteri(T,C.TEXTURE_COMPARE_MODE,C.NONE)):(C.texParameteri(T,C.TEXTURE_COMPARE_FUNC,h),C.texParameteri(T,C.TEXTURE_COMPARE_MODE,C.COMPARE_REF_TO_TEXTURE)))}},8864:(r,t,e)=>{var n=e(78322),i=e(19133),o=e(7164),a=e(81152);e(96352).w.prototype.createRenderTargetCubeTexture=function(s,l){var c=this._createHardwareRenderTargetWrapper(!1,!0,s),u=(0,n.Cl)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:a.Y.TEXTURETYPE_UNSIGNED_INT,samplingMode:a.Y.TEXTURE_TRILINEAR_SAMPLINGMODE,format:a.Y.TEXTUREFORMAT_RGBA},l);u.generateStencilBuffer=u.generateDepthBuffer&&u.generateStencilBuffer,(u.type!==a.Y.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(u.type!==a.Y.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(u.samplingMode=a.Y.TEXTURE_NEAREST_SAMPLINGMODE);var d=this._gl,h=new i.h(this,5);this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,h,!0);var p=this._getSamplingParameters(u.samplingMode,u.generateMipMaps);u.type!==a.Y.TEXTURETYPE_FLOAT||this._caps.textureFloat||(u.type=a.Y.TEXTURETYPE_UNSIGNED_INT,o.V.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,p.mag),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,p.min),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);for(var m=0;m<6;m++)d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+m,0,this._getRGBABufferInternalSizedFormat(u.type,u.format),s,s,0,this._getInternalFormat(u.format),this._getWebGLTextureType(u.type),null);var v=d.createFramebuffer();return this._bindUnboundFramebuffer(v),c._depthStencilBuffer=this._setupFramebufferDepthAttachments(u.generateStencilBuffer,u.generateDepthBuffer,s,s),u.generateMipMaps&&d.generateMipmap(d.TEXTURE_CUBE_MAP),this._bindTextureDirectly(d.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),c._framebuffer=v,c._generateDepthBuffer=u.generateDepthBuffer,c._generateStencilBuffer=u.generateStencilBuffer,h.width=s,h.height=s,h.isReady=!0,h.isCube=!0,h.samples=1,h.generateMipMaps=u.generateMipMaps,h.samplingMode=u.samplingMode,h.type=u.type,h.format=u.format,this._internalTexturesCache.push(h),c.setTextures(h),c}},64838:(r,t,e)=>{e(96352).w.prototype.setDepthStencilTexture=function(n,i,o,a){n!==void 0&&(i&&(this._boundUniforms[n]=i),o&&o.depthStencilTexture?this._setTexture(n,o,!1,!0,a):this._setTexture(n,null,void 0,void 0,a))}},59012:(r,t,e)=>{var n=e(96352),i=e(26218);n.w.prototype.createUniformBuffer=function(o,a){var s=this._gl.createBuffer();if(!s)throw new Error("Unable to create uniform buffer");var l=new i.A(s);return this.bindUniformBuffer(l),o instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,o,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(o),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),l.references=1,l},n.w.prototype.createDynamicUniformBuffer=function(o,a){var s=this._gl.createBuffer();if(!s)throw new Error("Unable to create dynamic uniform buffer");var l=new i.A(s);return this.bindUniformBuffer(l),o instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,o,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(o),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),l.references=1,l},n.w.prototype.updateUniformBuffer=function(o,a,s,l){this.bindUniformBuffer(o),s===void 0&&(s=0),l===void 0?a instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,s,a):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,s,new Float32Array(a)):a instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,a.subarray(s,s+l)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(a).subarray(s,s+l)),this.bindUniformBuffer(null)},n.w.prototype.bindUniformBuffer=function(o){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,o?o.underlyingResource:null)},n.w.prototype.bindUniformBufferBase=function(o,a,s){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,a,o?o.underlyingResource:null)},n.w.prototype.bindUniformBlock=function(o,a,s){var l=o.program,c=this._gl.getUniformBlockIndex(l,a);c!==4294967295&&this._gl.uniformBlockBinding(l,c,s)}},35930:(r,t,e)=>{e.d(t,{nO:()=>I,pB:()=>y,jC:()=>R,M0:()=>x,Iq:()=>Q,J:()=>ie});var n=function(){function q(){this.children=[]}return q.prototype.isValid=function(ee){return!0},q.prototype.process=function(ee,te){var ce,fe,de,Te,ue,U,N,w="";if(this.line){var k=this.line,J=te.processor;if(J){J.lineProcessor&&(k=J.lineProcessor(k,te.isFragment,te.processingContext));var le=(fe=(ce=te.processor)===null||ce===void 0?void 0:ce.attributeKeywordName)!==null&&fe!==void 0?fe:"attribute",be=te.isFragment&&(!((de=te.processor)===null||de===void 0)&&de.varyingFragmentKeywordName)?(Te=te.processor)===null||Te===void 0?void 0:Te.varyingFragmentKeywordName:!te.isFragment&&(!((ue=te.processor)===null||ue===void 0)&&ue.varyingVertexKeywordName)?(U=te.processor)===null||U===void 0?void 0:U.varyingVertexKeywordName:"varying";!te.isFragment&&J.attributeProcessor&&this.line.startsWith(le)?k=J.attributeProcessor(this.line,ee,te.processingContext):J.varyingProcessor&&(!((N=J.varyingCheck)===null||N===void 0)&&N.call(J,this.line,te.isFragment)||!J.varyingCheck&&this.line.startsWith(be))?k=J.varyingProcessor(this.line,te.isFragment,ee,te.processingContext):J.uniformProcessor&&J.uniformRegexp&&J.uniformRegexp.test(this.line)?te.lookForClosingBracketForUniformBuffer||(k=J.uniformProcessor(this.line,te.isFragment,ee,te.processingContext)):J.uniformBufferProcessor&&J.uniformBufferRegexp&&J.uniformBufferRegexp.test(this.line)?te.lookForClosingBracketForUniformBuffer||(k=J.uniformBufferProcessor(this.line,te.isFragment,te.processingContext),te.lookForClosingBracketForUniformBuffer=!0):J.textureProcessor&&J.textureRegexp&&J.textureRegexp.test(this.line)?k=J.textureProcessor(this.line,te.isFragment,ee,te.processingContext):(J.uniformProcessor||J.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!te.lookForClosingBracketForUniformBuffer&&(/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?J.uniformProcessor&&(k=J.uniformProcessor(this.line,te.isFragment,ee,te.processingContext)):J.uniformBufferProcessor&&(k=J.uniformBufferProcessor(this.line,te.isFragment,te.processingContext),te.lookForClosingBracketForUniformBuffer=!0)),te.lookForClosingBracketForUniformBuffer&&this.line.indexOf("}")!==-1&&(te.lookForClosingBracketForUniformBuffer=!1,J.endOfUniformBufferProcessor&&(k=J.endOfUniformBufferProcessor(this.line,te.isFragment,te.processingContext)))}w+=k+`
`}return this.children.forEach(function(ve){w+=ve.process(ee,te)}),this.additionalDefineKey&&(ee[this.additionalDefineKey]=this.additionalDefineValue||"true"),w},q}(),i=function(){function q(){this._lines=[]}return Object.defineProperty(q.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"lines",{set:function(ee){this._lines.length=0;for(var te=0,ce=ee;te<ce.length;te++){var fe=ce[te];if(fe&&fe!=="\r")if(fe[0]!=="#"){var de=fe.trim();if(de)if(de.startsWith("//"))this._lines.push(fe);else{var Te=de.indexOf(";");if(Te===-1)this._lines.push(de);else if(Te===de.length-1)de.length>1&&this._lines.push(de);else for(var ue=fe.split(";"),U=0;U<ue.length;U++){var N=ue[U];N&&(N=N.trim())&&this._lines.push(N+(U!==ue.length-1?";":""))}}}else this._lines.push(fe)}},enumerable:!1,configurable:!0}),q}(),o=e(78322),a=function(q){function ee(){return q!==null&&q.apply(this,arguments)||this}return(0,o.C6)(ee,q),ee.prototype.process=function(te,ce){for(var fe=0;fe<this.children.length;fe++){var de=this.children[fe];if(de.isValid(te))return de.process(te,ce)}return""},ee}(n),s=function(q){function ee(){return q!==null&&q.apply(this,arguments)||this}return(0,o.C6)(ee,q),ee.prototype.isValid=function(te){return this.testExpression.isTrue(te)},ee}(n),l=function(){function q(){}return q.prototype.isTrue=function(ee){return!0},q.postfixToInfix=function(ee){for(var te=[],ce=0,fe=ee;ce<fe.length;ce++){var de=fe[ce];if(q._OperatorPriority[de]===void 0)te.push(de);else{var Te=te[te.length-1],ue=te[te.length-2];te.length-=2,te.push("(".concat(ue).concat(de).concat(Te,")"))}}return te[te.length-1]},q.infixToPostfix=function(ee){var te=q._InfixToPostfixCache.get(ee);if(te)return te.accessTime=Date.now(),te.result;if(!(ee.includes("&&")||ee.includes("||")||ee.includes(")")||ee.includes("(")))return[ee];for(var ce=[],fe=-1,de=function(){(w=w.trim())!==""&&(ce.push(w),w="")},Te=function(le){fe<q._Stack.length-1&&(q._Stack[++fe]=le)},ue=function(){return q._Stack[fe]},U=function(){return fe===-1?"!!INVALID EXPRESSION!!":q._Stack[fe--]},N=0,w="";N<ee.length;){var k=ee.charAt(N),J=N<ee.length-1?ee.substring(N,2+N):"";if(k==="(")w="",Te(k);else if(k===")"){for(de();fe!==-1&&ue()!=="(";)ce.push(U());U()}else if(q._OperatorPriority[J]>1){for(de();fe!==-1&&q._OperatorPriority[ue()]>=q._OperatorPriority[J];)ce.push(U());Te(J),N++}else w+=k;N++}for(de();fe!==-1;)ue()==="("?U():ce.push(U());return q._InfixToPostfixCache.size>=q.InfixToPostfixCacheLimitSize&&q.ClearCache(),q._InfixToPostfixCache.set(ee,{result:ce,accessTime:Date.now()}),ce},q.ClearCache=function(){for(var ee=Array.from(q._InfixToPostfixCache.entries()).sort(function(ce,fe){return ce[1].accessTime-fe[1].accessTime}),te=0;te<q.InfixToPostfixCacheCleanupSize;te++)q._InfixToPostfixCache.delete(ee[te][0])},q.InfixToPostfixCacheLimitSize=5e4,q.InfixToPostfixCacheCleanupSize=25e3,q._InfixToPostfixCache=new Map,q._OperatorPriority={")":0,"(":1,"||":2,"&&":3},q._Stack=["","","","","","","","","","","","","","","","","","","",""],q}(),c=function(q){function ee(te,ce){ce===void 0&&(ce=!1);var fe=q.call(this)||this;return fe.define=te,fe.not=ce,fe}return(0,o.C6)(ee,q),ee.prototype.isTrue=function(te){var ce=te[this.define]!==void 0;return this.not&&(ce=!ce),ce},ee}(l),u=function(q){function ee(){return q!==null&&q.apply(this,arguments)||this}return(0,o.C6)(ee,q),ee.prototype.isTrue=function(te){return this.leftOperand.isTrue(te)||this.rightOperand.isTrue(te)},ee}(l),d=function(q){function ee(){return q!==null&&q.apply(this,arguments)||this}return(0,o.C6)(ee,q),ee.prototype.isTrue=function(te){return this.leftOperand.isTrue(te)&&this.rightOperand.isTrue(te)},ee}(l),h=function(q){function ee(te,ce,fe){var de=q.call(this)||this;return de.define=te,de.operand=ce,de.testValue=fe,de}return(0,o.C6)(ee,q),ee.prototype.isTrue=function(te){var ce=te[this.define];ce===void 0&&(ce=this.define);var fe=!1,de=parseInt(ce),Te=parseInt(this.testValue);switch(this.operand){case">":fe=de>Te;break;case"<":fe=de<Te;break;case"<=":fe=de<=Te;break;case">=":fe=de>=Te;break;case"==":fe=de===Te;break;case"!=":fe=de!==Te}return fe},ee}(l),p=e(41190),m=e(24894),v=/defined\s*?\((.+?)\)/g,b=/defined\s*?\[(.+?)\]/g,E=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,C=/__decl__/,T=/light\{X\}.(\w*)/g,f=/\{X\}/g,g=[],S=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function y(q){q.processor&&q.processor.initializeShaders&&q.processor.initializeShaders(q.processingContext)}function x(q,ee,te,ce){var fe;!((fe=ee.processor)===null||fe===void 0)&&fe.preProcessShaderCode&&(q=ee.processor.preProcessShaderCode(q,ee.isFragment)),Q(q,ee,function(de){ee.processCodeAfterIncludes&&(de=ee.processCodeAfterIncludes(ee.isFragment?"fragment":"vertex",de,ee.defines));var Te=function(ue,U,N){var w=function(le,be){var ve;if(!((ve=be.processor)===null||ve===void 0)&&ve.noPrecision)return le;var ye=be.shouldUseHighPrecisionShader;return le.indexOf("precision highp float")===-1?le=ye?`precision highp float;
`+le:`precision mediump float;
`+le:ye||(le=le.replace("precision highp float","precision mediump float")),le}(ue,U);if(!U.processor||U.processor.shaderLanguage===0&&w.indexOf("#version 3")!==-1&&(w=w.replace("#version 300 es",""),!U.processor.parseGLES3))return w;var k=U.defines,J=$(U,N);return U.processor.preProcessor&&(w=U.processor.preProcessor(w,k,J,U.isFragment,U.processingContext)),w=X(w,J,U),U.processor.postProcessor&&(w=U.processor.postProcessor(w,k,U.isFragment,U.processingContext,N?{drawBuffersExtensionDisabled:!N.getCaps().drawBuffersExtension}:{})),N?._features.needShaderCodeInlining&&(w=N.inlineShaderCode(w)),w}(de,ee,ce);te(Te,de)})}function R(q,ee,te,ce){var fe;!((fe=ee.processor)===null||fe===void 0)&&fe.preProcessShaderCode&&(q=ee.processor.preProcessShaderCode(q,ee.isFragment)),Q(q,ee,function(de){ee.processCodeAfterIncludes&&(de=ee.processCodeAfterIncludes(ee.isFragment?"fragment":"vertex",de,ee.defines));var Te=function(ue,U,N){var w,k,J=ue,le=U.defines,be=$(U,N);return!((w=U.processor)===null||w===void 0)&&w.preProcessor&&(J=U.processor.preProcessor(J,le,be,U.isFragment,U.processingContext)),J=X(J,be,U),!((k=U.processor)===null||k===void 0)&&k.postProcessor&&(J=U.processor.postProcessor(J,le,U.isFragment,U.processingContext,N?{drawBuffersExtensionDisabled:!N.getCaps().drawBuffersExtension}:{})),N._features.needShaderCodeInlining&&(J=N.inlineShaderCode(J)),J}(de,ee,ce);te(Te,de)})}function I(q,ee,te){return te.processor&&te.processor.finalizeShaders?te.processor.finalizeShaders(q,ee,te.processingContext):{vertexCode:q,fragmentCode:ee}}function M(q){var ee=/defined\((.+)\)/.exec(q);if(ee&&ee.length)return new c(ee[1].trim(),q[0]==="!");for(var te="",ce=0,fe=0,de=["==","!=",">=","<=","<",">"];fe<de.length&&(te=de[fe],!((ce=q.indexOf(te))>-1));fe++);if(ce===-1)return new c(q);var Te=q.substring(0,ce).trim(),ue=q.substring(ce+te.length).trim();return new h(Te,te,ue)}function D(q,ee){var te=new s,ce=q.substring(0,ee),fe=q.substring(ee);return fe=fe.substring(0,(fe.indexOf("//")+1||fe.length+1)-1).trim(),te.testExpression=ce==="#ifdef"?new c(fe):ce==="#ifndef"?new c(fe,!0):function(de){de=de.replace(v,"defined[$1]");for(var Te=[],ue=0,U=l.infixToPostfix(de);ue<U.length;ue++){var N=U[ue];if(N!=="||"&&N!=="&&")Te.push(N);else if(Te.length>=2){var w=Te[Te.length-1],k=Te[Te.length-2];Te.length-=2;var J=N=="&&"?new d:new u;typeof w=="string"&&(w=w.replace(b,"defined($1)")),typeof k=="string"&&(k=k.replace(b,"defined($1)")),J.leftOperand=typeof k=="string"?M(k):k,J.rightOperand=typeof w=="string"?M(w):w,Te.push(J)}}var le=Te[Te.length-1];return typeof le=="string"&&(le=le.replace(b,"defined($1)")),typeof le=="string"?M(le):le}(fe),te}function B(q,ee,te){for(var ce=q.currentLine;F(q,te);){var fe=(ce=q.currentLine).substring(0,5).toLowerCase();if(fe==="#else"){var de=new n;return ee.children.push(de),void F(q,de)}if(fe==="#elif"){var Te=D(ce,5);ee.children.push(Te),te=Te}}}function F(q,ee){for(;q.canRead;){q.lineIndex++;var te=q.currentLine;if(te.indexOf("#")>=0){var ce=S.exec(te);if(ce&&ce.length){switch(ce[0]){case"#ifdef":var fe=new a;ee.children.push(fe);var de=D(te,6);fe.children.push(de),B(q,fe,de);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":fe=new a,ee.children.push(fe),de=D(te,7),fe.children.push(de),B(q,fe,de);break;case"#if":fe=new a,de=D(te,3),ee.children.push(fe),fe.children.push(de),B(q,fe,de)}continue}}var Te=new n;if(Te.line=te,ee.children.push(Te),te[0]==="#"&&te[1]==="d"){var ue=te.replace(";","").split(" ");Te.additionalDefineKey=ue[1],ue.length===3&&(Te.additionalDefineValue=ue[2])}}return!1}function X(q,ee,te){var ce=new n,fe=new i;return fe.lineIndex=-1,fe.lines=q.split(`
`),F(fe,ce),ce.process(ee,te)}function $(q,ee){for(var te,ce={},fe=0,de=q.defines;fe<de.length;fe++){var Te=de[fe].replace("#define","").replace(";","").trim().split(" ");ce[Te[0]]=Te.length>1?Te[1]:""}return((te=q.processor)===null||te===void 0?void 0:te.shaderLanguage)===0&&(ce.GL_ES="true"),ce.__VERSION__=q.version,ce[q.platformName]="true",(0,m.xt)(ce,ee?.isNDCHalfZRange,ee?.useReverseDepthBuffer,ee?.useExactSrgbConversions),ce}function Q(q,ee,te){var ce;for(g.length=0;(ce=E.exec(q))!==null;)g.push(ce);for(var fe=String(q),de=[q],Te=!1,ue=function(k){var J=k[1];if(J.indexOf("__decl__")!==-1&&(J=J.replace(C,""),ee.supportsUniformBuffers&&(J=J.replace("Vertex","Ubo").replace("Fragment","Ubo")),J+="Declaration"),!ee.includesShadersStore[J]){var le=ee.shadersRepository+"ShadersInclude/"+J+".fx";return ie.loadFile(le,function(Ot){ee.includesShadersStore[J]=Ot,Q(de.join(""),ee,te)}),{value:void 0}}var be=ee.includesShadersStore[J];if(k[2])for(var ve=k[3].split(","),ye=0;ye<ve.length;ye+=2){var Me=new RegExp(ve[ye],"g"),we=ve[ye+1];be=be.replace(Me,we)}if(k[4]){var He=k[5];if(He.indexOf("..")!==-1){var Ke=He.split(".."),Qe=parseInt(Ke[0]),Je=parseInt(Ke[1]),ht=be.slice(0);be="",isNaN(Je)&&(Je=ee.indexParameters[Ke[1]]);for(var mt=Qe;mt<Je;mt++)ee.supportsUniformBuffers||(ht=ht.replace(T,function(Ot,Et){return Et+"{X}"})),be+=ht.replace(f,mt.toString())+`
`}else ee.supportsUniformBuffers||(be=be.replace(T,function(Ot,Et){return Et+"{X}"})),be=be.replace(f,He)}for(var yt=[],zt=0,$t=de;zt<$t.length;zt++){var St=$t[zt].split(k[0]);for(mt=0;mt<St.length-1;mt++)yt.push(St[mt]),yt.push(be);yt.push(St[St.length-1])}de=yt,Te=Te||be.indexOf("#include<")>=0||be.indexOf("#include <")>=0},U=0,N=g;U<N.length;U++){var w=ue(N[U]);if(typeof w=="object")return w.value}g.length=0,fe=de.join(""),Te?Q(fe.toString(),ee,te):te(fe)}var ie={loadFile:function(q,ee,te,ce,fe,de){throw(0,p.n)("FileTools")}}},24054:(r,t,e)=>{e.d(t,{B:()=>i});var n=/(flat\s)?\s*varying\s*.*/,i=function(){function o(){this.shaderLanguage=0}return o.prototype.attributeProcessor=function(a){return a.replace("attribute","in")},o.prototype.varyingCheck=function(a,s){return n.test(a)},o.prototype.varyingProcessor=function(a,s){return a.replace("varying",s?"in":"out")},o.prototype.postProcessor=function(a,s,l){var c=a.search(/#extension.+GL_EXT_draw_buffers.+require/)!==-1;if(a=(a=a.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),l){var u=a.search(/layout *\(location *= *0\) *out/g)!==-1;a=(a=(a=(a=(a=(a=(a=a.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(c||u?"":`layout(location = 0) out vec4 glFragColor;
`)+"void main(")}else if(s.indexOf("#define MULTIVIEW")!==-1)return`#extension GL_OVR_multiview2 : require
layout (num_views = 2) in;
`+a;return a},o}()},90519:(r,t,e)=>{e.d(t,{d:()=>n});var n=function(){function i(o,a){if(o===void 0&&(o=null),this._MSAARenderBuffers=null,this._context=a,!o&&!(o=a.createTexture()))throw new Error("Unable to create webGL texture");this.set(o)}return Object.defineProperty(i.prototype,"underlyingResource",{get:function(){return this._webGLTexture},enumerable:!1,configurable:!0}),i.prototype.setUsage=function(){},i.prototype.set=function(o){this._webGLTexture=o},i.prototype.reset=function(){this._webGLTexture=null,this._MSAARenderBuffers=null},i.prototype.addMSAARenderBuffer=function(o){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(o)},i.prototype.releaseMSAARenderBuffers=function(){if(this._MSAARenderBuffers){for(var o=0,a=this._MSAARenderBuffers;o<a.length;o++){var s=a[o];this._context.deleteRenderbuffer(s)}this._MSAARenderBuffers=null}},i.prototype.getMSAARenderBuffer=function(o){var a,s;return o===void 0&&(o=0),(s=(a=this._MSAARenderBuffers)===null||a===void 0?void 0:a[o])!==null&&s!==void 0?s:null},i.prototype.release=function(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()},i}()},14737:(r,t,e)=>{e.d(t,{x:()=>n});var n=function(){function i(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}return Object.defineProperty(i.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!1,configurable:!0}),i.prototype._handlesSpectorRebuildCallback=function(o){o&&this.program&&o(this.program)},i.prototype.setEngine=function(o){this.engine=o},i.prototype._fillEffectInformation=function(o,a,s,l,c,u,d,h){var p,m=this.engine;if(m.supportsUniformBuffers)for(var v in a)o.bindUniformBlock(v,a[v]);for(this.engine.getUniforms(this,s).forEach(function(T,f){l[s[f]]=T}),this._uniforms=l,p=0;p<c.length;p++)o.getUniform(c[p])==null&&(c.splice(p,1),p--);c.forEach(function(T,f){u[T]=f});for(var b=0,E=m.getAttributes(this,d);b<E.length;b++){var C=E[b];h.push(C)}},i.prototype.dispose=function(){this._uniforms={},this._isDisposed=!0},i.prototype._cacheMatrix=function(o,a){var s=this._valueCache[o],l=a.updateFlag;return(s===void 0||s!==l)&&(this._valueCache[o]=l,!0)},i.prototype._cacheFloat2=function(o,a,s){var l=this._valueCache[o];if(!l||l.length!==2)return l=[a,s],this._valueCache[o]=l,!0;var c=!1;return l[0]!==a&&(l[0]=a,c=!0),l[1]!==s&&(l[1]=s,c=!0),c},i.prototype._cacheFloat3=function(o,a,s,l){var c=this._valueCache[o];if(!c||c.length!==3)return c=[a,s,l],this._valueCache[o]=c,!0;var u=!1;return c[0]!==a&&(c[0]=a,u=!0),c[1]!==s&&(c[1]=s,u=!0),c[2]!==l&&(c[2]=l,u=!0),u},i.prototype._cacheFloat4=function(o,a,s,l,c){var u=this._valueCache[o];if(!u||u.length!==4)return u=[a,s,l,c],this._valueCache[o]=u,!0;var d=!1;return u[0]!==a&&(u[0]=a,d=!0),u[1]!==s&&(u[1]=s,d=!0),u[2]!==l&&(u[2]=l,d=!0),u[3]!==c&&(u[3]=c,d=!0),d},i.prototype.setInt=function(o,a){var s=this._valueCache[o];s!==void 0&&s===a||this.engine.setInt(this._uniforms[o],a)&&(this._valueCache[o]=a)},i.prototype.setInt2=function(o,a,s){this._cacheFloat2(o,a,s)&&(this.engine.setInt2(this._uniforms[o],a,s)||(this._valueCache[o]=null))},i.prototype.setInt3=function(o,a,s,l){this._cacheFloat3(o,a,s,l)&&(this.engine.setInt3(this._uniforms[o],a,s,l)||(this._valueCache[o]=null))},i.prototype.setInt4=function(o,a,s,l,c){this._cacheFloat4(o,a,s,l,c)&&(this.engine.setInt4(this._uniforms[o],a,s,l,c)||(this._valueCache[o]=null))},i.prototype.setIntArray=function(o,a){this._valueCache[o]=null,this.engine.setIntArray(this._uniforms[o],a)},i.prototype.setIntArray2=function(o,a){this._valueCache[o]=null,this.engine.setIntArray2(this._uniforms[o],a)},i.prototype.setIntArray3=function(o,a){this._valueCache[o]=null,this.engine.setIntArray3(this._uniforms[o],a)},i.prototype.setIntArray4=function(o,a){this._valueCache[o]=null,this.engine.setIntArray4(this._uniforms[o],a)},i.prototype.setUInt=function(o,a){var s=this._valueCache[o];s!==void 0&&s===a||this.engine.setUInt(this._uniforms[o],a)&&(this._valueCache[o]=a)},i.prototype.setUInt2=function(o,a,s){this._cacheFloat2(o,a,s)&&(this.engine.setUInt2(this._uniforms[o],a,s)||(this._valueCache[o]=null))},i.prototype.setUInt3=function(o,a,s,l){this._cacheFloat3(o,a,s,l)&&(this.engine.setUInt3(this._uniforms[o],a,s,l)||(this._valueCache[o]=null))},i.prototype.setUInt4=function(o,a,s,l,c){this._cacheFloat4(o,a,s,l,c)&&(this.engine.setUInt4(this._uniforms[o],a,s,l,c)||(this._valueCache[o]=null))},i.prototype.setUIntArray=function(o,a){this._valueCache[o]=null,this.engine.setUIntArray(this._uniforms[o],a)},i.prototype.setUIntArray2=function(o,a){this._valueCache[o]=null,this.engine.setUIntArray2(this._uniforms[o],a)},i.prototype.setUIntArray3=function(o,a){this._valueCache[o]=null,this.engine.setUIntArray3(this._uniforms[o],a)},i.prototype.setUIntArray4=function(o,a){this._valueCache[o]=null,this.engine.setUIntArray4(this._uniforms[o],a)},i.prototype.setArray=function(o,a){this._valueCache[o]=null,this.engine.setArray(this._uniforms[o],a)},i.prototype.setArray2=function(o,a){this._valueCache[o]=null,this.engine.setArray2(this._uniforms[o],a)},i.prototype.setArray3=function(o,a){this._valueCache[o]=null,this.engine.setArray3(this._uniforms[o],a)},i.prototype.setArray4=function(o,a){this._valueCache[o]=null,this.engine.setArray4(this._uniforms[o],a)},i.prototype.setMatrices=function(o,a){a&&(this._valueCache[o]=null,this.engine.setMatrices(this._uniforms[o],a))},i.prototype.setMatrix=function(o,a){this._cacheMatrix(o,a)&&(this.engine.setMatrices(this._uniforms[o],a.asArray())||(this._valueCache[o]=null))},i.prototype.setMatrix3x3=function(o,a){this._valueCache[o]=null,this.engine.setMatrix3x3(this._uniforms[o],a)},i.prototype.setMatrix2x2=function(o,a){this._valueCache[o]=null,this.engine.setMatrix2x2(this._uniforms[o],a)},i.prototype.setFloat=function(o,a){var s=this._valueCache[o];s!==void 0&&s===a||this.engine.setFloat(this._uniforms[o],a)&&(this._valueCache[o]=a)},i.prototype.setVector2=function(o,a){this._cacheFloat2(o,a.x,a.y)&&(this.engine.setFloat2(this._uniforms[o],a.x,a.y)||(this._valueCache[o]=null))},i.prototype.setFloat2=function(o,a,s){this._cacheFloat2(o,a,s)&&(this.engine.setFloat2(this._uniforms[o],a,s)||(this._valueCache[o]=null))},i.prototype.setVector3=function(o,a){this._cacheFloat3(o,a.x,a.y,a.z)&&(this.engine.setFloat3(this._uniforms[o],a.x,a.y,a.z)||(this._valueCache[o]=null))},i.prototype.setFloat3=function(o,a,s,l){this._cacheFloat3(o,a,s,l)&&(this.engine.setFloat3(this._uniforms[o],a,s,l)||(this._valueCache[o]=null))},i.prototype.setVector4=function(o,a){this._cacheFloat4(o,a.x,a.y,a.z,a.w)&&(this.engine.setFloat4(this._uniforms[o],a.x,a.y,a.z,a.w)||(this._valueCache[o]=null))},i.prototype.setQuaternion=function(o,a){this._cacheFloat4(o,a.x,a.y,a.z,a.w)&&(this.engine.setFloat4(this._uniforms[o],a.x,a.y,a.z,a.w)||(this._valueCache[o]=null))},i.prototype.setFloat4=function(o,a,s,l,c){this._cacheFloat4(o,a,s,l,c)&&(this.engine.setFloat4(this._uniforms[o],a,s,l,c)||(this._valueCache[o]=null))},i.prototype.setColor3=function(o,a){this._cacheFloat3(o,a.r,a.g,a.b)&&(this.engine.setFloat3(this._uniforms[o],a.r,a.g,a.b)||(this._valueCache[o]=null))},i.prototype.setColor4=function(o,a,s){this._cacheFloat4(o,a.r,a.g,a.b,s)&&(this.engine.setFloat4(this._uniforms[o],a.r,a.g,a.b,s)||(this._valueCache[o]=null))},i.prototype.setDirectColor4=function(o,a){this._cacheFloat4(o,a.r,a.g,a.b,a.a)&&(this.engine.setFloat4(this._uniforms[o],a.r,a.g,a.b,a.a)||(this._valueCache[o]=null))},i.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},i.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},i}()},37411:(r,t,e)=>{e.d(t,{e:()=>i});var n=e(70511),i=function(){function o(){this._gpuTimeInFrameId=-1,this.counter=new n.A}return o.prototype._addDuration=function(a,s){a<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==a?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(s,!1),this._gpuTimeInFrameId=a):this.counter.addCount(s,!1))},o}()},24894:(r,t,e)=>{e.d(t,{W0:()=>a,iL:()=>o,sg:()=>i,xt:()=>s});var n=e(41190),i=(e(5153),{});function o(l,c,u){return u===void 0&&(u=""),u+(c?c+`
`:"")+l}function a(l,c,u,d,h,p,m){var v=m||i.loadFile;if(v)return v(l,c,u,d,h,p);throw(0,n.n)("FileTools")}function s(l,c,u,d){if(l)return c?l.IS_NDC_HALF_ZRANGE="":delete l.IS_NDC_HALF_ZRANGE,u?l.USE_REVERSE_DEPTHBUFFER="":delete l.USE_REVERSE_DEPTHBUFFER,void(d?l.USE_EXACT_SRGB_CONVERSIONS="":delete l.USE_EXACT_SRGB_CONVERSIONS);var h="";return c&&(h+="#define IS_NDC_HALF_ZRANGE"),u&&(h&&(h+=`
`),h+="#define USE_REVERSE_DEPTHBUFFER"),d&&(h&&(h+=`
`),h+="#define USE_EXACT_SRGB_CONVERSIONS"),h}},82673:(r,t,e)=>{e.d(t,{$:()=>g,r:()=>f});var n=e(78322),i=e(66614),o=e(7164),a=e(74239),s=e(16106),l=e(85258),c=e(48424),u=e(75781),d=e(3911),h=e(69329),p=e(41190),m=e(19133),v=e(5153),b=e(81152),E=e(66377),C=e(24894),T=e(1235);function f(S,y){if((0,v.BA)()){var x=(y||window).requestAnimationFrame;if(typeof x=="function")return x(S)}else if(typeof requestAnimationFrame=="function")return requestAnimationFrame(S);return setTimeout(S,16)}var g=function(){function S(y,x,R){var I,M,D,B,F,X,$,Q,ie,q,ee,te=this;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new c.N,this._stencilStateComposer=new u.u,this._stencilState=new d.K,this._alphaState=new h.i,this._alphaMode=b.Y.ALPHA_ADD,this._alphaEquation=b.Y.ALPHA_DISABLE,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new E.cP,this.onCanvasFocusObservable=new E.cP,this.onNewSceneAddedObservable=new E.cP,this.onResizeObservable=new E.cP,this.onCanvasPointerOutObservable=new E.cP,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=b.Y.RENDERPASS_MAIN,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new E.cP,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=function(){return te._renderLoop()},this.onBeforeShaderCompilationObservable=new E.cP,this.onAfterShaderCompilationObservable=new E.cP,this.onBeginFrameObservable=new E.cP,this.onEndFrameObservable=new E.cP,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new E.cP,this.onContextRestoredObservable=new E.cP,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.onDisposeObservable=new E.cP,i.q.Instances.push(this),this.startTime=l.j.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,s.I.SetMatrixPrecision(!!x.useHighPrecisionMatrix),(0,v.XD)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=R!=null&&R,x.antialias=y??x.antialias,x.deterministicLockstep=(I=x.deterministicLockstep)!==null&&I!==void 0&&I,x.lockstepMaxSteps=(M=x.lockstepMaxSteps)!==null&&M!==void 0?M:4,x.timeStep=(D=x.timeStep)!==null&&D!==void 0?D:1/60,x.audioEngine=(B=x.audioEngine)===null||B===void 0||B,x.stencil=(F=x.stencil)===null||F===void 0||F,this._audioContext=($=(X=x.audioEngineOptions)===null||X===void 0?void 0:X.audioContext)!==null&&$!==void 0?$:null,this._audioDestination=(ie=(Q=x.audioEngineOptions)===null||Q===void 0?void 0:Q.audioDestination)!==null&&ie!==void 0?ie:null,this.premultipliedAlpha=(q=x.premultipliedAlpha)===null||q===void 0||q,this._doNotHandleContextLost=!!x.doNotHandleContextLost,this._isStencilEnable=!!x.stencil,this.useExactSrgbConversions=(ee=x.useExactSrgbConversions)!==null&&ee!==void 0&&ee;var ce=(0,v.BA)()&&window.devicePixelRatio||1,fe=x.limitDeviceRatio||ce;R=R||x.adaptToDeviceRatio||!1,this._hardwareScalingLevel=R?1/Math.min(fe,ce):1,this._lastDevicePixelRatio=ce,this._creationOptions=x}return Object.defineProperty(S.prototype,"frameId",{get:function(){return this._frameId},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"isWebGPU",{get:function(){return this._isWebGPU},enumerable:!1,configurable:!0}),S.prototype._getShaderProcessor=function(y){return this._shaderProcessor},Object.defineProperty(S.prototype,"shaderPlatformName",{get:function(){return this._shaderPlatformName},enumerable:!1,configurable:!0}),S.prototype._clearEmptyResources=function(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null},Object.defineProperty(S.prototype,"useReverseDepthBuffer",{get:function(){return this._useReverseDepthBuffer},set:function(y){y!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=y,this._depthCullingState.depthFunc=y?b.Y.GEQUAL:b.Y.LEQUAL)},enumerable:!1,configurable:!0}),S.prototype.setColorWrite=function(y){y!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=y)},S.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(S.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stencilStateComposer",{get:function(){return this._stencilStateComposer},enumerable:!1,configurable:!0}),S.prototype._getGlobalDefines=function(y){if(y)return this.isNDCHalfZRange?y.IS_NDC_HALF_ZRANGE="":delete y.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?y.USE_REVERSE_DEPTHBUFFER="":delete y.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?y.USE_EXACT_SRGB_CONVERSIONS="":delete y.USE_EXACT_SRGB_CONVERSIONS);var x="";return this.isNDCHalfZRange&&(x+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(x&&(x+=`
`),x+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(x&&(x+=`
`),x+="#define USE_EXACT_SRGB_CONVERSIONS"),x},S.prototype._rebuildInternalTextures=function(){for(var y=0,x=this._internalTexturesCache.slice();y<x.length;y++)x[y]._rebuild()},S.prototype._rebuildRenderTargetWrappers=function(){for(var y=0,x=this._renderTargetWrapperCache.slice();y<x.length;y++)x[y]._rebuild()},S.prototype._rebuildEffects=function(){for(var y in this._compiledEffects){var x=this._compiledEffects[y];x._pipelineContext=null,x._prepareEffect()}a.M.ResetCache()},S.prototype._rebuildGraphicsResources=function(){var y;this.wipeCaches(!0),this._rebuildEffects(),(y=this._rebuildComputeEffects)===null||y===void 0||y.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)},S.prototype._flagContextRestored=function(){o.V.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1},S.prototype._restoreEngineAfterContextLost=function(y){var x=this;setTimeout(function(){return(0,n.sH)(x,void 0,void 0,function(){var R,I,M,D;return(0,n.YH)(this,function(B){switch(B.label){case 0:return this._clearEmptyResources(),R=this._depthCullingState.depthTest,I=this._depthCullingState.depthFunc,M=this._depthCullingState.depthMask,D=this._stencilState.stencilTest,[4,y()];case 1:return B.sent(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=R,this._depthCullingState.depthFunc=I,this._depthCullingState.depthMask=M,this._stencilState.stencilTest=D,this._flagContextRestored(),[2]}})})},0)},Object.defineProperty(S.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"snapshotRendering",{get:function(){return!1},set:function(y){},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"snapshotRenderingMode",{get:function(){return b.Y.SNAPSHOTRENDERING_STANDARD},set:function(y){},enumerable:!1,configurable:!0}),S.prototype.getClassName=function(){return"AbstractEngine"},Object.defineProperty(S.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,b.Y.TEXTUREFORMAT_RGBA,!1,!1,b.Y.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,b.Y.TEXTUREFORMAT_RGBA,!1,!1,b.Y.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,b.Y.TEXTUREFORMAT_RGBA,!1,!1,b.Y.TEXTURE_NEAREST_SAMPLINGMODE)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var y=new Uint8Array(4),x=[y,y,y,y,y,y];this._emptyCubeTexture=this.createRawCubeTexture(x,1,b.Y.TEXTUREFORMAT_RGBA,b.Y.TEXTURETYPE_UNSIGNED_INT,!1,!1,b.Y.TEXTURE_NEAREST_SAMPLINGMODE)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"activeRenderLoops",{get:function(){return this._activeRenderLoops},enumerable:!1,configurable:!0}),S.prototype.stopRenderLoop=function(y){if(!y)return this._activeRenderLoops.length=0,void this._cancelFrame();var x=this._activeRenderLoops.indexOf(y);x>=0&&(this._activeRenderLoops.splice(x,1),this._activeRenderLoops.length==0&&this._cancelFrame())},S.prototype._cancelFrame=function(){if(this._frameHandler!==0){var y=this._frameHandler;if(this._frameHandler=0,(0,v.BA)()){var x=(this.getHostWindow()||window).cancelAnimationFrame;if(typeof x=="function")return x(y)}else if(typeof cancelAnimationFrame=="function")return cancelAnimationFrame(y);return clearTimeout(y)}},S.prototype.beginFrame=function(){this.onBeginFrameObservable.notifyObservers(this)},S.prototype.endFrame=function(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)},S.prototype._renderLoop=function(){if(this._frameHandler=0,!this._contextWasLost){var y=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(y=!1),y&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0&&this._frameHandler===0&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))},S.prototype._renderFrame=function(){for(var y=0;y<this._activeRenderLoops.length;y++)(0,this._activeRenderLoops[y])()},S.prototype._renderViews=function(){return!1},S.prototype._queueNewFrame=function(y,x){return f(y,x)},S.prototype.runRenderLoop=function(y){this._activeRenderLoops.indexOf(y)===-1&&(this._activeRenderLoops.push(y),this._activeRenderLoops.length===1&&this._frameHandler===0&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},S.prototype.getDepthBuffer=function(){return this._depthCullingState.depthTest},S.prototype.setDepthBuffer=function(y){this._depthCullingState.depthTest=y},S.prototype.setZOffset=function(y){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-y:y},S.prototype.getZOffset=function(){var y=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-y:y},S.prototype.setZOffsetUnits=function(y){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-y:y},S.prototype.getZOffsetUnits=function(){var y=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-y:y},S.prototype.getHostWindow=function(){return(0,v.BA)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},Object.defineProperty(S.prototype,"compatibilityMode",{get:function(){return this._compatibilityMode},set:function(y){this._compatibilityMode=!0},enumerable:!1,configurable:!0}),S.prototype._rebuildTextures=function(){for(var y=0,x=this.scenes;y<x.length;y++)x[y]._rebuildTextures();for(var R=0,I=this._virtualScenes;R<I.length;R++)I[R]._rebuildTextures()},S.prototype._releaseRenderTargetWrapper=function(y){var x=this._renderTargetWrapperCache.indexOf(y);x!==-1&&this._renderTargetWrapperCache.splice(x,1)},Object.defineProperty(S.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),S.prototype.setViewport=function(y,x,R){var I=x||this.getRenderWidth(),M=R||this.getRenderHeight(),D=y.x||0,B=y.y||0;this._cachedViewport=y,this._viewport(D*I,B*M,I*y.width,M*y.height)},S.prototype.createCanvasImage=function(){return document.createElement("img")},Object.defineProperty(S.prototype,"description",{get:function(){var y=this.name+this.version;return this._caps.parallelShaderCompile&&(y+=" - Parallel shader compilation"),y},enumerable:!1,configurable:!0}),S.prototype._createTextureBase=function(y,x,R,I,M,D,B,F,X,$,Q,ie,q,ee,te,ce){var fe=this;M===void 0&&(M=b.Y.TEXTURE_TRILINEAR_SAMPLINGMODE),D===void 0&&(D=null),B===void 0&&(B=null),$===void 0&&($=null),Q===void 0&&(Q=null),ie===void 0&&(ie=null),q===void 0&&(q=null);var de=(y=y||"").substr(0,5)==="data:",Te=y.substr(0,5)==="blob:",ue=de&&y.indexOf(";base64,")!==-1,U=Q||new m.h(this,1);U!==Q&&(U.label=y.substring(0,60));var N=y;!this._transformTextureUrl||ue||Q||$||(y=this._transformTextureUrl(y)),N!==y&&(U._originalUrl=N);var w=y.lastIndexOf("."),k=q||(w>-1?y.substring(w).toLowerCase():"");k.indexOf("?")>-1&&(k=k.split("?")[0]);var J=(0,T.gT)(k,ee);I&&I.addPendingData(U),U.url=y,U.generateMipMaps=!x,U.samplingMode=M,U.invertY=R,U._useSRGBBuffer=this._getUseSRGBBuffer(!!ce,x),this._doNotHandleContextLost||(U._buffer=$);var le=null;D&&!Q&&(le=U.onLoadedObservable.add(D)),Q||this._internalTexturesCache.push(U);var be=function(Me,we){I&&I.removePendingData(U),y===N?(le&&U.onLoadedObservable.remove(le),i.q.UseFallbackTexture&&y!==i.q.FallbackTexture&&fe._createTextureBase(i.q.FallbackTexture,x,U.invertY,I,M,null,B,F,X,$,U),Me=(Me||"Unknown error")+(i.q.UseFallbackTexture?" - Fallback texture was used":""),U.onErrorObservable.notifyObservers({message:Me,exception:we}),B&&B(Me,we)):(o.V.Warn("Failed to load ".concat(y,", falling back to ").concat(N)),fe._createTextureBase(N,x,U.invertY,I,M,D,B,F,X,$,U,ie,q,ee,te,ce))};if(J){var ve=function(Me){return(0,n.sH)(fe,void 0,void 0,function(){return(0,n.YH)(this,function(we){switch(we.label){case 0:return[4,J];case 1:return we.sent().loadData(Me,U,function(He,Ke,Qe,Je,ht,mt){mt?be("TextureLoader failed to load data"):F(U,k,I,{width:He,height:Ke},U.invertY,!Qe,Je,function(){return ht(),!1},M)},te),[2]}})})};$?$ instanceof ArrayBuffer?ve(new Uint8Array($)):ArrayBuffer.isView($)?ve($):B&&B("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(y,function(Me){return ve(new Uint8Array(Me))},void 0,I?I.offlineProvider:void 0,!0,function(Me,we){be("Unable to load "+(Me&&Me.responseURL,we))})}else{var ye=function(Me){Te&&!fe._doNotHandleContextLost&&(U._buffer=Me),F(U,k,I,Me,U.invertY,x,!1,X,M)};!de||ue?$&&(typeof $.decoding=="string"||$.close)?ye($):S._FileToolsLoadImage(y||"",ye,be,I?I.offlineProvider:null,ee,U.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):typeof $=="string"||$ instanceof ArrayBuffer||ArrayBuffer.isView($)||$ instanceof Blob?S._FileToolsLoadImage($,ye,be,I?I.offlineProvider:null,ee,U.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):$&&ye($)}return U},S.prototype._rebuildBuffers=function(){for(var y=0,x=this._uniformBuffers;y<x.length;y++)x[y]._rebuildAfterContextLost()},Object.defineProperty(S.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),S.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,v.Nf)()?document:null},S.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},S.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache.length=0},S.prototype.getCaps=function(){return this._caps},S.prototype.resetTextureCache=function(){for(var y in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,y)&&(this._boundTexturesCache[y]=null);this._currentTextureChannel=-1},Object.defineProperty(S.prototype,"name",{get:function(){return this._name},set:function(y){this._name=y},enumerable:!1,configurable:!0}),Object.defineProperty(S,"NpmPackage",{get:function(){return"babylonjs@7.25.2"},enumerable:!1,configurable:!0}),Object.defineProperty(S,"Version",{get:function(){return"7.25.2"},enumerable:!1,configurable:!0}),S.prototype.getRenderingCanvas=function(){return this._renderingCanvas},S.prototype.getAudioContext=function(){return this._audioContext},S.prototype.getAudioDestination=function(){return this._audioDestination},S.prototype.setHardwareScalingLevel=function(y){this._hardwareScalingLevel=y,this.resize()},S.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},Object.defineProperty(S.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(y){this._doNotHandleContextLost=y},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),S.prototype.getCreationOptions=function(){return this._creationOptions},S.prototype.resize=function(y){var x,R;if(y===void 0&&(y=!1),this.adaptToDeviceRatio){var I=(0,v.BA)()&&window.devicePixelRatio||1,M=this._lastDevicePixelRatio/I;this._lastDevicePixelRatio=I,this._hardwareScalingLevel*=M}if((0,v.BA)()&&(0,v.Nf)())if(this._renderingCanvas){var D=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};x=this._renderingCanvas.clientWidth||D.width||this._renderingCanvas.width||100,R=this._renderingCanvas.clientHeight||D.height||this._renderingCanvas.height||100}else x=window.innerWidth,R=window.innerHeight;else x=this._renderingCanvas?this._renderingCanvas.width:100,R=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(x/this._hardwareScalingLevel,R/this._hardwareScalingLevel,y)},S.prototype.setSize=function(y,x,R){if(R===void 0&&(R=!1),!this._renderingCanvas||(y|=0,x|=0,!R&&this._renderingCanvas.width===y&&this._renderingCanvas.height===x))return!1;if(this._renderingCanvas.width=y,this._renderingCanvas.height=x,this.scenes){for(var I=0;I<this.scenes.length;I++)for(var M=this.scenes[I],D=0;D<M.cameras.length;D++)M.cameras[D]._currentRenderId=0;this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},S.prototype.createRawTexture=function(y,x,R,I,M,D,B,F,X,$,Q){throw(0,p.n)("engine.rawTexture")},S.prototype.createRawCubeTexture=function(y,x,R,I,M,D,B,F){throw(0,p.n)("engine.rawTexture")},S.prototype.createRawTexture3D=function(y,x,R,I,M,D,B,F,X,$,Q){throw(0,p.n)("engine.rawTexture")},S.prototype.createRawTexture2DArray=function(y,x,R,I,M,D,B,F,X,$,Q){throw(0,p.n)("engine.rawTexture")},S.prototype._sharedInit=function(y){this._renderingCanvas=y},S.prototype._setupMobileChecks=function(){var y=this;navigator&&navigator.userAgent&&(this._checkForMobile=function(){var x=navigator.userAgent;y.hostInformation.isMobile=x.indexOf("Mobile")!==-1||x.indexOf("Mac")!==-1&&(0,v.Nf)()&&"ontouchend"in document},this._checkForMobile(),(0,v.BA)()&&window.addEventListener("resize",this._checkForMobile))},S.prototype.createVideoElement=function(y){return document.createElement("video")},S.prototype._reportDrawCall=function(y){var x;y===void 0&&(y=1),(x=this._drawCalls)===null||x===void 0||x.addCount(y,!1)},S.prototype.getFps=function(){return this._fps},S.prototype.getDeltaTime=function(){return this._deltaTime},S.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},S.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},S.prototype.getTimeStep=function(){return 1e3*this._timeStep},S.prototype._createImageBitmapFromSource=function(y,x){throw new Error("createImageBitmapFromSource is not implemented")},S.prototype.createImageBitmap=function(y,x){return createImageBitmap(y,x)},S.prototype.resizeImageBitmap=function(y,x,R){throw new Error("resizeImageBitmap is not implemented")},S.prototype.getFontOffset=function(y){throw new Error("getFontOffset is not implemented")},S._CreateCanvas=function(y,x){if(typeof document>"u")return new OffscreenCanvas(y,x);var R=document.createElement("canvas");return R.width=y,R.height=x,R},S.prototype.createCanvas=function(y,x){return S._CreateCanvas(y,x)},S._FileToolsLoadImage=function(y,x,R,I,M,D){throw(0,p.n)("FileTools")},S.prototype._loadFile=function(y,x,R,I,M,D){var B=this,F=(0,C.W0)(y,x,R,I,M,D);return this._activeRequests.push(F),F.onCompleteObservable.add(function(){var X=B._activeRequests.indexOf(F);X!==-1&&B._activeRequests.splice(X,1)}),F},S._FileToolsLoadFile=function(y,x,R,I,M,D){if(C.sg.loadFile)return C.sg.loadFile(y,x,R,I,M,D);throw(0,p.n)("FileTools")},S.prototype.dispose=function(){var y;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();(y=this.releaseComputeEffects)===null||y===void 0||y.call(this),a.M.ResetCache();for(var x=0,R=this._activeRequests;x<R.length;x++)R[x].abort();this._boundRenderFunction=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,v.BA)()&&window.removeEventListener("resize",this._checkForMobile);var I=i.q.Instances.indexOf(this);I>=0&&i.q.Instances.splice(I,1),i.q.Instances.length||(i.q.OnEnginesDisposedObservable.notifyObservers(this),i.q.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},S.DefaultLoadingScreenFactory=function(y){throw(0,p.n)("LoadingScreen")},S.MarkAllMaterialsAsDirty=function(y,x){for(var R=0;R<i.q.Instances.length;R++)for(var I=i.q.Instances[R],M=0;M<I.scenes.length;M++)I.scenes[M].markAllMaterialsAsDirty(y,x)},S._RenderPassIdCounter=0,S._RescalePostProcessFactory=null,S.CollisionsEpsilon=.001,S.QueueNewFrame=f,S}()},81152:(r,t,e)=>{e.d(t,{Y:()=>n});var n=function(){function i(){}return i.AUTOSAMPLERSUFFIX="Sampler",i.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",i.ALPHA_DISABLE=0,i.ALPHA_ADD=1,i.ALPHA_COMBINE=2,i.ALPHA_SUBTRACT=3,i.ALPHA_MULTIPLY=4,i.ALPHA_MAXIMIZED=5,i.ALPHA_ONEONE=6,i.ALPHA_PREMULTIPLIED=7,i.ALPHA_PREMULTIPLIED_PORTERDUFF=8,i.ALPHA_INTERPOLATE=9,i.ALPHA_SCREENMODE=10,i.ALPHA_ONEONE_ONEONE=11,i.ALPHA_ALPHATOCOLOR=12,i.ALPHA_REVERSEONEMINUS=13,i.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,i.ALPHA_ONEONE_ONEZERO=15,i.ALPHA_EXCLUSION=16,i.ALPHA_LAYER_ACCUMULATE=17,i.ALPHA_EQUATION_ADD=0,i.ALPHA_EQUATION_SUBSTRACT=1,i.ALPHA_EQUATION_REVERSE_SUBTRACT=2,i.ALPHA_EQUATION_MAX=3,i.ALPHA_EQUATION_MIN=4,i.ALPHA_EQUATION_DARKEN=5,i.DELAYLOADSTATE_NONE=0,i.DELAYLOADSTATE_LOADED=1,i.DELAYLOADSTATE_LOADING=2,i.DELAYLOADSTATE_NOTLOADED=4,i.NEVER=512,i.ALWAYS=519,i.LESS=513,i.EQUAL=514,i.LEQUAL=515,i.GREATER=516,i.GEQUAL=518,i.NOTEQUAL=517,i.KEEP=7680,i.ZERO=0,i.REPLACE=7681,i.INCR=7682,i.DECR=7683,i.INVERT=5386,i.INCR_WRAP=34055,i.DECR_WRAP=34056,i.TEXTURE_CLAMP_ADDRESSMODE=0,i.TEXTURE_WRAP_ADDRESSMODE=1,i.TEXTURE_MIRROR_ADDRESSMODE=2,i.TEXTURE_CREATIONFLAG_STORAGE=1,i.TEXTUREFORMAT_ALPHA=0,i.TEXTUREFORMAT_LUMINANCE=1,i.TEXTUREFORMAT_LUMINANCE_ALPHA=2,i.TEXTUREFORMAT_RGB=4,i.TEXTUREFORMAT_RGBA=5,i.TEXTUREFORMAT_RED=6,i.TEXTUREFORMAT_R=6,i.TEXTUREFORMAT_RG=7,i.TEXTUREFORMAT_RED_INTEGER=8,i.TEXTUREFORMAT_R_INTEGER=8,i.TEXTUREFORMAT_RG_INTEGER=9,i.TEXTUREFORMAT_RGB_INTEGER=10,i.TEXTUREFORMAT_RGBA_INTEGER=11,i.TEXTUREFORMAT_BGRA=12,i.TEXTUREFORMAT_DEPTH24_STENCIL8=13,i.TEXTUREFORMAT_DEPTH32_FLOAT=14,i.TEXTUREFORMAT_DEPTH16=15,i.TEXTUREFORMAT_DEPTH24=16,i.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,i.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,i.TEXTUREFORMAT_STENCIL8=19,i.TEXTUREFORMAT_UNDEFINED=4294967295,i.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,i.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,i.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,i.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,i.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,i.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,i.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,i.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,i.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,i.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,i.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,i.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,i.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,i.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,i.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,i.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,i.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,i.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,i.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,i.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,i.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,i.TEXTURETYPE_UNSIGNED_BYTE=0,i.TEXTURETYPE_UNSIGNED_INT=0,i.TEXTURETYPE_FLOAT=1,i.TEXTURETYPE_HALF_FLOAT=2,i.TEXTURETYPE_BYTE=3,i.TEXTURETYPE_SHORT=4,i.TEXTURETYPE_UNSIGNED_SHORT=5,i.TEXTURETYPE_INT=6,i.TEXTURETYPE_UNSIGNED_INTEGER=7,i.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,i.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,i.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,i.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,i.TEXTURETYPE_UNSIGNED_INT_24_8=12,i.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,i.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,i.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,i.TEXTURETYPE_UNDEFINED=16,i.TEXTURE_2D=3553,i.TEXTURE_2D_ARRAY=35866,i.TEXTURE_CUBE_MAP=34067,i.TEXTURE_CUBE_MAP_ARRAY=3735928559,i.TEXTURE_3D=32879,i.TEXTURE_NEAREST_SAMPLINGMODE=1,i.TEXTURE_NEAREST_NEAREST=1,i.TEXTURE_BILINEAR_SAMPLINGMODE=2,i.TEXTURE_LINEAR_LINEAR=2,i.TEXTURE_TRILINEAR_SAMPLINGMODE=3,i.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,i.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,i.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,i.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,i.TEXTURE_NEAREST_LINEAR=7,i.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,i.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,i.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,i.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,i.TEXTURE_LINEAR_NEAREST=12,i.TEXTURE_EXPLICIT_MODE=0,i.TEXTURE_SPHERICAL_MODE=1,i.TEXTURE_PLANAR_MODE=2,i.TEXTURE_CUBIC_MODE=3,i.TEXTURE_PROJECTION_MODE=4,i.TEXTURE_SKYBOX_MODE=5,i.TEXTURE_INVCUBIC_MODE=6,i.TEXTURE_EQUIRECTANGULAR_MODE=7,i.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,i.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,i.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,i.TEXTURE_FILTERING_QUALITY_HIGH=64,i.TEXTURE_FILTERING_QUALITY_MEDIUM=16,i.TEXTURE_FILTERING_QUALITY_LOW=8,i.SCALEMODE_FLOOR=1,i.SCALEMODE_NEAREST=2,i.SCALEMODE_CEILING=3,i.MATERIAL_TextureDirtyFlag=1,i.MATERIAL_LightDirtyFlag=2,i.MATERIAL_FresnelDirtyFlag=4,i.MATERIAL_AttributesDirtyFlag=8,i.MATERIAL_MiscDirtyFlag=16,i.MATERIAL_PrePassDirtyFlag=32,i.MATERIAL_AllDirtyFlag=63,i.MATERIAL_TriangleFillMode=0,i.MATERIAL_WireFrameFillMode=1,i.MATERIAL_PointFillMode=2,i.MATERIAL_PointListDrawMode=3,i.MATERIAL_LineListDrawMode=4,i.MATERIAL_LineLoopDrawMode=5,i.MATERIAL_LineStripDrawMode=6,i.MATERIAL_TriangleStripDrawMode=7,i.MATERIAL_TriangleFanDrawMode=8,i.MATERIAL_ClockWiseSideOrientation=0,i.MATERIAL_CounterClockWiseSideOrientation=1,i.ACTION_NothingTrigger=0,i.ACTION_OnPickTrigger=1,i.ACTION_OnLeftPickTrigger=2,i.ACTION_OnRightPickTrigger=3,i.ACTION_OnCenterPickTrigger=4,i.ACTION_OnPickDownTrigger=5,i.ACTION_OnDoublePickTrigger=6,i.ACTION_OnPickUpTrigger=7,i.ACTION_OnPickOutTrigger=16,i.ACTION_OnLongPressTrigger=8,i.ACTION_OnPointerOverTrigger=9,i.ACTION_OnPointerOutTrigger=10,i.ACTION_OnEveryFrameTrigger=11,i.ACTION_OnIntersectionEnterTrigger=12,i.ACTION_OnIntersectionExitTrigger=13,i.ACTION_OnKeyDownTrigger=14,i.ACTION_OnKeyUpTrigger=15,i.PARTICLES_BILLBOARDMODE_Y=2,i.PARTICLES_BILLBOARDMODE_ALL=7,i.PARTICLES_BILLBOARDMODE_STRETCHED=8,i.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,i.MESHES_CULLINGSTRATEGY_STANDARD=0,i.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,i.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,i.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,i.SCENELOADER_NO_LOGGING=0,i.SCENELOADER_MINIMAL_LOGGING=1,i.SCENELOADER_SUMMARY_LOGGING=2,i.SCENELOADER_DETAILED_LOGGING=3,i.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,i.PREPASS_POSITION_TEXTURE_TYPE=1,i.PREPASS_VELOCITY_TEXTURE_TYPE=2,i.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,i.PREPASS_COLOR_TEXTURE_TYPE=4,i.PREPASS_DEPTH_TEXTURE_TYPE=5,i.PREPASS_NORMAL_TEXTURE_TYPE=6,i.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,i.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,i.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,i.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,i.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,i.BUFFER_CREATIONFLAG_READ=1,i.BUFFER_CREATIONFLAG_WRITE=2,i.BUFFER_CREATIONFLAG_READWRITE=3,i.BUFFER_CREATIONFLAG_UNIFORM=4,i.BUFFER_CREATIONFLAG_VERTEX=8,i.BUFFER_CREATIONFLAG_INDEX=16,i.BUFFER_CREATIONFLAG_STORAGE=32,i.BUFFER_CREATIONFLAG_INDIRECT=64,i.RENDERPASS_MAIN=0,i.INPUT_ALT_KEY=18,i.INPUT_CTRL_KEY=17,i.INPUT_META_KEY1=91,i.INPUT_META_KEY2=92,i.INPUT_META_KEY3=93,i.INPUT_SHIFT_KEY=16,i.SNAPSHOTRENDERING_STANDARD=0,i.SNAPSHOTRENDERING_FAST=1,i.PERSPECTIVE_CAMERA=0,i.ORTHOGRAPHIC_CAMERA=1,i.FOVMODE_VERTICAL_FIXED=0,i.FOVMODE_HORIZONTAL_FIXED=1,i.RIG_MODE_NONE=0,i.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,i.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,i.RIG_MODE_STEREOSCOPIC_INTERLACED=14,i.RIG_MODE_VR=20,i.RIG_MODE_CUSTOM=22,i.MAX_SUPPORTED_UV_SETS=6,i.GL_ALPHA_EQUATION_ADD=32774,i.GL_ALPHA_EQUATION_MIN=32775,i.GL_ALPHA_EQUATION_MAX=32776,i.GL_ALPHA_EQUATION_SUBTRACT=32778,i.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,i.GL_ALPHA_FUNCTION_SRC=768,i.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,i.GL_ALPHA_FUNCTION_SRC_ALPHA=770,i.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,i.GL_ALPHA_FUNCTION_DST_ALPHA=772,i.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,i.GL_ALPHA_FUNCTION_DST_COLOR=774,i.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,i.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,i.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,i.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,i.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,i.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,i.SnippetUrl="https://snippet.babylonjs.com",i.FOGMODE_NONE=0,i.FOGMODE_EXP=1,i.FOGMODE_EXP2=2,i.FOGMODE_LINEAR=3,i.BYTE=5120,i.UNSIGNED_BYTE=5121,i.SHORT=5122,i.UNSIGNED_SHORT=5123,i.INT=5124,i.UNSIGNED_INT=5125,i.FLOAT=5126,i.PositionKind="position",i.NormalKind="normal",i.TangentKind="tangent",i.UVKind="uv",i.UV2Kind="uv2",i.UV3Kind="uv3",i.UV4Kind="uv4",i.UV5Kind="uv5",i.UV6Kind="uv6",i.ColorKind="color",i.ColorInstanceKind="instanceColor",i.MatricesIndicesKind="matricesIndices",i.MatricesWeightsKind="matricesWeights",i.MatricesIndicesExtraKind="matricesIndicesExtra",i.MatricesWeightsExtraKind="matricesWeightsExtra",i}()},66614:(r,t,e)=>{e.d(t,{q:()=>i});var n=e(66377),i=function(){function o(){}return Object.defineProperty(o,"LastCreatedEngine",{get:function(){return this.Instances.length===0?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(o,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),o.Instances=[],o.OnEnginesDisposedObservable=new n.cP,o._LastCreatedScene=null,o.UseFallbackTexture=!0,o.FallbackTexture="",o}()},16106:(r,t,e)=>{e.d(t,{I:()=>n});var n=function(){function i(){}return i.SetMatrixPrecision=function(o){if(i.MatrixTrackPrecisionChange=!1,o&&!i.MatrixUse64Bits&&i.MatrixTrackedMatrices)for(var a=0;a<i.MatrixTrackedMatrices.length;++a){var s=i.MatrixTrackedMatrices[a],l=s._m;s._m=new Array(16);for(var c=0;c<16;++c)s._m[c]=l[c]}i.MatrixUse64Bits=o,i.MatrixCurrentType=i.MatrixUse64Bits?Array:Float32Array,i.MatrixTrackedMatrices=null},i.MatrixUse64Bits=!1,i.MatrixTrackPrecisionChange=!0,i.MatrixCurrentType=Float32Array,i.MatrixTrackedMatrices=[],i}()},96925:(r,t,e)=>{e.d(t,{v:()=>i});var n=e(81152),i=function(){function o(a,s,l,c,u){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=a,this._isCube=s,this._size=l,this._engine=c,this._depthStencilTexture=null,this.label=u}return Object.defineProperty(o.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"depthStencilTextureWithStencil",{get:function(){return this._depthStencilTextureWithStencil},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isCube",{get:function(){return this._isCube},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isMulti",{get:function(){return this._isMulti},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"is2DArray",{get:function(){return this.layers>0},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"is3D",{get:function(){return this.depth>0},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"size",{get:function(){return this.width},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"width",{get:function(){return this._size.width||this._size},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"height",{get:function(){return this._size.height||this._size},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"layers",{get:function(){return this._size.layers||0},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"depth",{get:function(){return this._size.depth||0},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"texture",{get:function(){var a,s;return(s=(a=this._textures)===null||a===void 0?void 0:a[0])!==null&&s!==void 0?s:null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"textures",{get:function(){return this._textures},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"faceIndices",{get:function(){return this._faceIndices},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"layerIndices",{get:function(){return this._layerIndices},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"samples",{get:function(){return this._samples},enumerable:!1,configurable:!0}),o.prototype.setSamples=function(a,s,l){if(s===void 0&&(s=!0),l===void 0&&(l=!1),this.samples===a&&!l)return a;var c=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,a,s):this._engine.updateRenderTargetTextureSampleCount(this,a);return this._samples=a,c},o.prototype.setTextures=function(a){Array.isArray(a)?this._textures=a:this._textures=a?[a]:null},o.prototype.setTexture=function(a,s,l){s===void 0&&(s=0),l===void 0&&(l=!0),this._textures||(this._textures=[]),this._textures[s]!==a&&(this._textures[s]&&l&&this._textures[s].dispose(),this._textures[s]=a)},o.prototype.setLayerAndFaceIndices=function(a,s){this._layerIndices=a,this._faceIndices=s},o.prototype.setLayerAndFaceIndex=function(a,s,l){a===void 0&&(a=0),this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),s!==void 0&&s>=0&&(this._layerIndices[a]=s),l!==void 0&&l>=0&&(this._faceIndices[a]=l)},o.prototype.createDepthStencilTexture=function(a,s,l,c,u,d){var h;return a===void 0&&(a=0),s===void 0&&(s=!0),l===void 0&&(l=!1),c===void 0&&(c=1),u===void 0&&(u=n.Y.TEXTUREFORMAT_DEPTH32_FLOAT),(h=this._depthStencilTexture)===null||h===void 0||h.dispose(),this._depthStencilTextureWithStencil=l,this._depthStencilTextureLabel=d,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:s,comparisonFunction:a,generateStencil:l,isCube:this._isCube,samples:c,depthTextureFormat:u,label:d},this),this._depthStencilTexture},o.prototype._shareDepth=function(a){this.shareDepth(a)},o.prototype.shareDepth=function(a){this._depthStencilTexture&&(a._depthStencilTexture&&a._depthStencilTexture.dispose(),a._depthStencilTexture=this._depthStencilTexture,a._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())},o.prototype._swapAndDie=function(a){this.texture&&this.texture._swapAndDie(a),this._textures=null,this.dispose(!0)},o.prototype._cloneRenderTargetWrapper=function(){var a,s,l,c,u,d,h,p,m=null;if(this._isMulti){var v=this.textures;if(v&&v.length>0){var b=!1,E=v.length,C=-1,T=v[v.length-1]._source;T!==14&&T!==12||(b=!0,C=v[v.length-1].format,E--);for(var f=[],g=[],S=[],y=[],x=[],R=[],I=[],M={},D=0;D<E;++D){var B=v[D];f.push(B.samplingMode),g.push(B.type),S.push(B.format),($=M[B.uniqueId])!==void 0?(y.push(-1),I.push(0)):(M[B.uniqueId]=D,B.is2DArray?(y.push(n.Y.TEXTURE_2D_ARRAY),I.push(B.depth)):B.isCube?(y.push(n.Y.TEXTURE_CUBE_MAP),I.push(0)):B.is3D?(y.push(n.Y.TEXTURE_3D),I.push(B.depth)):(y.push(n.Y.TEXTURE_2D),I.push(0))),this._faceIndices&&x.push((a=this._faceIndices[D])!==null&&a!==void 0?a:0),this._layerIndices&&R.push((s=this._layerIndices[D])!==null&&s!==void 0?s:0)}var F={samplingModes:f,generateMipMaps:v[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:b,depthTextureFormat:C,types:g,formats:S,textureCount:E,targetTypes:y,faceIndex:x,layerIndex:R,layerCounts:I,label:this.label},X={width:this.width,height:this.height,depth:this.depth};for(m=this._engine.createMultipleRenderTarget(X,F),D=0;D<E;++D)if(y[D]===-1){var $=M[v[D].uniqueId];m.setTexture(m.textures[$],D)}}}else{var Q={};Q.generateDepthBuffer=this._generateDepthBuffer,Q.generateMipMaps=(c=(l=this.texture)===null||l===void 0?void 0:l.generateMipMaps)!==null&&c!==void 0&&c,Q.generateStencilBuffer=this._generateStencilBuffer,Q.samplingMode=(u=this.texture)===null||u===void 0?void 0:u.samplingMode,Q.type=(d=this.texture)===null||d===void 0?void 0:d.type,Q.format=(h=this.texture)===null||h===void 0?void 0:h.format,Q.noColorAttachment=!this._textures,Q.label=this.label,this.isCube?m=this._engine.createRenderTargetCubeTexture(this.width,Q):(X={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?(p=this.texture)===null||p===void 0?void 0:p.depth:void 0},m=this._engine.createRenderTargetTexture(X,Q)),m.texture&&(m.texture.isReady=!0)}return m},o.prototype._swapRenderTargetWrapper=function(a){if(this._textures&&a._textures)for(var s=0;s<this._textures.length;++s)this._textures[s]._swapAndDie(a._textures[s],!1),a._textures[s].isReady=!0;this._depthStencilTexture&&a._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(a._depthStencilTexture),a._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null},o.prototype._rebuild=function(){var a=this._cloneRenderTargetWrapper();if(a){if(this._depthStencilTexture){var s=this._depthStencilTexture.samplingMode,l=this._depthStencilTexture.format,c=s===n.Y.TEXTURE_BILINEAR_SAMPLINGMODE||s===n.Y.TEXTURE_TRILINEAR_SAMPLINGMODE||s===n.Y.TEXTURE_LINEAR_LINEAR_MIPNEAREST;a.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,c,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,l,this._depthStencilTextureLabel)}this.samples>1&&a.setSamples(this.samples),a._swapRenderTargetWrapper(this),a.dispose()}},o.prototype.releaseTextures=function(){var a,s;if(this._textures)for(var l=0;(s=l<((a=this._textures)===null||a===void 0?void 0:a.length))!==null&&s!==void 0&&s;++l)this._textures[l].dispose();this._textures=null},o.prototype.dispose=function(a){var s;a===void 0&&(a=!1),a||((s=this._depthStencilTexture)===null||s===void 0||s.dispose(),this._depthStencilTexture=null,this.releaseTextures()),this._engine._releaseRenderTargetWrapper(this)},o}()},98519:(r,t,e)=>{e.d(t,{l:()=>n});var n=function(){function i(){}return i.GetShadersRepository=function(o){return o===void 0&&(o=0),o===0?i.ShadersRepository:i.ShadersRepositoryWGSL},i.GetShadersStore=function(o){return o===void 0&&(o=0),o===0?i.ShadersStore:i.ShadersStoreWGSL},i.GetIncludesShadersStore=function(o){return o===void 0&&(o=0),o===0?i.IncludesShadersStore:i.IncludesShadersStoreWGSL},i.ShadersRepository="src/Shaders/",i.ShadersStore={},i.IncludesShadersStore={},i.ShadersRepositoryWGSL="src/ShadersWGSL/",i.ShadersStoreWGSL={},i.IncludesShadersStoreWGSL={},i}()},53399:(r,t,e)=>{e.d(t,{C5:()=>E,Cm:()=>l,EX:()=>u,GX:()=>d,N5:()=>s,YM:()=>m,bS:()=>C,kf:()=>c,tI:()=>h,tg:()=>p});var n=e(14737),i=e(24894),o=new WeakMap,a={_webGLVersion:2,cachedPipelines:{}};function s(T){var f=o.get(T);if(!f){if(!T)return a;f={_webGLVersion:T.TEXTURE_BINDING_3D?2:1,_context:T,cachedPipelines:{}},o.set(T,f)}return f}function l(T){o.delete(T)}function c(T,f,g,S,y,x){var R,I=s(S);return x||(x=(R=I._createShaderProgramInjection)!==null&&R!==void 0?R:h),x(T,b(f,"vertex",S,I._contextWasLost),b(g,"fragment",S,I._contextWasLost),S,y,I.validateShaderPrograms)}function u(T,f,g,S,y,x,R){var I;x===void 0&&(x=null);var M=s(y);R||(R=(I=M._createShaderProgramInjection)!==null&&I!==void 0?I:h);var D=M._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"";return R(T,v(f,"vertex",S,D,y,M._contextWasLost),v(g,"fragment",S,D,y,M._contextWasLost),y,x,M.validateShaderPrograms)}function d(T,f){var g=new n.x,S=s(T);return S.parallelShaderCompile&&(g.isParallelCompiled=!0),g.context=S._context,g}function h(T,f,g,S,y,x){var R=S.createProgram();if(T.program=R,!R)throw new Error("Unable to create program");return S.attachShader(R,f),S.attachShader(R,g),S.linkProgram(R),T.context=S,T.vertexShader=f,T.fragmentShader=g,T.isParallelCompiled||p(T,S,x),R}function p(T,f,g){var S=T.context,y=T.vertexShader,x=T.fragmentShader,R=T.program;if(!S.getProgramParameter(R,S.LINK_STATUS)){var I,M;if(!f.getShaderParameter(y,f.COMPILE_STATUS)&&(I=f.getShaderInfoLog(y)))throw T.vertexCompilationError=I,new Error("VERTEX SHADER "+I);if(!f.getShaderParameter(x,f.COMPILE_STATUS)&&(I=f.getShaderInfoLog(x)))throw T.fragmentCompilationError=I,new Error("FRAGMENT SHADER "+I);if(M=S.getProgramInfoLog(R))throw T.programLinkError=M,new Error(M)}if(g&&(S.validateProgram(R),!S.getProgramParameter(R,S.VALIDATE_STATUS)&&(M=S.getProgramInfoLog(R))))throw T.programValidationError=M,new Error(M);S.deleteShader(y),S.deleteShader(x),T.vertexShader=void 0,T.fragmentShader=void 0,T.onCompiled&&(T.onCompiled(),T.onCompiled=void 0)}function m(T,f,g,S,y,x,R,I,M,D,B,F,X){var $,Q,ie=s(T.context);F||(F=($=ie.createRawShaderProgramInjection)!==null&&$!==void 0?$:c),X||(X=(Q=ie.createShaderProgramInjection)!==null&&Q!==void 0?Q:u);var q=T;q.program=S?F(q,f,g,q.context,M):X(q,f,g,I,q.context,M),q.program.__SPECTOR_rebuildProgram=R,B()}function v(T,f,g,S,y,x){return b((0,i.iL)(T,g,S),f,y,x)}function b(T,f,g,S){var y=g.createShader(f==="vertex"?g.VERTEX_SHADER:g.FRAGMENT_SHADER);if(!y){for(var x=g.NO_ERROR,R=g.NO_ERROR;(R=g.getError())!==g.NO_ERROR;)x=R;throw new Error("Something went wrong while creating a gl ".concat(f," shader object. gl error=").concat(x,", gl isContextLost=").concat(g.isContextLost(),", _contextWasLost=").concat(S))}return g.shaderSource(y,T),g.compileShader(y),y}function E(T,f){f.useProgram(T)}function C(T,f){var g=T;if(g.isParallelCompiled){var S=g.onCompiled;g.onCompiled=function(){S?.(),f(T)}}else f(T)}},96352:(r,t,e)=>{e.d(t,{w:()=>f});var n=e(78322),i=e(53399),o=e(92118),a=e(7164),s=e(5153),l=function(){function g(){this.shaderLanguage=0}return g.prototype.postProcessor=function(S,y,x,R,I){return I.drawBuffersExtensionDisabled&&(S=S.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")),S},g}(),c=e(24054),u=e(26218),d=e(87074),h=e(82673),p=e(81152),m=e(90519),v=e(19133),b=e(74239),E=e(24894),C=e(76320),T=function(){},f=function(g){function S(y,x,R,I){var M=this;if(R=R||{},(M=g.call(this,x??R.antialias,R,I)||this)._name="WebGL",M.forcePOTTextures=!1,M.validateShaderPrograms=!1,M.disableUniformBuffers=!1,M._webGLVersion=1,M._vertexAttribArraysEnabled=[],M._uintIndicesCurrentlySet=!1,M._currentBoundBuffer=new Array,M._currentFramebuffer=null,M._dummyFramebuffer=null,M._currentBufferPointers=new Array,M._currentInstanceLocations=new Array,M._currentInstanceBuffers=new Array,M._vaoRecordInProgress=!1,M._mustWipeVertexAttributes=!1,M._nextFreeTextureSlots=new Array,M._maxSimultaneousTextures=0,M._maxMSAASamplesOverride=null,M._unpackFlipYCached=null,M.enableUnpackFlipYCached=!0,M._boundUniforms={},!y)return M;var D=null;if(y.getContext){if(D=y,M._renderingCanvas=D,R.preserveDrawingBuffer===void 0&&(R.preserveDrawingBuffer=!1),R.xrCompatible===void 0&&(R.xrCompatible=!1),navigator&&navigator.userAgent){M._setupMobileChecks();for(var B=navigator.userAgent,F=0,X=S.ExceptionList;F<X.length;F++){var $=X[F],Q=$.key,ie=$.targets;if(new RegExp(Q).test(B)){if($.capture&&$.captureConstraint){var q=$.capture,ee=$.captureConstraint,te=new RegExp(q).exec(B);if(te&&te.length>0&&parseInt(te[te.length-1])>=ee)continue}for(var ce=0,fe=ie;ce<fe.length;ce++)switch(fe[ce]){case"uniformBuffer":M.disableUniformBuffers=!0;break;case"vao":M.disableVertexArrayObjects=!0;break;case"antialias":R.antialias=!1;break;case"maxMSAASamples":M._maxMSAASamplesOverride=1}}}}if(M._doNotHandleContextLost||(M._onContextLost=function(N){N.preventDefault(),M._contextWasLost=!0,a.V.Warn("WebGL context lost."),M.onContextLostObservable.notifyObservers(M)},M._onContextRestored=function(){M._restoreEngineAfterContextLost(function(){return M._initGLContext()})},D.addEventListener("webglcontextlost",M._onContextLost,!1),D.addEventListener("webglcontextrestored",M._onContextRestored,!1),R.powerPreference=R.powerPreference||"high-performance"),M._badDesktopOS&&(R.xrCompatible=!1),!R.disableWebGL2Support)try{M._gl=D.getContext("webgl2",R)||D.getContext("experimental-webgl2",R),M._gl&&(M._webGLVersion=2,M._shaderPlatformName="WEBGL2",M._gl.deleteQuery||(M._webGLVersion=1,M._shaderPlatformName="WEBGL1"))}catch{}if(!M._gl){if(!D)throw new Error("The provided canvas is null or undefined.");try{M._gl=D.getContext("webgl",R)||D.getContext("experimental-webgl",R)}catch{throw new Error("WebGL not supported")}}if(!M._gl)throw new Error("WebGL not supported")}else{M._gl=y,M._renderingCanvas=M._gl.canvas,M._gl.renderbufferStorageMultisample?(M._webGLVersion=2,M._shaderPlatformName="WEBGL2"):M._shaderPlatformName="WEBGL1";var de=M._gl.getContextAttributes();de&&(R.stencil=de.stencil)}M._gl.pixelStorei(M._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,M._gl.NONE),R.useHighPrecisionFloats!==void 0&&(M._highPrecisionShadersAllowed=R.useHighPrecisionFloats),M.resize(),M._initGLContext(),M._initFeatures();for(var Te=0;Te<M._caps.maxVertexAttribs;Te++)M._currentBufferPointers[Te]=new T;M._shaderProcessor=M.webGLVersion>1?new c.B:new l;var ue="Babylon.js v".concat(S.Version);a.V.Log(ue+" - ".concat(M.description)),M._renderingCanvas&&M._renderingCanvas.setAttribute&&M._renderingCanvas.setAttribute("data-engine",ue);var U=(0,i.N5)(M._gl);return U.validateShaderPrograms=M.validateShaderPrograms,U.parallelShaderCompile=M._caps.parallelShaderCompile,M}return(0,n.C6)(S,g),Object.defineProperty(S.prototype,"name",{get:function(){return this._name},set:function(y){this._name=y},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"version",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),Object.defineProperty(S,"ShadersRepository",{get:function(){return b.M.ShadersRepository},set:function(y){b.M.ShadersRepository=y},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"framebufferDimensionsObject",{set:function(y){this._framebufferDimensionsObject=y},enumerable:!1,configurable:!0}),S.prototype.snapshotRenderingReset=function(){this.snapshotRendering=!1},S.prototype._clearEmptyResources=function(){this._dummyFramebuffer=null,g.prototype._clearEmptyResources.call(this)},S.prototype._getShaderProcessingContext=function(y){return null},S.prototype.areAllEffectsReady=function(){for(var y in this._compiledEffects)if(!this._compiledEffects[y].isReady())return!1;return!0},S.prototype._initGLContext=function(){var y;this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||this._gl.getExtension("OES_standard_derivatives")!==null,maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||this._gl.getExtension("OES_element_index_uint")!==null,fragmentDepthSupported:this._webGLVersion>1||this._gl.getExtension("EXT_frag_depth")!==null,highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:this._webGLVersion!==1,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);var x=this._gl.getExtension("WEBGL_debug_renderer_info");if(x!=null&&(this._glRenderer=this._gl.getParameter(x.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(x.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),this._gl.HALF_FLOAT_OES!==36193&&(this._gl.HALF_FLOAT_OES=36193),this._gl.RGBA16F!==34842&&(this._gl.RGBA16F=34842),this._gl.RGBA32F!==34836&&(this._gl.RGBA32F=34836),this._gl.DEPTH24_STENCIL8!==35056&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(this._webGLVersion===1&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=((y=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT))!==null&&y!==void 0?y:0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&this._gl.HALF_FLOAT_OES!==5131&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._maxMSAASamplesOverride!==null?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{var R=this._gl.getExtension("WEBGL_draw_buffers");if(R!==null){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=R.drawBuffersWEBGL.bind(R),this._caps.maxDrawBuffers=this._gl.getParameter(R.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var I=0;I<16;I++)this._gl["COLOR_ATTACHMENT"+I+"_WEBGL"]=R["COLOR_ATTACHMENT"+I+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var M=this._gl.getExtension("WEBGL_depth_texture");M!=null&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=M.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var D=this._gl.getExtension("OES_vertex_array_object");D!=null&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=D.createVertexArrayOES.bind(D),this._gl.bindVertexArray=D.bindVertexArrayOES.bind(D),this._gl.deleteVertexArray=D.deleteVertexArrayOES.bind(D))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var B=this._gl.getExtension("ANGLE_instanced_arrays");B!=null?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=B.drawArraysInstancedANGLE.bind(B),this._gl.drawElementsInstanced=B.drawElementsInstancedANGLE.bind(B),this._gl.vertexAttribDivisor=B.vertexAttribDivisorANGLE.bind(B)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var F=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),X=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);F&&X&&(this._caps.highPrecisionShaderSupported=F.precision!==0&&X.precision!==0)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var $=this._gl.getExtension("EXT_blend_minmax");$!=null&&(this._caps.blendMinMax=!0,this._gl.MAX=$.MAX_EXT,this._gl.MIN=$.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{var Q=this._gl.getExtension("EXT_sRGB");Q!=null&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:Q.SRGB_EXT,SRGB8:Q.SRGB_ALPHA_EXT,SRGB8_ALPHA8:Q.SRGB_ALPHA_EXT})}if(this._creationOptions){var ie=this._creationOptions.forceSRGBBufferSupportState;ie!==void 0&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&ie)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var q=0;q<this._maxSimultaneousTextures;q++)this._nextFreeTextureSlots.push(q);this._glRenderer==="Mali-G72"&&(this._caps.disableMorphTargetTexture=!0)},S.prototype._initFeatures=function(){this._features={forceBitmapOverHTMLImageElement:typeof HTMLImageElement>"u",supportRenderAndCopyToLodForFloatTextures:this._webGLVersion!==1,supportDepthStencilTexture:this._webGLVersion!==1,supportShadowSamplers:this._webGLVersion!==1,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:this._webGLVersion!==1,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:this._webGLVersion!==1,basisNeedsPOT:this._webGLVersion===1,support3DTextures:this._webGLVersion!==1,needTypeSuffixInShaderConstants:this._webGLVersion!==1,supportMSAA:this._webGLVersion!==1,supportSSAO2:this._webGLVersion!==1,supportIBLShadows:this._webGLVersion!==1,supportExtendedTextureFormats:this._webGLVersion!==1,supportSwitchCaseInShader:this._webGLVersion!==1,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}},Object.defineProperty(S.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),S.prototype.getClassName=function(){return"ThinEngine"},S.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=this.createCanvas(1,1);var y=this._workingCanvas.getContext("2d");y&&(this._workingContext=y)}},S.prototype.getInfo=function(){return this.getGlInfo()},S.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},S.prototype.extractDriverInfo=function(){var y=this.getGlInfo();return y&&y.renderer?y.renderer:""},S.prototype.getRenderWidth=function(y){return y===void 0&&(y=!1),!y&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},S.prototype.getRenderHeight=function(y){return y===void 0&&(y=!1),!y&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},S.prototype.clear=function(y,x,R,I){var M,D;I===void 0&&(I=!1);var B=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=B;var F=0;if(x&&y){var X=!0;if(this._currentRenderTarget){var $=(M=this._currentRenderTarget.texture)===null||M===void 0?void 0:M.format;if($===p.Y.TEXTUREFORMAT_RED_INTEGER||$===p.Y.TEXTUREFORMAT_RG_INTEGER||$===p.Y.TEXTUREFORMAT_RGB_INTEGER||$===p.Y.TEXTUREFORMAT_RGBA_INTEGER){var Q=(D=this._currentRenderTarget.texture)===null||D===void 0?void 0:D.type;Q===p.Y.TEXTURETYPE_UNSIGNED_INTEGER||Q===p.Y.TEXTURETYPE_UNSIGNED_SHORT?(S._TempClearColorUint32[0]=255*y.r,S._TempClearColorUint32[1]=255*y.g,S._TempClearColorUint32[2]=255*y.b,S._TempClearColorUint32[3]=255*y.a,this._gl.clearBufferuiv(this._gl.COLOR,0,S._TempClearColorUint32),X=!1):(S._TempClearColorInt32[0]=255*y.r,S._TempClearColorInt32[1]=255*y.g,S._TempClearColorInt32[2]=255*y.b,S._TempClearColorInt32[3]=255*y.a,this._gl.clearBufferiv(this._gl.COLOR,0,S._TempClearColorInt32),X=!1)}}X&&(this._gl.clearColor(y.r,y.g,y.b,y.a!==void 0?y.a:1),F|=this._gl.COLOR_BUFFER_BIT)}R&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),F|=this._gl.DEPTH_BUFFER_BIT),I&&(this._gl.clearStencil(0),F|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(F)},S.prototype._viewport=function(y,x,R,I){y===this._viewportCached.x&&x===this._viewportCached.y&&R===this._viewportCached.z&&I===this._viewportCached.w||(this._viewportCached.x=y,this._viewportCached.y=x,this._viewportCached.z=R,this._viewportCached.w=I,this._gl.viewport(y,x,R,I))},S.prototype.endFrame=function(){g.prototype.endFrame.call(this),this._badOS&&this.flushFramebuffer()},Object.defineProperty(S.prototype,"performanceMonitor",{get:function(){throw new Error("Not Supported by ThinEngine")},enumerable:!1,configurable:!0}),S.prototype.bindFramebuffer=function(y,x,R,I,M,D,B){var F,X,$,Q,ie,q;x===void 0&&(x=0),D===void 0&&(D=0),B===void 0&&(B=0);var ee=y;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=y,this._bindUnboundFramebuffer(ee._framebuffer);var te=this._gl;y.isMulti||(y.is2DArray||y.is3D?(te.framebufferTextureLayer(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,(F=y.texture._hardwareTexture)===null||F===void 0?void 0:F.underlyingResource,D,B),ee._currentLOD=D):y.isCube?te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_CUBE_MAP_POSITIVE_X+x,(X=y.texture._hardwareTexture)===null||X===void 0?void 0:X.underlyingResource,D):ee._currentLOD!==D&&(te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_2D,($=y.texture._hardwareTexture)===null||$===void 0?void 0:$.underlyingResource,D),ee._currentLOD=D));var ce=y._depthStencilTexture;if(ce){y.is3D&&(y.texture.width===ce.width&&y.texture.height===ce.height&&y.texture.depth===ce.depth||a.V.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));var fe=y._depthStencilTextureWithStencil?te.DEPTH_STENCIL_ATTACHMENT:te.DEPTH_ATTACHMENT;y.is2DArray||y.is3D?te.framebufferTextureLayer(te.FRAMEBUFFER,fe,(Q=ce._hardwareTexture)===null||Q===void 0?void 0:Q.underlyingResource,D,B):y.isCube?te.framebufferTexture2D(te.FRAMEBUFFER,fe,te.TEXTURE_CUBE_MAP_POSITIVE_X+x,(ie=ce._hardwareTexture)===null||ie===void 0?void 0:ie.underlyingResource,D):te.framebufferTexture2D(te.FRAMEBUFFER,fe,te.TEXTURE_2D,(q=ce._hardwareTexture)===null||q===void 0?void 0:q.underlyingResource,D)}ee._MSAAFramebuffer&&this._bindUnboundFramebuffer(ee._MSAAFramebuffer),this._cachedViewport&&!M?this.setViewport(this._cachedViewport,R,I):(R||(R=y.width,D&&(R/=Math.pow(2,D))),I||(I=y.height,D&&(I/=Math.pow(2,D))),this._viewport(0,0,R,I)),this.wipeCaches()},S.prototype.setState=function(y,x,R,I,M,D,B){var F,X;x===void 0&&(x=0),I===void 0&&(I=!1),B===void 0&&(B=0),(this._depthCullingState.cull!==y||R)&&(this._depthCullingState.cull=y);var $=(X=(F=this.cullBackFaces)!==null&&F!==void 0?F:M)===null||X===void 0||X?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==$||R)&&(this._depthCullingState.cullFace=$),this.setZOffset(x),this.setZOffsetUnits(B);var Q=I?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==Q||R)&&(this._depthCullingState.frontFace=Q),this._stencilStateComposer.stencilMaterial=D},S.prototype._bindUnboundFramebuffer=function(y){this._currentFramebuffer!==y&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,y),this._currentFramebuffer=y)},S.prototype._currentFrameBufferIsDefaultFrameBuffer=function(){return this._currentFramebuffer===null},S.prototype.generateMipmaps=function(y){var x=this._getTextureTarget(y);this._bindTextureDirectly(x,y,!0),this._gl.generateMipmap(x),this._bindTextureDirectly(x,null)},S.prototype.unBindFramebuffer=function(y,x,R){var I;x===void 0&&(x=!1);var M=y;this._currentRenderTarget=null;var D=this._gl;if(M._MSAAFramebuffer){if(y.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(y,x,R);D.bindFramebuffer(D.READ_FRAMEBUFFER,M._MSAAFramebuffer),D.bindFramebuffer(D.DRAW_FRAMEBUFFER,M._framebuffer),D.blitFramebuffer(0,0,y.width,y.height,0,0,y.width,y.height,D.COLOR_BUFFER_BIT,D.NEAREST)}!(!((I=y.texture)===null||I===void 0)&&I.generateMipMaps)||x||y.isCube||this.generateMipmaps(y.texture),R&&(M._MSAAFramebuffer&&this._bindUnboundFramebuffer(M._framebuffer),R()),this._bindUnboundFramebuffer(null)},S.prototype.flushFramebuffer=function(){this._gl.flush()},S.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},S.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},S.prototype.createVertexBuffer=function(y,x,R){return this._createVertexBuffer(y,this._gl.STATIC_DRAW)},S.prototype._createVertexBuffer=function(y,x){var R=this._gl.createBuffer();if(!R)throw new Error("Unable to create vertex buffer");var I=new u.A(R);return this.bindArrayBuffer(I),typeof y!="number"?y instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(y),x),I.capacity=4*y.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,y,x),I.capacity=y.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(y),x),I.capacity=y),this._resetVertexBufferBinding(),I.references=1,I},S.prototype.createDynamicVertexBuffer=function(y,x){return this._createVertexBuffer(y,this._gl.DYNAMIC_DRAW)},S.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},S.prototype.createIndexBuffer=function(y,x,R){var I=this._gl.createBuffer(),M=new u.A(I);if(!I)throw new Error("Unable to create index buffer");this.bindIndexBuffer(M);var D=this._normalizeIndexData(y);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,D,x?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),M.references=1,M.is32Bits=D.BYTES_PER_ELEMENT===4,M},S.prototype._normalizeIndexData=function(y){if(y.BYTES_PER_ELEMENT===2)return y;if(this._caps.uintIndices){if(y instanceof Uint32Array)return y;for(var x=0;x<y.length;x++)if(y[x]>=65535)return new Uint32Array(y);return new Uint16Array(y)}return new Uint16Array(y)},S.prototype.bindArrayBuffer=function(y){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(y,this._gl.ARRAY_BUFFER)},S.prototype.bindUniformBlock=function(y,x,R){var I=y.program,M=this._gl.getUniformBlockIndex(I,x);this._gl.uniformBlockBinding(I,M,R)},S.prototype.bindIndexBuffer=function(y){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(y,this._gl.ELEMENT_ARRAY_BUFFER)},S.prototype._bindBuffer=function(y,x){(this._vaoRecordInProgress||this._currentBoundBuffer[x]!==y)&&(this._gl.bindBuffer(x,y?y.underlyingResource:null),this._currentBoundBuffer[x]=y)},S.prototype.updateArrayBuffer=function(y){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,y)},S.prototype._vertexAttribPointer=function(y,x,R,I,M,D,B){var F=this._currentBufferPointers[x];if(F){var X=!1;F.active?(F.buffer!==y&&(F.buffer=y,X=!0),F.size!==R&&(F.size=R,X=!0),F.type!==I&&(F.type=I,X=!0),F.normalized!==M&&(F.normalized=M,X=!0),F.stride!==D&&(F.stride=D,X=!0),F.offset!==B&&(F.offset=B,X=!0)):(X=!0,F.active=!0,F.index=x,F.size=R,F.type=I,F.normalized=M,F.stride=D,F.offset=B,F.buffer=y),(X||this._vaoRecordInProgress)&&(this.bindArrayBuffer(y),I===this._gl.UNSIGNED_INT||I===this._gl.INT?this._gl.vertexAttribIPointer(x,R,I,D,B):this._gl.vertexAttribPointer(x,R,I,M,D,B))}},S.prototype._bindIndexBufferWithCache=function(y){y!=null&&this._cachedIndexBuffer!==y&&(this._cachedIndexBuffer=y,this.bindIndexBuffer(y),this._uintIndicesCurrentlySet=y.is32Bits)},S.prototype._bindVertexBuffersAttributes=function(y,x,R){var I=x.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var M=0;M<I.length;M++){var D=x.getAttributeLocation(M);if(D>=0){var B=I[M],F=null;if(R&&(F=R[B]),F||(F=y[B]),!F)continue;this._gl.enableVertexAttribArray(D),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[D]=!0);var X=F.getBuffer();X&&(this._vertexAttribPointer(X,D,F.getSize(),F.type,F.normalized,F.byteStride,F.byteOffset),F.getIsInstanced()&&(this._gl.vertexAttribDivisor(D,F.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(D),this._currentInstanceBuffers.push(X))))}}},S.prototype.recordVertexArrayObject=function(y,x,R,I){var M=this._gl.createVertexArray();if(!M)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(M),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(y,R,I),this.bindIndexBuffer(x),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),M},S.prototype.bindVertexArrayObject=function(y,x){this._cachedVertexArrayObject!==y&&(this._cachedVertexArrayObject=y,this._gl.bindVertexArray(y),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=x!=null&&x.is32Bits,this._mustWipeVertexAttributes=!0)},S.prototype.bindBuffersDirectly=function(y,x,R,I,M){if(this._cachedVertexBuffers!==y||this._cachedEffectForVertexBuffers!==M){this._cachedVertexBuffers=y,this._cachedEffectForVertexBuffers=M;var D=M.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var B=0,F=0;F<D;F++)if(F<R.length){var X=M.getAttributeLocation(F);X>=0&&(this._gl.enableVertexAttribArray(X),this._vertexAttribArraysEnabled[X]=!0,this._vertexAttribPointer(y,X,R[F],this._gl.FLOAT,!1,I,B)),B+=4*R[F]}}this._bindIndexBufferWithCache(x)},S.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},S.prototype.bindBuffers=function(y,x,R,I){this._cachedVertexBuffers===y&&this._cachedEffectForVertexBuffers===R||(this._cachedVertexBuffers=y,this._cachedEffectForVertexBuffers=R,this._bindVertexBuffersAttributes(y,R,I)),this._bindIndexBufferWithCache(x)},S.prototype.unbindInstanceAttributes=function(){for(var y,x=0,R=this._currentInstanceLocations.length;x<R;x++){var I=this._currentInstanceBuffers[x];y!=I&&I.references&&(y=I,this.bindArrayBuffer(I));var M=this._currentInstanceLocations[x];this._gl.vertexAttribDivisor(M,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},S.prototype.releaseVertexArrayObject=function(y){this._gl.deleteVertexArray(y)},S.prototype._releaseBuffer=function(y){return y.references--,y.references===0&&(this._deleteBuffer(y),!0)},S.prototype._deleteBuffer=function(y){this._gl.deleteBuffer(y.underlyingResource)},S.prototype.updateAndBindInstancesBuffer=function(y,x,R){if(this.bindArrayBuffer(y),x&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,x),R[0].index!==void 0)this.bindInstancesBuffer(y,R,!0);else for(var I=0;I<4;I++){var M=R[I];this._vertexAttribArraysEnabled[M]||(this._gl.enableVertexAttribArray(M),this._vertexAttribArraysEnabled[M]=!0),this._vertexAttribPointer(y,M,4,this._gl.FLOAT,!1,64,16*I),this._gl.vertexAttribDivisor(M,1),this._currentInstanceLocations.push(M),this._currentInstanceBuffers.push(y)}},S.prototype.bindInstancesBuffer=function(y,x,R){R===void 0&&(R=!0),this.bindArrayBuffer(y);var I=0;if(R)for(var M=0;M<x.length;M++)I+=4*(D=x[M]).attributeSize;for(M=0;M<x.length;M++){var D;(D=x[M]).index===void 0&&(D.index=this._currentEffect.getAttributeLocationByName(D.attributeName)),D.index<0||(this._vertexAttribArraysEnabled[D.index]||(this._gl.enableVertexAttribArray(D.index),this._vertexAttribArraysEnabled[D.index]=!0),this._vertexAttribPointer(y,D.index,D.attributeSize,D.attributeType||this._gl.FLOAT,D.normalized||!1,I,D.offset),this._gl.vertexAttribDivisor(D.index,D.divisor===void 0?1:D.divisor),this._currentInstanceLocations.push(D.index),this._currentInstanceBuffers.push(y))}},S.prototype.disableInstanceAttributeByName=function(y){if(this._currentEffect){var x=this._currentEffect.getAttributeLocationByName(y);this.disableInstanceAttribute(x)}},S.prototype.disableInstanceAttribute=function(y){for(var x,R=!1;(x=this._currentInstanceLocations.indexOf(y))!==-1;)this._currentInstanceLocations.splice(x,1),this._currentInstanceBuffers.splice(x,1),R=!0,x=this._currentInstanceLocations.indexOf(y);R&&(this._gl.vertexAttribDivisor(y,0),this.disableAttributeByIndex(y))},S.prototype.disableAttributeByIndex=function(y){this._gl.disableVertexAttribArray(y),this._vertexAttribArraysEnabled[y]=!1,this._currentBufferPointers[y].active=!1},S.prototype.draw=function(y,x,R,I){this.drawElementsType(y?p.Y.MATERIAL_TriangleFillMode:p.Y.MATERIAL_WireFrameFillMode,x,R,I)},S.prototype.drawPointClouds=function(y,x,R){this.drawArraysType(p.Y.MATERIAL_PointFillMode,y,x,R)},S.prototype.drawUnIndexed=function(y,x,R,I){this.drawArraysType(y?p.Y.MATERIAL_TriangleFillMode:p.Y.MATERIAL_WireFrameFillMode,x,R,I)},S.prototype.drawElementsType=function(y,x,R,I){this.applyStates(),this._reportDrawCall();var M=this._drawMode(y),D=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,B=this._uintIndicesCurrentlySet?4:2;I?this._gl.drawElementsInstanced(M,R,D,x*B,I):this._gl.drawElements(M,R,D,x*B)},S.prototype.drawArraysType=function(y,x,R,I){this.applyStates(),this._reportDrawCall();var M=this._drawMode(y);I?this._gl.drawArraysInstanced(M,x,R,I):this._gl.drawArrays(M,x,R)},S.prototype._drawMode=function(y){switch(y){case p.Y.MATERIAL_TriangleFillMode:return this._gl.TRIANGLES;case p.Y.MATERIAL_PointFillMode:return this._gl.POINTS;case p.Y.MATERIAL_WireFrameFillMode:return this._gl.LINES;case p.Y.MATERIAL_PointListDrawMode:return this._gl.POINTS;case p.Y.MATERIAL_LineListDrawMode:return this._gl.LINES;case p.Y.MATERIAL_LineLoopDrawMode:return this._gl.LINE_LOOP;case p.Y.MATERIAL_LineStripDrawMode:return this._gl.LINE_STRIP;case p.Y.MATERIAL_TriangleStripDrawMode:return this._gl.TRIANGLE_STRIP;case p.Y.MATERIAL_TriangleFanDrawMode:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},S.prototype._releaseEffect=function(y){this._compiledEffects[y._key]&&delete this._compiledEffects[y._key];var x=y.getPipelineContext();x&&this._deletePipelineContext(x)},S.prototype._deletePipelineContext=function(y){var x=y;x&&x.program&&(x.program.__SPECTOR_rebuildProgram=null,(0,C.mO)(x),this._gl.deleteProgram(x.program))},S.prototype._getGlobalDefines=function(y){return(0,E.xt)(y,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)},S.prototype.createEffect=function(y,x,R,I,M,D,B,F,X,$,Q){var ie,q,ee;$===void 0&&($=0);var te=typeof y=="string"?y:y.vertexToken||y.vertexSource||y.vertexElement||y.vertex,ce=typeof y=="string"?y:y.fragmentToken||y.fragmentSource||y.fragmentElement||y.fragment,fe=this._getGlobalDefines(),de=(ie=M??x.defines)!==null&&ie!==void 0?ie:"";fe&&(de+=fe);var Te=te+"+"+ce+"@"+de;if(this._compiledEffects[Te]){var ue=this._compiledEffects[Te];return B&&ue.isReady()&&B(ue),ue._refCount++,ue}this._gl&&(0,i.N5)(this._gl);var U=new b.M(y,x,R,I,this,M,D,B,F,X,Te,(q=x.shaderLanguage)!==null&&q!==void 0?q:$,(ee=x.extraInitializationsAsync)!==null&&ee!==void 0?ee:Q);return this._compiledEffects[Te]=U,U},S.prototype._getShaderSource=function(y){return this._gl.getShaderSource(y)},S.prototype.createRawShaderProgram=function(y,x,R,I,M){M===void 0&&(M=null);var D=(0,i.N5)(this._gl);return D._contextWasLost=this._contextWasLost,D.validateShaderPrograms=this.validateShaderPrograms,(0,i.kf)(y,x,R,I||this._gl,M)},S.prototype.createShaderProgram=function(y,x,R,I,M,D){D===void 0&&(D=null);var B=(0,i.N5)(this._gl);return B._contextWasLost=this._contextWasLost,B.validateShaderPrograms=this.validateShaderPrograms,(0,i.EX)(y,x,R,I,M||this._gl,D)},S.prototype.inlineShaderCode=function(y){return y},S.prototype.createPipelineContext=function(y){this._gl&&((0,i.N5)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile);var x=(0,i.GX)(this._gl,y);return x.engine=this,x},S.prototype.createMaterialContext=function(){},S.prototype.createDrawContext=function(){},S.prototype._finalizePipelineContext=function(y){return(0,i.tg)(y,this._gl,this.validateShaderPrograms)},S.prototype._preparePipelineContext=function(y,x,R,I,M,D,B,F,X,$,Q){var ie=(0,i.N5)(this._gl);return ie._contextWasLost=this._contextWasLost,ie.validateShaderPrograms=this.validateShaderPrograms,ie._createShaderProgramInjection=this._createShaderProgram.bind(this),ie.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),ie.createShaderProgramInjection=this.createShaderProgram.bind(this),ie.loadFileInjection=this._loadFile.bind(this),(0,i.YM)(y,x,R,I,M,D,B,F,X,$,Q)},S.prototype._createShaderProgram=function(y,x,R,I,M){return M===void 0&&(M=null),(0,i.tI)(y,x,R,I,M)},S.prototype._isRenderingStateCompiled=function(y){var x=y;return!(this._isDisposed||x._isDisposed||!this._gl.getProgramParameter(x.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)||(this._finalizePipelineContext(x),0))},S.prototype._executeWhenRenderingStateIsCompiled=function(y,x){(0,i.bS)(y,x)},S.prototype.getUniforms=function(y,x){for(var R=new Array,I=y,M=0;M<x.length;M++)R.push(this._gl.getUniformLocation(I.program,x[M]));return R},S.prototype.getAttributes=function(y,x){for(var R=[],I=y,M=0;M<x.length;M++)try{R.push(this._gl.getAttribLocation(I.program,x[M]))}catch{R.push(-1)}return R},S.prototype.enableEffect=function(y){(y=y!==null&&(0,o.E)(y)?y.effect:y)&&y!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(y),this._currentEffect=y,y.onBind&&y.onBind(y),y._onBindObservable&&y._onBindObservable.notifyObservers(y))},S.prototype.setInt=function(y,x){return!!y&&(this._gl.uniform1i(y,x),!0)},S.prototype.setInt2=function(y,x,R){return!!y&&(this._gl.uniform2i(y,x,R),!0)},S.prototype.setInt3=function(y,x,R,I){return!!y&&(this._gl.uniform3i(y,x,R,I),!0)},S.prototype.setInt4=function(y,x,R,I,M){return!!y&&(this._gl.uniform4i(y,x,R,I,M),!0)},S.prototype.setIntArray=function(y,x){return!!y&&(this._gl.uniform1iv(y,x),!0)},S.prototype.setIntArray2=function(y,x){return!(!y||x.length%2!=0||(this._gl.uniform2iv(y,x),0))},S.prototype.setIntArray3=function(y,x){return!(!y||x.length%3!=0||(this._gl.uniform3iv(y,x),0))},S.prototype.setIntArray4=function(y,x){return!(!y||x.length%4!=0||(this._gl.uniform4iv(y,x),0))},S.prototype.setUInt=function(y,x){return!!y&&(this._gl.uniform1ui(y,x),!0)},S.prototype.setUInt2=function(y,x,R){return!!y&&(this._gl.uniform2ui(y,x,R),!0)},S.prototype.setUInt3=function(y,x,R,I){return!!y&&(this._gl.uniform3ui(y,x,R,I),!0)},S.prototype.setUInt4=function(y,x,R,I,M){return!!y&&(this._gl.uniform4ui(y,x,R,I,M),!0)},S.prototype.setUIntArray=function(y,x){return!!y&&(this._gl.uniform1uiv(y,x),!0)},S.prototype.setUIntArray2=function(y,x){return!(!y||x.length%2!=0||(this._gl.uniform2uiv(y,x),0))},S.prototype.setUIntArray3=function(y,x){return!(!y||x.length%3!=0||(this._gl.uniform3uiv(y,x),0))},S.prototype.setUIntArray4=function(y,x){return!(!y||x.length%4!=0||(this._gl.uniform4uiv(y,x),0))},S.prototype.setArray=function(y,x){return!(!y||x.length<1||(this._gl.uniform1fv(y,x),0))},S.prototype.setArray2=function(y,x){return!(!y||x.length%2!=0||(this._gl.uniform2fv(y,x),0))},S.prototype.setArray3=function(y,x){return!(!y||x.length%3!=0||(this._gl.uniform3fv(y,x),0))},S.prototype.setArray4=function(y,x){return!(!y||x.length%4!=0||(this._gl.uniform4fv(y,x),0))},S.prototype.setMatrices=function(y,x){return!!y&&(this._gl.uniformMatrix4fv(y,!1,x),!0)},S.prototype.setMatrix3x3=function(y,x){return!!y&&(this._gl.uniformMatrix3fv(y,!1,x),!0)},S.prototype.setMatrix2x2=function(y,x){return!!y&&(this._gl.uniformMatrix2fv(y,!1,x),!0)},S.prototype.setFloat=function(y,x){return!!y&&(this._gl.uniform1f(y,x),!0)},S.prototype.setFloat2=function(y,x,R){return!!y&&(this._gl.uniform2f(y,x,R),!0)},S.prototype.setFloat3=function(y,x,R,I){return!!y&&(this._gl.uniform3f(y,x,R,I),!0)},S.prototype.setFloat4=function(y,x,R,I,M){return!!y&&(this._gl.uniform4f(y,x,R,I,M),!0)},S.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var y=this._colorWrite;this._gl.colorMask(y,y,y,y)}},S.prototype.wipeCaches=function(y){this.preventCacheWipeBetweenFrames&&!y||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),y&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=p.Y.ALPHA_ADD,this._alphaEquation=p.Y.ALPHA_DISABLE,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},S.prototype._getSamplingParameters=function(y,x){var R=this._gl,I=R.NEAREST,M=R.NEAREST;switch(y){case p.Y.TEXTURE_LINEAR_LINEAR_MIPNEAREST:I=R.LINEAR,M=x?R.LINEAR_MIPMAP_NEAREST:R.LINEAR;break;case p.Y.TEXTURE_LINEAR_LINEAR_MIPLINEAR:I=R.LINEAR,M=x?R.LINEAR_MIPMAP_LINEAR:R.LINEAR;break;case p.Y.TEXTURE_NEAREST_NEAREST_MIPLINEAR:I=R.NEAREST,M=x?R.NEAREST_MIPMAP_LINEAR:R.NEAREST;break;case p.Y.TEXTURE_NEAREST_NEAREST_MIPNEAREST:I=R.NEAREST,M=x?R.NEAREST_MIPMAP_NEAREST:R.NEAREST;break;case p.Y.TEXTURE_NEAREST_LINEAR_MIPNEAREST:I=R.NEAREST,M=x?R.LINEAR_MIPMAP_NEAREST:R.LINEAR;break;case p.Y.TEXTURE_NEAREST_LINEAR_MIPLINEAR:I=R.NEAREST,M=x?R.LINEAR_MIPMAP_LINEAR:R.LINEAR;break;case p.Y.TEXTURE_NEAREST_LINEAR:I=R.NEAREST,M=R.LINEAR;break;case p.Y.TEXTURE_NEAREST_NEAREST:I=R.NEAREST,M=R.NEAREST;break;case p.Y.TEXTURE_LINEAR_NEAREST_MIPNEAREST:I=R.LINEAR,M=x?R.NEAREST_MIPMAP_NEAREST:R.NEAREST;break;case p.Y.TEXTURE_LINEAR_NEAREST_MIPLINEAR:I=R.LINEAR,M=x?R.NEAREST_MIPMAP_LINEAR:R.NEAREST;break;case p.Y.TEXTURE_LINEAR_LINEAR:I=R.LINEAR,M=R.LINEAR;break;case p.Y.TEXTURE_LINEAR_NEAREST:I=R.LINEAR,M=R.NEAREST}return{min:M,mag:I}},S.prototype._createTexture=function(){var y=this._gl.createTexture();if(!y)throw new Error("Unable to create texture");return y},S.prototype._createHardwareTexture=function(){return new m.d(this._createTexture(),this._gl)},S.prototype._createInternalTexture=function(y,x,R,I){var M;I===void 0&&(I=0);var D,B=!1,F=p.Y.TEXTURETYPE_UNSIGNED_INT,X=p.Y.TEXTURE_TRILINEAR_SAMPLINGMODE,$=p.Y.TEXTUREFORMAT_RGBA,Q=!1,ie=1;x!==void 0&&typeof x=="object"?(B=!!x.generateMipMaps,F=x.type===void 0?p.Y.TEXTURETYPE_UNSIGNED_INT:x.type,X=x.samplingMode===void 0?p.Y.TEXTURE_TRILINEAR_SAMPLINGMODE:x.samplingMode,$=x.format===void 0?p.Y.TEXTUREFORMAT_RGBA:x.format,Q=x.useSRGBBuffer!==void 0&&x.useSRGBBuffer,ie=(M=x.samples)!==null&&M!==void 0?M:1,D=x.label):B=!!x,Q&&(Q=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(F!==p.Y.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(F!==p.Y.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(X=p.Y.TEXTURE_NEAREST_SAMPLINGMODE),F!==p.Y.TEXTURETYPE_FLOAT||this._caps.textureFloat||(F=p.Y.TEXTURETYPE_UNSIGNED_INT,a.V.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));var q=this._gl,ee=new v.h(this,I),te=y.width||y,ce=y.height||y,fe=y.depth||0,de=y.layers||0,Te=this._getSamplingParameters(X,B),ue=de!==0?q.TEXTURE_2D_ARRAY:fe!==0?q.TEXTURE_3D:q.TEXTURE_2D,U=this._getRGBABufferInternalSizedFormat(F,$,Q),N=this._getInternalFormat($),w=this._getWebGLTextureType(F);return this._bindTextureDirectly(ue,ee),de!==0?(ee.is2DArray=!0,q.texImage3D(ue,0,U,te,ce,de,0,N,w,null)):fe!==0?(ee.is3D=!0,q.texImage3D(ue,0,U,te,ce,fe,0,N,w,null)):q.texImage2D(ue,0,U,te,ce,0,N,w,null),q.texParameteri(ue,q.TEXTURE_MAG_FILTER,Te.mag),q.texParameteri(ue,q.TEXTURE_MIN_FILTER,Te.min),q.texParameteri(ue,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(ue,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),B&&this._gl.generateMipmap(ue),this._bindTextureDirectly(ue,null),ee._useSRGBBuffer=Q,ee.baseWidth=te,ee.baseHeight=ce,ee.width=te,ee.height=ce,ee.depth=de,ee.isReady=!0,ee.samples=ie,ee.generateMipMaps=B,ee.samplingMode=X,ee.type=F,ee.format=$,ee.label=D,this._internalTexturesCache.push(ee),ee},S.prototype._getUseSRGBBuffer=function(y,x){return y&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||x)},S.prototype.createTexture=function(y,x,R,I,M,D,B,F,X,$,Q,ie,q,ee,te){var ce=this;return M===void 0&&(M=p.Y.TEXTURE_TRILINEAR_SAMPLINGMODE),D===void 0&&(D=null),B===void 0&&(B=null),F===void 0&&(F=null),X===void 0&&(X=null),$===void 0&&($=null),Q===void 0&&(Q=null),this._createTextureBase(y,x,R,I,M,D,B,function(){for(var fe=[],de=0;de<arguments.length;de++)fe[de]=arguments[de];return ce._prepareWebGLTexture.apply(ce,(0,n.fX)((0,n.fX)([],fe,!1),[$],!1))},function(fe,de,Te,ue,U,N){var w=ce._gl,k=Te.width===fe&&Te.height===de;U._creationFlags=ee??0;var J=ce._getTexImageParametersForCreateTexture(U.format,U._useSRGBBuffer);if(k)return w.texImage2D(w.TEXTURE_2D,0,J.internalFormat,J.format,J.type,Te),!1;var le=ce._caps.maxTextureSize;if(Te.width>le||Te.height>le||!ce._supportsHardwareTextureRescaling)return ce._prepareWorkingCanvas(),!(!ce._workingCanvas||!ce._workingContext||(ce._workingCanvas.width=fe,ce._workingCanvas.height=de,ce._workingContext.drawImage(Te,0,0,Te.width,Te.height,0,0,fe,de),w.texImage2D(w.TEXTURE_2D,0,J.internalFormat,J.format,J.type,ce._workingCanvas),U.width=fe,U.height=de,1));var be=new v.h(ce,2);return ce._bindTextureDirectly(w.TEXTURE_2D,be,!0),w.texImage2D(w.TEXTURE_2D,0,J.internalFormat,J.format,J.type,Te),ce._rescaleTexture(be,U,I,J.format,function(){ce._releaseTexture(be),ce._bindTextureDirectly(w.TEXTURE_2D,U,!0),N()}),!0},F,X,$,Q,ie,q,te)},S.prototype._getTexImageParametersForCreateTexture=function(y,x){var R,I;return this.webGLVersion===1?I=R=this._getInternalFormat(y,x):(R=this._getInternalFormat(y,!1),I=this._getRGBABufferInternalSizedFormat(p.Y.TEXTURETYPE_UNSIGNED_BYTE,y,x)),{internalFormat:I,format:R,type:this._gl.UNSIGNED_BYTE}},S.prototype._rescaleTexture=function(y,x,R,I,M){},S.prototype._unpackFlipY=function(y){this._unpackFlipYCached!==y&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,y?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=y))},S.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},S.prototype._getTextureTarget=function(y){return y.isCube?this._gl.TEXTURE_CUBE_MAP:y.is3D?this._gl.TEXTURE_3D:y.is2DArray||y.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},S.prototype.updateTextureSamplingMode=function(y,x,R){R===void 0&&(R=!1);var I=this._getTextureTarget(x),M=this._getSamplingParameters(y,x.useMipMaps||R);this._setTextureParameterInteger(I,this._gl.TEXTURE_MAG_FILTER,M.mag,x),this._setTextureParameterInteger(I,this._gl.TEXTURE_MIN_FILTER,M.min),R&&(x.generateMipMaps=!0,this._gl.generateMipmap(I)),this._bindTextureDirectly(I,null),x.samplingMode=y},S.prototype.updateTextureDimensions=function(y,x,R,I){},S.prototype.updateTextureWrappingMode=function(y,x,R,I){R===void 0&&(R=null),I===void 0&&(I=null);var M=this._getTextureTarget(y);x!==null&&(this._setTextureParameterInteger(M,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(x),y),y._cachedWrapU=x),R!==null&&(this._setTextureParameterInteger(M,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(R),y),y._cachedWrapV=R),(y.is2DArray||y.is3D)&&I!==null&&(this._setTextureParameterInteger(M,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(I),y),y._cachedWrapR=I),this._bindTextureDirectly(M,null)},S.prototype._uploadCompressedDataToTextureDirectly=function(y,x,R,I,M,D,B){D===void 0&&(D=0),B===void 0&&(B=0);var F=this._gl,X=F.TEXTURE_2D;if(y.isCube&&(X=F.TEXTURE_CUBE_MAP_POSITIVE_X+D),y._useSRGBBuffer)switch(x){case p.Y.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2:case p.Y.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL:this._caps.etc2?x=F.COMPRESSED_SRGB8_ETC2:y._useSRGBBuffer=!1;break;case p.Y.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC:this._caps.etc2?x=F.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:y._useSRGBBuffer=!1;break;case p.Y.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM:x=F.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case p.Y.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4:x=F.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case p.Y.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1:this._caps.s3tc_srgb?x=F.COMPRESSED_SRGB_S3TC_DXT1_EXT:y._useSRGBBuffer=!1;break;case p.Y.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1:this._caps.s3tc_srgb?x=F.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:y._useSRGBBuffer=!1;break;case p.Y.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5:this._caps.s3tc_srgb?x=F.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:y._useSRGBBuffer=!1;break;default:y._useSRGBBuffer=!1}this._gl.compressedTexImage2D(X,B,x,R,I,0,M)},S.prototype._uploadDataToTextureDirectly=function(y,x,R,I,M,D){R===void 0&&(R=0),I===void 0&&(I=0),D===void 0&&(D=!1);var B=this._gl,F=this._getWebGLTextureType(y.type),X=this._getInternalFormat(y.format),$=M===void 0?this._getRGBABufferInternalSizedFormat(y.type,y.format,y._useSRGBBuffer):this._getInternalFormat(M,y._useSRGBBuffer);this._unpackFlipY(y.invertY);var Q=B.TEXTURE_2D;y.isCube&&(Q=B.TEXTURE_CUBE_MAP_POSITIVE_X+R);var ie=Math.round(Math.log(y.width)*Math.LOG2E),q=Math.round(Math.log(y.height)*Math.LOG2E),ee=D?y.width:Math.pow(2,Math.max(ie-I,0)),te=D?y.height:Math.pow(2,Math.max(q-I,0));B.texImage2D(Q,I,$,ee,te,0,X,F,x)},S.prototype.updateTextureData=function(y,x,R,I,M,D,B,F,X){B===void 0&&(B=0),F===void 0&&(F=0),X===void 0&&(X=!1);var $=this._gl,Q=this._getWebGLTextureType(y.type),ie=this._getInternalFormat(y.format);this._unpackFlipY(y.invertY);var q=$.TEXTURE_2D,ee=$.TEXTURE_2D;y.isCube&&(ee=$.TEXTURE_CUBE_MAP_POSITIVE_X+B,q=$.TEXTURE_CUBE_MAP),this._bindTextureDirectly(q,y,!0),$.texSubImage2D(ee,F,R,I,M,D,ie,Q,x),X&&this._gl.generateMipmap(ee),this._bindTextureDirectly(q,null)},S.prototype._uploadArrayBufferViewToTexture=function(y,x,R,I){R===void 0&&(R=0),I===void 0&&(I=0);var M=this._gl,D=y.isCube?M.TEXTURE_CUBE_MAP:M.TEXTURE_2D;this._bindTextureDirectly(D,y,!0),this._uploadDataToTextureDirectly(y,x,R,I),this._bindTextureDirectly(D,null,!0)},S.prototype._prepareWebGLTextureContinuation=function(y,x,R,I,M){var D=this._gl;if(D){var B=this._getSamplingParameters(M,!R);D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,B.mag),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,B.min),R||I||D.generateMipmap(D.TEXTURE_2D),this._bindTextureDirectly(D.TEXTURE_2D,null),x&&x.removePendingData(y),y.onLoadedObservable.notifyObservers(y),y.onLoadedObservable.clear()}},S.prototype._prepareWebGLTexture=function(y,x,R,I,M,D,B,F,X,$){var Q=this,ie=this.getCaps().maxTextureSize,q=Math.min(ie,this.needPOTTextures?(0,d.R)(I.width,ie):I.width),ee=Math.min(ie,this.needPOTTextures?(0,d.R)(I.height,ie):I.height),te=this._gl;te&&(y._hardwareTexture?(this._bindTextureDirectly(te.TEXTURE_2D,y,!0),this._unpackFlipY(M===void 0||!!M),y.baseWidth=I.width,y.baseHeight=I.height,y.width=q,y.height=ee,y.isReady=!0,y.type=y.type!==-1?y.type:p.Y.TEXTURETYPE_UNSIGNED_BYTE,y.format=y.format!==-1?y.format:$??(x!==".jpg"||y._useSRGBBuffer?p.Y.TEXTUREFORMAT_RGBA:p.Y.TEXTUREFORMAT_RGB),F(q,ee,I,x,y,function(){Q._prepareWebGLTextureContinuation(y,R,D,B,X)})||this._prepareWebGLTextureContinuation(y,R,D,B,X)):R&&R.removePendingData(y))},S.prototype._getInternalFormatFromDepthTextureFormat=function(y,x,R){var I=this._gl;if(!x)return I.STENCIL_INDEX8;var M=R?I.DEPTH_STENCIL:I.DEPTH_COMPONENT;return this.webGLVersion>1?y===p.Y.TEXTUREFORMAT_DEPTH16?M=I.DEPTH_COMPONENT16:y===p.Y.TEXTUREFORMAT_DEPTH24?M=I.DEPTH_COMPONENT24:y===p.Y.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8||y===p.Y.TEXTUREFORMAT_DEPTH24_STENCIL8?M=R?I.DEPTH24_STENCIL8:I.DEPTH_COMPONENT24:y===p.Y.TEXTUREFORMAT_DEPTH32_FLOAT?M=I.DEPTH_COMPONENT32F:y===p.Y.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8&&(M=R?I.DEPTH32F_STENCIL8:I.DEPTH_COMPONENT32F):M=I.DEPTH_COMPONENT16,M},S.prototype._setupFramebufferDepthAttachments=function(y,x,R,I,M,D){M===void 0&&(M=1);var B=this._gl;D=D??(y?p.Y.TEXTUREFORMAT_DEPTH24_STENCIL8:p.Y.TEXTUREFORMAT_DEPTH32_FLOAT);var F=this._getInternalFormatFromDepthTextureFormat(D,x,y);return y&&x?this._createRenderBuffer(R,I,M,B.DEPTH_STENCIL,F,B.DEPTH_STENCIL_ATTACHMENT):x?this._createRenderBuffer(R,I,M,F,F,B.DEPTH_ATTACHMENT):y?this._createRenderBuffer(R,I,M,F,F,B.STENCIL_ATTACHMENT):null},S.prototype._createRenderBuffer=function(y,x,R,I,M,D,B){B===void 0&&(B=!0);var F=this._gl.createRenderbuffer();return this._updateRenderBuffer(F,y,x,R,I,M,D,B)},S.prototype._updateRenderBuffer=function(y,x,R,I,M,D,B,F){F===void 0&&(F=!0);var X=this._gl;return X.bindRenderbuffer(X.RENDERBUFFER,y),I>1&&X.renderbufferStorageMultisample?X.renderbufferStorageMultisample(X.RENDERBUFFER,I,D,x,R):X.renderbufferStorage(X.RENDERBUFFER,M,x,R),X.framebufferRenderbuffer(X.FRAMEBUFFER,B,X.RENDERBUFFER,y),F&&X.bindRenderbuffer(X.RENDERBUFFER,null),y},S.prototype._releaseTexture=function(y){this._deleteTexture(y._hardwareTexture),this.unbindAllTextures();var x=this._internalTexturesCache.indexOf(y);x!==-1&&this._internalTexturesCache.splice(x,1),y._lodTextureHigh&&y._lodTextureHigh.dispose(),y._lodTextureMid&&y._lodTextureMid.dispose(),y._lodTextureLow&&y._lodTextureLow.dispose(),y._irradianceTexture&&y._irradianceTexture.dispose()},S.prototype._deleteTexture=function(y){y?.release()},S.prototype._setProgram=function(y){this._currentProgram!==y&&((0,i.C5)(y,this._gl),this._currentProgram=y)},S.prototype.bindSamplers=function(y){var x=y.getPipelineContext();this._setProgram(x.program);for(var R=y.getSamplers(),I=0;I<R.length;I++){var M=y.getUniform(R[I]);M&&(this._boundUniforms[I]=M)}this._currentEffect=null},S.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},S.prototype._bindTextureDirectly=function(y,x,R,I){var M,D;R===void 0&&(R=!1),I===void 0&&(I=!1);var B=!1,F=x&&x._associatedChannel>-1;if(R&&F&&(this._activeChannel=x._associatedChannel),this._boundTexturesCache[this._activeChannel]!==x||I){if(this._activateCurrentTexture(),x&&x.isMultiview)throw a.V.Error(["_bindTextureDirectly called with a multiview texture!",y,x]),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(y,(D=(M=x?._hardwareTexture)===null||M===void 0?void 0:M.underlyingResource)!==null&&D!==void 0?D:null),this._boundTexturesCache[this._activeChannel]=x,x&&(x._associatedChannel=this._activeChannel)}else R&&(B=!0,this._activateCurrentTexture());return F&&!R&&this._bindSamplerUniformToChannel(x._associatedChannel,this._activeChannel),B},S.prototype._bindTexture=function(y,x,R){if(y!==void 0){x&&(x._associatedChannel=y),this._activeChannel=y;var I=x?this._getTextureTarget(x):this._gl.TEXTURE_2D;this._bindTextureDirectly(I,x)}},S.prototype.unbindAllTextures=function(){for(var y=0;y<this._maxSimultaneousTextures;y++)this._activeChannel=y,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},S.prototype.setTexture=function(y,x,R,I){y!==void 0&&(x&&(this._boundUniforms[y]=x),this._setTexture(y,R))},S.prototype._bindSamplerUniformToChannel=function(y,x){var R=this._boundUniforms[y];R&&R._currentState!==x&&(this._gl.uniform1i(R,x),R._currentState=x)},S.prototype._getTextureWrapMode=function(y){switch(y){case p.Y.TEXTURE_WRAP_ADDRESSMODE:return this._gl.REPEAT;case p.Y.TEXTURE_CLAMP_ADDRESSMODE:return this._gl.CLAMP_TO_EDGE;case p.Y.TEXTURE_MIRROR_ADDRESSMODE:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},S.prototype._setTexture=function(y,x,R,I,M){if(R===void 0&&(R=!1),I===void 0&&(I=!1),!x)return this._boundTexturesCache[y]!=null&&(this._activeChannel=y,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(x.video){this._activeChannel=y;var D=x.getInternalTexture();D&&(D._associatedChannel=y),x.update()}else if(x.delayLoadState===p.Y.DELAYLOADSTATE_NOTLOADED)return x.delayLoad(),!1;var B;B=I?x.depthStencilTexture:x.isReady()?x.getInternalTexture():x.isCube?this.emptyCubeTexture:x.is3D?this.emptyTexture3D:x.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!R&&B&&(B._associatedChannel=y);var F=!0;this._boundTexturesCache[y]===B&&(R||this._bindSamplerUniformToChannel(B._associatedChannel,y),F=!1),this._activeChannel=y;var X=this._getTextureTarget(B);if(F&&this._bindTextureDirectly(X,B,R),B&&!B.isMultiview){if(B.isCube&&B._cachedCoordinatesMode!==x.coordinatesMode){B._cachedCoordinatesMode=x.coordinatesMode;var $=x.coordinatesMode!==p.Y.TEXTURE_CUBIC_MODE&&x.coordinatesMode!==p.Y.TEXTURE_SKYBOX_MODE?p.Y.TEXTURE_WRAP_ADDRESSMODE:p.Y.TEXTURE_CLAMP_ADDRESSMODE;x.wrapU=$,x.wrapV=$}B._cachedWrapU!==x.wrapU&&(B._cachedWrapU=x.wrapU,this._setTextureParameterInteger(X,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(x.wrapU),B)),B._cachedWrapV!==x.wrapV&&(B._cachedWrapV=x.wrapV,this._setTextureParameterInteger(X,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(x.wrapV),B)),B.is3D&&B._cachedWrapR!==x.wrapR&&(B._cachedWrapR=x.wrapR,this._setTextureParameterInteger(X,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(x.wrapR),B)),this._setAnisotropicLevel(X,B,x.anisotropicFilteringLevel)}return!0},S.prototype.setTextureArray=function(y,x,R,I){if(y!==void 0&&x){this._textureUnits&&this._textureUnits.length===R.length||(this._textureUnits=new Int32Array(R.length));for(var M=0;M<R.length;M++){var D=R[M].getInternalTexture();D?(this._textureUnits[M]=y+M,D._associatedChannel=y+M):this._textureUnits[M]=-1}this._gl.uniform1iv(x,this._textureUnits);for(var B=0;B<R.length;B++)this._setTexture(this._textureUnits[B],R[B],!0)}},S.prototype._setAnisotropicLevel=function(y,x,R){var I=this._caps.textureAnisotropicFilterExtension;x.samplingMode!==p.Y.TEXTURE_LINEAR_LINEAR_MIPNEAREST&&x.samplingMode!==p.Y.TEXTURE_LINEAR_LINEAR_MIPLINEAR&&x.samplingMode!==p.Y.TEXTURE_LINEAR_LINEAR&&(R=1),I&&x._cachedAnisotropicFilteringLevel!==R&&(this._setTextureParameterFloat(y,I.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(R,this._caps.maxAnisotropy),x),x._cachedAnisotropicFilteringLevel=R)},S.prototype._setTextureParameterFloat=function(y,x,R,I){this._bindTextureDirectly(y,I,!0,!0),this._gl.texParameterf(y,x,R)},S.prototype._setTextureParameterInteger=function(y,x,R,I){I&&this._bindTextureDirectly(y,I,!0,!0),this._gl.texParameteri(y,x,R)},S.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var y=0;y<this._caps.maxVertexAttribs;y++)this.disableAttributeByIndex(y)}else{y=0;for(var x=this._vertexAttribArraysEnabled.length;y<x;y++)y>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[y]||this.disableAttributeByIndex(y)}},S.prototype.releaseEffects=function(){for(var y=0,x=Object.keys(this._compiledEffects);y<x.length;y++){var R=x[y];this._compiledEffects[R].dispose()}this._compiledEffects={}},S.prototype.dispose=function(){var y;(0,s.BA)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),g.prototype.dispose.call(this),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose&&((y=this._gl.getExtension("WEBGL_lose_context"))===null||y===void 0||y.loseContext()),(0,i.Cm)(this._gl)},S.prototype.attachContextLostEvent=function(y){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",y,!1)},S.prototype.attachContextRestoredEvent=function(y){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",y,!1)},S.prototype.getError=function(){return this._gl.getError()},S.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(p.Y.TEXTURETYPE_FLOAT)},S.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(p.Y.TEXTURETYPE_HALF_FLOAT)},S.prototype._canRenderToFramebuffer=function(y){for(var x=this._gl;x.getError()!==x.NO_ERROR;);var R=!0,I=x.createTexture();x.bindTexture(x.TEXTURE_2D,I),x.texImage2D(x.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(y),1,1,0,x.RGBA,this._getWebGLTextureType(y),null),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.NEAREST);var M=x.createFramebuffer();x.bindFramebuffer(x.FRAMEBUFFER,M),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,I,0);var D=x.checkFramebufferStatus(x.FRAMEBUFFER);if((R=(R=R&&D===x.FRAMEBUFFER_COMPLETE)&&x.getError()===x.NO_ERROR)&&(x.clear(x.COLOR_BUFFER_BIT),R=R&&x.getError()===x.NO_ERROR),R){x.bindFramebuffer(x.FRAMEBUFFER,null);var B=x.RGBA,F=x.UNSIGNED_BYTE,X=new Uint8Array(4);x.readPixels(0,0,1,1,B,F,X),R=R&&x.getError()===x.NO_ERROR}for(x.deleteTexture(I),x.deleteFramebuffer(M),x.bindFramebuffer(x.FRAMEBUFFER,null);!R&&x.getError()!==x.NO_ERROR;);return R},S.prototype._getWebGLTextureType=function(y){if(this._webGLVersion===1){switch(y){case p.Y.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case p.Y.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT_OES;case p.Y.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case p.Y.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case p.Y.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case p.Y.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(y){case p.Y.TEXTURETYPE_BYTE:return this._gl.BYTE;case p.Y.TEXTURETYPE_UNSIGNED_BYTE:return this._gl.UNSIGNED_BYTE;case p.Y.TEXTURETYPE_SHORT:return this._gl.SHORT;case p.Y.TEXTURETYPE_UNSIGNED_SHORT:return this._gl.UNSIGNED_SHORT;case p.Y.TEXTURETYPE_INT:return this._gl.INT;case p.Y.TEXTURETYPE_UNSIGNED_INTEGER:return this._gl.UNSIGNED_INT;case p.Y.TEXTURETYPE_FLOAT:return this._gl.FLOAT;case p.Y.TEXTURETYPE_HALF_FLOAT:return this._gl.HALF_FLOAT;case p.Y.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.UNSIGNED_SHORT_4_4_4_4;case p.Y.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.UNSIGNED_SHORT_5_5_5_1;case p.Y.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.UNSIGNED_SHORT_5_6_5;case p.Y.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case p.Y.TEXTURETYPE_UNSIGNED_INT_24_8:return this._gl.UNSIGNED_INT_24_8;case p.Y.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case p.Y.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case p.Y.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},S.prototype._getInternalFormat=function(y,x){x===void 0&&(x=!1);var R=x?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(y){case p.Y.TEXTUREFORMAT_ALPHA:R=this._gl.ALPHA;break;case p.Y.TEXTUREFORMAT_LUMINANCE:R=this._gl.LUMINANCE;break;case p.Y.TEXTUREFORMAT_LUMINANCE_ALPHA:R=this._gl.LUMINANCE_ALPHA;break;case p.Y.TEXTUREFORMAT_RED:R=this._gl.RED;break;case p.Y.TEXTUREFORMAT_RG:R=this._gl.RG;break;case p.Y.TEXTUREFORMAT_RGB:R=x?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case p.Y.TEXTUREFORMAT_RGBA:R=x?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(y){case p.Y.TEXTUREFORMAT_RED_INTEGER:R=this._gl.RED_INTEGER;break;case p.Y.TEXTUREFORMAT_RG_INTEGER:R=this._gl.RG_INTEGER;break;case p.Y.TEXTUREFORMAT_RGB_INTEGER:R=this._gl.RGB_INTEGER;break;case p.Y.TEXTUREFORMAT_RGBA_INTEGER:R=this._gl.RGBA_INTEGER}return R},S.prototype._getRGBABufferInternalSizedFormat=function(y,x,R){if(R===void 0&&(R=!1),this._webGLVersion===1){if(x!==void 0)switch(x){case p.Y.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case p.Y.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case p.Y.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;case p.Y.TEXTUREFORMAT_RGB:return R?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(y){case p.Y.TEXTURETYPE_BYTE:switch(x){case p.Y.TEXTUREFORMAT_RED:return this._gl.R8_SNORM;case p.Y.TEXTUREFORMAT_RG:return this._gl.RG8_SNORM;case p.Y.TEXTUREFORMAT_RGB:return this._gl.RGB8_SNORM;case p.Y.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8I;case p.Y.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8I;case p.Y.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8I;case p.Y.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case p.Y.TEXTURETYPE_UNSIGNED_BYTE:switch(x){case p.Y.TEXTUREFORMAT_RED:return this._gl.R8;case p.Y.TEXTUREFORMAT_RG:return this._gl.RG8;case p.Y.TEXTUREFORMAT_RGB:return R?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case p.Y.TEXTUREFORMAT_RGBA:return R?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case p.Y.TEXTUREFORMAT_RED_INTEGER:return this._gl.R8UI;case p.Y.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG8UI;case p.Y.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB8UI;case p.Y.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGBA8UI;case p.Y.TEXTUREFORMAT_ALPHA:return this._gl.ALPHA;case p.Y.TEXTUREFORMAT_LUMINANCE:return this._gl.LUMINANCE;case p.Y.TEXTUREFORMAT_LUMINANCE_ALPHA:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case p.Y.TEXTURETYPE_SHORT:switch(x){case p.Y.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16I;case p.Y.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16I;case p.Y.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16I;case p.Y.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16I}case p.Y.TEXTURETYPE_UNSIGNED_SHORT:switch(x){case p.Y.TEXTUREFORMAT_RED_INTEGER:return this._gl.R16UI;case p.Y.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG16UI;case p.Y.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB16UI;case p.Y.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA16UI}case p.Y.TEXTURETYPE_INT:switch(x){case p.Y.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32I;case p.Y.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32I;case p.Y.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32I;case p.Y.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32I}case p.Y.TEXTURETYPE_UNSIGNED_INTEGER:switch(x){case p.Y.TEXTUREFORMAT_RED_INTEGER:return this._gl.R32UI;case p.Y.TEXTUREFORMAT_RG_INTEGER:return this._gl.RG32UI;case p.Y.TEXTUREFORMAT_RGB_INTEGER:return this._gl.RGB32UI;case p.Y.TEXTUREFORMAT_RGBA_INTEGER:default:return this._gl.RGBA32UI}case p.Y.TEXTURETYPE_FLOAT:switch(x){case p.Y.TEXTUREFORMAT_RED:return this._gl.R32F;case p.Y.TEXTUREFORMAT_RG:return this._gl.RG32F;case p.Y.TEXTUREFORMAT_RGB:return this._gl.RGB32F;case p.Y.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA32F}case p.Y.TEXTURETYPE_HALF_FLOAT:switch(x){case p.Y.TEXTUREFORMAT_RED:return this._gl.R16F;case p.Y.TEXTUREFORMAT_RG:return this._gl.RG16F;case p.Y.TEXTUREFORMAT_RGB:return this._gl.RGB16F;case p.Y.TEXTUREFORMAT_RGBA:default:return this._gl.RGBA16F}case p.Y.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return this._gl.RGB565;case p.Y.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV:return this._gl.R11F_G11F_B10F;case p.Y.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV:return this._gl.RGB9_E5;case p.Y.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return this._gl.RGBA4;case p.Y.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return this._gl.RGB5_A1;case p.Y.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV:switch(x){case p.Y.TEXTUREFORMAT_RGBA:return this._gl.RGB10_A2;case p.Y.TEXTUREFORMAT_RGBA_INTEGER:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return R?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8},S.prototype.readPixels=function(y,x,R,I,M,D){M===void 0&&(M=!0),D===void 0&&(D=!0);var B=M?4:3,F=M?this._gl.RGBA:this._gl.RGB,X=new Uint8Array(I*R*B);return D&&this.flushFramebuffer(),this._gl.readPixels(y,x,R,I,F,this._gl.UNSIGNED_BYTE,X),Promise.resolve(X)},Object.defineProperty(S,"IsSupportedAsync",{get:function(){return Promise.resolve(this.isSupported())},enumerable:!1,configurable:!0}),Object.defineProperty(S,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),S.isSupported=function(){if(this._HasMajorPerformanceCaveat!==null)return!this._HasMajorPerformanceCaveat;if(this._IsSupported===null)try{var y=h.$._CreateCanvas(1,1),x=y.getContext("webgl")||y.getContext("experimental-webgl");this._IsSupported=x!=null&&!!window.WebGLRenderingContext}catch{this._IsSupported=!1}return this._IsSupported},Object.defineProperty(S,"HasMajorPerformanceCaveat",{get:function(){if(this._HasMajorPerformanceCaveat===null)try{var y=h.$._CreateCanvas(1,1),x=y.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||y.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!x}catch{this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),S._TempClearColorUint32=new Uint32Array(4),S._TempClearColorInt32=new Int32Array(4),S.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],S._ConcatenateShader=E.iL,S._IsSupported=null,S._HasMajorPerformanceCaveat=null,S}(h.$)},50712:(r,t,e)=>{var n;e.d(t,{b:()=>n,s:()=>i}),function(o){o[o.PointerMove=0]="PointerMove",o[o.PointerDown=1]="PointerDown",o[o.PointerUp=2]="PointerUp"}(n||(n={}));var i=function(){function o(){}return o.DOM_DELTA_PIXEL=0,o.DOM_DELTA_LINE=1,o.DOM_DELTA_PAGE=2,o}()},6451:(r,t,e)=>{e.d(t,{Bu:()=>a,TB:()=>i,W0:()=>o});var n=e(78322),i=function(){function s(){}return s.KEYDOWN=1,s.KEYUP=2,s}(),o=function(s,l){this.type=s,this.event=l},a=function(s){function l(c,u){var d=s.call(this,c,u)||this;return d.type=c,d.event=u,d.skipOnKeyboardObservable=!1,d}return(0,n.C6)(l,s),Object.defineProperty(l.prototype,"skipOnPointerObservable",{get:function(){return this.skipOnKeyboardObservable},set:function(c){this.skipOnKeyboardObservable=c},enumerable:!1,configurable:!0}),l}(o)},64391:(r,t,e)=>{e.d(t,{Vn:()=>a,Zp:()=>o,mx:()=>l,tT:()=>s});var n=e(78322),i=e(8046),o=function(){function c(){}return c.POINTERDOWN=1,c.POINTERUP=2,c.POINTERMOVE=4,c.POINTERWHEEL=8,c.POINTERPICK=16,c.POINTERTAP=32,c.POINTERDOUBLETAP=64,c}(),a=function(c,u){this.type=c,this.event=u},s=function(c){function u(d,h,p,m){var v=c.call(this,d,h)||this;return v.ray=null,v.originalPickingInfo=null,v.skipOnPointerObservable=!1,v.localPosition=new i.I9(p,m),v}return(0,n.C6)(u,c),u}(a),l=function(c){function u(d,h,p,m){m===void 0&&(m=null);var v=c.call(this,d,h)||this;return v._pickInfo=p,v._inputManager=m,v}return(0,n.C6)(u,c),Object.defineProperty(u.prototype,"pickInfo",{get:function(){return this._pickInfo||this._generatePickInfo(),this._pickInfo},enumerable:!1,configurable:!0}),u.prototype._generatePickInfo=function(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)},u}(a)},91946:(r,t,e)=>{e.d(t,{c:()=>n});var n=function(){function i(){}return i.CompareLightsPriority=function(o,a){return o.shadowEnabled!==a.shadowEnabled?(a.shadowEnabled?1:0)-(o.shadowEnabled?1:0):a.renderPriority-o.renderPriority},i.FALLOFF_DEFAULT=0,i.FALLOFF_PHYSICAL=1,i.FALLOFF_GLTF=2,i.FALLOFF_STANDARD=3,i.LIGHTMAP_DEFAULT=0,i.LIGHTMAP_SPECULAR=1,i.LIGHTMAP_SHADOWSONLY=2,i.INTENSITYMODE_AUTOMATIC=0,i.INTENSITYMODE_LUMINOUSPOWER=1,i.INTENSITYMODE_LUMINOUSINTENSITY=2,i.INTENSITYMODE_ILLUMINANCE=3,i.INTENSITYMODE_LUMINANCE=4,i.LIGHTTYPEID_POINTLIGHT=0,i.LIGHTTYPEID_DIRECTIONALLIGHT=1,i.LIGHTTYPEID_SPOTLIGHT=2,i.LIGHTTYPEID_HEMISPHERICLIGHT=3,i}()},50919:(r,t,e)=>{e.d(t,{FG:()=>s,Kq:()=>f,ZR:()=>m,tb:()=>T});var n=e(45109),i=e(25598),o=32768,a=65535;function s(g,S){for(var y=0,x=0;x<i.Ez;++x)(x==0||g[x>>3]&1<<(7&x))&&(S[y++]=x);for(var R=y-1;y<i.Ez;)S[y++]=0;return R}function l(g,S,y,x,R){for(;y<g;)S=S<<8|(0,n.fz)(x,R),y+=8;return{l:S>>(y-=g)&(1<<g)-1,c:S,lc:y}}function c(g,S,y,x){return{c:g=g<<8|(0,n.fz)(y,x),lc:S+=8}}function u(g,S,y,x,R,I,M,D,B){if(g==S){if(x<8){var F=c(y,x,R,I);y=F.c,x=F.lc}var X=y>>(x-=8);if(X=new Uint8Array([X])[0],D.value+X>B)return null;for(var $=M[D.value-1];X-- >0;)M[D.value++]=$}else{if(!(D.value<B))return null;M[D.value++]=g}return{c:y,lc:x}}var d=new Array(59);function h(g){return 63&g}function p(g){return g>>6}function m(g,S,y,x,R,I){var M=y.value,D=(0,n.PX)(S,y),B=(0,n.PX)(S,y);y.value+=4;var F=(0,n.PX)(S,y);if(y.value+=4,D<0||D>=i.U0||B<0||B>=i.U0)throw new Error("Wrong HUF_ENCSIZE");var X=new Array(i.U0),$=new Array(i.A_);if(function(Q){for(var ie=0;ie<i.A_;ie++)Q[ie]={},Q[ie].len=0,Q[ie].lit=0,Q[ie].p=null}($),function(Q,ie,q,ee,te,ce){for(var fe=ie,de=0,Te=0;ee<=te;ee++){if(fe.value-ie.value>q)return;var ue=l(6,de,Te,Q,fe),U=ue.l;if(de=ue.c,Te=ue.lc,ce[ee]=U,U==i.Hh){if(fe.value-ie.value>q)throw new Error("Error in HufUnpackEncTable");var N=(ue=l(8,de,Te,Q,fe)).l+i.gn;if(de=ue.c,Te=ue.lc,ee+N>te+1)throw new Error("Error in HufUnpackEncTable");for(;N--;)ce[ee++]=0;ee--}else if(U>=i.LU){if(ee+(N=U-i.LU+2)>te+1)throw new Error("Error in HufUnpackEncTable");for(;N--;)ce[ee++]=0;ee--}}(function(w){for(var k=0;k<=58;++k)d[k]=0;for(k=0;k<i.U0;++k)d[w[k]]+=1;var J=0;for(k=58;k>0;--k){var le=J+d[k]>>1;d[k]=J,J=le}for(k=0;k<i.U0;++k){var be=w[k];be>0&&(w[k]=be|d[be]++<<6)}})(ce)}(g,y,x-(y.value-M),D,B,X),F>8*(x-(y.value-M)))throw new Error("Wrong hufUncompress");(function(Q,ie,q,ee){for(;ie<=q;ie++){var te=p(Q[ie]),ce=h(Q[ie]);if(te>>ce)throw new Error("Invalid table entry");if(ce>i.LK){if((ue=ee[te>>ce-i.LK]).len)throw new Error("Invalid table entry");if(ue.lit++,ue.p){var fe=ue.p;ue.p=new Array(ue.lit);for(var de=0;de<ue.lit-1;++de)ue.p[de]=fe[de]}else ue.p=new Array(1);ue.p[ue.lit-1]=ie}else if(ce){var Te=0;for(de=1<<i.LK-ce;de>0;de--){var ue;if((ue=ee[(te<<i.LK-ce)+Te]).len||ue.p)throw new Error("Invalid table entry");ue.len=ce,ue.lit=ie,Te++}}}})(X,D,B,$),function(Q,ie,q,ee,te,ce,fe,de,Te){for(var ue=0,U=0,N=fe,w=Math.trunc(ee.value+(te+7)/8);ee.value<w;){var k=c(ue,U,q,ee);for(ue=k.c,U=k.lc;U>=i.LK;)if((ve=ie[ue>>U-i.LK&i.lR]).len)U-=ve.len,(ye=u(ve.lit,ce,ue,U,q,ee,de,Te,N))&&(ue=ye.c,U=ye.lc);else{if(!ve.p)throw new Error("hufDecode issues");var J=void 0;for(J=0;J<ve.lit;J++){for(var le=h(Q[ve.p[J]]);U<le&&ee.value<w;)ue=(k=c(ue,U,q,ee)).c,U=k.lc;if(U>=le&&p(Q[ve.p[J]])==(ue>>U-le&(1<<le)-1)){U-=le,(ye=u(ve.p[J],ce,ue,U,q,ee,de,Te,N))&&(ue=ye.c,U=ye.lc);break}}if(J==ve.lit)throw new Error("HufDecode issues")}}var be=8-te&7;for(ue>>=be,U-=be;U>0;){var ve,ye;if(!(ve=ie[ue<<i.LK-U&i.lR]).len)throw new Error("HufDecode issues");U-=ve.len,(ye=u(ve.lit,ce,ue,U,q,ee,de,Te,N))&&(ue=ye.c,U=ye.lc)}}(X,$,g,y,F,B,I,R,{value:0})}function v(g){return 65535&g}function b(g){var S=v(g);return S>32767?S-65536:S}function E(g,S){var y=b(g),x=b(S),R=y+(1&x)+(x>>1);return{a:R,b:R-x}}function C(g,S){var y=v(g),x=v(S),R=y-(x>>1)&a;return{a:x+R-o&a,b:R}}function T(g,S,y,x,R,I,M){for(var D,B,F=M<16384,X=y>R?R:y,$=1;$<=X;)$<<=1;for(D=$>>=1,$>>=1;$>=1;){for(var Q=(B=0)+I*(R-D),ie=I*$,q=I*D,ee=x*$,te=x*D,ce=void 0,fe=void 0,de=void 0,Te=void 0;B<=Q;B+=q){for(var ue=B,U=B+x*(y-D);ue<=U;ue+=te){var N=ue+ee,w=(k=ue+ie)+ee;F?(ce=(J=E(g[ue+S],g[k+S])).a,de=J.b,fe=(J=E(g[N+S],g[w+S])).a,Te=J.b,J=E(ce,fe),g[ue+S]=J.a,g[N+S]=J.b,J=E(de,Te),g[k+S]=J.a,g[w+S]=J.b):(ce=(J=C(g[ue+S],g[k+S])).a,de=J.b,fe=(J=C(g[N+S],g[w+S])).a,Te=J.b,J=C(ce,fe),g[ue+S]=J.a,g[N+S]=J.b,J=C(de,Te),g[k+S]=J.a,g[w+S]=J.b)}if(y&$){var k=ue+ie,J=void 0;ce=(J=F?E(g[ue+S],g[k+S]):C(g[ue+S],g[k+S])).a,g[k+S]=J.b,g[ue+S]=ce}}if(R&$)for(ue=B,U=B+x*(y-D);ue<=U;ue+=te)N=ue+ee,J=void 0,ce=(J=F?E(g[ue+S],g[N+S]):C(g[ue+S],g[N+S])).a,g[N+S]=J.b,g[ue+S]=ce;D=$,$>>=1}return B}function f(g,S,y){for(var x=0;x<y;++x)S[x]=g[S[x]]}},51289:(r,t,e)=>{function n(i){for(var o=i.byteLength,a=new Array,s=0,l=new DataView(i);o>0;){var c=l.getInt8(s++);if(c<0){o-=1+(d=-c);for(var u=0;u<d;u++)a.push(l.getUint8(s++))}else{var d=c;o-=2;var h=l.getUint8(s++);for(u=0;u<d+1;u++)a.push(h)}}return a}e.d(t,{_:()=>n})},8102:(r,t,e)=>{e.d(t,{S4:()=>s,VE:()=>c,_k:()=>u,r:()=>l,tg:()=>d});var n=e(50919),i=e(51289),o=e(45109),a=e(25598);function s(h){return new DataView(h.array.buffer,h.offset.value,h.size)}function l(h){var p=h.viewer.buffer.slice(h.offset.value,h.offset.value+h.size),m=new Uint8Array((0,i._)(p)),v=new Uint8Array(m.length);return(0,o.XE)(m),(0,o.KA)(m,v),new DataView(v.buffer)}function c(h){var p=h.array.slice(h.offset.value,h.offset.value+h.size),m=fflate.unzlibSync(p),v=new Uint8Array(m.length);return(0,o.XE)(m),(0,o.KA)(m,v),new DataView(v.buffer)}function u(h){for(var p=h.array.slice(h.offset.value,h.offset.value+h.size),m=fflate.unzlibSync(p),v=h.lines*h.channels*h.width,b=h.type==1?new Uint16Array(v):new Uint32Array(v),E=0,C=0,T=new Array(4),f=0;f<h.lines;f++)for(var g=0;g<h.channels;g++){var S=0;switch(h.type){case 1:T[0]=E,T[1]=T[0]+h.width,E=T[1]+h.width;for(var y=0;y<h.width;++y)S+=m[T[0]++]<<8|m[T[1]++],b[C]=S,C++;break;case 2:for(T[0]=E,T[1]=T[0]+h.width,T[2]=T[1]+h.width,E=T[2]+h.width,y=0;y<h.width;++y)S+=m[T[0]++]<<24|m[T[1]++]<<16|m[T[2]++]<<8,b[C]=S,C++}}return new DataView(b.buffer)}function d(h){for(var p=h.viewer,m={value:h.offset.value},v=new Uint16Array(h.width*h.scanlineBlockSize*(h.channels*h.type)),b=new Uint8Array(a.cQ),E=0,C=new Array(h.channels),T=0;T<h.channels;T++)C[T]={},C[T].start=E,C[T].end=C[T].start,C[T].nx=h.width,C[T].ny=h.lines,C[T].size=h.type,E+=C[T].nx*C[T].ny*C[T].size;var f=(0,o.Jn)(p,m),g=(0,o.Jn)(p,m);if(g>=a.cQ)throw new Error("Wrong PIZ_COMPRESSION BITMAP_SIZE");if(f<=g)for(T=0;T<g-f+1;T++)b[T+f]=(0,o._S)(p,m);var S=new Uint16Array(a.Ez),y=(0,n.FG)(b,S),x=(0,o.PX)(p,m);for((0,n.ZR)(h.array,p,m,x,v,E),T=0;T<h.channels;++T)for(var R=C[T],I=0;I<C[T].size;++I)(0,n.tb)(v,R.start+I,R.nx,R.size,R.ny,R.nx*R.size,y);(0,n.Kq)(S,v,E);for(var M=0,D=new Uint8Array(v.buffer.byteLength),B=0;B<h.lines;B++)for(var F=0;F<h.channels;F++){var X=(R=C[F]).nx*R.size,$=new Uint8Array(v.buffer,R.end*a.JH,X*a.JH);D.set($,M),M+=X*a.JH,R.end+=X}return new DataView(D.buffer)}},54646:(r,t,e)=>{var n;e.d(t,{V:()=>n,u:()=>i}),function(o){o[o.Float=0]="Float",o[o.HalfFloat=1]="HalfFloat"}(n||(n={}));var i=function(){function o(){}return o.DefaultOutputType=n.HalfFloat,o.FFLATEUrl="https://unpkg.com/fflate@0.8.2",o}()},45109:(r,t,e)=>{e.d(t,{Ff:()=>v,Jn:()=>h,KA:()=>f,LD:()=>b,PX:()=>u,Sn:()=>E,T$:()=>l,XE:()=>T,_S:()=>d,cL:()=>c,fz:()=>p,he:()=>n,tB:()=>m,zX:()=>C});var n,i,o=e(48810),a=e(25598);(function(g){g[g.NO_COMPRESSION=0]="NO_COMPRESSION",g[g.RLE_COMPRESSION=1]="RLE_COMPRESSION",g[g.ZIPS_COMPRESSION=2]="ZIPS_COMPRESSION",g[g.ZIP_COMPRESSION=3]="ZIP_COMPRESSION",g[g.PIZ_COMPRESSION=4]="PIZ_COMPRESSION",g[g.PXR24_COMPRESSION=5]="PXR24_COMPRESSION"})(n||(n={})),function(g){g[g.INCREASING_Y=0]="INCREASING_Y",g[g.DECREASING_Y=1]="DECREASING_Y"}(i||(i={}));var s=function(){for(var g=new ArrayBuffer(4),S=new Float32Array(g),y=new Uint32Array(g),x=new Uint32Array(512),R=new Uint32Array(512),I=0;I<256;++I)(X=I-127)<-27?(x[I]=0,x[256|I]=32768,R[I]=24,R[256|I]=24):X<-14?(x[I]=1024>>-X-14,x[256|I]=1024>>-X-14|32768,R[I]=-X-1,R[256|I]=-X-1):X<=15?(x[I]=X+15<<10,x[256|I]=X+15<<10|32768,R[I]=13,R[256|I]=13):X<128?(x[I]=31744,x[256|I]=64512,R[I]=24,R[256|I]=24):(x[I]=31744,x[256|I]=64512,R[I]=13,R[256|I]=13);var M=new Uint32Array(2048),D=new Uint32Array(64),B=new Uint32Array(64);for(I=1;I<1024;++I){for(var F=I<<13,X=0;!(8388608&F);)F<<=1,X-=8388608;F&=-8388609,X+=947912704,M[I]=F|X}for(I=1024;I<2048;++I)M[I]=939524096+(I-1024<<13);for(I=1;I<31;++I)D[I]=I<<23;for(D[31]=1199570944,D[32]=2147483648,I=33;I<63;++I)D[I]=2147483648+(I-32<<23);for(D[63]=3347054592,I=1;I<64;++I)I!==32&&(B[I]=1024);return{floatView:S,uint32View:y,baseTable:x,shiftTable:R,mantissaTable:M,exponentTable:D,offsetTable:B}}();function l(g,S){for(var y=new Uint8Array(g),x=0;y[S.value+x]!=0;)x+=1;var R=new TextDecoder().decode(y.slice(S.value,S.value+x));return S.value=S.value+x+1,R}function c(g,S){var y=g.getInt32(S.value,!0);return S.value+=a.b7,y}function u(g,S){var y=g.getUint32(S.value,!0);return S.value+=a.b7,y}function d(g,S){var y=g.getUint8(S.value);return S.value+=a.aN,y}function h(g,S){var y=g.getUint16(S.value,!0);return S.value+=a.JH,y}function p(g,S){var y=g[S.value];return S.value+=a.aN,y}function m(g,S){var y;return y="getBigInt64"in DataView.prototype?Number(g.getBigInt64(S.value,!0)):g.getUint32(S.value+4,!0)+Number(g.getUint32(S.value,!0)<<32),S.value+=a.Kl,y}function v(g,S){var y=g.getFloat32(S.value,!0);return S.value+=a.Y3,y}function b(g,S){return R=1023&(y=h(g,S)),(y>>15?-1:1)*((x=(31744&y)>>10)?x===31?R?NaN:1/0:Math.pow(2,x-15)*(1+R/1024):R/1024*6103515625e-14);var y,x,R}function E(g,S){return function(y){if(Math.abs(y)>65504)throw new Error("Value out of range.Consider using float instead of half-float.");y=(0,o.Clamp)(y,-65504,65504),s.floatView[0]=y;var x=s.uint32View[0],R=x>>23&511;return s.baseTable[R]+((8388607&x)>>s.shiftTable[R])}(v(g,S))}function C(g,S,y,x){switch(y){case"string":case"stringvector":case"iccProfile":return function(R,I,M){var D=new TextDecoder().decode(new Uint8Array(R).slice(I.value,I.value+M));return I.value=I.value+M,D}(g.buffer,S,x);case"chlist":return function(R,I,M){for(var D=I.value,B=[];I.value<D+M-1;){var F=l(R.buffer,I),X=c(R,I),$=d(R,I);I.value+=3;var Q=c(R,I),ie=c(R,I);B.push({name:F,pixelType:X,pLinear:$,xSampling:Q,ySampling:ie})}return I.value+=1,B}(g,S,x);case"chromaticities":return function(R,I){return{redX:v(R,I),redY:v(R,I),greenX:v(R,I),greenY:v(R,I),blueX:v(R,I),blueY:v(R,I),whiteX:v(R,I),whiteY:v(R,I)}}(g,S);case"compression":return function(R,I){return d(R,I)}(g,S);case"box2i":return function(R,I){return{xMin:c(R,I),yMin:c(R,I),xMax:c(R,I),yMax:c(R,I)}}(g,S);case"lineOrder":return function(R,I){var M=d(R,I);return i[M]}(g,S);case"float":return v(g,S);case"v2f":return function(R,I){return[v(R,I),v(R,I)]}(g,S);case"v3f":return function(R,I){return[v(R,I),v(R,I),v(R,I)]}(g,S);case"int":return c(g,S);case"rational":return function(R,I){return[c(R,I),u(R,I)]}(g,S);case"timecode":return function(R,I){return[u(R,I),u(R,I)]}(g,S);case"preview":return S.value+=x,"skipped";default:return void(S.value+=x)}}function T(g){for(var S=1;S<g.length;S++){var y=g[S-1]+g[S]-128;g[S]=y}}function f(g,S){for(var y=0,x=Math.floor((g.length+1)/2),R=0,I=g.length-1;!(R>I||(S[R++]=g[y++],R>I));)S[R++]=g[x++]}},99448:(r,t,e)=>{e.d(t,{d:()=>u,u:()=>d});var n=e(78322),i=e(45109),o=e(8102),a=e(25598),s=e(81152),l=e(44957),c=e(54646);function u(h,p,m,v){return(0,n.sH)(this,void 0,void 0,function(){var b,E,C,T,f,g,S,y,x,R,I;return(0,n.YH)(this,function(M){switch(M.label){case 0:switch(b={size:0,viewer:p,array:new Uint8Array(p.buffer),offset:m,width:h.dataWindow.xMax-h.dataWindow.xMin+1,height:h.dataWindow.yMax-h.dataWindow.yMin+1,channels:h.channels.length,channelLineOffsets:{},scanOrder:function(){return 0},bytesPerLine:0,outLineWidth:0,lines:0,scanlineBlockSize:0,inputSize:null,type:0,uncompress:null,getter:function(){return 0},format:s.Y.TEXTUREFORMAT_RGBA,outputChannels:0,decodeChannels:{},blockCount:null,byteArray:null,linearSpace:!1,textureType:0},h.compression){case i.he.NO_COMPRESSION:return[3,1];case i.he.RLE_COMPRESSION:return[3,2];case i.he.ZIPS_COMPRESSION:return[3,3];case i.he.ZIP_COMPRESSION:return[3,5];case i.he.PIZ_COMPRESSION:return[3,7];case i.he.PXR24_COMPRESSION:return[3,8]}return[3,10];case 1:return b.lines=1,b.uncompress=o.S4,[3,11];case 2:return b.lines=1,b.uncompress=o.r,[3,11];case 3:return b.lines=1,b.uncompress=o.VE,[4,l.S0.LoadScriptAsync(c.u.FFLATEUrl)];case 4:case 6:case 9:return M.sent(),[3,11];case 5:return b.lines=16,b.uncompress=o.VE,[4,l.S0.LoadScriptAsync(c.u.FFLATEUrl)];case 7:return b.lines=32,b.uncompress=o.tg,[3,11];case 8:return b.lines=16,b.uncompress=o._k,[4,l.S0.LoadScriptAsync(c.u.FFLATEUrl)];case 10:throw new Error(i.he[h.compression]+" is unsupported");case 11:for(b.scanlineBlockSize=b.lines,E={},C=0,T=h.channels;C<T.length;C++)switch((I=T[C]).name){case"Y":case"R":case"G":case"B":case"A":E[I.name]=!0,b.type=I.pixelType}if(f=!1,E.R&&E.G&&E.B)f=!E.A,b.outputChannels=4,b.decodeChannels={R:0,G:1,B:2,A:3};else{if(!E.Y)throw new Error("EXRLoader.parse: file contains unsupported data channels.");b.outputChannels=1,b.decodeChannels={Y:0}}if(b.type===1)switch(v){case c.V.Float:b.getter=i.LD,b.inputSize=a.JH;break;case c.V.HalfFloat:b.getter=i.Jn,b.inputSize=a.JH}else{if(b.type!==2)throw new Error("Unsupported pixelType "+b.type+" for "+h.compression);switch(v){case c.V.Float:b.getter=i.Ff,b.inputSize=a.Y3;break;case c.V.HalfFloat:b.getter=i.Sn,b.inputSize=a.Y3}}for(b.blockCount=b.height/b.scanlineBlockSize,g=0;g<b.blockCount;g++)(0,i.tB)(p,m);switch(S=b.width*b.height*b.outputChannels,v){case c.V.Float:b.byteArray=new Float32Array(S),b.textureType=s.Y.TEXTURETYPE_FLOAT,f&&b.byteArray.fill(1,0,S);break;case c.V.HalfFloat:b.byteArray=new Uint16Array(S),b.textureType=s.Y.TEXTURETYPE_HALF_FLOAT,f&&b.byteArray.fill(15360,0,S);break;default:throw new Error("Unsupported type: "+v)}for(y=0,x=0,R=h.channels;x<R.length;x++)I=R[x],b.decodeChannels[I.name]!==void 0&&(b.channelLineOffsets[I.name]=y*b.width),y+=2*I.pixelType;return b.bytesPerLine=b.width*y,b.outLineWidth=b.width*b.outputChannels,h.lineOrder==="INCREASING_Y"?b.scanOrder=function(D){return D}:b.scanOrder=function(D){return b.height-1-D},b.outputChannels==4?(b.format=s.Y.TEXTUREFORMAT_RGBA,b.linearSpace=!0):(b.format=s.Y.TEXTUREFORMAT_R,b.linearSpace=!1),[2,b]}})})}function d(h,p,m,v){for(var b={value:0},E=0;E<h.height/h.scanlineBlockSize;E++){var C=(0,i.cL)(m,v)-p.dataWindow.yMin;h.size=(0,i.PX)(m,v),h.lines=C+h.scanlineBlockSize>h.height?h.height-C:h.scanlineBlockSize;var T=h.size<h.lines*h.bytesPerLine&&h.uncompress?h.uncompress(h):(0,o.S4)(h);v.value+=h.size;for(var f=0;f<h.scanlineBlockSize;f++){var g=E*h.scanlineBlockSize,S=f+h.scanOrder(g);if(!(S>=h.height))for(var y=f*h.bytesPerLine,x=(h.height-1-S)*h.outLineWidth,R=0;R<h.channels;R++){var I=p.channels[R].name,M=h.channelLineOffsets[I],D=h.decodeChannels[I];if(D!==void 0){b.value=y+M;for(var B=0;B<h.width;B++){var F=x+B*h.outputChannels+D;h.byteArray&&(h.byteArray[F]=h.getter(T,b))}}}}}}},95487:(r,t,e)=>{e.d(t,{V:()=>s});var n=e(78322),i=e(7164),o=e(45109),a=20000630;function s(l,c){if(l.getUint32(0,!0)!=a)throw new Error("Incorrect OpenEXR format");var u=l.getUint8(4),d=l.getUint8(5),h={singleTile:!!(2&d),longName:!!(4&d),deepFormat:!!(8&d),multiPart:!!(16&d)};c.value=8;for(var p={},m=!0;m;){var v=(0,o.T$)(l.buffer,c);if(v){var b=(0,o.T$)(l.buffer,c),E=(0,o.PX)(l,c),C=(0,o.zX)(l,c,b,E);C===void 0?i.V.Warn("Unknown header attribute type ".concat(b,"'.")):p[v]=C}else m=!1}if(-5&d)throw new Error("Unsupported file format");return(0,n.Cl)({version:u,spec:h},p)}},25598:(r,t,e)=>{e.d(t,{A_:()=>h,Ez:()=>l,Hh:()=>v,JH:()=>a,Kl:()=>s,LK:()=>u,LU:()=>m,U0:()=>d,Y3:()=>i,aN:()=>o,b7:()=>n,cQ:()=>c,gn:()=>b,lR:()=>p});var n=4,i=4,o=1,a=2,s=8,l=65536,c=l>>3,u=14,d=65537,h=1<<u,p=h-1,m=59,v=63,b=2+v-m},23586:(r,t,e)=>{e.r(t),e.d(t,{_BasisTextureLoader:()=>o});var n=e(82941),i=e(44957),o=(e(71974),function(){function a(){this.supportCascades=!1}return a.prototype.loadCubeData=function(s,l,c,u,d){if(!Array.isArray(s)){var h=l.getEngine().getCaps(),p={supportedCompressionFormats:{etc1:!!h.etc1,s3tc:!!h.s3tc,pvrtc:!!h.pvrtc,etc2:!!h.etc2,astc:!!h.astc,bc7:!!h.bptc}};(0,n.yk)(s,p).then(function(m){var v=m.fileInfo.images[0].levels.length>1&&l.generateMipMaps;(0,n.aB)(l,m),l.getEngine()._setCubeMapTextureParams(l,v),l.isReady=!0,l.onLoadedObservable.notifyObservers(l),l.onLoadedObservable.clear(),u&&u()}).catch(function(m){i.S0.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),l.isReady=!0,d&&d(m)})}},a.prototype.loadData=function(s,l,c){var u=l.getEngine().getCaps(),d={supportedCompressionFormats:{etc1:!!u.etc1,s3tc:!!u.s3tc,pvrtc:!!u.pvrtc,etc2:!!u.etc2,astc:!!u.astc,bc7:!!u.bptc}};(0,n.yk)(s,d).then(function(h){var p=h.fileInfo.images[0].levels[0],m=h.fileInfo.images[0].levels.length>1&&l.generateMipMaps;c(p.width,p.height,m,h.format!==-1,function(){(0,n.aB)(l,h)})}).catch(function(h){i.S0.Warn("Failed to transcode Basis file, transcoding may not be supported on this device"),i.S0.Warn("Failed to transcode Basis file: ".concat(h)),c(0,0,!1,!1,function(){},!0)})},a}())},19135:(r,t,e)=>{e.r(t),e.d(t,{_DDSTextureLoader:()=>o});var n=e(51428),i=e(49611),o=(e(71974),function(){function a(){this.supportCascades=!0}return a.prototype.loadCubeData=function(s,l,c,u){var d,h=l.getEngine(),p=!1,m=1e3;if(Array.isArray(s))for(var v=0;v<s.length;v++){var b=s[v];d=i.D.GetDDSInfo(b),l.width=d.width,l.height=d.height,p=(d.isRGB||d.isLuminance||d.mipmapCount>1)&&l.generateMipMaps,h._unpackFlipY(d.isCompressed),i.D.UploadDDSLevels(h,l,b,d,p,6,-1,v),d.isFourCC||d.mipmapCount!==1?m=d.mipmapCount-1:h.generateMipMapsForCubemap(l)}else b=s,d=i.D.GetDDSInfo(b),l.width=d.width,l.height=d.height,c&&(d.sphericalPolynomial=new n.Q),p=(d.isRGB||d.isLuminance||d.mipmapCount>1)&&l.generateMipMaps,h._unpackFlipY(d.isCompressed),i.D.UploadDDSLevels(h,l,b,d,p,6),d.isFourCC||d.mipmapCount!==1?m=d.mipmapCount-1:h.generateMipMapsForCubemap(l,!1);h._setCubeMapTextureParams(l,p,m),l.isReady=!0,l.onLoadedObservable.notifyObservers(l),l.onLoadedObservable.clear(),u&&u({isDDS:!0,width:l.width,info:d,data:s,texture:l})},a.prototype.loadData=function(s,l,c){var u=i.D.GetDDSInfo(s),d=(u.isRGB||u.isLuminance||u.mipmapCount>1)&&l.generateMipMaps&&Math.max(u.width,u.height)>>u.mipmapCount-1==1;c(u.width,u.height,d,u.isFourCC,function(){i.D.UploadDDSLevels(l.getEngine(),l,s,u,d,1)})},a}())},71545:(r,t,e)=>{e.r(t),e.d(t,{_ENVTextureLoader:()=>i});var n=e(88309),i=function(){function o(){this.supportCascades=!1}return o.prototype.loadCubeData=function(a,s,l,c,u){if(!Array.isArray(a)){var d=(0,n.cU)(a);if(d){s.width=d.width,s.height=d.width;try{(0,n.ow)(s,d),(0,n.o5)(s,a,d).then(function(){s.isReady=!0,s.onLoadedObservable.notifyObservers(s),s.onLoadedObservable.clear(),c&&c()},function(h){u?.("Can not upload environment levels",h)})}catch(h){u?.("Can not upload environment file",h)}}else u&&u("Can not parse the environment file",null)}},o.prototype.loadData=function(){throw".env not supported in 2d."},o}()},93747:(r,t,e)=>{e.r(t),e.d(t,{_ExrTextureLoader:()=>s});var n=e(78322),i=e(95487),o=e(99448),a=e(54646),s=function(){function l(){this.supportCascades=!1}return l.prototype.loadCubeData=function(c,u,d,h,p){throw".exr not supported in Cube."},l.prototype.loadData=function(c,u,d){return(0,n.sH)(this,void 0,void 0,function(){var h,p,m,v,b,E;return(0,n.YH)(this,function(C){switch(C.label){case 0:return h=new DataView(c.buffer),p={value:0},m=(0,i.V)(h,p),[4,(0,o.d)(m,h,p,a.u.DefaultOutputType)];case 1:return v=C.sent(),(0,o.u)(v,m,h,p),b=m.dataWindow.xMax-m.dataWindow.xMin+1,E=m.dataWindow.yMax-m.dataWindow.yMin+1,d(b,E,u.generateMipMaps,!1,function(){var T=u.getEngine();u.format=m.format,u.type=v.textureType,u.invertY=!1,u._gammaSpace=!m.linearSpace,v.byteArray&&T._uploadDataToTextureDirectly(u,v.byteArray,0,0,void 0,!0)}),[2]}})})},l}()},78750:(r,t,e)=>{e.r(t),e.d(t,{_HDRTextureLoader:()=>o});var n=e(51967),i=e(81152),o=function(){function a(){this.supportCascades=!1}return a.prototype.loadCubeData=function(){throw".env not supported in Cube."},a.prototype.loadData=function(s,l,c){for(var u=new Uint8Array(s.buffer,s.byteOffset,s.byteLength),d=(0,n.NK)(u),h=(0,n.LT)(u,d),p=d.width*d.height,m=new Float32Array(4*p),v=0;v<p;v+=1)m[4*v]=h[3*v],m[4*v+1]=h[3*v+1],m[4*v+2]=h[3*v+2],m[4*v+3]=1;c(d.width,d.height,l.generateMipMaps,!1,function(){var b=l.getEngine();l.type=i.Y.TEXTURETYPE_FLOAT,l.format=i.Y.TEXTUREFORMAT_RGBA,l._gammaSpace=!1,b._uploadDataToTextureDirectly(l,m)})},a}()},81867:(r,t,e)=>{e.r(t),e.d(t,{_KTXTextureLoader:()=>s});var n=e(88188),i=e(47347),o=e(7164),a=e(81152);e(71974);var s=function(){function l(){this.supportCascades=!1}return l.prototype.loadCubeData=function(c,u,d,h){if(!Array.isArray(c)){u._invertVScale=!u.invertY;var p=u.getEngine(),m=new n.H(c,6),v=m.numberOfMipmapLevels>1&&u.generateMipMaps;p._unpackFlipY(!0),m.uploadLevels(u,u.generateMipMaps),u.width=m.pixelWidth,u.height=m.pixelHeight,p._setCubeMapTextureParams(u,v,m.numberOfMipmapLevels-1),u.isReady=!0,u.onLoadedObservable.notifyObservers(u),u.onLoadedObservable.clear(),h&&h()}},l.prototype.loadData=function(c,u,d,h){if(n.H.IsValid(c)){u._invertVScale=!u.invertY;var p=new n.H(c,1),m=function(v){switch(v){case a.Y.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT:return a.Y.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1;case a.Y.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:return a.Y.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3;case a.Y.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:return a.Y.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5;case a.Y.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2:return a.Y.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2;case a.Y.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return a.Y.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC;case a.Y.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return a.Y.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case a.Y.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:return a.Y.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4;case a.Y.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM:return a.Y.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM}return null}(p.glInternalFormat);m?(u.format=m,u._useSRGBBuffer=u.getEngine()._getUseSRGBBuffer(!0,u.generateMipMaps),u._gammaSpace=!0):u.format=p.glInternalFormat,d(p.pixelWidth,p.pixelHeight,u.generateMipMaps,!0,function(){p.uploadLevels(u,u.generateMipMaps)},p.isInvalid)}else i.Z.IsValid(c)?new i.Z(u.getEngine())._uploadAsync(c,u,h).then(function(){d(u.width,u.height,u.generateMipMaps,!0,function(){},!1)},function(v){o.V.Warn("Failed to load KTX2 texture data: ".concat(v.message)),d(0,0,!1,!1,function(){},!0)}):(o.V.Error("texture missing KTX identifier"),d(0,0,!1,!1,function(){},!0))},l}()},1235:(r,t,e)=>{e.d(t,{gT:()=>s,hy:()=>a,kf:()=>o});var n=e(7164),i=new Map;function o(l,c){a(l)&&n.V.Warn("Extension with the name '".concat(name,"' already exists")),i.set(l,c)}function a(l){return i.delete(l)}function s(l,c){c!=="image/ktx"&&c!=="image/ktx2"||(l=".ktx"),i.has(l)||(l.endsWith(".dds")&&o(".dds",function(){return Promise.resolve().then(e.bind(e,19135)).then(function(d){return new d._DDSTextureLoader})}),l.endsWith(".basis")&&o(".basis",function(){return Promise.resolve().then(e.bind(e,23586)).then(function(d){return new d._BasisTextureLoader})}),l.endsWith(".env")&&o(".env",function(){return Promise.resolve().then(e.bind(e,71545)).then(function(d){return new d._ENVTextureLoader})}),l.endsWith(".hdr")&&o(".hdr",function(){return Promise.resolve().then(e.bind(e,78750)).then(function(d){return new d._HDRTextureLoader})}),(l.endsWith(".ktx")||l.endsWith(".ktx2"))&&(o(".ktx",function(){return Promise.resolve().then(e.bind(e,81867)).then(function(d){return new d._KTXTextureLoader})}),o(".ktx2",function(){return Promise.resolve().then(e.bind(e,81867)).then(function(d){return new d._KTXTextureLoader})})),l.endsWith(".tga")&&o(".tga",function(){return Promise.resolve().then(e.bind(e,5996)).then(function(d){return new d._TGATextureLoader})}),l.endsWith(".exr")&&o(".exr",function(){return Promise.resolve().then(e.bind(e,93747)).then(function(d){return new d._ExrTextureLoader})}));var u=i.get(l);return u?Promise.resolve(u(c)):null}},5996:(r,t,e)=>{e.r(t),e.d(t,{_TGATextureLoader:()=>i});var n=e(65054),i=function(){function o(){this.supportCascades=!1}return o.prototype.loadCubeData=function(){throw".env not supported in Cube."},o.prototype.loadData=function(a,s,l){var c=new Uint8Array(a.buffer,a.byteOffset,a.byteLength),u=(0,n.O_)(c);l(u.width,u.height,s.generateMipMaps,!1,function(){(0,n.FA)(s,c)})},o}()},39813:(r,t,e)=>{var n=e(75768),i=e(28081);i.t.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(i.t.prototype,"sphericalPolynomial",{get:function(){var o=this;if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=n.d.ConvertCubeMapTextureToSphericalPolynomial(this),this._texture._sphericalPolynomialPromise===null?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then(function(a){o._texture._sphericalPolynomial=a,o._texture._sphericalPolynomialComputed=!0})),null}return null},set:function(o){this._texture&&(this._texture._sphericalPolynomial=o)},enumerable:!0,configurable:!0})},28081:(r,t,e)=>{e.d(t,{t:()=>h});var n=e(78322),i=e(6174),o=e(66377),a=e(8046),s=e(66614),l=e(81152),c=e(23885),u=(e(17347),e(63919)),d=e(12028),h=(e(82345),function(p){function m(v,b){b===void 0&&(b=null);var E=p.call(this,null)||this;return E.metadata=null,E.reservedDataStore=null,E._hasAlpha=!1,E._getAlphaFromRGB=!1,E.level=1,E._coordinatesIndex=0,E.optimizeUVAllocation=!0,E._coordinatesMode=l.Y.TEXTURE_EXPLICIT_MODE,E.wrapR=l.Y.TEXTURE_WRAP_ADDRESSMODE,E.anisotropicFilteringLevel=m.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,E._isCube=!1,E._gammaSpace=!0,E.invertZ=!1,E.lodLevelInAlpha=!1,E.isRenderTarget=!1,E._prefiltered=!1,E._forceSerialize=!1,E.animations=[],E.onDisposeObservable=new o.cP,E._onDisposeObserver=null,E._scene=null,E._uid=null,E._parentContainer=null,E._loadingError=!1,v?m._IsScene(v)?E._scene=v:E._engine=v:E._scene=s.q.LastCreatedScene,E._scene&&(E.uniqueId=E._scene.getUniqueId(),E._scene.addTexture(E),E._engine=E._scene.getEngine()),E._texture=b,E._uid=null,E}return(0,n.C6)(m,p),Object.defineProperty(m.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(v){var b=this;this._hasAlpha!==v&&(this._hasAlpha=v,this._scene&&this._scene.markAllMaterialsAsDirty(l.Y.MATERIAL_TextureDirtyFlag,function(E){return E.hasTexture(b)}))},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"getAlphaFromRGB",{get:function(){return this._getAlphaFromRGB},set:function(v){var b=this;this._getAlphaFromRGB!==v&&(this._getAlphaFromRGB=v,this._scene&&this._scene.markAllMaterialsAsDirty(l.Y.MATERIAL_TextureDirtyFlag,function(E){return E.hasTexture(b)}))},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"coordinatesIndex",{get:function(){return this._coordinatesIndex},set:function(v){var b=this;this._coordinatesIndex!==v&&(this._coordinatesIndex=v,this._scene&&this._scene.markAllMaterialsAsDirty(l.Y.MATERIAL_TextureDirtyFlag,function(E){return E.hasTexture(b)}))},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(v){var b=this;this._coordinatesMode!==v&&(this._coordinatesMode=v,this._scene&&this._scene.markAllMaterialsAsDirty(l.Y.MATERIAL_TextureDirtyFlag,function(E){return E.hasTexture(b)}))},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"wrapU",{get:function(){return this._wrapU},set:function(v){this._wrapU=v},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"wrapV",{get:function(){return this._wrapV},set:function(v){this._wrapV=v},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"isCube",{get:function(){return this._texture?this._texture.isCube:this._isCube},set:function(v){this._texture?this._texture.isCube=v:this._isCube=v},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(v){this._texture&&(this._texture.is3D=v)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(v){this._texture&&(this._texture.is2DArray=v)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"gammaSpace",{get:function(){return this._texture?(this._texture._gammaSpace===null&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace},set:function(v){var b,E=this;if(this._texture){if(this._texture._gammaSpace===v)return;this._texture._gammaSpace=v}else{if(this._gammaSpace===v)return;this._gammaSpace=v}(b=this.getScene())===null||b===void 0||b.markAllMaterialsAsDirty(l.Y.MATERIAL_TextureDirtyFlag,function(C){return C.hasTexture(E)})},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"isRGBD",{get:function(){return this._texture!=null&&this._texture._isRGBD},set:function(v){var b,E=this;v!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=v),(b=this.getScene())===null||b===void 0||b.markAllMaterialsAsDirty(l.Y.MATERIAL_TextureDirtyFlag,function(C){return C.hasTexture(E)}))},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"noMipmap",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(v){this._texture&&(this._texture._lodGenerationOffset=v)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(v){this._texture&&(this._texture._lodGenerationScale=v)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(v){this._texture&&(this._texture._linearSpecularLOD=v)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(v){this._texture&&(this._texture._irradianceTexture=v)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"uid",{get:function(){return this._uid||(this._uid=(0,c.z)()),this._uid},enumerable:!1,configurable:!0}),m.prototype.toString=function(){return this.name},m.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(m.prototype,"onDispose",{set:function(v){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(v)},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"isBlocking",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"loadingError",{get:function(){return this._loadingError},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"errorObject",{get:function(){return this._errorObject},enumerable:!1,configurable:!0}),m.prototype.getScene=function(){return this._scene},m.prototype._getEngine=function(){return this._engine},m.prototype.getTextureMatrix=function(){return a.uq.IdentityReadOnly},m.prototype.getReflectionTextureMatrix=function(){return a.uq.IdentityReadOnly},m.prototype.getRefractionTextureMatrix=function(){return this.getReflectionTextureMatrix()},m.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()||this.loadingError},m.prototype.scale=function(v){},Object.defineProperty(m.prototype,"canRescale",{get:function(){return!1},enumerable:!1,configurable:!0}),m.prototype._getFromCache=function(v,b,E,C,T,f){var g=this._getEngine();if(!g)return null;for(var S=g._getUseSRGBBuffer(!!T,b),y=g.getLoadedTexturesCache(),x=0;x<y.length;x++){var R=y[x];if(!(T!==void 0&&S!==R._useSRGBBuffer||C!==void 0&&C!==R.invertY||R.url!==v||R.generateMipMaps!==!b||E&&E!==R.samplingMode||f!==void 0&&f!==R.isCube))return R.incrementReferences(),R}return null},m.prototype._rebuild=function(v){},m.prototype.clone=function(){return null},Object.defineProperty(m.prototype,"textureType",{get:function(){return this._texture&&this._texture.type!==void 0?this._texture.type:l.Y.TEXTURETYPE_UNSIGNED_INT},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"textureFormat",{get:function(){return this._texture&&this._texture.format!==void 0?this._texture.format:l.Y.TEXTUREFORMAT_RGBA},enumerable:!1,configurable:!0}),m.prototype._markAllSubMeshesAsTexturesDirty=function(){var v=this.getScene();v&&v.markAllMaterialsAsDirty(l.Y.MATERIAL_TextureDirtyFlag)},m.prototype.readPixels=function(v,b,E,C,T,f,g,S,y){if(v===void 0&&(v=0),b===void 0&&(b=0),E===void 0&&(E=null),C===void 0&&(C=!0),T===void 0&&(T=!1),f===void 0&&(f=0),g===void 0&&(g=0),S===void 0&&(S=Number.MAX_VALUE),y===void 0&&(y=Number.MAX_VALUE),!this._texture)return null;var x=this._getEngine();if(!x)return null;var R=this.getSize(),I=R.width,M=R.height;b!==0&&(I/=Math.pow(2,b),M/=Math.pow(2,b),I=Math.round(I),M=Math.round(M)),S=Math.min(I,S),y=Math.min(M,y);try{return this._texture.isCube?x._readTexturePixels(this._texture,S,y,v,b,E,C,T,f,g):x._readTexturePixels(this._texture,S,y,-1,b,E,C,T,f,g)}catch{return null}},m.prototype._readPixelsSync=function(v,b,E,C,T){if(v===void 0&&(v=0),b===void 0&&(b=0),E===void 0&&(E=null),C===void 0&&(C=!0),T===void 0&&(T=!1),!this._texture)return null;var f=this.getSize(),g=f.width,S=f.height,y=this._getEngine();if(!y)return null;b!=0&&(g/=Math.pow(2,b),S/=Math.pow(2,b),g=Math.round(g),S=Math.round(S));try{return this._texture.isCube?y._readTexturePixelsSync(this._texture,g,S,v,b,E,C,T):y._readTexturePixelsSync(this._texture,g,S,-1,b,E,C,T)}catch{return null}},Object.defineProperty(m.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!1,configurable:!0}),m.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);var v=this._scene.textures.indexOf(this);if(v>=0&&this._scene.textures.splice(v,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){var b=this._parentContainer.textures.indexOf(this);b>-1&&this._parentContainer.textures.splice(b,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,p.prototype.dispose.call(this)},m.prototype.serialize=function(v){if(v===void 0&&(v=!1),!this.name&&!v)return null;var b=d.p.Serialize(this);return d.p.AppendSerializedAnimations(this,b),b},m.WhenAllReady=function(v,b){var E=v.length;if(E!==0)for(var C=0;C<v.length;C++){var T=v[C];if(T.isReady())--E==0&&b();else{var f=T.onLoadObservable;f?f.addOnce(function(){--E==0&&b()}):--E==0&&b()}}else b()},m._IsScene=function(v){return v.getClassName()==="Scene"},m.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,n.Cg)([(0,i.lK)()],m.prototype,"uniqueId",void 0),(0,n.Cg)([(0,i.lK)()],m.prototype,"name",void 0),(0,n.Cg)([(0,i.lK)()],m.prototype,"metadata",void 0),(0,n.Cg)([(0,i.lK)("hasAlpha")],m.prototype,"_hasAlpha",void 0),(0,n.Cg)([(0,i.lK)("getAlphaFromRGB")],m.prototype,"_getAlphaFromRGB",void 0),(0,n.Cg)([(0,i.lK)()],m.prototype,"level",void 0),(0,n.Cg)([(0,i.lK)("coordinatesIndex")],m.prototype,"_coordinatesIndex",void 0),(0,n.Cg)([(0,i.lK)()],m.prototype,"optimizeUVAllocation",void 0),(0,n.Cg)([(0,i.lK)("coordinatesMode")],m.prototype,"_coordinatesMode",void 0),(0,n.Cg)([(0,i.lK)()],m.prototype,"wrapU",null),(0,n.Cg)([(0,i.lK)()],m.prototype,"wrapV",null),(0,n.Cg)([(0,i.lK)()],m.prototype,"wrapR",void 0),(0,n.Cg)([(0,i.lK)()],m.prototype,"anisotropicFilteringLevel",void 0),(0,n.Cg)([(0,i.lK)()],m.prototype,"isCube",null),(0,n.Cg)([(0,i.lK)()],m.prototype,"is3D",null),(0,n.Cg)([(0,i.lK)()],m.prototype,"is2DArray",null),(0,n.Cg)([(0,i.lK)()],m.prototype,"gammaSpace",null),(0,n.Cg)([(0,i.lK)()],m.prototype,"invertZ",void 0),(0,n.Cg)([(0,i.lK)()],m.prototype,"lodLevelInAlpha",void 0),(0,n.Cg)([(0,i.lK)()],m.prototype,"lodGenerationOffset",null),(0,n.Cg)([(0,i.lK)()],m.prototype,"lodGenerationScale",null),(0,n.Cg)([(0,i.lK)()],m.prototype,"linearSpecularLOD",null),(0,n.Cg)([(0,i.uM)()],m.prototype,"irradianceTexture",null),(0,n.Cg)([(0,i.lK)()],m.prototype,"isRenderTarget",void 0),m}(u.D))},19133:(r,t,e)=>{e.d(t,{G:()=>n,h:()=>s});var n,i=e(78322),o=e(66377),a=e(55204);(function(l){l[l.Unknown=0]="Unknown",l[l.Url=1]="Url",l[l.Temp=2]="Temp",l[l.Raw=3]="Raw",l[l.Dynamic=4]="Dynamic",l[l.RenderTarget=5]="RenderTarget",l[l.MultiRenderTarget=6]="MultiRenderTarget",l[l.Cube=7]="Cube",l[l.CubeRaw=8]="CubeRaw",l[l.CubePrefiltered=9]="CubePrefiltered",l[l.Raw3D=10]="Raw3D",l[l.Raw2DArray=11]="Raw2DArray",l[l.DepthStencil=12]="DepthStencil",l[l.CubeRawRGBD=13]="CubeRawRGBD",l[l.Depth=14]="Depth"})(n||(n={}));var s=function(l){function c(u,d,h){h===void 0&&(h=!1);var p=l.call(this)||this;return p.isReady=!1,p.isCube=!1,p.is3D=!1,p.is2DArray=!1,p.isMultiview=!1,p.url="",p.generateMipMaps=!1,p.samples=0,p.type=-1,p.format=-1,p.onLoadedObservable=new o.cP,p.onErrorObservable=new o.cP,p.onRebuildCallback=null,p.width=0,p.height=0,p.depth=0,p.baseWidth=0,p.baseHeight=0,p.baseDepth=0,p.invertY=!1,p._invertVScale=!1,p._associatedChannel=-1,p._source=0,p._buffer=null,p._bufferView=null,p._bufferViewArray=null,p._bufferViewArrayArray=null,p._size=0,p._extension="",p._files=null,p._workingCanvas=null,p._workingContext=null,p._cachedCoordinatesMode=null,p._isDisabled=!1,p._compression=null,p._sphericalPolynomial=null,p._sphericalPolynomialPromise=null,p._sphericalPolynomialComputed=!1,p._lodGenerationScale=0,p._lodGenerationOffset=0,p._useSRGBBuffer=!1,p._creationFlags=0,p._lodTextureHigh=null,p._lodTextureMid=null,p._lodTextureLow=null,p._isRGBD=!1,p._linearSpecularLOD=!1,p._irradianceTexture=null,p._hardwareTexture=null,p._maxLodLevel=null,p._references=1,p._gammaSpace=null,p._premulAlpha=!1,p._dynamicTextureSource=null,p._engine=u,p._source=d,p._uniqueId=c._Counter++,h||(p._hardwareTexture=u._createHardwareTexture()),p}return(0,i.C6)(c,l),Object.defineProperty(c.prototype,"useMipMaps",{get:function(){return this.generateMipMaps},set:function(u){this.generateMipMaps=u},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),c.prototype._setUniqueId=function(u){this._uniqueId=u},c.prototype.getEngine=function(){return this._engine},Object.defineProperty(c.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),c.prototype.incrementReferences=function(){this._references++},c.prototype.updateSize=function(u,d,h){h===void 0&&(h=1),this._engine.updateTextureDimensions(this,u,d,h),this.width=u,this.height=d,this.depth=h,this.baseWidth=u,this.baseHeight=d,this.baseDepth=h,this._size=u*d*h},c.prototype._rebuild=function(){var u,d,h=this;if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){var p=this.onRebuildCallback(this),m=function(b){b._swapAndDie(h,!1),h.isReady=p.isReady};p.isAsync?p.proxy.then(m):m(p.proxy)}else{var v;switch(this.source){case 2:case 12:case 14:break;case 1:return void(v=this._engine.createTexture((u=this._originalUrl)!==null&&u!==void 0?u:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(b){b._swapAndDie(h,!1),h.isReady=!0},null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:(v=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer))._swapAndDie(this,!1),this.isReady=!0;break;case 10:(v=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case 11:(v=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case 4:(v=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(v=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){v._swapAndDie(h,!1),h.isReady=!0},null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:(v=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,(d=this._originalFormat)!==null&&d!==void 0?d:this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return void((v=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(b){b&&b._swapAndDie(h,!1),h.isReady=!0},null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}}},c.prototype._swapAndDie=function(u,d){var h;d===void 0&&(d=!0),(h=this._hardwareTexture)===null||h===void 0||h.setUsage(u._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),u._hardwareTexture=this._hardwareTexture,d&&(u._isRGBD=this._isRGBD),this._lodTextureHigh&&(u._lodTextureHigh&&u._lodTextureHigh.dispose(),u._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(u._lodTextureMid&&u._lodTextureMid.dispose(),u._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(u._lodTextureLow&&u._lodTextureLow.dispose(),u._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(u._irradianceTexture&&u._irradianceTexture.dispose(),u._irradianceTexture=this._irradianceTexture);var p=this._engine.getLoadedTexturesCache(),m=p.indexOf(this);m!==-1&&p.splice(m,1),(m=p.indexOf(u))===-1&&p.push(u)},c.prototype.dispose=function(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._references===0&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)},c._Counter=0,c}(a.u)},54665:(r,t,e)=>{var n,i,o;e.d(t,{GQ:()=>o,Ok:()=>n,Xl:()=>i}),function(a){a[a.ETC1S=0]="ETC1S",a[a.UASTC4x4=1]="UASTC4x4"}(n||(n={})),function(a){a[a.ASTC_4X4_RGBA=0]="ASTC_4X4_RGBA",a[a.BC7_RGBA=1]="BC7_RGBA",a[a.BC3_RGBA=2]="BC3_RGBA",a[a.BC1_RGB=3]="BC1_RGB",a[a.PVRTC1_4_RGBA=4]="PVRTC1_4_RGBA",a[a.PVRTC1_4_RGB=5]="PVRTC1_4_RGB",a[a.ETC2_RGBA=6]="ETC2_RGBA",a[a.ETC1_RGB=7]="ETC1_RGB",a[a.RGBA32=8]="RGBA32",a[a.R8=9]="R8",a[a.RG8=10]="RG8"}(i||(i={})),function(a){a[a.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",a[a.COMPRESSED_RGBA_ASTC_4X4_KHR=37808]="COMPRESSED_RGBA_ASTC_4X4_KHR",a[a.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",a[a.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",a[a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",a[a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",a[a.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",a[a.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",a[a.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",a[a.RGBA8Format=32856]="RGBA8Format",a[a.R8Format=33321]="R8Format",a[a.RG8Format=33323]="RG8Format"}(o||(o={}))},41085:(r,t,e)=>{e.d(t,{$:()=>p});var n=e(78322),i=e(66377),o=e(8046),a=e(50582),s=e(63639),l=e(7931),c=e(81152),u=(e(71073),e(8864),e(64838),e(11296)),d=e(24687),h=e(87074);e(74239).M.prototype.setDepthStencilTexture=function(m,v){this._engine.setDepthStencilTexture(this._samplers[m],this._uniforms[m],v,m)};var p=function(m){function v(b,E,C,T,f,g,S,y,x,R,I,M,D,B,F,X,$){T===void 0&&(T=!1),f===void 0&&(f=!0),g===void 0&&(g=c.Y.TEXTURETYPE_UNSIGNED_INT),S===void 0&&(S=!1),y===void 0&&(y=a.g.TRILINEAR_SAMPLINGMODE),x===void 0&&(x=!0),R===void 0&&(R=!1),I===void 0&&(I=!1),M===void 0&&(M=c.Y.TEXTUREFORMAT_RGBA),D===void 0&&(D=!1),X===void 0&&(X=!1),$===void 0&&($=!1);var Q,ie,q,ee,te,ce,fe,de=this,Te=void 0,ue=!0;if(typeof T=="object"){var U=T;T=!!U.generateMipMaps,f=(Q=U.doNotChangeAspectRatio)===null||Q===void 0||Q,g=(ie=U.type)!==null&&ie!==void 0?ie:c.Y.TEXTURETYPE_UNSIGNED_BYTE,S=!!U.isCube,y=(q=U.samplingMode)!==null&&q!==void 0?q:a.g.TRILINEAR_SAMPLINGMODE,x=(ee=U.generateDepthBuffer)===null||ee===void 0||ee,R=!!U.generateStencilBuffer,I=!!U.isMulti,M=(te=U.format)!==null&&te!==void 0?te:c.Y.TEXTUREFORMAT_RGBA,D=!!U.delayAllocation,B=U.samples,F=U.creationFlags,X=!!U.noColorAttachment,$=!!U.useSRGBBuffer,Te=U.colorAttachment,ue=(ce=U.gammaSpace)!==null&&ce!==void 0?ce:ue}if((de=m.call(this,null,C,!T,void 0,y,void 0,void 0,void 0,void 0,M)||this)._unObserveRenderList=null,de._renderListHasChanged=function(w,k){var J,le=de._renderList?de._renderList.length:0;(k===0&&le>0||le===0)&&((J=de.getScene())===null||J===void 0||J.meshes.forEach(function(be){be._markSubMeshesAsLightDirty()}))},de.renderParticles=!0,de.renderSprites=!1,de.forceLayerMaskCheck=!1,de.ignoreCameraViewport=!1,de.onBeforeBindObservable=new i.cP,de.onAfterUnbindObservable=new i.cP,de.onBeforeRenderObservable=new i.cP,de.onAfterRenderObservable=new i.cP,de.onClearObservable=new i.cP,de.onResizeObservable=new i.cP,de._cleared=!1,de.skipInitialClear=!1,de._currentRefreshId=-1,de._refreshRate=1,de._samples=1,de._canRescale=!0,de._renderTarget=null,de.boundingBoxPosition=o.Pq.Zero(),!(C=de.getScene()))return de;var N=de.getScene().getEngine();return de._gammaSpace=ue,de._coordinatesMode=a.g.PROJECTION_MODE,de.renderList=[],de.name=b,de.isRenderTarget=!0,de._initialSizeParameter=E,de._renderPassIds=[],de._isCubeData=S,de._processSizeParameter(E),de.renderPassId=de._renderPassIds[0],de._resizeObserver=N.onResizeObservable.add(function(){}),de._generateMipMaps=!!T,de._doNotChangeAspectRatio=f,de._renderingManager=new l.m(C),de._renderingManager._useSceneAutoClearSetup=!0,I||(de._renderTargetOptions={generateMipMaps:T,type:g,format:(fe=de._format)!==null&&fe!==void 0?fe:void 0,samplingMode:de.samplingMode,generateDepthBuffer:x,generateStencilBuffer:R,samples:B,creationFlags:F,noColorAttachment:X,useSRGBBuffer:$,colorAttachment:Te,label:de.name},de.samplingMode===a.g.NEAREST_SAMPLINGMODE&&(de.wrapU=a.g.CLAMP_ADDRESSMODE,de.wrapV=a.g.CLAMP_ADDRESSMODE),D||(S?(de._renderTarget=C.getEngine().createRenderTargetCubeTexture(de.getRenderSize(),de._renderTargetOptions),de.coordinatesMode=a.g.INVCUBIC_MODE,de._textureMatrix=o.uq.Identity()):de._renderTarget=C.getEngine().createRenderTargetTexture(de._size,de._renderTargetOptions),de._texture=de._renderTarget.texture,B!==void 0&&(de.samples=B))),de}return(0,n.C6)(v,m),Object.defineProperty(v.prototype,"renderList",{get:function(){return this._renderList},set:function(b){this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),b&&(this._unObserveRenderList=(0,u.lL)(b,this._renderListHasChanged)),this._renderList=b},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"postProcesses",{get:function(){return this._postProcesses},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"_prePassEnabled",{get:function(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onAfterUnbind",{set:function(b){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(b)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onBeforeRender",{set:function(b){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(b)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onAfterRender",{set:function(b){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(b)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onClear",{set:function(b){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(b)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"renderPassIds",{get:function(){return this._renderPassIds},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"currentRefreshId",{get:function(){return this._currentRefreshId},enumerable:!1,configurable:!0}),v.prototype.setMaterialForRendering=function(b,E){var C;C=Array.isArray(b)?b:[b];for(var T=0;T<C.length;++T)for(var f=0;f<this._renderPassIds.length;++f)C[T].setMaterialForRenderPass(this._renderPassIds[f],E!==void 0?Array.isArray(E)?E[f]:E:void 0)},Object.defineProperty(v.prototype,"isMulti",{get:function(){var b,E;return(E=(b=this._renderTarget)===null||b===void 0?void 0:b.isMulti)!==null&&E!==void 0&&E},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!1,configurable:!0}),v.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(v.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(b){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(b)){this._boundingBoxSize=b;var E=this.getScene();E&&E.markAllMaterialsAsDirty(c.Y.MATERIAL_TextureDirtyFlag)}},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"depthStencilTexture",{get:function(){var b,E;return(E=(b=this._renderTarget)===null||b===void 0?void 0:b._depthStencilTexture)!==null&&E!==void 0?E:null},enumerable:!1,configurable:!0}),v.prototype.createDepthStencilTexture=function(b,E,C,T,f,g){var S;b===void 0&&(b=0),E===void 0&&(E=!0),C===void 0&&(C=!1),T===void 0&&(T=1),f===void 0&&(f=c.Y.TEXTUREFORMAT_DEPTH32_FLOAT),(S=this._renderTarget)===null||S===void 0||S.createDepthStencilTexture(b,E,C,T,f,g)},v.prototype._releaseRenderPassId=function(){if(this._scene)for(var b=this._scene.getEngine(),E=0;E<this._renderPassIds.length;++E)b.releaseRenderPassId(this._renderPassIds[E]);this._renderPassIds=[]},v.prototype._createRenderPassId=function(){this._releaseRenderPassId();for(var b=this._scene.getEngine(),E=this._isCubeData?6:this.getRenderLayers()||1,C=0;C<E;++C)this._renderPassIds[C]=b.createRenderPassId("RenderTargetTexture - ".concat(this.name,"#").concat(C))},v.prototype._processSizeParameter=function(b,E){if(E===void 0&&(E=!0),b.ratio){this._sizeRatio=b.ratio;var C=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(C.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(C.getRenderHeight(),this._sizeRatio)}}else this._size=b;E&&this._createRenderPassId()},Object.defineProperty(v.prototype,"samples",{get:function(){var b,E;return(E=(b=this._renderTarget)===null||b===void 0?void 0:b.samples)!==null&&E!==void 0?E:this._samples},set:function(b){this._renderTarget&&(this._samples=this._renderTarget.setSamples(b))},enumerable:!1,configurable:!0}),v.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(v.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(b){this._refreshRate=b,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),v.prototype.addPostProcess=function(b){if(!this._postProcessManager){var E=this.getScene();if(!E)return;this._postProcessManager=new s.X(E),this._postProcesses=new Array}this._postProcesses.push(b),this._postProcesses[0].autoClear=!1},v.prototype.clearPostProcesses=function(b){if(b===void 0&&(b=!1),this._postProcesses){if(b)for(var E=0,C=this._postProcesses;E<C.length;E++)C[E].dispose();this._postProcesses=[]}},v.prototype.removePostProcess=function(b){if(this._postProcesses){var E=this._postProcesses.indexOf(b);E!==-1&&(this._postProcesses.splice(E,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},v.prototype._shouldRender=function(){return this._currentRefreshId===-1||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},v.prototype.getRenderSize=function(){return this.getRenderWidth()},v.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},v.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},v.prototype.getRenderLayers=function(){var b=this._size.layers;return b||this._size.depth||0},v.prototype.disableRescaling=function(){this._canRescale=!1},Object.defineProperty(v.prototype,"canRescale",{get:function(){return this._canRescale},enumerable:!1,configurable:!0}),v.prototype.scale=function(b){var E=Math.max(1,this.getRenderSize()*b);this.resize(E)},v.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:m.prototype.getReflectionTextureMatrix.call(this)},v.prototype.resize=function(b){var E,C=this.isCube;(E=this._renderTarget)===null||E===void 0||E.dispose(),this._renderTarget=null;var T=this.getScene();T&&(this._processSizeParameter(b,!1),this._renderTarget=C?T.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):T.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,this._renderTargetOptions.samples!==void 0&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},v.prototype.render=function(b,E){b===void 0&&(b=!1),E===void 0&&(E=!1),this._render(b,E)},v.prototype.isReadyForRendering=function(){return this._render(!1,!1,!0)},v.prototype._render=function(b,E,C){var T;b===void 0&&(b=!1),E===void 0&&(E=!1),C===void 0&&(C=!1);var f=this.getScene();if(!f)return C;var g=f.getEngine();if(this.useCameraPostProcesses!==void 0&&(b=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(var S=0;S<this._waitingRenderList.length;S++){var y=this._waitingRenderList[S];(I=f.getMeshById(y))&&this.renderList.push(I)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];var x=this.getScene();if(!x)return C;var R=x.meshes;for(S=0;S<R.length;S++){var I=R[S];this.renderListPredicate(I)&&this.renderList.push(I)}}var M=g.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);var D=(T=this.activeCamera)!==null&&T!==void 0?T:f.activeCamera,B=f.activeCamera;D&&(D!==f.activeCamera&&(f.setTransformMatrix(D.getViewMatrix(),D.getProjectionMatrix(!0)),f.activeCamera=D),g.setViewport(D.rigParent?D.rigParent.viewport:D.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;var F=C;if(C){f.getViewMatrix()||f.updateTransformMatrix();var X=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(te=0;te<X&&F;te++){var $=null,Q=this.renderList?this.renderList:f.getActiveMeshes().data,ie=this.renderList?this.renderList.length:f.getActiveMeshes().length;g.currentRenderPassId=this._renderPassIds[te],this.onBeforeRenderObservable.notifyObservers(te),this.getCustomRenderList&&($=this.getCustomRenderList(te,Q,ie)),$||($=Q),this._doNotChangeAspectRatio||f.updateTransformMatrix(!0);for(var q=0;q<$.length&&F;++q)if((I=$[q]).isEnabled()&&!I.isBlocked&&I.isVisible&&I.subMeshes){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(I,this.refreshRate,C)){F=!1;continue}}else if(!I.isReady(!0)){F=!1;continue}}this.onAfterRenderObservable.notifyObservers(te),(this.is2DArray||this.is3D||this.isCube)&&(f.incrementRenderId(),f.resetCachedMaterial())}}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(var ee=0;ee<6;ee++)this._renderToTarget(ee,b,E,void 0,D),f.incrementRenderId(),f.resetCachedMaterial();else this._renderToTarget(0,b,E,void 0,D);else for(var te=0;te<this.getRenderLayers();te++)this._renderToTarget(0,b,E,te,D),f.incrementRenderId(),f.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),g.currentRenderPassId=M,B&&(f.activeCamera=B,this.activeCamera&&this.activeCamera!==f.activeCamera&&f.setTransformMatrix(f.activeCamera.getViewMatrix(),f.activeCamera.getProjectionMatrix(!0)),g.setViewport(f.activeCamera.viewport)),f.resetCachedMaterial(),F},v.prototype._bestReflectionRenderTargetDimension=function(b,E){var C=b*E,T=(0,h.OG)(C+16384/(128+C));return Math.min((0,h.C4)(b),T)},v.prototype._prepareRenderingManager=function(b,E,C,T){var f=this.getScene();if(f){this._renderingManager.reset();for(var g=f.getRenderId(),S=0;S<E;S++){var y=b[S];if(y&&!y.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(y,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!y.isReady(this.refreshRate===0)){this.resetRefreshCounter();continue}if(!y._internalAbstractMeshDataInfo._currentLODIsUpToDate&&f.activeCamera&&(y._internalAbstractMeshDataInfo._currentLOD=f.customLODSelector?f.customLODSelector(y,this.activeCamera||f.activeCamera):y.getLOD(this.activeCamera||f.activeCamera),y._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!y._internalAbstractMeshDataInfo._currentLOD)continue;var x=y._internalAbstractMeshDataInfo._currentLOD;x._preActivateForIntermediateRendering(g);var R;if(R=!(!T||!C||y.layerMask&C.layerMask),y.isEnabled()&&y.isVisible&&y.subMeshes&&!R){if(x!==y&&x._activate(g,!0),y._activate(g,!0)&&y.subMeshes.length){y.isAnInstance?y._internalAbstractMeshDataInfo._actAsRegularMesh&&(x=y):x._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,x._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var I=0;I<x.subMeshes.length;I++){var M=x.subMeshes[I];this._renderingManager.dispatch(M,x)}}y._postActivate()}}}for(var D=0;D<f.particleSystems.length;D++){var B=f.particleSystems[D],F=B.emitter;B.isStarted()&&F&&(!F.position||F.isEnabled())&&this._renderingManager.dispatchParticles(B)}}},v.prototype._bindFrameBuffer=function(b,E){b===void 0&&(b=0),E===void 0&&(E=0);var C=this.getScene();if(C){var T=C.getEngine();this._renderTarget&&T.bindFramebuffer(this._renderTarget,this.isCube?b:void 0,void 0,void 0,this.ignoreCameraViewport,0,E)}},v.prototype._unbindFrameBuffer=function(b,E){var C=this;this._renderTarget&&b.unBindFramebuffer(this._renderTarget,this.isCube,function(){C.onAfterRenderObservable.notifyObservers(E)})},v.prototype._prepareFrame=function(b,E,C,T){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):T&&b.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(E,C)},v.prototype._renderToTarget=function(b,E,C,T,f){var g,S,y,x,R,I;T===void 0&&(T=0),f===void 0&&(f=null);var M=this.getScene();if(M){var D=M.getEngine();if((g=D._debugPushGroup)===null||g===void 0||g.call(D,"render to face #".concat(b," layer #").concat(T),1),this._prepareFrame(M,b,T,E),this.is2DArray||this.is3D?(D.currentRenderPassId=this._renderPassIds[T],this.onBeforeRenderObservable.notifyObservers(T)):(D.currentRenderPassId=this._renderPassIds[b],this.onBeforeRenderObservable.notifyObservers(b)),D.snapshotRendering&&D.snapshotRenderingMode===c.Y.SNAPSHOTRENDERING_FAST)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(D):this.skipInitialClear||D.clear(this.clearColor||M.clearColor,!0,!0,!0);else{var B=null,F=this.renderList?this.renderList:M.getActiveMeshes().data,X=this.renderList?this.renderList.length:M.getActiveMeshes().length;this.getCustomRenderList&&(B=this.getCustomRenderList(this.is2DArray||this.is3D?T:b,F,X)),B?this._prepareRenderingManager(B,B.length,f,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(F,X,f,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),B=F);for(var $=0,Q=M._beforeRenderTargetClearStage;$<Q.length;$++)Q[$].action(this,b,T);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(D):this.skipInitialClear||D.clear(this.clearColor||M.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||M.updateTransformMatrix(!0);for(var ie=0,q=M._beforeRenderTargetDrawStage;ie<q.length;ie++)q[ie].action(this,b,T);this._renderingManager.render(this.customRenderFunction,B,this.renderParticles,this.renderSprites);for(var ee=0,te=M._afterRenderTargetDrawStage;ee<te.length;ee++)te[ee].action(this,b,T);var ce=(y=(S=this._texture)===null||S===void 0?void 0:S.generateMipMaps)!==null&&y!==void 0&&y;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,(x=this._renderTarget)!==null&&x!==void 0?x:void 0,b,this._postProcesses,this.ignoreCameraViewport):E&&M.postProcessManager._finalizeFrame(!1,(R=this._renderTarget)!==null&&R!==void 0?R:void 0,b);for(var fe=0,de=M._afterRenderTargetPostProcessStage;fe<de.length;fe++)de[fe].action(this,b,T);this._texture&&(this._texture.generateMipMaps=ce),this._doNotChangeAspectRatio||M.updateTransformMatrix(!0),C&&(0,d.yp)(this.getRenderWidth(),this.getRenderHeight(),D)}this._unbindFrameBuffer(D,b),this._texture&&this.isCube&&b===5&&D.generateMipMapsForCubemap(this._texture,!0),(I=D._debugPopGroup)===null||I===void 0||I.call(D,1)}},v.prototype.setRenderingOrder=function(b,E,C,T){E===void 0&&(E=null),C===void 0&&(C=null),T===void 0&&(T=null),this._renderingManager.setRenderingOrder(b,E,C,T)},v.prototype.setRenderingAutoClearDepthStencil=function(b,E){this._renderingManager.setRenderingAutoClearDepthStencil(b,E),this._renderingManager._useSceneAutoClearSetup=!1},v.prototype.clone=function(){var b=this.getSize(),E=new v(this.name,b,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return E.hasAlpha=this.hasAlpha,E.level=this.level,E.coordinatesMode=this.coordinatesMode,this.renderList&&(E.renderList=this.renderList.slice(0)),E},v.prototype.serialize=function(){if(!this.name)return null;var b=m.prototype.serialize.call(this);if(b.renderTargetSize=this.getRenderSize(),b.renderList=[],this.renderList)for(var E=0;E<this.renderList.length;E++)b.renderList.push(this.renderList[E].id);return b},v.prototype.disposeFramebufferObjects=function(){var b;(b=this._renderTarget)===null||b===void 0||b.dispose(!0)},v.prototype.releaseInternalTexture=function(){var b;(b=this._renderTarget)===null||b===void 0||b.releaseTextures(),this._texture=null},v.prototype.dispose=function(){var b;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var E=this.getScene();if(E){var C=E.customRenderTargets.indexOf(this);C>=0&&E.customRenderTargets.splice(C,1);for(var T=0,f=E.cameras;T<f.length;T++){var g=f[T];(C=g.customRenderTargets.indexOf(this))>=0&&g.customRenderTargets.splice(C,1)}(b=this._renderTarget)===null||b===void 0||b.dispose(),this._renderTarget=null,this._texture=null,m.prototype.dispose.call(this)}},v.prototype._rebuild=function(){this.refreshRate===v.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=v.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},v.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},v.prototype.getViewCount=function(){return 1},v.REFRESHRATE_RENDER_ONCE=0,v.REFRESHRATE_RENDER_ONEVERYFRAME=1,v.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,v}(a.g);a.g._CreateRenderTargetTexture=function(m,v,b,E,C){return new p(m,v,b,E)}},50582:(r,t,e)=>{e.d(t,{g:()=>C});var n=e(78322),i=e(6174),o=e(66377),a=e(8046),s=e(28081),l=e(81152),c=e(34623),u=e(41190),d=e(53695),h=e(252),p=e(43939),m=e(37530),v=e(75838),b=e(51956),E=e(12028),C=function(T){function f(g,S,y,x,R,I,M,D,B,F,X,$,Q,ie){R===void 0&&(R=f.TRILINEAR_SAMPLINGMODE),I===void 0&&(I=null),M===void 0&&(M=null),D===void 0&&(D=null),B===void 0&&(B=!1);var q,ee,te,ce,fe,de,Te,ue,U,N,w,k=this;(k=T.call(this,S)||this).url=null,k.uOffset=0,k.vOffset=0,k.uScale=1,k.vScale=1,k.uAng=0,k.vAng=0,k.wAng=0,k.uRotationCenter=.5,k.vRotationCenter=.5,k.wRotationCenter=.5,k.homogeneousRotationInUVTransform=!1,k.inspectableCustomProperties=null,k._noMipmap=!1,k._invertY=!1,k._rowGenerationMatrix=null,k._cachedTextureMatrix=null,k._projectionModeMatrix=null,k._t0=null,k._t1=null,k._t2=null,k._cachedUOffset=-1,k._cachedVOffset=-1,k._cachedUScale=0,k._cachedVScale=0,k._cachedUAng=-1,k._cachedVAng=-1,k._cachedWAng=-1,k._cachedReflectionProjectionMatrixId=-1,k._cachedURotationCenter=-1,k._cachedVRotationCenter=-1,k._cachedWRotationCenter=-1,k._cachedHomogeneousRotationInUVTransform=!1,k._cachedIdentity3x2=!0,k._cachedReflectionTextureMatrix=null,k._cachedReflectionUOffset=-1,k._cachedReflectionVOffset=-1,k._cachedReflectionUScale=0,k._cachedReflectionVScale=0,k._cachedReflectionCoordinatesMode=-1,k._buffer=null,k._deleteBuffer=!1,k._format=null,k._delayedOnLoad=null,k._delayedOnError=null,k.onLoadObservable=new o.cP,k._isBlocking=!0,k.name=g||"",k.url=g;var J=!1,le=null,be=!0;typeof y=="object"&&y!==null?(w=(q=y.noMipmap)!==null&&q!==void 0&&q,x=(ee=y.invertY)!==null&&ee!==void 0?ee:!b.rX,R=(te=y.samplingMode)!==null&&te!==void 0?te:f.TRILINEAR_SAMPLINGMODE,I=(ce=y.onLoad)!==null&&ce!==void 0?ce:null,M=(fe=y.onError)!==null&&fe!==void 0?fe:null,D=(de=y.buffer)!==null&&de!==void 0?de:null,B=(Te=y.deleteBuffer)!==null&&Te!==void 0&&Te,F=y.format,X=y.mimeType,$=y.loaderOptions,Q=y.creationFlags,J=(ue=y.useSRGBBuffer)!==null&&ue!==void 0&&ue,le=(U=y.internalTexture)!==null&&U!==void 0?U:null,be=(N=y.gammaSpace)!==null&&N!==void 0?N:be):w=!!y,k._gammaSpace=be,k._noMipmap=w,k._invertY=x===void 0?!b.rX:x,k._initialSamplingMode=R,k._buffer=D,k._deleteBuffer=B,k._mimeType=X,k._loaderOptions=$,k._creationFlags=Q,k._useSRGBBuffer=J,k._forcedExtension=ie,F&&(k._format=F);var ve=k.getScene(),ye=k._getEngine();if(!ye)return k;ye.onBeforeTextureInitObservable.notifyObservers(k);var Me=function(){k._texture&&(k._texture._invertVScale&&(k.vScale*=-1,k.vOffset+=1),k._texture._cachedWrapU!==null&&(k.wrapU=k._texture._cachedWrapU,k._texture._cachedWrapU=null),k._texture._cachedWrapV!==null&&(k.wrapV=k._texture._cachedWrapV,k._texture._cachedWrapV=null),k._texture._cachedWrapR!==null&&(k.wrapR=k._texture._cachedWrapR,k._texture._cachedWrapR=null)),k.onLoadObservable.hasObservers()&&k.onLoadObservable.notifyObservers(k),I&&I(),!k.isBlocking&&ve&&ve.resetCachedMaterial()},we=function(Ke,Qe){k._loadingError=!0,k._errorObject={message:Ke,exception:Qe},M&&M(Ke,Qe),f.OnTextureLoadErrorObservable.notifyObservers(k)};if(!k.url&&!le)return k._delayedOnLoad=Me,k._delayedOnError=we,k;if(k._texture=le??k._getFromCache(k.url,w,R,k._invertY,J,k.isCube),k._texture)if(k._texture.isReady)d._.SetImmediate(function(){return Me()});else{var He=k._texture.onLoadedObservable.add(Me);k._texture.onErrorObservable.add(function(Ke){var Qe;we(Ke.message,Ke.exception),(Qe=k._texture)===null||Qe===void 0||Qe.onLoadedObservable.remove(He)})}else if(ve&&ve.useDelayedTextureLoading)k.delayLoadState=l.Y.DELAYLOADSTATE_NOTLOADED,k._delayedOnLoad=Me,k._delayedOnError=we;else{try{k._texture=ye.createTexture(k.url,w,k._invertY,ve,R,Me,we,k._buffer,void 0,k._format,k._forcedExtension,X,$,Q,J)}catch(Ke){throw we("error loading",Ke),Ke}B&&(k._buffer=null)}return k}return(0,n.C6)(f,T),f._CreateVideoTexture=function(g,S,y,x,R,I,M,D,B){throw I===void 0&&(I=f.TRILINEAR_SAMPLINGMODE),B===void 0&&(B=l.Y.TEXTUREFORMAT_RGBA),(0,u.n)("VideoTexture")},Object.defineProperty(f.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"mimeType",{get:function(){return this._mimeType},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(g){this._isBlocking=g},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"invertY",{get:function(){return this._invertY},enumerable:!1,configurable:!0}),f.prototype.updateURL=function(g,S,y,x){var R=this;S===void 0&&(S=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(l.Y.MATERIAL_TextureDirtyFlag,function(I){return I.hasTexture(R)})),this.name&&!this.name.startsWith("data:")||(this.name=g),this.url=g,this._buffer=S,this._forcedExtension=x,this.delayLoadState=l.Y.DELAYLOADSTATE_NOTLOADED,y&&(this._delayedOnLoad=y),this.delayLoad()},f.prototype.delayLoad=function(){if(this.delayLoadState===l.Y.DELAYLOADSTATE_NOTLOADED){var g=this.getScene();g&&(this.delayLoadState=l.Y.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?d._.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=g.getEngine().createTexture(this.url,this._noMipmap,this._invertY,g,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}},f.prototype._prepareRowForTextureGeneration=function(g,S,y,x){g*=this._cachedUScale,S*=this._cachedVScale,g-=this.uRotationCenter*this._cachedUScale,S-=this.vRotationCenter*this._cachedVScale,y-=this.wRotationCenter,a.Pq.TransformCoordinatesFromFloatsToRef(g,S,y,this._rowGenerationMatrix,x),x.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,x.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,x.z+=this.wRotationCenter},f.prototype.getTextureMatrix=function(g){var S=this;if(g===void 0&&(g=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*g===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*g,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=a.uq.Zero(),this._rowGenerationMatrix=new a.uq,this._t0=a.Pq.Zero(),this._t1=a.Pq.Zero(),this._t2=a.Pq.Zero()),a.uq.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(a.uq.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,a.AA.Matrix[0]),a.uq.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,a.AA.Matrix[1]),a.uq.ScalingToRef(this._cachedUScale,this._cachedVScale,0,a.AA.Matrix[2]),a.uq.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,a.AA.Matrix[3]),a.AA.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.AA.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.AA.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(a.AA.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),a.uq.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));var y=this.getScene();if(!y)return this._cachedTextureMatrix;var x=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&x!==this._cachedIdentity3x2&&y.markAllMaterialsAsDirty(l.Y.MATERIAL_TextureDirtyFlag,function(R){return R.hasTexture(S)}),this._cachedTextureMatrix},f.prototype.getReflectionTextureMatrix=function(){var g=this,S=this.getScene();if(!S)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==f.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===S.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=a.uq.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=a.uq.Zero());var y=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case f.PLANAR_MODE:a.uq.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case f.PROJECTION_MODE:a.uq.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var x=S.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=x.updateFlag,x.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break;default:a.uq.IdentityToRef(this._cachedReflectionTextureMatrix)}return y&&S.markAllMaterialsAsDirty(l.Y.MATERIAL_TextureDirtyFlag,function(R){return R.hasTexture(g)}),this._cachedReflectionTextureMatrix},f.prototype.clone=function(){var g=this,S={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return E.p.Clone(function(){return new f(g._texture?g._texture.url:null,g.getScene(),S)},this)},f.prototype.serialize=function(){var g,S,y=this.name;f.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");var x=T.prototype.serialize.call(this,f._SerializeInternalTextureUniqueId);return x?((f.SerializeBuffers||f.ForceSerializeBuffers)&&(typeof this._buffer=="string"&&this._buffer.substring(0,5)==="data:"?(x.base64String=this._buffer,x.name=x.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?x.base64String="data:image/png;base64,"+(0,m.EL)(this._buffer):(f.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(x.base64String=!this._engine||this._engine._features.supportSyncTextureRead?(0,v.lP)(this):(0,v.nh)(this))),x.invertY=this._invertY,x.samplingMode=this.samplingMode,x._creationFlags=this._creationFlags,x._useSRGBBuffer=this._useSRGBBuffer,f._SerializeInternalTextureUniqueId&&(x.internalTextureUniqueId=(S=(g=this._texture)===null||g===void 0?void 0:g.uniqueId)!==null&&S!==void 0?S:void 0),x.noMipmap=this._noMipmap,this.name=y,x):null},f.prototype.getClassName=function(){return"Texture"},f.prototype.dispose=function(){T.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null},f.Parse=function(g,S,y){if(g.customType){var x=h.n.Instantiate(g.customType).Parse(g,S,y);return g.samplingMode&&x.updateSamplingMode&&x._samplingMode&&x._samplingMode!==g.samplingMode&&x.updateSamplingMode(g.samplingMode),x}if(g.isCube&&!g.isRenderTarget)return f._CubeTextureParser(g,S,y);var R,I=g.internalTextureUniqueId!==void 0;if(!g.name&&!g.isRenderTarget&&!I)return null;if(I)for(var M=0,D=S.getEngine().getLoadedTexturesCache();M<D.length;M++){var B=D[M];if(B.uniqueId===g.internalTextureUniqueId){R=B;break}}var F=function($){var Q;if($&&$._texture&&($._texture._cachedWrapU=null,$._texture._cachedWrapV=null,$._texture._cachedWrapR=null),g.samplingMode){var ie=g.samplingMode;$&&$.samplingMode!==ie&&$.updateSamplingMode(ie)}if($&&g.animations)for(var q=0;q<g.animations.length;q++){var ee=g.animations[q],te=(0,c.n9)("BABYLON.Animation");te&&$.animations.push(te.Parse(ee))}I&&!R&&((Q=$?._texture)===null||Q===void 0||Q._setUniqueId(g.internalTextureUniqueId))},X=E.p.Parse(function(){var $,Q,ie,q,ee=!0;if(g.noMipmap&&(ee=!1),g.mirrorPlane){var te=f._CreateMirror(g.name,g.renderTargetSize,S,ee);return te._waitingRenderList=g.renderList,te.mirrorPlane=p.Z.FromArray(g.mirrorPlane),F(te),te}if(g.isRenderTarget){var ce=null;if(g.isCube){if(S.reflectionProbes)for(var fe=0;fe<S.reflectionProbes.length;fe++){var de=S.reflectionProbes[fe];if(de.name===g.name)return de.cubeTexture}}else(ce=f._CreateRenderTargetTexture(g.name,g.renderTargetSize,S,ee,($=g._creationFlags)!==null&&$!==void 0?$:0))._waitingRenderList=g.renderList;return F(ce),ce}if(g.isVideo){var Te=f._CreateVideoTexture(y+(g.url||g.name),y+(g.src||g.url),S,ee,g.invertY,g.samplingMode,g.settings||{});return F(Te),Te}if(g.base64String&&!R)(q=f.CreateFromBase64String(g.base64String,g.base64String,S,!ee,g.invertY,g.samplingMode,function(){F(q)},(Q=g._creationFlags)!==null&&Q!==void 0?Q:0,(ie=g._useSRGBBuffer)!==null&&ie!==void 0&&ie)).name=g.name;else{var ue=void 0;ue=g.name&&(g.name.indexOf("://")>0||g.name.startsWith("data:"))?g.name:y+g.name,g.url&&(g.url.startsWith("data:")||f.UseSerializedUrlIfAny)&&(ue=g.url);var U={noMipmap:!ee,invertY:g.invertY,samplingMode:g.samplingMode,onLoad:function(){F(q)},internalTexture:R};q=new f(ue,S,U)}return q},g,S);return X},f.CreateFromBase64String=function(g,S,y,x,R,I,M,D,B,F,X){return I===void 0&&(I=f.TRILINEAR_SAMPLINGMODE),M===void 0&&(M=null),D===void 0&&(D=null),B===void 0&&(B=l.Y.TEXTUREFORMAT_RGBA),new f("data:"+S,y,x,R,I,M,D,g,!1,B,void 0,void 0,F,X)},f.LoadFromDataString=function(g,S,y,x,R,I,M,D,B,F,X,$){return x===void 0&&(x=!1),I===void 0&&(I=!0),M===void 0&&(M=f.TRILINEAR_SAMPLINGMODE),D===void 0&&(D=null),B===void 0&&(B=null),F===void 0&&(F=l.Y.TEXTUREFORMAT_RGBA),g.substring(0,5)!=="data:"&&(g="data:"+g),new f(g,y,R,I,M,D,B,S,x,F,void 0,void 0,X,$)},f.SerializeBuffers=!0,f.ForceSerializeBuffers=!1,f.OnTextureLoadErrorObservable=new o.cP,f._SerializeInternalTextureUniqueId=!1,f._CubeTextureParser=function(g,S,y){throw(0,u.n)("CubeTexture")},f._CreateMirror=function(g,S,y,x){throw(0,u.n)("MirrorTexture")},f._CreateRenderTargetTexture=function(g,S,y,x,R){throw(0,u.n)("RenderTargetTexture")},f.NEAREST_SAMPLINGMODE=l.Y.TEXTURE_NEAREST_SAMPLINGMODE,f.NEAREST_NEAREST_MIPLINEAR=l.Y.TEXTURE_NEAREST_NEAREST_MIPLINEAR,f.BILINEAR_SAMPLINGMODE=l.Y.TEXTURE_BILINEAR_SAMPLINGMODE,f.LINEAR_LINEAR_MIPNEAREST=l.Y.TEXTURE_LINEAR_LINEAR_MIPNEAREST,f.TRILINEAR_SAMPLINGMODE=l.Y.TEXTURE_TRILINEAR_SAMPLINGMODE,f.LINEAR_LINEAR_MIPLINEAR=l.Y.TEXTURE_LINEAR_LINEAR_MIPLINEAR,f.NEAREST_NEAREST_MIPNEAREST=l.Y.TEXTURE_NEAREST_NEAREST_MIPNEAREST,f.NEAREST_LINEAR_MIPNEAREST=l.Y.TEXTURE_NEAREST_LINEAR_MIPNEAREST,f.NEAREST_LINEAR_MIPLINEAR=l.Y.TEXTURE_NEAREST_LINEAR_MIPLINEAR,f.NEAREST_LINEAR=l.Y.TEXTURE_NEAREST_LINEAR,f.NEAREST_NEAREST=l.Y.TEXTURE_NEAREST_NEAREST,f.LINEAR_NEAREST_MIPNEAREST=l.Y.TEXTURE_LINEAR_NEAREST_MIPNEAREST,f.LINEAR_NEAREST_MIPLINEAR=l.Y.TEXTURE_LINEAR_NEAREST_MIPLINEAR,f.LINEAR_LINEAR=l.Y.TEXTURE_LINEAR_LINEAR,f.LINEAR_NEAREST=l.Y.TEXTURE_LINEAR_NEAREST,f.EXPLICIT_MODE=l.Y.TEXTURE_EXPLICIT_MODE,f.SPHERICAL_MODE=l.Y.TEXTURE_SPHERICAL_MODE,f.PLANAR_MODE=l.Y.TEXTURE_PLANAR_MODE,f.CUBIC_MODE=l.Y.TEXTURE_CUBIC_MODE,f.PROJECTION_MODE=l.Y.TEXTURE_PROJECTION_MODE,f.SKYBOX_MODE=l.Y.TEXTURE_SKYBOX_MODE,f.INVCUBIC_MODE=l.Y.TEXTURE_INVCUBIC_MODE,f.EQUIRECTANGULAR_MODE=l.Y.TEXTURE_EQUIRECTANGULAR_MODE,f.FIXED_EQUIRECTANGULAR_MODE=l.Y.TEXTURE_FIXED_EQUIRECTANGULAR_MODE,f.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=l.Y.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE,f.CLAMP_ADDRESSMODE=l.Y.TEXTURE_CLAMP_ADDRESSMODE,f.WRAP_ADDRESSMODE=l.Y.TEXTURE_WRAP_ADDRESSMODE,f.MIRROR_ADDRESSMODE=l.Y.TEXTURE_MIRROR_ADDRESSMODE,f.UseSerializedUrlIfAny=!1,(0,n.Cg)([(0,i.lK)()],f.prototype,"url",void 0),(0,n.Cg)([(0,i.lK)()],f.prototype,"uOffset",void 0),(0,n.Cg)([(0,i.lK)()],f.prototype,"vOffset",void 0),(0,n.Cg)([(0,i.lK)()],f.prototype,"uScale",void 0),(0,n.Cg)([(0,i.lK)()],f.prototype,"vScale",void 0),(0,n.Cg)([(0,i.lK)()],f.prototype,"uAng",void 0),(0,n.Cg)([(0,i.lK)()],f.prototype,"vAng",void 0),(0,n.Cg)([(0,i.lK)()],f.prototype,"wAng",void 0),(0,n.Cg)([(0,i.lK)()],f.prototype,"uRotationCenter",void 0),(0,n.Cg)([(0,i.lK)()],f.prototype,"vRotationCenter",void 0),(0,n.Cg)([(0,i.lK)()],f.prototype,"wRotationCenter",void 0),(0,n.Cg)([(0,i.lK)()],f.prototype,"homogeneousRotationInUVTransform",void 0),(0,n.Cg)([(0,i.lK)()],f.prototype,"isBlocking",null),f}(s.t);(0,c.Y5)("BABYLON.Texture",C),E.p._TextureParser=C.Parse},55204:(r,t,e)=>{e.d(t,{u:()=>i});var n=e(81152),i=function(){function o(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}return Object.defineProperty(o.prototype,"wrapU",{get:function(){return this._cachedWrapU},set:function(a){this._cachedWrapU=a},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"wrapV",{get:function(){return this._cachedWrapV},set:function(a){this._cachedWrapV=a},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"wrapR",{get:function(){return this._cachedWrapR},set:function(a){this._cachedWrapR=a},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"anisotropicFilteringLevel",{get:function(){return this._cachedAnisotropicFilteringLevel},set:function(a){this._cachedAnisotropicFilteringLevel=a},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"comparisonFunction",{get:function(){return this._comparisonFunction},set:function(a){this._comparisonFunction=a},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"useMipMaps",{get:function(){return this._useMipMaps},set:function(a){this._useMipMaps=a},enumerable:!1,configurable:!0}),o.prototype.setParameters=function(a,s,l,c,u,d){return a===void 0&&(a=n.Y.TEXTURE_WRAP_ADDRESSMODE),s===void 0&&(s=n.Y.TEXTURE_WRAP_ADDRESSMODE),l===void 0&&(l=n.Y.TEXTURE_WRAP_ADDRESSMODE),c===void 0&&(c=1),u===void 0&&(u=n.Y.TEXTURE_BILINEAR_SAMPLINGMODE),d===void 0&&(d=0),this._cachedWrapU=a,this._cachedWrapV=s,this._cachedWrapR=l,this._cachedAnisotropicFilteringLevel=c,this.samplingMode=u,this._comparisonFunction=d,this},o.prototype.compareSampler=function(a){return this._cachedWrapU===a._cachedWrapU&&this._cachedWrapV===a._cachedWrapV&&this._cachedWrapR===a._cachedWrapR&&this._cachedAnisotropicFilteringLevel===a._cachedAnisotropicFilteringLevel&&this.samplingMode===a.samplingMode&&this._comparisonFunction===a._comparisonFunction&&this._useMipMaps===a._useMipMaps},o}()},63919:(r,t,e)=>{e.d(t,{D:()=>o});var n=e(81152),i=e(73152),o=function(){function a(s){this._wrapU=n.Y.TEXTURE_WRAP_ADDRESSMODE,this._wrapV=n.Y.TEXTURE_WRAP_ADDRESSMODE,this.wrapR=n.Y.TEXTURE_WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=4,this.delayLoadState=n.Y.DELAYLOADSTATE_NONE,this._texture=null,this._engine=null,this._cachedSize=i.o.Zero(),this._cachedBaseSize=i.o.Zero(),this._initialSamplingMode=n.Y.TEXTURE_BILINEAR_SAMPLINGMODE,this._texture=a._IsRenderTargetWrapper(s)?s.texture:s,this._texture&&(this._engine=this._texture.getEngine())}return Object.defineProperty(a.prototype,"wrapU",{get:function(){return this._wrapU},set:function(s){this._wrapU=s},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"wrapV",{get:function(){return this._wrapV},set:function(s){this._wrapV=s},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"coordinatesMode",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(s){this._texture&&(this._texture.isCube=s)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(s){this._texture&&(this._texture.is3D=s)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(s){this._texture&&(this._texture.is2DArray=s)},enumerable:!1,configurable:!0}),a.prototype.getClassName=function(){return"ThinTexture"},a._IsRenderTargetWrapper=function(s){return s?.shareDepth!==void 0},a.prototype.isReady=function(){return this.delayLoadState===n.Y.DELAYLOADSTATE_NOTLOADED?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},a.prototype.delayLoad=function(){},a.prototype.getInternalTexture=function(){return this._texture},a.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},a.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)},Object.defineProperty(a.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!1,configurable:!0}),a.prototype.updateSamplingMode=function(s){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(s,this._texture)},a.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},a.prototype.dispose=function(){this._texture&&(this.releaseInternalTexture(),this._engine=null)},a}()},34561:(r,t,e)=>{function n(l){l.indexOf("vClipPlane")===-1&&l.push("vClipPlane"),l.indexOf("vClipPlane2")===-1&&l.push("vClipPlane2"),l.indexOf("vClipPlane3")===-1&&l.push("vClipPlane3"),l.indexOf("vClipPlane4")===-1&&l.push("vClipPlane4"),l.indexOf("vClipPlane5")===-1&&l.push("vClipPlane5"),l.indexOf("vClipPlane6")===-1&&l.push("vClipPlane6")}function i(l,c,u){var d,h,p,m,v,b,E=!!((d=l.clipPlane)!==null&&d!==void 0?d:c.clipPlane),C=!!((h=l.clipPlane2)!==null&&h!==void 0?h:c.clipPlane2),T=!!((p=l.clipPlane3)!==null&&p!==void 0?p:c.clipPlane3),f=!!((m=l.clipPlane4)!==null&&m!==void 0?m:c.clipPlane4),g=!!((v=l.clipPlane5)!==null&&v!==void 0?v:c.clipPlane5),S=!!((b=l.clipPlane6)!==null&&b!==void 0?b:c.clipPlane6);E&&u.push("#define CLIPPLANE"),C&&u.push("#define CLIPPLANE2"),T&&u.push("#define CLIPPLANE3"),f&&u.push("#define CLIPPLANE4"),g&&u.push("#define CLIPPLANE5"),S&&u.push("#define CLIPPLANE6")}function o(l,c,u){var d,h,p,m,v,b,E=!1,C=!!((d=l.clipPlane)!==null&&d!==void 0?d:c.clipPlane),T=!!((h=l.clipPlane2)!==null&&h!==void 0?h:c.clipPlane2),f=!!((p=l.clipPlane3)!==null&&p!==void 0?p:c.clipPlane3),g=!!((m=l.clipPlane4)!==null&&m!==void 0?m:c.clipPlane4),S=!!((v=l.clipPlane5)!==null&&v!==void 0?v:c.clipPlane5),y=!!((b=l.clipPlane6)!==null&&b!==void 0?b:c.clipPlane6);return u.CLIPPLANE!==C&&(u.CLIPPLANE=C,E=!0),u.CLIPPLANE2!==T&&(u.CLIPPLANE2=T,E=!0),u.CLIPPLANE3!==f&&(u.CLIPPLANE3=f,E=!0),u.CLIPPLANE4!==g&&(u.CLIPPLANE4=g,E=!0),u.CLIPPLANE5!==S&&(u.CLIPPLANE5=S,E=!0),u.CLIPPLANE6!==y&&(u.CLIPPLANE6=y,E=!0),E}function a(l,c,u){var d,h,p,m,v,b,E=(d=c.clipPlane)!==null&&d!==void 0?d:u.clipPlane;s(l,"vClipPlane",E),s(l,"vClipPlane2",E=(h=c.clipPlane2)!==null&&h!==void 0?h:u.clipPlane2),s(l,"vClipPlane3",E=(p=c.clipPlane3)!==null&&p!==void 0?p:u.clipPlane3),s(l,"vClipPlane4",E=(m=c.clipPlane4)!==null&&m!==void 0?m:u.clipPlane4),s(l,"vClipPlane5",E=(v=c.clipPlane5)!==null&&v!==void 0?v:u.clipPlane5),s(l,"vClipPlane6",E=(b=c.clipPlane6)!==null&&b!==void 0?b:u.clipPlane6)}function s(l,c,u){u&&l.setFloat4(c,u.normal.x,u.normal.y,u.normal.z,u.d)}e.d(t,{Eq:()=>o,TV:()=>n,gS:()=>a,tv:()=>i})},10740:(r,t,e)=>{function n(i){i.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}e.d(t,{B:()=>n})},76331:(r,t,e)=>{e.d(t,{Q:()=>l});var n=e(78322),i=e(6174),o=e(64726),a=e(12028),s=e(10740),l=function(){function c(){this._dirty=!0,this._tempColor=new o.ov(0,0,0,0),this._globalCurve=new o.ov(0,0,0,0),this._highlightsCurve=new o.ov(0,0,0,0),this._midtonesCurve=new o.ov(0,0,0,0),this._shadowsCurve=new o.ov(0,0,0,0),this._positiveCurve=new o.ov(0,0,0,0),this._negativeCurve=new o.ov(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(c.prototype,"globalHue",{get:function(){return this._globalHue},set:function(u){this._globalHue=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(u){this._globalDensity=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(u){this._globalSaturation=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(u){this._globalExposure=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(u){this._highlightsHue=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(u){this._highlightsDensity=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(u){this._highlightsSaturation=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(u){this._highlightsExposure=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(u){this._midtonesHue=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(u){this._midtonesDensity=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(u){this._midtonesSaturation=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(u){this._midtonesExposure=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(u){this._shadowsHue=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(u){this._shadowsDensity=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(u){this._shadowsSaturation=u,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(u){this._shadowsExposure=u,this._dirty=!0},enumerable:!1,configurable:!0}),c.prototype.getClassName=function(){return"ColorCurves"},c.Bind=function(u,d,h,p,m){h===void 0&&(h="vCameraColorCurvePositive"),p===void 0&&(p="vCameraColorCurveNeutral"),m===void 0&&(m="vCameraColorCurveNegative"),u._dirty&&(u._dirty=!1,u._getColorGradingDataToRef(u._globalHue,u._globalDensity,u._globalSaturation,u._globalExposure,u._globalCurve),u._getColorGradingDataToRef(u._highlightsHue,u._highlightsDensity,u._highlightsSaturation,u._highlightsExposure,u._tempColor),u._tempColor.multiplyToRef(u._globalCurve,u._highlightsCurve),u._getColorGradingDataToRef(u._midtonesHue,u._midtonesDensity,u._midtonesSaturation,u._midtonesExposure,u._tempColor),u._tempColor.multiplyToRef(u._globalCurve,u._midtonesCurve),u._getColorGradingDataToRef(u._shadowsHue,u._shadowsDensity,u._shadowsSaturation,u._shadowsExposure,u._tempColor),u._tempColor.multiplyToRef(u._globalCurve,u._shadowsCurve),u._highlightsCurve.subtractToRef(u._midtonesCurve,u._positiveCurve),u._midtonesCurve.subtractToRef(u._shadowsCurve,u._negativeCurve)),d&&(d.setFloat4(h,u._positiveCurve.r,u._positiveCurve.g,u._positiveCurve.b,u._positiveCurve.a),d.setFloat4(p,u._midtonesCurve.r,u._midtonesCurve.g,u._midtonesCurve.b,u._midtonesCurve.a),d.setFloat4(m,u._negativeCurve.r,u._negativeCurve.g,u._negativeCurve.b,u._negativeCurve.a))},c.prototype._getColorGradingDataToRef=function(u,d,h,p,m){u!=null&&(u=c._Clamp(u,0,360),d=c._Clamp(d,-100,100),h=c._Clamp(h,-100,100),p=c._Clamp(p,-100,100),d=c._ApplyColorGradingSliderNonlinear(d),d*=.5,p=c._ApplyColorGradingSliderNonlinear(p),d<0&&(d*=-1,u=(u+180)%360),c._FromHSBToRef(u,d,50+.25*p,m),m.scaleToRef(2,m),m.a=1+.01*h)},c._ApplyColorGradingSliderNonlinear=function(u){u/=100;var d=Math.abs(u);return d=Math.pow(d,2),u<0&&(d*=-1),100*d},c._FromHSBToRef=function(u,d,h,p){var m=c._Clamp(u,0,360),v=c._Clamp(d/100,0,1),b=c._Clamp(h/100,0,1);if(v===0)p.r=b,p.g=b,p.b=b;else{m/=60;var E=Math.floor(m),C=m-E,T=b*(1-v),f=b*(1-v*C),g=b*(1-v*(1-C));switch(E){case 0:p.r=b,p.g=g,p.b=T;break;case 1:p.r=f,p.g=b,p.b=T;break;case 2:p.r=T,p.g=b,p.b=g;break;case 3:p.r=T,p.g=f,p.b=b;break;case 4:p.r=g,p.g=T,p.b=b;break;default:p.r=b,p.g=T,p.b=f}}p.a=1},c._Clamp=function(u,d,h){return Math.min(Math.max(u,d),h)},c.prototype.clone=function(){return a.p.Clone(function(){return new c},this)},c.prototype.serialize=function(){return a.p.Serialize(this)},c.Parse=function(u){return a.p.Parse(function(){return new c},u,null,null)},c.PrepareUniforms=s.B,(0,n.Cg)([(0,i.lK)()],c.prototype,"_globalHue",void 0),(0,n.Cg)([(0,i.lK)()],c.prototype,"_globalDensity",void 0),(0,n.Cg)([(0,i.lK)()],c.prototype,"_globalSaturation",void 0),(0,n.Cg)([(0,i.lK)()],c.prototype,"_globalExposure",void 0),(0,n.Cg)([(0,i.lK)()],c.prototype,"_highlightsHue",void 0),(0,n.Cg)([(0,i.lK)()],c.prototype,"_highlightsDensity",void 0),(0,n.Cg)([(0,i.lK)()],c.prototype,"_highlightsSaturation",void 0),(0,n.Cg)([(0,i.lK)()],c.prototype,"_highlightsExposure",void 0),(0,n.Cg)([(0,i.lK)()],c.prototype,"_midtonesHue",void 0),(0,n.Cg)([(0,i.lK)()],c.prototype,"_midtonesDensity",void 0),(0,n.Cg)([(0,i.lK)()],c.prototype,"_midtonesSaturation",void 0),(0,n.Cg)([(0,i.lK)()],c.prototype,"_midtonesExposure",void 0),c}();a.p._ColorCurvesParser=l.Parse},92118:(r,t,e)=>{function n(i){return i.getPipelineContext===void 0}e.d(t,{E:()=>n})},14777:(r,t,e)=>{e.d(t,{E:()=>n});var n=function(){function i(o,a){a===void 0&&(a=!0),this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=o.createDrawContext(),a&&(this.materialContext=o.createMaterialContext())}return i.GetEffect=function(o){return o.getPipelineContext===void 0?o.effect:o},i.prototype.setEffect=function(o,a,s){var l;s===void 0&&(s=!0),this.effect=o,a!==void 0&&(this.defines=a),s&&((l=this.drawContext)===null||l===void 0||l.reset())},i.prototype.dispose=function(){var o;(o=this.drawContext)===null||o===void 0||o.dispose()},i}()},76320:(r,t,e)=>{e.d(t,{b4:()=>c,bu:()=>d,mO:()=>u,uR:()=>p});var n=e(5153),i=e(53399),o=e(98519),a=e(7164),s=e(35930),l=e(24894);function c(m,v){return(0,i.N5)(v).cachedPipelines[m]}function u(m){var v=m._name,b=m.context;if(v&&b){var E=(0,i.N5)(b),C=E.cachedPipelines[v];C?.dispose(),delete E.cachedPipelines[v]}}function d(m,v,b,E,C,T,f){var g,S,y=(0,n.BA)()?T?.getHostDocument():null;g=typeof v=="string"?v:v.vertexSource?"source:"+v.vertexSource:v.vertexElement?y?.getElementById(v.vertexElement)||v.vertexElement:v.vertex||v,S=typeof v=="string"?v:v.fragmentSource?"source:"+v.fragmentSource:v.fragmentElement?y?.getElementById(v.fragmentElement)||v.fragmentElement:v.fragment||v;var x=[void 0,void 0],R=function(){if(x[0]&&x[1]){m.isFragment=!0;var I=x[0],M=x[1];(0,s.M0)(M,m,function(D,B){f&&(f._fragmentSourceCodeBeforeMigration=B),b&&(D=b("fragment",D));var F=(0,s.nO)(I,D,m);m=null;var X=function($,Q,ie,q){return ie?{vertexSourceCode:(q===1?"//":"")+"#define SHADER_NAME vertex:"+(ie.vertexElement||ie.vertex||ie.spectorName||ie)+`
`+$,fragmentSourceCode:(q===1?"//":"")+"#define SHADER_NAME fragment:"+(ie.fragmentElement||ie.fragment||ie.spectorName||ie)+`
`+Q}:{vertexSourceCode:$,fragmentSourceCode:Q}}(F.vertexCode,F.fragmentCode,v,C);E?.(X.vertexSourceCode,X.fragmentSourceCode)},T)}};h(g,"Vertex","",function(I){(0,s.pB)(m),(0,s.M0)(I,m,function(M,D){f&&(f._rawVertexSourceCode=I,f._vertexSourceCodeBeforeMigration=D),b&&(M=b("vertex",M)),x[0]=M,R()},T)},C),h(S,"Fragment","Pixel",function(I){f&&(f._rawFragmentSourceCode=I),x[1]=I,R()},C)}function h(m,v,b,E,C,T){if(typeof HTMLElement<"u"&&m instanceof HTMLElement)E((0,n.Zl)(m));else if(m.substring(0,7)!=="source:")if(m.substring(0,7)!=="base64:"){var f=o.l.GetShadersStore(C);if(f[m+v+"Shader"])E(f[m+v+"Shader"]);else if(b&&f[m+b+"Shader"])E(f[m+b+"Shader"]);else{var g;if(g=m[0]==="."||m[0]==="/"||m.indexOf("http")>-1?m:o.l.GetShadersRepository(C)+m,!(T=T||l.W0))throw new Error("loadFileInjection is not defined");T(g+"."+v.toLowerCase()+".fx",E)}}else E(window.atob(m.substring(7)));else E(m.substring(7))}var p=function(m,v,b,E){try{var C=m.existingPipelineContext||v(m.shaderProcessingContext);return C._name=m.name,m.name&&m.context&&((0,i.N5)(m.context).cachedPipelines[m.name]=C),b(C,m.vertex,m.fragment,!!m.createAsRaw,"","",m.rebuildRebind,m.defines,m.transformFeedbackVaryings,"",function(){E(C,function(){var T;(T=m.onRenderingStateCompiled)===null||T===void 0||T.call(m,C)})}),C}catch(T){throw a.V.Error("Error compiling effect"),T}}},74239:(r,t,e)=>{e.d(t,{M:()=>c});var n=e(78322),i=e(66377),o=e(81152),a=e(7164),s=e(98519),l=e(76320),c=function(){function u(d,h,p,m,v,b,E,C,T,f,g,S,y){var x,R,I,M;m===void 0&&(m=null),b===void 0&&(b=null),E===void 0&&(E=null),C===void 0&&(C=null),T===void 0&&(T=null),g===void 0&&(g=""),S===void 0&&(S=0),this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new i.cP,this.onErrorObservable=new i.cP,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=d,this._key=g;var D=this._key.replace(/\r/g,"").replace(/\n/g,"|"),B=void 0;if(h.attributes){var F=h;if(this._engine=p,this._attributesNames=F.attributes,this._uniformsNames=F.uniformsNames.concat(F.samplers),this._samplerList=F.samplers.slice(),this.defines=F.defines,this.onError=F.onError,this.onCompiled=F.onCompiled,this._fallbacks=F.fallbacks,this._indexParameters=F.indexParameters,this._transformFeedbackVaryings=F.transformFeedbackVaryings||null,this._multiTarget=!!F.multiTarget,this._shaderLanguage=(x=F.shaderLanguage)!==null&&x!==void 0?x:0,F.uniformBuffersNames){this._uniformBuffersNamesList=F.uniformBuffersNames.slice();for(var X=0;X<F.uniformBuffersNames.length;X++)this._uniformBuffersNames[F.uniformBuffersNames[X]]=X}this._processFinalCode=(R=F.processFinalCode)!==null&&R!==void 0?R:null,this._processCodeAfterIncludes=(I=F.processCodeAfterIncludes)!==null&&I!==void 0?I:void 0,B=F.existingPipelineContext}else this._engine=v,this.defines=b??"",this._uniformsNames=p.concat(m),this._samplerList=m?m.slice():[],this._attributesNames=h,this._uniformBuffersNamesList=[],this._shaderLanguage=S,this.onError=T,this.onCompiled=C,this._indexParameters=f,this._fallbacks=E;this._engine.shaderPlatformName==="WEBGL2"&&(B=(M=(0,l.b4)(D,this._engine._gl))!==null&&M!==void 0?M:B),this._attributeLocationByName={},this.uniqueId=u._UniqueIdSeed++,B?(this._pipelineContext=B,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,y)}return Object.defineProperty(u,"ShadersRepository",{get:function(){return s.l.ShadersRepository},set:function(d){s.l.ShadersRepository=d},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new i.cP),this._onBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"shaderLanguage",{get:function(){return this._shaderLanguage},enumerable:!1,configurable:!0}),u.prototype._processShaderCodeAsync=function(d,h,p,m){return d===void 0&&(d=null),h===void 0&&(h=!1),p===void 0&&(p=null),(0,n.sH)(this,void 0,void 0,function(){var v,b=this;return(0,n.YH)(this,function(E){switch(E.label){case 0:return m?[4,m()]:[3,2];case 1:E.sent(),E.label=2;case 2:return this._processingContext=p||this._engine._getShaderProcessingContext(this._shaderLanguage,!1),v={defines:this.defines.split(`
`),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:d??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:s.l.GetShadersRepository(this._shaderLanguage),includesShadersStore:s.l.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes},(0,l.bu)(v,this.name,this._processFinalCode,function(C,T){b._vertexSourceCode=C,b._fragmentSourceCode=T,b._prepareEffect(h)},this._shaderLanguage,this._engine,this),[2]}})})},Object.defineProperty(u.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),u.prototype.isReady=function(){try{return this._isReadyInternal()}catch{return!1}},u.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},u.prototype.getEngine=function(){return this._engine},u.prototype.getPipelineContext=function(){return this._pipelineContext},u.prototype.getAttributesNames=function(){return this._attributesNames},u.prototype.getAttributeLocation=function(d){return this._attributes[d]},u.prototype.getAttributeLocationByName=function(d){return this._attributeLocationByName[d]},u.prototype.getAttributesCount=function(){return this._attributes.length},u.prototype.getUniformIndex=function(d){return this._uniformsNames.indexOf(d)},u.prototype.getUniform=function(d){return this._uniforms[d]},u.prototype.getSamplers=function(){return this._samplerList},u.prototype.getUniformNames=function(){return this._uniformsNames},u.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},u.prototype.getIndexParameters=function(){return this._indexParameters},u.prototype.getCompilationError=function(){return this._compilationError},u.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},u.prototype.executeWhenCompiled=function(d){var h=this;this.isReady()?d(this):(this.onCompileObservable.add(function(p){d(p)}),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout(function(){h._checkIsReady(null)},16))},u.prototype._checkIsReady=function(d){var h=this;try{if(this._isReadyInternal())return}catch(p){return void this._processCompilationErrors(p,d)}this._isDisposed||setTimeout(function(){h._checkIsReady(d)},16)},Object.defineProperty(u.prototype,"vertexSourceCode",{get:function(){var d,h;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(h=(d=this._pipelineContext)===null||d===void 0?void 0:d._getVertexShaderCode())!==null&&h!==void 0?h:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"fragmentSourceCode",{get:function(){var d,h;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(h=(d=this._pipelineContext)===null||d===void 0?void 0:d._getFragmentShaderCode())!==null&&h!==void 0?h:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"vertexSourceCodeBeforeMigration",{get:function(){return this._vertexSourceCodeBeforeMigration},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"fragmentSourceCodeBeforeMigration",{get:function(){return this._fragmentSourceCodeBeforeMigration},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),u.prototype.getPipelineGenerationOptions=function(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split(`
`),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}},u.prototype._rebuildProgram=function(d,h,p,m){var v=this;this._isReady=!1,this._vertexSourceCodeOverride=d,this._fragmentSourceCodeOverride=h,this.onError=function(b,E){m&&m(E)},this.onCompiled=function(){var b,E,C=v.getEngine().scenes;if(C)for(var T=0;T<C.length;T++)C[T].markAllMaterialsAsDirty(o.Y.MATERIAL_AllDirtyFlag);(E=(b=v._pipelineContext)._handlesSpectorRebuildCallback)===null||E===void 0||E.call(b,p)},this._fallbacks=null,this._prepareEffect()},u.prototype._onRenderingStateCompiled=function(d){if(this._pipelineContext=d,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(var h=0;h<this._attributesNames.length;h++){var p=this._attributesNames[h];this._attributeLocationByName[p]=this._attributes[h]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh()},u.prototype._prepareEffect=function(d){var h=this;d===void 0&&(d=!1);var p=this._pipelineContext;this._isReady=!1;try{var m=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),v=m?null:this.defines,b=m?this._vertexSourceCodeOverride:this._vertexSourceCode,E=m?this._fragmentSourceCodeOverride:this._fragmentSourceCode,C=this._engine;this._pipelineContext=(0,l.uR)({existingPipelineContext:d?p:null,vertex:b,fragment:E,context:C.shaderPlatformName==="WEBGL2"?C._gl:void 0,rebuildRebind:function(T,f,g,S){return h._rebuildProgram(T,f,g,S)},defines:v,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:m,parallelShaderCompile:C._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:function(T){p&&!d&&h._engine._deletePipelineContext(p),T&&h._onRenderingStateCompiled(T)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(p)}catch(T){this._processCompilationErrors(T,p)}},u.prototype._getShaderCodeAndErrorLine=function(d,h,p){var m=p?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,v=null;if(h&&d){var b=h.match(m);if(b&&b.length===2){var E=parseInt(b[1]),C=d.split(`
`,-1);C.length>=E&&(v="Offending line [".concat(E,"] in ").concat(p?"fragment":"vertex"," code: ").concat(C[E-1]))}}return[d,v]},u.prototype._processCompilationErrors=function(d,h){var p,m,v,b,E,C=this;h===void 0&&(h=null),this._compilationError=d.message;var T=this._attributesNames,f=this._fallbacks;if(a.V.Error("Unable to compile effect:"),a.V.Error("Uniforms: "+this._uniformsNames.map(function(R){return" "+R})),a.V.Error("Attributes: "+T.map(function(R){return" "+R})),a.V.Error(`Defines:
`+this.defines),u.LogShaderCodeOnCompilationError){var g=null,S=null,y=null;!((v=this._pipelineContext)===null||v===void 0)&&v._getVertexShaderCode()&&(y=(p=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1))[0],g=p[1],y&&(a.V.Error("Vertex code:"),a.V.Error(y))),!((b=this._pipelineContext)===null||b===void 0)&&b._getFragmentShaderCode()&&(y=(m=this._getShaderCodeAndErrorLine((E=this._pipelineContext)===null||E===void 0?void 0:E._getFragmentShaderCode(),this._compilationError,!0))[0],S=m[1],y&&(a.V.Error("Fragment code:"),a.V.Error(y))),g&&a.V.Error(g),S&&a.V.Error(S)}a.V.Error("Error: "+this._compilationError);var x=function(){C.onError&&C.onError(C,C._compilationError),C.onErrorObservable.notifyObservers(C)};h&&(this._pipelineContext=h,this._isReady=!0,x()),f?(this._pipelineContext=null,f.hasMoreFallbacks?(this._allFallbacksProcessed=!1,a.V.Error("Trying next fallback."),this.defines=f.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,x(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,h||x())},Object.defineProperty(u.prototype,"isSupported",{get:function(){return this._compilationError===""},enumerable:!1,configurable:!0}),u.prototype._bindTexture=function(d,h){this._engine._bindTexture(this._samplers[d],h,d)},u.prototype.setTexture=function(d,h){this._engine.setTexture(this._samplers[d],this._uniforms[d],h,d)},u.prototype.setTextureArray=function(d,h){var p=d+"Ex";if(this._samplerList.indexOf(p+"0")===-1){for(var m=this._samplerList.indexOf(d),v=1;v<h.length;v++){var b=p+(v-1).toString();this._samplerList.splice(m+v,0,b)}for(var E=0,C=0,T=this._samplerList;C<T.length;C++){var f=T[C];this._samplers[f]=E,E+=1}}this._engine.setTextureArray(this._samplers[d],this._uniforms[d],h,d)},u.prototype.bindUniformBuffer=function(d,h){var p=this._uniformBuffersNames[h];p===void 0||u._BaseCache[p]===d&&this._engine._features.useUBOBindingCache||(u._BaseCache[p]=d,this._engine.bindUniformBufferBase(d,p,h))},u.prototype.bindUniformBlock=function(d,h){this._engine.bindUniformBlock(this._pipelineContext,d,h)},u.prototype.setInt=function(d,h){return this._pipelineContext.setInt(d,h),this},u.prototype.setInt2=function(d,h,p){return this._pipelineContext.setInt2(d,h,p),this},u.prototype.setInt3=function(d,h,p,m){return this._pipelineContext.setInt3(d,h,p,m),this},u.prototype.setInt4=function(d,h,p,m,v){return this._pipelineContext.setInt4(d,h,p,m,v),this},u.prototype.setIntArray=function(d,h){return this._pipelineContext.setIntArray(d,h),this},u.prototype.setIntArray2=function(d,h){return this._pipelineContext.setIntArray2(d,h),this},u.prototype.setIntArray3=function(d,h){return this._pipelineContext.setIntArray3(d,h),this},u.prototype.setIntArray4=function(d,h){return this._pipelineContext.setIntArray4(d,h),this},u.prototype.setUInt=function(d,h){return this._pipelineContext.setUInt(d,h),this},u.prototype.setUInt2=function(d,h,p){return this._pipelineContext.setUInt2(d,h,p),this},u.prototype.setUInt3=function(d,h,p,m){return this._pipelineContext.setUInt3(d,h,p,m),this},u.prototype.setUInt4=function(d,h,p,m,v){return this._pipelineContext.setUInt4(d,h,p,m,v),this},u.prototype.setUIntArray=function(d,h){return this._pipelineContext.setUIntArray(d,h),this},u.prototype.setUIntArray2=function(d,h){return this._pipelineContext.setUIntArray2(d,h),this},u.prototype.setUIntArray3=function(d,h){return this._pipelineContext.setUIntArray3(d,h),this},u.prototype.setUIntArray4=function(d,h){return this._pipelineContext.setUIntArray4(d,h),this},u.prototype.setFloatArray=function(d,h){return this._pipelineContext.setArray(d,h),this},u.prototype.setFloatArray2=function(d,h){return this._pipelineContext.setArray2(d,h),this},u.prototype.setFloatArray3=function(d,h){return this._pipelineContext.setArray3(d,h),this},u.prototype.setFloatArray4=function(d,h){return this._pipelineContext.setArray4(d,h),this},u.prototype.setArray=function(d,h){return this._pipelineContext.setArray(d,h),this},u.prototype.setArray2=function(d,h){return this._pipelineContext.setArray2(d,h),this},u.prototype.setArray3=function(d,h){return this._pipelineContext.setArray3(d,h),this},u.prototype.setArray4=function(d,h){return this._pipelineContext.setArray4(d,h),this},u.prototype.setMatrices=function(d,h){return this._pipelineContext.setMatrices(d,h),this},u.prototype.setMatrix=function(d,h){return this._pipelineContext.setMatrix(d,h),this},u.prototype.setMatrix3x3=function(d,h){return this._pipelineContext.setMatrix3x3(d,h),this},u.prototype.setMatrix2x2=function(d,h){return this._pipelineContext.setMatrix2x2(d,h),this},u.prototype.setFloat=function(d,h){return this._pipelineContext.setFloat(d,h),this},u.prototype.setBool=function(d,h){return this._pipelineContext.setInt(d,h?1:0),this},u.prototype.setVector2=function(d,h){return this._pipelineContext.setVector2(d,h),this},u.prototype.setFloat2=function(d,h,p){return this._pipelineContext.setFloat2(d,h,p),this},u.prototype.setVector3=function(d,h){return this._pipelineContext.setVector3(d,h),this},u.prototype.setFloat3=function(d,h,p,m){return this._pipelineContext.setFloat3(d,h,p,m),this},u.prototype.setVector4=function(d,h){return this._pipelineContext.setVector4(d,h),this},u.prototype.setQuaternion=function(d,h){return this._pipelineContext.setQuaternion(d,h),this},u.prototype.setFloat4=function(d,h,p,m,v){return this._pipelineContext.setFloat4(d,h,p,m,v),this},u.prototype.setColor3=function(d,h){return this._pipelineContext.setColor3(d,h),this},u.prototype.setColor4=function(d,h,p){return this._pipelineContext.setColor4(d,h,p),this},u.prototype.setDirectColor4=function(d,h){return this._pipelineContext.setDirectColor4(d,h),this},u.prototype.dispose=function(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,l.mO)(this._pipelineContext),this._engine._releaseEffect(this),this._isDisposed=!0)},u.RegisterShader=function(d,h,p,m){m===void 0&&(m=0),h&&(s.l.GetShadersStore(m)["".concat(d,"PixelShader")]=h),p&&(s.l.GetShadersStore(m)["".concat(d,"VertexShader")]=p)},u.ResetCache=function(){u._BaseCache={}},u.LogShaderCodeOnCompilationError=!0,u._UniqueIdSeed=0,u._BaseCache={},u.ShadersStore=s.l.ShadersStore,u.IncludesShadersStore=s.l.IncludesShadersStore,u}()},93540:(r,t,e)=>{e.d(t,{$:()=>d,J:()=>u});var n=e(62623),i=e(25187),o=e(81152),a=e(66377),s=e(74239),l=e(14777),c=(e(96795),{positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]}),u=function(){function h(p,m){var v;m===void 0&&(m=c);var b,E,C=this;this._fullscreenViewport=new i.L(0,0,1,1);var T=(b=m.positions)!==null&&b!==void 0?b:c.positions,f=(E=m.indices)!==null&&E!==void 0?E:c.indices;this.engine=p,this._vertexBuffers=((v={})[n.R.PositionKind]=new n.R(p,T,n.R.PositionKind,!1,!1,2),v),this._indexBuffer=p.createIndexBuffer(f),this._onContextRestoredObserver=p.onContextRestoredObservable.add(function(){for(var g in C._indexBuffer=p.createIndexBuffer(f),C._vertexBuffers)C._vertexBuffers[g]._rebuild()})}return h.prototype.setViewport=function(p){p===void 0&&(p=this._fullscreenViewport),this.engine.setViewport(p)},h.prototype.bindBuffers=function(p){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,p)},h.prototype.applyEffectWrapper=function(p){this.engine.setState(!0),this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(p._drawWrapper),this.bindBuffers(p.effect),p.onApplyObservable.notifyObservers({})},h.prototype.saveStates=function(){this._savedStateDepthTest=this.engine.depthCullingState.depthTest,this._savedStateStencilTest=this.engine.stencilState.stencilTest},h.prototype.restoreStates=function(){this.engine.depthCullingState.depthTest=this._savedStateDepthTest,this.engine.stencilState.stencilTest=this._savedStateStencilTest},h.prototype.draw=function(){this.engine.drawElementsType(o.Y.MATERIAL_TriangleFillMode,0,6)},h.prototype._isRenderTargetTexture=function(p){return p.renderTarget!==void 0},h.prototype.render=function(p,m){if(m===void 0&&(m=null),p.effect.isReady()){this.saveStates(),this.setViewport();var v=m===null?null:this._isRenderTargetTexture(m)?m.renderTarget:m;v&&this.engine.bindFramebuffer(v),this.applyEffectWrapper(p),this.draw(),v&&this.engine.unBindFramebuffer(v),this.restoreStates()}},h.prototype.dispose=function(){var p=this._vertexBuffers[n.R.PositionKind];p&&(p.dispose(),delete this._vertexBuffers[n.R.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.engine.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)},h}(),d=function(){function h(p){var m,v=this;this.onApplyObservable=new a.cP;var b=p.uniformNames||[];p.vertexShader?m={fragmentSource:p.fragmentShader,vertexSource:p.vertexShader,spectorName:p.name||"effectWrapper"}:(b.push("scale"),m={fragmentSource:p.fragmentShader,vertex:"postprocess",spectorName:p.name||"effectWrapper"},this.onApplyObservable.add(function(){v.effect.setFloat2("scale",1,1)}));var E=p.defines?p.defines.join(`
`):"";this._drawWrapper=new l.E(p.engine),p.useShaderStore?(m.fragment=m.fragmentSource,m.vertex||(m.vertex=m.vertexSource),delete m.fragmentSource,delete m.vertexSource,this.effect=p.engine.createEffect(m,p.attributeNames||["position"],b,p.samplerNames,E,void 0,p.onCompiled,void 0,void 0,p.shaderLanguage,p.extraInitializationsAsync)):(this.effect=new s.M(m,p.attributeNames||["position"],b,p.samplerNames,p.engine,E,void 0,p.onCompiled,void 0,void 0,void 0,p.shaderLanguage,p.extraInitializationsAsync),this._onContextRestoredObserver=p.engine.onContextRestoredObservable.add(function(){v.effect._pipelineContext=null,v.effect._prepareEffect()}))}return Object.defineProperty(h.prototype,"effect",{get:function(){return this._drawWrapper.effect},set:function(p){this._drawWrapper.effect=p},enumerable:!1,configurable:!0}),h.prototype.dispose=function(p){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.effect.dispose()},h}()},27181:(r,t,e)=>{e.d(t,{C:()=>o,_:()=>i});var n=e(10740);function i(a,s){s.EXPOSURE&&a.push("exposureLinear"),s.CONTRAST&&a.push("contrast"),s.COLORGRADING&&a.push("colorTransformSettings"),(s.VIGNETTE||s.DITHER)&&a.push("vInverseScreenSize"),s.VIGNETTE&&(a.push("vignetteSettings1"),a.push("vignetteSettings2")),s.COLORCURVES&&(0,n.B)(a),s.DITHER&&a.push("ditherIntensity")}function o(a,s){s.COLORGRADING&&a.push("txColorTransform")}},81914:(r,t,e)=>{e.d(t,{p:()=>h});var n=e(78322),i=e(6174),o=e(66377),a=e(64726),s=e(76331),l=e(87074),c=e(12028),u=e(27181),d=e(34623),h=function(){function p(){this.colorCurves=new s.Q,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=p.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new a.ov(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=p.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new o.cP}return Object.defineProperty(p.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(m){this._colorCurvesEnabled!==m&&(this._colorCurvesEnabled=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(m){this._colorGradingTexture!==m&&(this._colorGradingTexture=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(m){this._colorGradingEnabled!==m&&(this._colorGradingEnabled=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(m){this._colorGradingWithGreenDepth!==m&&(this._colorGradingWithGreenDepth=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(m){this._colorGradingBGR!==m&&(this._colorGradingBGR=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"exposure",{get:function(){return this._exposure},set:function(m){this._exposure!==m&&(this._exposure=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(m){this._toneMappingEnabled!==m&&(this._toneMappingEnabled=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(m){this._toneMappingType!==m&&(this._toneMappingType=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"contrast",{get:function(){return this._contrast},set:function(m){this._contrast!==m&&(this._contrast=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"vignetteCentreY",{get:function(){return this.vignetteCenterY},set:function(m){this.vignetteCenterY=m},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"vignetteCentreX",{get:function(){return this.vignetteCenterX},set:function(m){this.vignetteCenterX=m},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(m){this._vignetteBlendMode!==m&&(this._vignetteBlendMode=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(m){this._vignetteEnabled!==m&&(this._vignetteEnabled=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"ditheringEnabled",{get:function(){return this._ditheringEnabled},set:function(m){this._ditheringEnabled!==m&&(this._ditheringEnabled=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"ditheringIntensity",{get:function(){return this._ditheringIntensity},set:function(m){this._ditheringIntensity!==m&&(this._ditheringIntensity=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"skipFinalColorClamp",{get:function(){return this._skipFinalColorClamp},set:function(m){this._skipFinalColorClamp!==m&&(this._skipFinalColorClamp=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(m){this._applyByPostProcess!==m&&(this._applyByPostProcess=m,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(m){this._isEnabled!==m&&(this._isEnabled=m,this._updateParameters())},enumerable:!1,configurable:!0}),p.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},p.prototype.getClassName=function(){return"ImageProcessingConfiguration"},p.prototype.prepareDefines=function(m,v){if(v===void 0&&(v=!1),v!==this.applyByPostProcess||!this._isEnabled)return m.VIGNETTE=!1,m.TONEMAPPING=0,m.CONTRAST=!1,m.EXPOSURE=!1,m.COLORCURVES=!1,m.COLORGRADING=!1,m.COLORGRADING3D=!1,m.DITHER=!1,m.IMAGEPROCESSING=!1,m.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(m.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(m.VIGNETTE=this.vignetteEnabled,m.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===p._VIGNETTEMODE_MULTIPLY,m.VIGNETTEBLENDMODEOPAQUE=!m.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case p.TONEMAPPING_KHR_PBR_NEUTRAL:m.TONEMAPPING=3;break;case p.TONEMAPPING_ACES:m.TONEMAPPING=2;break;default:m.TONEMAPPING=1}else m.TONEMAPPING=0;m.CONTRAST=this.contrast!==1,m.EXPOSURE=this.exposure!==1,m.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,m.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,m.COLORGRADING?m.COLORGRADING3D=this.colorGradingTexture.is3D:m.COLORGRADING3D=!1,m.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,m.SAMPLER3DBGRMAP=this.colorGradingBGR,m.DITHER=this._ditheringEnabled,m.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,m.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,m.IMAGEPROCESSING=m.VIGNETTE||!!m.TONEMAPPING||m.CONTRAST||m.EXPOSURE||m.COLORCURVES||m.COLORGRADING||m.DITHER},p.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},p.prototype.bind=function(m,v){if(this._colorCurvesEnabled&&this.colorCurves&&s.Q.Bind(this.colorCurves,m),this._vignetteEnabled||this._ditheringEnabled){var b=1/m.getEngine().getRenderWidth(),E=1/m.getEngine().getRenderHeight();if(m.setFloat2("vInverseScreenSize",b,E),this._ditheringEnabled&&m.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){var C=v??E/b,T=Math.tan(.5*this.vignetteCameraFov),f=T*C,g=Math.sqrt(f*T);f=(0,l.zF)(f,g,this.vignetteStretch),T=(0,l.zF)(T,g,this.vignetteStretch),m.setFloat4("vignetteSettings1",f,T,-f*this.vignetteCenterX,-T*this.vignetteCenterY);var S=-2*this.vignetteWeight;m.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,S)}}if(m.setFloat("exposureLinear",this.exposure),m.setFloat("contrast",this.contrast),this.colorGradingTexture){m.setTexture("txColorTransform",this.colorGradingTexture);var y=this.colorGradingTexture.getSize().height;m.setFloat4("colorTransformSettings",(y-1)/y,.5/y,y,this.colorGradingTexture.level)}},p.prototype.clone=function(){return c.p.Clone(function(){return new p},this)},p.prototype.serialize=function(){return c.p.Serialize(this)},p.Parse=function(m){var v=c.p.Parse(function(){return new p},m,null,null);return m.vignetteCentreX!==void 0&&(v.vignetteCenterX=m.vignetteCentreX),m.vignetteCentreY!==void 0&&(v.vignetteCenterY=m.vignetteCentreY),v},Object.defineProperty(p,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(p,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),p.TONEMAPPING_STANDARD=0,p.TONEMAPPING_ACES=1,p.TONEMAPPING_KHR_PBR_NEUTRAL=2,p.PrepareUniforms=u._,p.PrepareSamplers=u.C,p._VIGNETTEMODE_MULTIPLY=0,p._VIGNETTEMODE_OPAQUE=1,(0,n.Cg)([(0,i.wL)()],p.prototype,"colorCurves",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_colorCurvesEnabled",void 0),(0,n.Cg)([(0,i.uM)("colorGradingTexture")],p.prototype,"_colorGradingTexture",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_colorGradingEnabled",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_colorGradingWithGreenDepth",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_colorGradingBGR",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_exposure",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_toneMappingEnabled",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_toneMappingType",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_contrast",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"vignetteStretch",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"vignetteCenterX",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"vignetteCenterY",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"vignetteWeight",void 0),(0,n.Cg)([(0,i.qK)()],p.prototype,"vignetteColor",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"vignetteCameraFov",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_vignetteBlendMode",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_vignetteEnabled",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_ditheringEnabled",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_ditheringIntensity",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_skipFinalColorClamp",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_applyByPostProcess",void 0),(0,n.Cg)([(0,i.lK)()],p.prototype,"_isEnabled",void 0),p}();c.p._ImageProcessingConfigurationParser=h.Parse,(0,d.Y5)("BABYLON.ImageProcessingConfiguration",h)},85096:(r,t,e)=>{e.d(t,{Bb:()=>ue,DL:()=>d,ER:()=>I,GD:()=>Te,IC:()=>Q,IF:()=>m,J2:()=>f,Jz:()=>ie,Kd:()=>y,L0:()=>S,MF:()=>p,N4:()=>fe,Nc:()=>ce,OR:()=>$,RL:()=>x,VO:()=>te,Y7:()=>de,YT:()=>C,Yy:()=>h,_8:()=>E,az:()=>F,c4:()=>M,f$:()=>g,fm:()=>B,lo:()=>X,mA:()=>T,nR:()=>b,ni:()=>R,qB:()=>ee,qL:()=>D,te:()=>v,wu:()=>q});var n=e(7164),i=e(81152),o=e(64726),a=e(66614),s=e(91946),l=e(34561),c=o.v9.Black(),u={NUM_MORPH_INFLUENCERS:0};function d(U,N,w){if(!U||U.LOGARITHMICDEPTH||U.indexOf&&U.indexOf("LOGARITHMICDEPTH")>=0){var k=w.activeCamera;k.mode===i.Y.ORTHOGRAPHIC_CAMERA&&n.V.Error("Logarithmic depth is not compatible with orthographic cameras!",20),N.setFloat("logarithmicDepthConstant",2/(Math.log(k.maxZ+1)/Math.LN2))}}function h(U,N,w,k){k===void 0&&(k=!1),w&&U.fogEnabled&&(!N||N.applyFog)&&U.fogMode!==i.Y.FOGMODE_NONE&&(w.setFloat4("vFogInfos",U.fogMode,U.fogStart,U.fogEnd,U.fogDensity),k?(U.fogColor.toLinearSpaceToRef(c,U.getEngine().useExactSrgbConversions),w.setColor3("vFogColor",c)):w.setColor3("vFogColor",U.fogColor))}function p(U,N,w){u.NUM_MORPH_INFLUENCERS=w,m(U,N,u)}function m(U,N,w){var k=w.NUM_MORPH_INFLUENCERS;if(k>0&&a.q.LastCreatedEngine){var J=a.q.LastCreatedEngine.getCaps().maxVertexAttribs,le=N.morphTargetManager;if(le?.isUsingTextureForTargets)return;for(var be=le&&le.supportsNormals&&w.NORMAL,ve=le&&le.supportsTangents&&w.TANGENT,ye=le&&le.supportsUVs&&w.UV1,Me=0;Me<k;Me++)U.push(i.Y.PositionKind+Me),be&&U.push(i.Y.NormalKind+Me),ve&&U.push(i.Y.TangentKind+Me),ye&&U.push(i.Y.UVKind+"_"+Me),U.length>J&&n.V.Error("Cannot add more vertex attributes for mesh "+N.name)}}function v(U,N){N===void 0&&(N=!1),U.push("world0"),U.push("world1"),U.push("world2"),U.push("world3"),N&&(U.push("previousWorld0"),U.push("previousWorld1"),U.push("previousWorld2"),U.push("previousWorld3"))}function b(U,N){var w=U.morphTargetManager;U&&w&&N.setFloatArray("morphTargetInfluences",w.influences)}function E(U,N){N.bindToEffect(U,"Scene")}function C(U,N,w){N._needUVs=!0,N[w]=!0,U.optimizeUVAllocation&&U.getTextureMatrix().isIdentityAs3x2()?(N[w+"DIRECTUV"]=U.coordinatesIndex+1,N["MAINUV"+(U.coordinatesIndex+1)]=!0):N[w+"DIRECTUV"]=0}function T(U,N,w){var k=U.getTextureMatrix();N.updateMatrix(w+"Matrix",k)}function f(U,N,w){w.BAKED_VERTEX_ANIMATION_TEXTURE&&w.INSTANCES&&U.push("bakedVertexAnimationSettingsInstanced")}function g(U,N,w){var k;if(N&&U&&(U.computeBonesUsingShaders&&N._bonesComputationForcedToCPU&&(U.computeBonesUsingShaders=!1),U.useBones&&U.computeBonesUsingShaders&&U.skeleton)){var J=U.skeleton;if(J.isUsingTextureForMatrices&&N.getUniformIndex("boneTextureWidth")>-1){var le=J.getTransformMatrixTexture(U);N.setTexture("boneSampler",le),N.setFloat("boneTextureWidth",4*(J.bones.length+1))}else{var be=J.getTransformMatrices(U);be&&(N.setMatrices("mBones",be),w&&U.getScene().prePassRenderer&&U.getScene().prePassRenderer.getIndex(i.Y.PREPASS_VELOCITY_TEXTURE_TYPE)&&(w.previousBones[U.uniqueId]||(w.previousBones[U.uniqueId]=be.slice()),N.setMatrices("mPreviousBones",w.previousBones[U.uniqueId]),k=be,w.previousBones[U.uniqueId].set(k)))}}}function S(U,N,w){U.transferToEffect(N,w+"")}function y(U,N,w,k,J,le){le===void 0&&(le=!0),U._bindLight(N,w,k,J,le)}function x(U,N,w,k,J){J===void 0&&(J=4);for(var le=Math.min(N.lightSources.length,J),be=0;be<le;be++)y(N.lightSources[be],be,U,w,typeof k=="boolean"?k:k.SPECULARTERM,N.receiveShadows)}function R(U,N,w,k){w.NUM_BONE_INFLUENCERS>0&&(k.addCPUSkinningFallback(0,N),U.push(i.Y.MatricesIndicesKind),U.push(i.Y.MatricesWeightsKind),w.NUM_BONE_INFLUENCERS>4&&(U.push(i.Y.MatricesIndicesExtraKind),U.push(i.Y.MatricesWeightsExtraKind)))}function I(U,N){(N.INSTANCES||N.THIN_INSTANCES)&&v(U,!!N.PREPASS_VELOCITY),N.INSTANCESCOLOR&&U.push(i.Y.ColorInstanceKind)}function M(U,N,w,k){w===void 0&&(w=4),k===void 0&&(k=0);for(var J=0,le=0;le<w&&U["LIGHT"+le];le++)le>0&&(J=k+le,N.addFallback(J,"LIGHT"+le)),U.SHADOWS||(U["SHADOW"+le]&&N.addFallback(k,"SHADOW"+le),U["SHADOWPCF"+le]&&N.addFallback(k,"SHADOWPCF"+le),U["SHADOWPCSS"+le]&&N.addFallback(k,"SHADOWPCSS"+le),U["SHADOWPOISSON"+le]&&N.addFallback(k,"SHADOWPOISSON"+le),U["SHADOWESM"+le]&&N.addFallback(k,"SHADOWESM"+le),U["SHADOWCLOSEESM"+le]&&N.addFallback(k,"SHADOWCLOSEESM"+le));return J++}function D(U,N){return N.fogEnabled&&U.applyFog&&N.fogMode!==i.Y.FOGMODE_NONE}function B(U,N,w,k,J,le,be,ve){ve===void 0&&(ve=!1),be._areMiscDirty&&(be.LOGARITHMICDEPTH=w,be.POINTSIZE=k,be.FOG=J&&D(U,N),be.NONUNIFORMSCALING=U.nonUniformScaling,be.ALPHATEST=le,be.DECAL_AFTER_DETAIL=ve)}function F(U,N,w,k,J,le){if(J===void 0&&(J=4),le===void 0&&(le=!1),!w._areLightsDirty)return w._needNormals;var be=0,ve={needNormals:w._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(U.lightsEnabled&&!le)for(var ye=0,Me=N.lightSources;ye<Me.length&&(X(U,N,Me[ye],be,w,k,ve),++be!==J);ye++);w.SPECULARTERM=ve.specularEnabled,w.SHADOWS=ve.shadowEnabled;for(var we=be;we<J;we++)w["LIGHT"+we]!==void 0&&(w["LIGHT"+we]=!1,w["HEMILIGHT"+we]=!1,w["POINTLIGHT"+we]=!1,w["DIRLIGHT"+we]=!1,w["SPOTLIGHT"+we]=!1,w["SHADOW"+we]=!1,w["SHADOWCSM"+we]=!1,w["SHADOWCSMDEBUG"+we]=!1,w["SHADOWCSMNUM_CASCADES"+we]=!1,w["SHADOWCSMUSESHADOWMAXZ"+we]=!1,w["SHADOWCSMNOBLEND"+we]=!1,w["SHADOWCSM_RIGHTHANDED"+we]=!1,w["SHADOWPCF"+we]=!1,w["SHADOWPCSS"+we]=!1,w["SHADOWPOISSON"+we]=!1,w["SHADOWESM"+we]=!1,w["SHADOWCLOSEESM"+we]=!1,w["SHADOWCUBE"+we]=!1,w["SHADOWLOWQUALITY"+we]=!1,w["SHADOWMEDIUMQUALITY"+we]=!1);var He=U.getEngine().getCaps();return w.SHADOWFLOAT===void 0&&(ve.needRebuild=!0),w.SHADOWFLOAT=ve.shadowEnabled&&(He.textureFloatRender&&He.textureFloatLinearFiltering||He.textureHalfFloatRender&&He.textureHalfFloatLinearFiltering),w.LIGHTMAPEXCLUDED=ve.lightmapMode,ve.needRebuild&&w.rebuild(),ve.needNormals}function X(U,N,w,k,J,le,be){var ve;switch(be.needNormals=!0,J["LIGHT"+k]===void 0&&(be.needRebuild=!0),J["LIGHT"+k]=!0,J["SPOTLIGHT"+k]=!1,J["HEMILIGHT"+k]=!1,J["POINTLIGHT"+k]=!1,J["DIRLIGHT"+k]=!1,w.prepareLightSpecificDefines(J,k),J["LIGHT_FALLOFF_PHYSICAL"+k]=!1,J["LIGHT_FALLOFF_GLTF"+k]=!1,J["LIGHT_FALLOFF_STANDARD"+k]=!1,w.falloffType){case s.c.FALLOFF_GLTF:J["LIGHT_FALLOFF_GLTF"+k]=!0;break;case s.c.FALLOFF_PHYSICAL:J["LIGHT_FALLOFF_PHYSICAL"+k]=!0;break;case s.c.FALLOFF_STANDARD:J["LIGHT_FALLOFF_STANDARD"+k]=!0}if(le&&!w.specular.equalsFloats(0,0,0)&&(be.specularEnabled=!0),J["SHADOW"+k]=!1,J["SHADOWCSM"+k]=!1,J["SHADOWCSMDEBUG"+k]=!1,J["SHADOWCSMNUM_CASCADES"+k]=!1,J["SHADOWCSMUSESHADOWMAXZ"+k]=!1,J["SHADOWCSMNOBLEND"+k]=!1,J["SHADOWCSM_RIGHTHANDED"+k]=!1,J["SHADOWPCF"+k]=!1,J["SHADOWPCSS"+k]=!1,J["SHADOWPOISSON"+k]=!1,J["SHADOWESM"+k]=!1,J["SHADOWCLOSEESM"+k]=!1,J["SHADOWCUBE"+k]=!1,J["SHADOWLOWQUALITY"+k]=!1,J["SHADOWMEDIUMQUALITY"+k]=!1,N&&N.receiveShadows&&U.shadowsEnabled&&w.shadowEnabled){var ye=(ve=w.getShadowGenerator(U.activeCamera))!==null&&ve!==void 0?ve:w.getShadowGenerator();if(ye){var Me=ye.getShadowMap();Me&&Me.renderList&&Me.renderList.length>0&&(be.shadowEnabled=!0,ye.prepareDefines(J,k))}}w.lightmapMode!=s.c.LIGHTMAP_DEFAULT?(be.lightmapMode=!0,J["LIGHTMAPEXCLUDED"+k]=!0,J["LIGHTMAPNOSPECULAR"+k]=w.lightmapMode==s.c.LIGHTMAP_SHADOWSONLY):(J["LIGHTMAPEXCLUDED"+k]=!1,J["LIGHTMAPNOSPECULAR"+k]=!1)}function $(U,N,w,k,J,le,be){le===void 0&&(le=null),be===void 0&&(be=!1);var ve=de(U,k);le!==!1&&(ve=(0,l.Eq)(w,U,k)),k.DEPTHPREPASS!==!N.getColorWrite()&&(k.DEPTHPREPASS=!k.DEPTHPREPASS,ve=!0),k.INSTANCES!==J&&(k.INSTANCES=J,ve=!0),k.THIN_INSTANCES!==be&&(k.THIN_INSTANCES=be,ve=!0),ve&&k.markAsUnprocessed()}function Q(U,N){if(U.useBones&&U.computeBonesUsingShaders&&U.skeleton){N.NUM_BONE_INFLUENCERS=U.numBoneInfluencers;var w=N.BONETEXTURE!==void 0;if(U.skeleton.isUsingTextureForMatrices&&w)N.BONETEXTURE=!0;else{N.BonesPerMesh=U.skeleton.bones.length+1,N.BONETEXTURE=!w&&void 0;var k=U.getScene().prePassRenderer;if(k&&k.enabled){var J=k.excludedSkinnedMesh.indexOf(U)===-1;N.BONES_VELOCITY_ENABLED=J}}}else N.NUM_BONE_INFLUENCERS=0,N.BonesPerMesh=0,N.BONETEXTURE!==void 0&&(N.BONETEXTURE=!1)}function ie(U,N){var w=U.morphTargetManager;w?(N.MORPHTARGETS_UV=w.supportsUVs&&N.UV1,N.MORPHTARGETS_TANGENT=w.supportsTangents&&N.TANGENT,N.MORPHTARGETS_NORMAL=w.supportsNormals&&N.NORMAL,N.NUM_MORPH_INFLUENCERS=w.numMaxInfluencers||w.numInfluencers,N.MORPHTARGETS=N.NUM_MORPH_INFLUENCERS>0,N.MORPHTARGETS_TEXTURE=w.isUsingTextureForTargets):(N.MORPHTARGETS_UV=!1,N.MORPHTARGETS_TANGENT=!1,N.MORPHTARGETS_NORMAL=!1,N.MORPHTARGETS=!1,N.NUM_MORPH_INFLUENCERS=0)}function q(U,N){var w=U.bakedVertexAnimationManager;N.BAKED_VERTEX_ANIMATION_TEXTURE=!(!w||!w.isEnabled)}function ee(U,N,w,k,J,le,be){if(J===void 0&&(J=!1),le===void 0&&(le=!0),be===void 0&&(be=!0),!N._areAttributesDirty&&N._needNormals===N._normals&&N._needUVs===N._uvs)return!1;N._normals=N._needNormals,N._uvs=N._needUVs,N.NORMAL=N._needNormals&&U.isVerticesDataPresent(i.Y.NormalKind),N._needNormals&&U.isVerticesDataPresent(i.Y.TangentKind)&&(N.TANGENT=!0);for(var ve=1;ve<=i.Y.MAX_SUPPORTED_UV_SETS;++ve)N["UV"+ve]=!!N._needUVs&&U.isVerticesDataPresent("uv".concat(ve===1?"":ve));if(w){var ye=U.useVertexColors&&U.isVerticesDataPresent(i.Y.ColorKind);N.VERTEXCOLOR=ye,N.VERTEXALPHA=U.hasVertexAlpha&&ye&&le}return U.isVerticesDataPresent(i.Y.ColorInstanceKind)&&(U.hasInstances||U.hasThinInstances)&&(N.INSTANCESCOLOR=!0),k&&Q(U,N),J&&ie(U,N),be&&q(U,N),!0}function te(U,N){if(U.activeCamera){var w=N.MULTIVIEW;N.MULTIVIEW=U.activeCamera.outputRenderTarget!==null&&U.activeCamera.outputRenderTarget.getViewCount()>1,N.MULTIVIEW!=w&&N.markAsUnprocessed()}}function ce(U,N,w){var k=N.ORDER_INDEPENDENT_TRANSPARENCY,J=N.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;N.ORDER_INDEPENDENT_TRANSPARENCY=U.useOrderIndependentTransparency&&w,N.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!U.getEngine().getCaps().textureFloatLinearFiltering,k===N.ORDER_INDEPENDENT_TRANSPARENCY&&J===N.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||N.markAsUnprocessed()}function fe(U,N,w){var k=N.PREPASS;if(N._arePrePassDirty){var J=[{type:i.Y.PREPASS_POSITION_TEXTURE_TYPE,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:i.Y.PREPASS_LOCAL_POSITION_TEXTURE_TYPE,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:i.Y.PREPASS_VELOCITY_TEXTURE_TYPE,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:i.Y.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:i.Y.PREPASS_REFLECTIVITY_TEXTURE_TYPE,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:i.Y.PREPASS_IRRADIANCE_TEXTURE_TYPE,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:i.Y.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:i.Y.PREPASS_DEPTH_TEXTURE_TYPE,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:i.Y.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:i.Y.PREPASS_NORMAL_TEXTURE_TYPE,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:i.Y.PREPASS_WORLD_NORMAL_TEXTURE_TYPE,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(U.prePassRenderer&&U.prePassRenderer.enabled&&w){N.PREPASS=!0,N.SCENE_MRT_COUNT=U.prePassRenderer.mrtCount,N.PREPASS_NORMAL_WORLDSPACE=U.prePassRenderer.generateNormalsInWorldSpace;for(var le=0;le<J.length;le++){var be=U.prePassRenderer.getIndex(J[le].type);be!==-1?(N[J[le].define]=!0,N[J[le].index]=be):N[J[le].define]=!1}}else for(N.PREPASS=!1,le=0;le<J.length;le++)N[J[le].define]=!1;N.PREPASS!=k&&(N.markAsUnprocessed(),N.markAsImageProcessingDirty())}}function de(U,N){var w=!1;if(U.activeCamera){var k=N.CAMERA_ORTHOGRAPHIC?1:0,J=N.CAMERA_PERSPECTIVE?1:0,le=U.activeCamera.mode===i.Y.ORTHOGRAPHIC_CAMERA?1:0,be=U.activeCamera.mode===i.Y.PERSPECTIVE_CAMERA?1:0;(k^le||J^be)&&(N.CAMERA_ORTHOGRAPHIC=le===1,N.CAMERA_PERSPECTIVE=be===1,w=!0)}return w}function Te(U,N,w,k,J,le){J===void 0&&(J=null),le===void 0&&(le=!1),J&&J.push("Light"+U),le||(N.push("vLightData"+U,"vLightDiffuse"+U,"vLightSpecular"+U,"vLightDirection"+U,"vLightFalloff"+U,"vLightGround"+U,"lightMatrix"+U,"shadowsInfo"+U,"depthValues"+U),w.push("shadowTexture"+U),w.push("depthTexture"+U),N.push("viewFrustumZ"+U,"cascadeBlendFactor"+U,"lightSizeUVCorrection"+U,"depthCorrection"+U,"penumbraDarkness"+U,"frustumLengths"+U),k&&(w.push("projectionLightTexture"+U),N.push("textureProjectionMatrix"+U)))}function ue(U,N,w,k){var J;k===void 0&&(k=4);var le=null;if(U.uniformsNames){var be=U;J=be.uniformsNames,le=be.uniformBuffersNames,N=be.samplers,w=be.defines,k=be.maxSimultaneousLights||0}else J=U,N||(N=[]);for(var ve=0;ve<k&&w["LIGHT"+ve];ve++)Te(ve,J,N,w["PROJECTEDLIGHTTEXTURE"+ve],le);w.NUM_MORPH_INFLUENCERS&&(J.push("morphTargetInfluences"),J.push("morphTargetCount")),w.BAKED_VERTEX_ANIMATION_TEXTURE&&(J.push("bakedVertexAnimationSettings"),J.push("bakedVertexAnimationTextureSizeInverted"),J.push("bakedVertexAnimationTime"),N.push("bakedVertexAnimationTexture"))}},75482:(r,t,e)=>{e.d(t,{D:()=>o});var n=e(7164),i=e(44957),o=(e(59012),function(){function a(s,l,c,u,d){d===void 0&&(d=!1),this._valueCache={},this._engine=s,this._noUBO=!s.supportsUniformBuffers||d,this._dynamic=c,this._name=u??"no-name",this._data=l||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}return Object.defineProperty(a.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),a.prototype.isDynamic=function(){return this._dynamic!==void 0},a.prototype.getData=function(){return this._bufferData},a.prototype.getBuffer=function(){return this._buffer},a.prototype._fillAlignment=function(s){var l;if(l=s<=2?s:4,this._uniformLocationPointer%l!=0){var c=this._uniformLocationPointer;this._uniformLocationPointer+=l-this._uniformLocationPointer%l;for(var u=this._uniformLocationPointer-c,d=0;d<u;d++)this._data.push(0)}},a.prototype.addUniform=function(s,l,c){if(c===void 0&&(c=0),!this._noUBO&&this._uniformLocations[s]===void 0){var u;if(c>0){if(l instanceof Array)throw"addUniform should not be use with Array in UBO: "+s;this._fillAlignment(4),this._uniformArraySizes[s]={strideSize:l,arraySize:c},l==16?l*=c:l=l*c+(4-l)*c,u=[];for(var d=0;d<l;d++)u.push(0)}else{if(l instanceof Array)l=(u=l).length;else for(u=[],d=0;d<l;d++)u.push(0);this._fillAlignment(l)}for(this._uniformSizes[s]=l,this._uniformLocations[s]=this._uniformLocationPointer,this._uniformLocationPointer+=l,d=0;d<l;d++)this._data.push(u[d]);this._needSync=!0}},a.prototype.addMatrix=function(s,l){this.addUniform(s,Array.prototype.slice.call(l.asArray()))},a.prototype.addFloat2=function(s,l,c){var u=[l,c];this.addUniform(s,u)},a.prototype.addFloat3=function(s,l,c,u){var d=[l,c,u];this.addUniform(s,d)},a.prototype.addColor3=function(s,l){var c=[l.r,l.g,l.b];this.addUniform(s,c)},a.prototype.addColor4=function(s,l,c){var u=[l.r,l.g,l.b,c];this.addUniform(s,u)},a.prototype.addVector3=function(s,l){var c=[l.x,l.y,l.z];this.addUniform(s,c)},a.prototype.addMatrix3x3=function(s){this.addUniform(s,12)},a.prototype.addMatrix2x2=function(s){this.addUniform(s,8)},a.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},a.prototype._getNames=function(){var s=[],l=0;for(var c in this._uniformLocations)if(s.push(c),++l==10)break;return s.join(",")},a.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))},a.prototype._rebuildAfterContextLost=function(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()},Object.defineProperty(a.prototype,"_numBuffers",{get:function(){return this._buffers.length},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"_indexBuffer",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"currentEffect",{get:function(){return this._currentEffect},enumerable:!1,configurable:!0}),a.prototype._buffersEqual=function(s,l){for(var c=0;c<s.length;++c)if(s[c]!==l[c])return!1;return!0},a.prototype._copyBuffer=function(s,l){for(var c=0;c<s.length;++c)l[c]=s[c]},a.prototype.update=function(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(a._UpdatedUbosInFrame[this._name]||(a._UpdatedUbosInFrame[this._name]=0),a._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()},a.prototype._createNewBuffer=function(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()},a.prototype._checkNewFrame=function(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=this._bufferIndex!==0,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)},a.prototype.updateUniform=function(s,l,c){this._checkNewFrame();var u=this._uniformLocations[s];if(u===void 0){if(this._buffer)return void n.V.Error("Cannot add an uniform after UBO has been created. uniformName="+s);this.addUniform(s,c),u=this._uniformLocations[s]}if(this._buffer||this.create(),this._dynamic)for(h=0;h<c;h++)this._bufferData[u+h]=l[h];else{for(var d=!1,h=0;h<c;h++)(c===16&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[u+h]!==Math.fround(l[h]))&&(d=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[u+h]=l[h]);this._needSync=this._needSync||d}},a.prototype.updateUniformArray=function(s,l,c){this._checkNewFrame();var u=this._uniformLocations[s];if(u!==void 0){this._buffer||this.create();var d=this._uniformArraySizes[s];if(this._dynamic)for(v=0;v<c;v++)this._bufferData[u+v]=l[v];else{for(var h=!1,p=0,m=0,v=0;v<c;v++)if(this._bufferData[u+4*m+p]!==i.S0.FloatRound(l[v])&&(h=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[u+4*m+p]=l[v]),++p===d.strideSize){for(;p<4;p++)this._bufferData[u+4*m+p]=0;p=0,m++}this._needSync=this._needSync||h}}else n.V.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.")},a.prototype._cacheMatrix=function(s,l){this._checkNewFrame();var c=this._valueCache[s],u=l.updateFlag;return(c===void 0||c!==u)&&(this._valueCache[s]=u,!0)},a.prototype._updateMatrix3x3ForUniform=function(s,l){for(var c=0;c<3;c++)a._TempBuffer[4*c]=l[3*c],a._TempBuffer[4*c+1]=l[3*c+1],a._TempBuffer[4*c+2]=l[3*c+2],a._TempBuffer[4*c+3]=0;this.updateUniform(s,a._TempBuffer,12)},a.prototype._updateMatrix3x3ForEffect=function(s,l){this._currentEffect.setMatrix3x3(s,l)},a.prototype._updateMatrix2x2ForEffect=function(s,l){this._currentEffect.setMatrix2x2(s,l)},a.prototype._updateMatrix2x2ForUniform=function(s,l){for(var c=0;c<2;c++)a._TempBuffer[4*c]=l[2*c],a._TempBuffer[4*c+1]=l[2*c+1],a._TempBuffer[4*c+2]=0,a._TempBuffer[4*c+3]=0;this.updateUniform(s,a._TempBuffer,8)},a.prototype._updateFloatForEffect=function(s,l){this._currentEffect.setFloat(s,l)},a.prototype._updateFloatForUniform=function(s,l){a._TempBuffer[0]=l,this.updateUniform(s,a._TempBuffer,1)},a.prototype._updateFloat2ForEffect=function(s,l,c,u){u===void 0&&(u=""),this._currentEffect.setFloat2(s+u,l,c)},a.prototype._updateFloat2ForUniform=function(s,l,c){a._TempBuffer[0]=l,a._TempBuffer[1]=c,this.updateUniform(s,a._TempBuffer,2)},a.prototype._updateFloat3ForEffect=function(s,l,c,u,d){d===void 0&&(d=""),this._currentEffect.setFloat3(s+d,l,c,u)},a.prototype._updateFloat3ForUniform=function(s,l,c,u){a._TempBuffer[0]=l,a._TempBuffer[1]=c,a._TempBuffer[2]=u,this.updateUniform(s,a._TempBuffer,3)},a.prototype._updateFloat4ForEffect=function(s,l,c,u,d,h){h===void 0&&(h=""),this._currentEffect.setFloat4(s+h,l,c,u,d)},a.prototype._updateFloat4ForUniform=function(s,l,c,u,d){a._TempBuffer[0]=l,a._TempBuffer[1]=c,a._TempBuffer[2]=u,a._TempBuffer[3]=d,this.updateUniform(s,a._TempBuffer,4)},a.prototype._updateFloatArrayForEffect=function(s,l){this._currentEffect.setFloatArray(s,l)},a.prototype._updateFloatArrayForUniform=function(s,l){this.updateUniformArray(s,l,l.length)},a.prototype._updateArrayForEffect=function(s,l){this._currentEffect.setArray(s,l)},a.prototype._updateArrayForUniform=function(s,l){this.updateUniformArray(s,l,l.length)},a.prototype._updateIntArrayForEffect=function(s,l){this._currentEffect.setIntArray(s,l)},a.prototype._updateIntArrayForUniform=function(s,l){a._TempBufferInt32View.set(l),this.updateUniformArray(s,a._TempBuffer,l.length)},a.prototype._updateUIntArrayForEffect=function(s,l){this._currentEffect.setUIntArray(s,l)},a.prototype._updateUIntArrayForUniform=function(s,l){a._TempBufferUInt32View.set(l),this.updateUniformArray(s,a._TempBuffer,l.length)},a.prototype._updateMatrixForEffect=function(s,l){this._currentEffect.setMatrix(s,l)},a.prototype._updateMatrixForUniform=function(s,l){this._cacheMatrix(s,l)&&this.updateUniform(s,l.asArray(),16)},a.prototype._updateMatricesForEffect=function(s,l){this._currentEffect.setMatrices(s,l)},a.prototype._updateMatricesForUniform=function(s,l){this.updateUniform(s,l,l.length)},a.prototype._updateVector3ForEffect=function(s,l){this._currentEffect.setVector3(s,l)},a.prototype._updateVector3ForUniform=function(s,l){a._TempBuffer[0]=l.x,a._TempBuffer[1]=l.y,a._TempBuffer[2]=l.z,this.updateUniform(s,a._TempBuffer,3)},a.prototype._updateVector4ForEffect=function(s,l){this._currentEffect.setVector4(s,l)},a.prototype._updateVector4ForUniform=function(s,l){a._TempBuffer[0]=l.x,a._TempBuffer[1]=l.y,a._TempBuffer[2]=l.z,a._TempBuffer[3]=l.w,this.updateUniform(s,a._TempBuffer,4)},a.prototype._updateColor3ForEffect=function(s,l,c){c===void 0&&(c=""),this._currentEffect.setColor3(s+c,l)},a.prototype._updateColor3ForUniform=function(s,l){a._TempBuffer[0]=l.r,a._TempBuffer[1]=l.g,a._TempBuffer[2]=l.b,this.updateUniform(s,a._TempBuffer,3)},a.prototype._updateColor4ForEffect=function(s,l,c,u){u===void 0&&(u=""),this._currentEffect.setColor4(s+u,l,c)},a.prototype._updateDirectColor4ForEffect=function(s,l,c){c===void 0&&(c=""),this._currentEffect.setDirectColor4(s+c,l)},a.prototype._updateColor4ForUniform=function(s,l,c){a._TempBuffer[0]=l.r,a._TempBuffer[1]=l.g,a._TempBuffer[2]=l.b,a._TempBuffer[3]=c,this.updateUniform(s,a._TempBuffer,4)},a.prototype._updateDirectColor4ForUniform=function(s,l){a._TempBuffer[0]=l.r,a._TempBuffer[1]=l.g,a._TempBuffer[2]=l.b,a._TempBuffer[3]=l.a,this.updateUniform(s,a._TempBuffer,4)},a.prototype._updateIntForEffect=function(s,l,c){c===void 0&&(c=""),this._currentEffect.setInt(s+c,l)},a.prototype._updateIntForUniform=function(s,l){a._TempBufferInt32View[0]=l,this.updateUniform(s,a._TempBuffer,1)},a.prototype._updateInt2ForEffect=function(s,l,c,u){u===void 0&&(u=""),this._currentEffect.setInt2(s+u,l,c)},a.prototype._updateInt2ForUniform=function(s,l,c){a._TempBufferInt32View[0]=l,a._TempBufferInt32View[1]=c,this.updateUniform(s,a._TempBuffer,2)},a.prototype._updateInt3ForEffect=function(s,l,c,u,d){d===void 0&&(d=""),this._currentEffect.setInt3(s+d,l,c,u)},a.prototype._updateInt3ForUniform=function(s,l,c,u){a._TempBufferInt32View[0]=l,a._TempBufferInt32View[1]=c,a._TempBufferInt32View[2]=u,this.updateUniform(s,a._TempBuffer,3)},a.prototype._updateInt4ForEffect=function(s,l,c,u,d,h){h===void 0&&(h=""),this._currentEffect.setInt4(s+h,l,c,u,d)},a.prototype._updateInt4ForUniform=function(s,l,c,u,d){a._TempBufferInt32View[0]=l,a._TempBufferInt32View[1]=c,a._TempBufferInt32View[2]=u,a._TempBufferInt32View[3]=d,this.updateUniform(s,a._TempBuffer,4)},a.prototype._updateUIntForEffect=function(s,l,c){c===void 0&&(c=""),this._currentEffect.setUInt(s+c,l)},a.prototype._updateUIntForUniform=function(s,l){a._TempBufferUInt32View[0]=l,this.updateUniform(s,a._TempBuffer,1)},a.prototype._updateUInt2ForEffect=function(s,l,c,u){u===void 0&&(u=""),this._currentEffect.setUInt2(s+u,l,c)},a.prototype._updateUInt2ForUniform=function(s,l,c){a._TempBufferUInt32View[0]=l,a._TempBufferUInt32View[1]=c,this.updateUniform(s,a._TempBuffer,2)},a.prototype._updateUInt3ForEffect=function(s,l,c,u,d){d===void 0&&(d=""),this._currentEffect.setUInt3(s+d,l,c,u)},a.prototype._updateUInt3ForUniform=function(s,l,c,u){a._TempBufferUInt32View[0]=l,a._TempBufferUInt32View[1]=c,a._TempBufferUInt32View[2]=u,this.updateUniform(s,a._TempBuffer,3)},a.prototype._updateUInt4ForEffect=function(s,l,c,u,d,h){h===void 0&&(h=""),this._currentEffect.setUInt4(s+h,l,c,u,d)},a.prototype._updateUInt4ForUniform=function(s,l,c,u,d){a._TempBufferUInt32View[0]=l,a._TempBufferUInt32View[1]=c,a._TempBufferUInt32View[2]=u,a._TempBufferUInt32View[3]=d,this.updateUniform(s,a._TempBuffer,4)},a.prototype.setTexture=function(s,l){this._currentEffect.setTexture(s,l)},a.prototype.setTextureArray=function(s,l){this._currentEffect.setTextureArray(s,l)},a.prototype.bindTexture=function(s,l){this._currentEffect._bindTexture(s,l)},a.prototype.updateUniformDirectly=function(s,l){this.updateUniform(s,l,l.length),this.update()},a.prototype.bindToEffect=function(s,l){this._currentEffect=s,this._currentEffectName=l},a.prototype.bindUniformBuffer=function(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)},a.prototype.unbindEffect=function(){this._currentEffect=void 0,this._currentEffectName=void 0},a.prototype.setDataBuffer=function(s){if(!this._buffers)return this._buffer===s;for(var l=0;l<this._buffers.length;++l)if(this._buffers[l][0]===s)return this._bufferIndex=l,this._buffer=s,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0;return!1},a.prototype.dispose=function(){if(!this._noUBO){var s=this._engine._uniformBuffers,l=s.indexOf(this);if(l!==-1&&(s[l]=s[s.length-1],s.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(var c=0;c<this._buffers.length;++c){var u=this._buffers[c][0];this._engine._releaseBuffer(u)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},a._UpdatedUbosInFrame={},a._MAX_UNIFORM_SIZE=256,a._TempBuffer=new Float32Array(a._MAX_UNIFORM_SIZE),a._TempBufferInt32View=new Int32Array(a._TempBuffer.buffer),a._TempBufferUInt32View=new Uint32Array(a._TempBuffer.buffer),a}())},13424:(r,t,e)=>{e.d(t,{$x:()=>n,_0:()=>a,xp:()=>o});var n,i=e(8046);(function(s){s[s.LOCAL=0]="LOCAL",s[s.WORLD=1]="WORLD",s[s.BONE=2]="BONE"})(n||(n={}));var o,a=function(){function s(){}return s.X=new i.Pq(1,0,0),s.Y=new i.Pq(0,1,0),s.Z=new i.Pq(0,0,1),s}();(function(s){s[s.X=0]="X",s[s.Y=1]="Y",s[s.Z=2]="Z"})(o||(o={}))},64726:(r,t,e)=>{e.d(t,{IG:()=>p,ov:()=>h,v9:()=>d});var n=e(11296),i=e(34623),o=e(56740),a=e(48810);function s(m){return Math.pow(m,o.tk)}function l(m){return m<=.04045?.0773993808*m:Math.pow(.947867299*(m+.055),2.4)}function c(m){return Math.pow(m,o.rv)}function u(m){return m<=.0031308?12.92*m:1.055*Math.pow(m,.41666)-.055}var d=function(){function m(v,b,E){v===void 0&&(v=0),b===void 0&&(b=0),E===void 0&&(E=0),this.r=v,this.g=b,this.b=E}return m.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},m.prototype.getClassName=function(){return"Color3"},m.prototype.getHashCode=function(){var v=255*this.r|0;return 397*(v=397*v^255*this.g)^255*this.b},m.prototype.toArray=function(v,b){return b===void 0&&(b=0),v[b]=this.r,v[b+1]=this.g,v[b+2]=this.b,this},m.prototype.fromArray=function(v,b){return b===void 0&&(b=0),m.FromArrayToRef(v,b,this),this},m.prototype.toColor4=function(v){return v===void 0&&(v=1),new h(this.r,this.g,this.b,v)},m.prototype.asArray=function(){return[this.r,this.g,this.b]},m.prototype.toLuminance=function(){return .3*this.r+.59*this.g+.11*this.b},m.prototype.multiply=function(v){return new m(this.r*v.r,this.g*v.g,this.b*v.b)},m.prototype.multiplyToRef=function(v,b){return b.r=this.r*v.r,b.g=this.g*v.g,b.b=this.b*v.b,b},m.prototype.multiplyInPlace=function(v){return this.r*=v.r,this.g*=v.g,this.b*=v.b,this},m.prototype.multiplyByFloats=function(v,b,E){return new m(this.r*v,this.g*b,this.b*E)},m.prototype.divide=function(v){throw new ReferenceError("Can not divide a color")},m.prototype.divideToRef=function(v,b){throw new ReferenceError("Can not divide a color")},m.prototype.divideInPlace=function(v){throw new ReferenceError("Can not divide a color")},m.prototype.minimizeInPlace=function(v){return this.minimizeInPlaceFromFloats(v.r,v.g,v.b)},m.prototype.maximizeInPlace=function(v){return this.maximizeInPlaceFromFloats(v.r,v.g,v.b)},m.prototype.minimizeInPlaceFromFloats=function(v,b,E){return this.r=Math.min(v,this.r),this.g=Math.min(b,this.g),this.b=Math.min(E,this.b),this},m.prototype.maximizeInPlaceFromFloats=function(v,b,E){return this.r=Math.max(v,this.r),this.g=Math.max(b,this.g),this.b=Math.max(E,this.b),this},m.prototype.floorToRef=function(v){throw new ReferenceError("Can not floor a color")},m.prototype.floor=function(){throw new ReferenceError("Can not floor a color")},m.prototype.fractToRef=function(v){throw new ReferenceError("Can not fract a color")},m.prototype.fract=function(){throw new ReferenceError("Can not fract a color")},m.prototype.equals=function(v){return v&&this.r===v.r&&this.g===v.g&&this.b===v.b},m.prototype.equalsFloats=function(v,b,E){return this.equalsToFloats(v,b,E)},m.prototype.equalsToFloats=function(v,b,E){return this.r===v&&this.g===b&&this.b===E},m.prototype.equalsWithEpsilon=function(v,b){return b===void 0&&(b=o.bH),(0,a.WithinEpsilon)(this.r,v.r,b)&&(0,a.WithinEpsilon)(this.g,v.g,b)&&(0,a.WithinEpsilon)(this.b,v.b,b)},m.prototype.negate=function(){throw new ReferenceError("Can not negate a color")},m.prototype.negateInPlace=function(){throw new ReferenceError("Can not negate a color")},m.prototype.negateToRef=function(v){throw new ReferenceError("Can not negate a color")},m.prototype.scale=function(v){return new m(this.r*v,this.g*v,this.b*v)},m.prototype.scaleInPlace=function(v){return this.r*=v,this.g*=v,this.b*=v,this},m.prototype.scaleToRef=function(v,b){return b.r=this.r*v,b.g=this.g*v,b.b=this.b*v,b},m.prototype.scaleAndAddToRef=function(v,b){return b.r+=this.r*v,b.g+=this.g*v,b.b+=this.b*v,b},m.prototype.clampToRef=function(v,b,E){return v===void 0&&(v=0),b===void 0&&(b=1),E.r=(0,a.Clamp)(this.r,v,b),E.g=(0,a.Clamp)(this.g,v,b),E.b=(0,a.Clamp)(this.b,v,b),E},m.prototype.add=function(v){return new m(this.r+v.r,this.g+v.g,this.b+v.b)},m.prototype.addInPlace=function(v){return this.r+=v.r,this.g+=v.g,this.b+=v.b,this},m.prototype.addInPlaceFromFloats=function(v,b,E){return this.r+=v,this.g+=b,this.b+=E,this},m.prototype.addToRef=function(v,b){return b.r=this.r+v.r,b.g=this.g+v.g,b.b=this.b+v.b,b},m.prototype.subtract=function(v){return new m(this.r-v.r,this.g-v.g,this.b-v.b)},m.prototype.subtractToRef=function(v,b){return b.r=this.r-v.r,b.g=this.g-v.g,b.b=this.b-v.b,b},m.prototype.subtractInPlace=function(v){return this.r-=v.r,this.g-=v.g,this.b-=v.b,this},m.prototype.subtractFromFloats=function(v,b,E){return new m(this.r-v,this.g-b,this.b-E)},m.prototype.subtractFromFloatsToRef=function(v,b,E,C){return C.r=this.r-v,C.g=this.g-b,C.b=this.b-E,C},m.prototype.clone=function(){return new m(this.r,this.g,this.b)},m.prototype.copyFrom=function(v){return this.r=v.r,this.g=v.g,this.b=v.b,this},m.prototype.copyFromFloats=function(v,b,E){return this.r=v,this.g=b,this.b=E,this},m.prototype.set=function(v,b,E){return this.copyFromFloats(v,b,E)},m.prototype.setAll=function(v){return this.r=this.g=this.b=v,this},m.prototype.toHexString=function(){var v=Math.round(255*this.r),b=Math.round(255*this.g),E=Math.round(255*this.b);return"#"+(0,a.ToHex)(v)+(0,a.ToHex)(b)+(0,a.ToHex)(E)},m.prototype.toHSV=function(){return this.toHSVToRef(new m)},m.prototype.toHSVToRef=function(v){var b=this.r,E=this.g,C=this.b,T=Math.max(b,E,C),f=Math.min(b,E,C),g=0,S=0,y=T,x=T-f;return T!==0&&(S=x/T),T!=f&&(T==b?(g=(E-C)/x,E<C&&(g+=6)):T==E?g=(C-b)/x+2:T==C&&(g=(b-E)/x+4),g*=60),v.r=g,v.g=S,v.b=y,v},m.prototype.toLinearSpace=function(v){v===void 0&&(v=!1);var b=new m;return this.toLinearSpaceToRef(b,v),b},m.prototype.toLinearSpaceToRef=function(v,b){return b===void 0&&(b=!1),b?(v.r=l(this.r),v.g=l(this.g),v.b=l(this.b)):(v.r=s(this.r),v.g=s(this.g),v.b=s(this.b)),this},m.prototype.toGammaSpace=function(v){v===void 0&&(v=!1);var b=new m;return this.toGammaSpaceToRef(b,v),b},m.prototype.toGammaSpaceToRef=function(v,b){return b===void 0&&(b=!1),b?(v.r=u(this.r),v.g=u(this.g),v.b=u(this.b)):(v.r=c(this.r),v.g=c(this.g),v.b=c(this.b)),this},m.HSVtoRGBToRef=function(v,b,E,C){var T=E*b,f=v/60,g=T*(1-Math.abs(f%2-1)),S=0,y=0,x=0;f>=0&&f<=1?(S=T,y=g):f>=1&&f<=2?(S=g,y=T):f>=2&&f<=3?(y=T,x=g):f>=3&&f<=4?(y=g,x=T):f>=4&&f<=5?(S=g,x=T):f>=5&&f<=6&&(S=T,x=g);var R=E-T;return C.r=S+R,C.g=y+R,C.b=x+R,C},m.FromHSV=function(v,b,E){var C=new m(0,0,0);return m.HSVtoRGBToRef(v,b,E,C),C},m.FromHexString=function(v){if(v.substring(0,1)!=="#"||v.length!==7)return new m(0,0,0);var b=parseInt(v.substring(1,3),16),E=parseInt(v.substring(3,5),16),C=parseInt(v.substring(5,7),16);return m.FromInts(b,E,C)},m.FromArray=function(v,b){return b===void 0&&(b=0),new m(v[b],v[b+1],v[b+2])},m.FromArrayToRef=function(v,b,E){b===void 0&&(b=0),E.r=v[b],E.g=v[b+1],E.b=v[b+2]},m.FromInts=function(v,b,E){return new m(v/255,b/255,E/255)},m.Lerp=function(v,b,E){var C=new m(0,0,0);return m.LerpToRef(v,b,E,C),C},m.LerpToRef=function(v,b,E,C){C.r=v.r+(b.r-v.r)*E,C.g=v.g+(b.g-v.g)*E,C.b=v.b+(b.b-v.b)*E},m.Hermite=function(v,b,E,C,T){var f=T*T,g=T*f,S=2*g-3*f+1,y=-2*g+3*f,x=g-2*f+T,R=g-f;return new m(v.r*S+E.r*y+b.r*x+C.r*R,v.g*S+E.g*y+b.g*x+C.g*R,v.b*S+E.b*y+b.b*x+C.b*R)},m.Hermite1stDerivative=function(v,b,E,C,T){var f=m.Black();return this.Hermite1stDerivativeToRef(v,b,E,C,T,f),f},m.Hermite1stDerivativeToRef=function(v,b,E,C,T,f){var g=T*T;f.r=6*(g-T)*v.r+(3*g-4*T+1)*b.r+6*(-g+T)*E.r+(3*g-2*T)*C.r,f.g=6*(g-T)*v.g+(3*g-4*T+1)*b.g+6*(-g+T)*E.g+(3*g-2*T)*C.g,f.b=6*(g-T)*v.b+(3*g-4*T+1)*b.b+6*(-g+T)*E.b+(3*g-2*T)*C.b},m.Red=function(){return new m(1,0,0)},m.Green=function(){return new m(0,1,0)},m.Blue=function(){return new m(0,0,1)},m.Black=function(){return new m(0,0,0)},Object.defineProperty(m,"BlackReadOnly",{get:function(){return m._BlackReadOnly},enumerable:!1,configurable:!0}),m.White=function(){return new m(1,1,1)},m.Purple=function(){return new m(.5,0,.5)},m.Magenta=function(){return new m(1,0,1)},m.Yellow=function(){return new m(1,1,0)},m.Gray=function(){return new m(.5,.5,.5)},m.Teal=function(){return new m(0,1,1)},m.Random=function(){return new m(Math.random(),Math.random(),Math.random())},m._BlackReadOnly=m.Black(),m}();Object.defineProperties(d.prototype,{dimension:{value:[3]},rank:{value:1}});var h=function(){function m(v,b,E,C){v===void 0&&(v=0),b===void 0&&(b=0),E===void 0&&(E=0),C===void 0&&(C=1),this.r=v,this.g=b,this.b=E,this.a=C}return m.prototype.asArray=function(){return[this.r,this.g,this.b,this.a]},m.prototype.toArray=function(v,b){return b===void 0&&(b=0),v[b]=this.r,v[b+1]=this.g,v[b+2]=this.b,v[b+3]=this.a,this},m.prototype.fromArray=function(v,b){return b===void 0&&(b=0),this.r=v[b],this.g=v[b+1],this.b=v[b+2],this.a=v[b+3],this},m.prototype.equals=function(v){return v&&this.r===v.r&&this.g===v.g&&this.b===v.b&&this.a===v.a},m.prototype.add=function(v){return new m(this.r+v.r,this.g+v.g,this.b+v.b,this.a+v.a)},m.prototype.addToRef=function(v,b){return b.r=this.r+v.r,b.g=this.g+v.g,b.b=this.b+v.b,b.a=this.a+v.a,b},m.prototype.addInPlace=function(v){return this.r+=v.r,this.g+=v.g,this.b+=v.b,this.a+=v.a,this},m.prototype.addInPlaceFromFloats=function(v,b,E,C){return this.r+=v,this.g+=b,this.b+=E,this.a+=C,this},m.prototype.subtract=function(v){return new m(this.r-v.r,this.g-v.g,this.b-v.b,this.a-v.a)},m.prototype.subtractToRef=function(v,b){return b.r=this.r-v.r,b.g=this.g-v.g,b.b=this.b-v.b,b.a=this.a-v.a,b},m.prototype.subtractInPlace=function(v){return this.r-=v.r,this.g-=v.g,this.b-=v.b,this.a-=v.a,this},m.prototype.subtractFromFloats=function(v,b,E,C){return new m(this.r-v,this.g-b,this.b-E,this.a-C)},m.prototype.subtractFromFloatsToRef=function(v,b,E,C,T){return T.r=this.r-v,T.g=this.g-b,T.b=this.b-E,T.a=this.a-C,T},m.prototype.scale=function(v){return new m(this.r*v,this.g*v,this.b*v,this.a*v)},m.prototype.scaleInPlace=function(v){return this.r*=v,this.g*=v,this.b*=v,this.a*=v,this},m.prototype.scaleToRef=function(v,b){return b.r=this.r*v,b.g=this.g*v,b.b=this.b*v,b.a=this.a*v,b},m.prototype.scaleAndAddToRef=function(v,b){return b.r+=this.r*v,b.g+=this.g*v,b.b+=this.b*v,b.a+=this.a*v,b},m.prototype.clampToRef=function(v,b,E){return v===void 0&&(v=0),b===void 0&&(b=1),E.r=(0,a.Clamp)(this.r,v,b),E.g=(0,a.Clamp)(this.g,v,b),E.b=(0,a.Clamp)(this.b,v,b),E.a=(0,a.Clamp)(this.a,v,b),E},m.prototype.multiply=function(v){return new m(this.r*v.r,this.g*v.g,this.b*v.b,this.a*v.a)},m.prototype.multiplyToRef=function(v,b){return b.r=this.r*v.r,b.g=this.g*v.g,b.b=this.b*v.b,b.a=this.a*v.a,b},m.prototype.multiplyInPlace=function(v){return this.r*=v.r,this.g*=v.g,this.b*=v.b,this.a*=v.a,this},m.prototype.multiplyByFloats=function(v,b,E,C){return new m(this.r*v,this.g*b,this.b*E,this.a*C)},m.prototype.divide=function(v){throw new ReferenceError("Can not divide a color")},m.prototype.divideToRef=function(v,b){throw new ReferenceError("Can not divide a color")},m.prototype.divideInPlace=function(v){throw new ReferenceError("Can not divide a color")},m.prototype.minimizeInPlace=function(v){return this.r=Math.min(this.r,v.r),this.g=Math.min(this.g,v.g),this.b=Math.min(this.b,v.b),this.a=Math.min(this.a,v.a),this},m.prototype.maximizeInPlace=function(v){return this.r=Math.max(this.r,v.r),this.g=Math.max(this.g,v.g),this.b=Math.max(this.b,v.b),this.a=Math.max(this.a,v.a),this},m.prototype.minimizeInPlaceFromFloats=function(v,b,E,C){return this.r=Math.min(v,this.r),this.g=Math.min(b,this.g),this.b=Math.min(E,this.b),this.a=Math.min(C,this.a),this},m.prototype.maximizeInPlaceFromFloats=function(v,b,E,C){return this.r=Math.max(v,this.r),this.g=Math.max(b,this.g),this.b=Math.max(E,this.b),this.a=Math.max(C,this.a),this},m.prototype.floorToRef=function(v){throw new ReferenceError("Can not floor a color")},m.prototype.floor=function(){throw new ReferenceError("Can not floor a color")},m.prototype.fractToRef=function(v){throw new ReferenceError("Can not fract a color")},m.prototype.fract=function(){throw new ReferenceError("Can not fract a color")},m.prototype.negate=function(){throw new ReferenceError("Can not negate a color")},m.prototype.negateInPlace=function(){throw new ReferenceError("Can not negate a color")},m.prototype.negateToRef=function(v){throw new ReferenceError("Can not negate a color")},m.prototype.equalsWithEpsilon=function(v,b){return b===void 0&&(b=o.bH),(0,a.WithinEpsilon)(this.r,v.r,b)&&(0,a.WithinEpsilon)(this.g,v.g,b)&&(0,a.WithinEpsilon)(this.b,v.b,b)&&(0,a.WithinEpsilon)(this.a,v.a,b)},m.prototype.equalsToFloats=function(v,b,E,C){return this.r===v&&this.g===b&&this.b===E&&this.a===C},m.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},m.prototype.getClassName=function(){return"Color4"},m.prototype.getHashCode=function(){var v=255*this.r|0;return 397*(v=397*(v=397*v^255*this.g)^255*this.b)^255*this.a},m.prototype.clone=function(){return new m().copyFrom(this)},m.prototype.copyFrom=function(v){return this.r=v.r,this.g=v.g,this.b=v.b,this.a=v.a,this},m.prototype.copyFromFloats=function(v,b,E,C){return this.r=v,this.g=b,this.b=E,this.a=C,this},m.prototype.set=function(v,b,E,C){return this.copyFromFloats(v,b,E,C)},m.prototype.setAll=function(v){return this.r=this.g=this.b=this.a=v,this},m.prototype.toHexString=function(v){v===void 0&&(v=!1);var b=Math.round(255*this.r),E=Math.round(255*this.g),C=Math.round(255*this.b);if(v)return"#"+(0,a.ToHex)(b)+(0,a.ToHex)(E)+(0,a.ToHex)(C);var T=Math.round(255*this.a);return"#"+(0,a.ToHex)(b)+(0,a.ToHex)(E)+(0,a.ToHex)(C)+(0,a.ToHex)(T)},m.prototype.toLinearSpace=function(v){v===void 0&&(v=!1);var b=new m;return this.toLinearSpaceToRef(b,v),b},m.prototype.toLinearSpaceToRef=function(v,b){return b===void 0&&(b=!1),b?(v.r=l(this.r),v.g=l(this.g),v.b=l(this.b)):(v.r=s(this.r),v.g=s(this.g),v.b=s(this.b)),v.a=this.a,this},m.prototype.toGammaSpace=function(v){v===void 0&&(v=!1);var b=new m;return this.toGammaSpaceToRef(b,v),b},m.prototype.toGammaSpaceToRef=function(v,b){return b===void 0&&(b=!1),b?(v.r=u(this.r),v.g=u(this.g),v.b=u(this.b)):(v.r=c(this.r),v.g=c(this.g),v.b=c(this.b)),v.a=this.a,this},m.FromHexString=function(v){if(v.substring(0,1)!=="#"||v.length!==9&&v.length!==7)return new m(0,0,0,0);var b=parseInt(v.substring(1,3),16),E=parseInt(v.substring(3,5),16),C=parseInt(v.substring(5,7),16),T=v.length===9?parseInt(v.substring(7,9),16):255;return m.FromInts(b,E,C,T)},m.Lerp=function(v,b,E){return m.LerpToRef(v,b,E,new m)},m.LerpToRef=function(v,b,E,C){return C.r=v.r+(b.r-v.r)*E,C.g=v.g+(b.g-v.g)*E,C.b=v.b+(b.b-v.b)*E,C.a=v.a+(b.a-v.a)*E,C},m.Hermite=function(v,b,E,C,T){var f=T*T,g=T*f,S=2*g-3*f+1,y=-2*g+3*f,x=g-2*f+T,R=g-f;return new m(v.r*S+E.r*y+b.r*x+C.r*R,v.g*S+E.g*y+b.g*x+C.g*R,v.b*S+E.b*y+b.b*x+C.b*R,v.a*S+E.a*y+b.a*x+C.a*R)},m.Hermite1stDerivative=function(v,b,E,C,T){var f=new m;return this.Hermite1stDerivativeToRef(v,b,E,C,T,f),f},m.Hermite1stDerivativeToRef=function(v,b,E,C,T,f){var g=T*T;f.r=6*(g-T)*v.r+(3*g-4*T+1)*b.r+6*(-g+T)*E.r+(3*g-2*T)*C.r,f.g=6*(g-T)*v.g+(3*g-4*T+1)*b.g+6*(-g+T)*E.g+(3*g-2*T)*C.g,f.b=6*(g-T)*v.b+(3*g-4*T+1)*b.b+6*(-g+T)*E.b+(3*g-2*T)*C.b,f.a=6*(g-T)*v.a+(3*g-4*T+1)*b.a+6*(-g+T)*E.a+(3*g-2*T)*C.a},m.FromColor3=function(v,b){return b===void 0&&(b=1),new m(v.r,v.g,v.b,b)},m.FromArray=function(v,b){return b===void 0&&(b=0),new m(v[b],v[b+1],v[b+2],v[b+3])},m.FromArrayToRef=function(v,b,E){b===void 0&&(b=0),E.r=v[b],E.g=v[b+1],E.b=v[b+2],E.a=v[b+3]},m.FromInts=function(v,b,E,C){return new m(v/255,b/255,E/255,C/255)},m.CheckColors4=function(v,b){if(v.length===3*b){for(var E=[],C=0;C<v.length;C+=3){var T=C/3*4;E[T]=v[C],E[T+1]=v[C+1],E[T+2]=v[C+2],E[T+3]=1}return E}return v},m}();Object.defineProperties(h.prototype,{dimension:{value:[4]},rank:{value:1}});var p=function(){function m(){}return m.Color3=(0,n.mI)(3,d.Black),m.Color4=(0,n.mI)(3,function(){return new h(0,0,0,0)}),m}();(0,i.Y5)("BABYLON.Color3",d),(0,i.Y5)("BABYLON.Color4",h)},56740:(r,t,e)=>{e.d(t,{a6:()=>o,bH:()=>a,rv:()=>n,tk:()=>i});var n=1/2.2,i=2.2,o=(1+Math.sqrt(5))/2,a=.001},36359:(r,t,e)=>{e.d(t,{P:()=>i});var n=e(43939),i=function(){function o(){}return o.GetPlanes=function(a){for(var s=[],l=0;l<6;l++)s.push(new n.Z(0,0,0,0));return o.GetPlanesToRef(a,s),s},o.GetNearPlaneToRef=function(a,s){var l=a.m;s.normal.x=l[3]+l[2],s.normal.y=l[7]+l[6],s.normal.z=l[11]+l[10],s.d=l[15]+l[14],s.normalize()},o.GetFarPlaneToRef=function(a,s){var l=a.m;s.normal.x=l[3]-l[2],s.normal.y=l[7]-l[6],s.normal.z=l[11]-l[10],s.d=l[15]-l[14],s.normalize()},o.GetLeftPlaneToRef=function(a,s){var l=a.m;s.normal.x=l[3]+l[0],s.normal.y=l[7]+l[4],s.normal.z=l[11]+l[8],s.d=l[15]+l[12],s.normalize()},o.GetRightPlaneToRef=function(a,s){var l=a.m;s.normal.x=l[3]-l[0],s.normal.y=l[7]-l[4],s.normal.z=l[11]-l[8],s.d=l[15]-l[12],s.normalize()},o.GetTopPlaneToRef=function(a,s){var l=a.m;s.normal.x=l[3]-l[1],s.normal.y=l[7]-l[5],s.normal.z=l[11]-l[9],s.d=l[15]-l[13],s.normalize()},o.GetBottomPlaneToRef=function(a,s){var l=a.m;s.normal.x=l[3]+l[1],s.normal.y=l[7]+l[5],s.normal.z=l[11]+l[9],s.d=l[15]+l[13],s.normalize()},o.GetPlanesToRef=function(a,s){o.GetNearPlaneToRef(a,s[0]),o.GetFarPlaneToRef(a,s[1]),o.GetLeftPlaneToRef(a,s[2]),o.GetRightPlaneToRef(a,s[3]),o.GetTopPlaneToRef(a,s[4]),o.GetBottomPlaneToRef(a,s[5])},o.IsPointInFrustum=function(a,s){for(var l=0;l<6;l++)if(s[l].dotCoordinate(a)<0)return!1;return!0},o}()},47424:(r,t,e)=>{e.d(t,{b:()=>l,c:()=>s});var n=e(78322),i=e(8046),o=e(6174),a=function(){function c(){}return c.extractMinAndMaxIndexed=function(u,d,h,p,m,v){for(var b=h;b<h+p;b++){var E=3*d[b],C=u[E],T=u[E+1],f=u[E+2];m.minimizeInPlaceFromFloats(C,T,f),v.maximizeInPlaceFromFloats(C,T,f)}},c.extractMinAndMax=function(u,d,h,p,m,v){for(var b=d,E=d*p;b<d+h;b++,E+=p){var C=u[E],T=u[E+1],f=u[E+2];m.minimizeInPlaceFromFloats(C,T,f),v.maximizeInPlaceFromFloats(C,T,f)}},(0,n.Cg)([o.Cx.filter(function(){for(var u=[],d=0;d<arguments.length;d++)u[d]=arguments[d];var h=u[0],p=u[1];return!Array.isArray(h)&&!Array.isArray(p)})],c,"extractMinAndMaxIndexed",null),(0,n.Cg)([o.Cx.filter(function(){for(var u=[],d=0;d<arguments.length;d++)u[d]=arguments[d];var h=u[0];return!Array.isArray(h)})],c,"extractMinAndMax",null),c}();function s(c,u,d,h,p){p===void 0&&(p=null);var m=new i.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),v=new i.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return a.extractMinAndMaxIndexed(c,u,d,h,m,v),p&&(m.x-=m.x*p.x+p.y,m.y-=m.y*p.x+p.y,m.z-=m.z*p.x+p.y,v.x+=v.x*p.x+p.y,v.y+=v.y*p.x+p.y,v.z+=v.z*p.x+p.y),{minimum:m,maximum:v}}function l(c,u,d,h,p){h===void 0&&(h=null);var m=new i.Pq(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),v=new i.Pq(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return p||(p=3),a.extractMinAndMax(c,u,d,p,m,v),h&&(m.x-=m.x*h.x+h.y,m.y-=m.y*h.x+h.y,m.z-=m.z*h.x+h.y,v.x+=v.x*h.x+h.y,v.y+=v.y*h.x+h.y,v.z+=v.z*h.x+h.y),{minimum:m,maximum:v}}},95318:(r,t,e)=>{e.d(t,{Cu:()=>u,Xy:()=>c,jj:()=>h,t4:()=>n,tO:()=>d,uM:()=>l,vr:()=>s});var n,i=e(48810),o=e(8046),a=e(56740);(function(p){p[p.CW=0]="CW",p[p.CCW=1]="CCW"})(n||(n={}));var s=function(){function p(){}return p.Interpolate=function(m,v,b,E,C){for(var T=1-3*E+3*v,f=3*E-6*v,g=3*v,S=m,y=0;y<5;y++){var x=S*S;S-=1/(3*T*x+2*f*S+g)*(T*(x*S)+f*x+g*S-m),S=Math.min(1,Math.max(0,S))}return 3*Math.pow(1-S,2)*S*b+3*(1-S)*Math.pow(S,2)*C+Math.pow(S,3)},p}(),l=function(){function p(m){this._radians=m,this._radians<0&&(this._radians+=2*Math.PI)}return p.prototype.degrees=function(){return 180*this._radians/Math.PI},p.prototype.radians=function(){return this._radians},p.BetweenTwoPoints=function(m,v){var b=v.subtract(m);return new p(Math.atan2(b.y,b.x))},p.BetweenTwoVectors=function(m,v){var b=m.lengthSquared()*v.lengthSquared();if(b===0)return new p(Math.PI/2);b=Math.sqrt(b);var E=m.dot(v)/b;return E=(0,i.Clamp)(E,-1,1),new p(Math.acos(E))},p.FromRadians=function(m){return new p(m)},p.FromDegrees=function(m){return new p(m*Math.PI/180)},p}(),c=function(p,m,v){this.startPoint=p,this.midPoint=m,this.endPoint=v;var b=Math.pow(m.x,2)+Math.pow(m.y,2),E=(Math.pow(p.x,2)+Math.pow(p.y,2)-b)/2,C=(b-Math.pow(v.x,2)-Math.pow(v.y,2))/2,T=(p.x-m.x)*(m.y-v.y)-(m.x-v.x)*(p.y-m.y);this.centerPoint=new o.I9((E*(m.y-v.y)-C*(p.y-m.y))/T,((p.x-m.x)*C-(m.x-v.x)*E)/T),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=l.BetweenTwoPoints(this.centerPoint,this.startPoint);var f=this.startAngle.degrees(),g=l.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),S=l.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();g-f>180&&(g-=360),g-f<-180&&(g+=360),S-g>180&&(S-=360),S-g<-180&&(S+=360),this.orientation=g-f<0?0:1,this.angle=l.FromDegrees(this.orientation===0?f-S:S-f)},u=function(){function p(m,v){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new o.I9(m,v))}return p.prototype.addLineTo=function(m,v){if(this.closed)return this;var b=new o.I9(m,v),E=this._points[this._points.length-1];return this._points.push(b),this._length+=b.subtract(E).length(),this},p.prototype.addArcTo=function(m,v,b,E,C){if(C===void 0&&(C=36),this.closed)return this;var T=this._points[this._points.length-1],f=new o.I9(m,v),g=new o.I9(b,E),S=new c(T,f,g),y=S.angle.radians()/C;S.orientation===0&&(y*=-1);for(var x=S.startAngle.radians()+y,R=0;R<C;R++){var I=Math.cos(x)*S.radius+S.centerPoint.x,M=Math.sin(x)*S.radius+S.centerPoint.y;this.addLineTo(I,M),x+=y}return this},p.prototype.addQuadraticCurveTo=function(m,v,b,E,C){if(C===void 0&&(C=36),this.closed)return this;for(var T=function(R,I,M,D){return(1-R)*(1-R)*I+2*R*(1-R)*M+R*R*D},f=this._points[this._points.length-1],g=0;g<=C;g++){var S=g/C,y=T(S,f.x,m,b),x=T(S,f.y,v,E);this.addLineTo(y,x)}return this},p.prototype.addBezierCurveTo=function(m,v,b,E,C,T,f){if(f===void 0&&(f=36),this.closed)return this;for(var g=function(M,D,B,F,X){return(1-M)*(1-M)*(1-M)*D+3*M*(1-M)*(1-M)*B+3*M*M*(1-M)*F+M*M*M*X},S=this._points[this._points.length-1],y=0;y<=f;y++){var x=y/f,R=g(x,S.x,m,b,C),I=g(x,S.y,v,E,T);this.addLineTo(R,I)}return this},p.prototype.isPointInside=function(m){for(var v=!1,b=this._points.length,E=b-1,C=0;C<b;E=C++){var T=this._points[E],f=this._points[C],g=f.x-T.x,S=f.y-T.y;if(Math.abs(S)>Number.EPSILON){if(S<0&&(T=this._points[C],g=-g,f=this._points[E],S=-S),m.y<T.y||m.y>f.y)continue;if(m.y===T.y&&m.x===T.x)return!0;var y=S*(m.x-T.x)-g*(m.y-T.y);if(y===0)return!0;if(y<0)continue;v=!v}else{if(m.y!==T.y)continue;if(f.x<=m.x&&m.x<=T.x||T.x<=m.x&&m.x<=f.x)return!0}}return v},p.prototype.close=function(){return this.closed=!0,this},p.prototype.length=function(){var m=this._length;if(this.closed){var v=this._points[this._points.length-1];m+=this._points[0].subtract(v).length()}return m},p.prototype.area=function(){for(var m=this._points.length,v=0,b=m-1,E=0;E<m;b=E++)v+=this._points[b].x*this._points[E].y-this._points[E].x*this._points[b].y;return .5*v},p.prototype.getPoints=function(){return this._points},p.prototype.getPointAtLengthPosition=function(m){if(m<0||m>1)return o.I9.Zero();for(var v=m*this.length(),b=0,E=0;E<this._points.length;E++){var C=(E+1)%this._points.length,T=this._points[E],f=this._points[C].subtract(T),g=f.length()+b;if(v>=b&&v<=g){var S=f.normalize(),y=v-b;return new o.I9(T.x+S.x*y,T.y+S.y*y)}b=g}return o.I9.Zero()},p.StartingAt=function(m,v){return new p(m,v)},p}(),d=function(){function p(m,v,b,E){v===void 0&&(v=null),E===void 0&&(E=!1),this.path=m,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:o.Pq.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:o.uq.Identity()};for(var C=0;C<m.length;C++)this._curve[C]=m[C].clone();this._raw=b||!1,this._alignTangentsWithPath=E,this._compute(v,E)}return p.prototype.getCurve=function(){return this._curve},p.prototype.getPoints=function(){return this._curve},p.prototype.length=function(){return this._distances[this._distances.length-1]},p.prototype.getTangents=function(){return this._tangents},p.prototype.getNormals=function(){return this._normals},p.prototype.getBinormals=function(){return this._binormals},p.prototype.getDistances=function(){return this._distances},p.prototype.getPointAt=function(m){return this._updatePointAtData(m).point},p.prototype.getTangentAt=function(m,v){return v===void 0&&(v=!1),this._updatePointAtData(m,v),v?o.Pq.TransformCoordinates(o.Pq.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]},p.prototype.getNormalAt=function(m,v){return v===void 0&&(v=!1),this._updatePointAtData(m,v),v?o.Pq.TransformCoordinates(o.Pq.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]},p.prototype.getBinormalAt=function(m,v){return v===void 0&&(v=!1),this._updatePointAtData(m,v),v?o.Pq.TransformCoordinates(o.Pq.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]},p.prototype.getDistanceAt=function(m){return this.length()*m},p.prototype.getPreviousPointIndexAt=function(m){return this._updatePointAtData(m),this._pointAtData.previousPointArrayIndex},p.prototype.getSubPositionAt=function(m){return this._updatePointAtData(m),this._pointAtData.subPosition},p.prototype.getClosestPositionTo=function(m){for(var v=Number.MAX_VALUE,b=0,E=0;E<this._curve.length-1;E++){var C=this._curve[E+0],T=this._curve[E+1].subtract(C).normalize(),f=this._distances[E+1]-this._distances[E+0],g=Math.min(Math.max(o.Pq.Dot(T,m.subtract(C).normalize()),0)*o.Pq.Distance(C,m)/f,1),S=o.Pq.Distance(C.add(T.scale(g*f)),m);S<v&&(v=S,b=(this._distances[E+0]+f*g)/this.length())}return b},p.prototype.slice=function(m,v){if(m===void 0&&(m=0),v===void 0&&(v=1),m<0&&(m=1- -1*m%1),v<0&&(v=1- -1*v%1),m>v){var b=m;m=v,v=b}var E=this.getCurve(),C=this.getPointAt(m),T=this.getPreviousPointIndexAt(m),f=this.getPointAt(v),g=this.getPreviousPointIndexAt(v)+1,S=[];return m!==0&&(T++,S.push(C)),S.push.apply(S,E.slice(T,g)),v===1&&m!==1||S.push(f),new p(S,this.getNormalAt(m),this._raw,this._alignTangentsWithPath)},p.prototype.update=function(m,v,b){v===void 0&&(v=null),b===void 0&&(b=!1);for(var E=0;E<m.length;E++)this._curve[E].x=m[E].x,this._curve[E].y=m[E].y,this._curve[E].z=m[E].z;return this._compute(v,b),this},p.prototype._compute=function(m,v){v===void 0&&(v=!1);var b=this._curve.length;if(!(b<2)){this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[b-1]=this._curve[b-1].subtract(this._curve[b-2]),this._raw||this._tangents[b-1].normalize();var E,C,T,f,g,S=this._tangents[0],y=this._normalVector(S,m);this._normals[0]=y,this._raw||this._normals[0].normalize(),this._binormals[0]=o.Pq.Cross(S,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var x=1;x<b;x++)E=this._getLastNonNullVector(x),x<b-1&&(C=this._getFirstNonNullVector(x),this._tangents[x]=v?C:E.add(C),this._tangents[x].normalize()),this._distances[x]=this._distances[x-1]+this._curve[x].subtract(this._curve[x-1]).length(),T=this._tangents[x],g=this._binormals[x-1],this._normals[x]=o.Pq.Cross(g,T),this._raw||(this._normals[x].length()===0?(f=this._normals[x-1],this._normals[x]=f.clone()):this._normals[x].normalize()),this._binormals[x]=o.Pq.Cross(T,this._normals[x]),this._raw||this._binormals[x].normalize();this._pointAtData.id=NaN}},p.prototype._getFirstNonNullVector=function(m){for(var v=1,b=this._curve[m+v].subtract(this._curve[m]);b.length()===0&&m+v+1<this._curve.length;)v++,b=this._curve[m+v].subtract(this._curve[m]);return b},p.prototype._getLastNonNullVector=function(m){for(var v=1,b=this._curve[m].subtract(this._curve[m-v]);b.length()===0&&m>v+1;)v++,b=this._curve[m].subtract(this._curve[m-v]);return b},p.prototype._normalVector=function(m,v){var b,E=m.length();if(E===0&&(E=1),v==null){var C;C=(0,i.WithinEpsilon)(Math.abs(m.y)/E,1,a.bH)?(0,i.WithinEpsilon)(Math.abs(m.x)/E,1,a.bH)?(0,i.WithinEpsilon)(Math.abs(m.z)/E,1,a.bH)?o.Pq.Zero():new o.Pq(0,0,1):new o.Pq(1,0,0):new o.Pq(0,-1,0),b=o.Pq.Cross(m,C)}else b=o.Pq.Cross(m,v),o.Pq.CrossToRef(b,m,b);return b.normalize(),b},p.prototype._updatePointAtData=function(m,v){if(v===void 0&&(v=!1),this._pointAtData.id===m)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=m;var b=this.getPoints();if(m<=0)return this._setPointAtData(0,0,b[0],0,v);if(m>=1)return this._setPointAtData(1,1,b[b.length-1],b.length-1,v);for(var E,C=b[0],T=0,f=m*this.length(),g=1;g<b.length;g++){E=b[g];var S=o.Pq.Distance(C,E);if((T+=S)===f)return this._setPointAtData(m,1,E,g,v);if(T>f){var y=(T-f)/S,x=C.subtract(E),R=E.add(x.scaleInPlace(y));return this._setPointAtData(m,1-y,R,g-1,v)}C=E}return this._pointAtData},p.prototype._setPointAtData=function(m,v,b,E,C){return this._pointAtData.point=b,this._pointAtData.position=m,this._pointAtData.subPosition=v,this._pointAtData.previousPointArrayIndex=E,this._pointAtData.interpolateReady=C,C&&this._updateInterpolationMatrix(),this._pointAtData},p.prototype._updateInterpolationMatrix=function(){this._pointAtData.interpolationMatrix=o.uq.Identity();var m=this._pointAtData.previousPointArrayIndex;if(m!==this._tangents.length-1){var v=m+1,b=this._tangents[m].clone(),E=this._normals[m].clone(),C=this._binormals[m].clone(),T=this._tangents[v].clone(),f=this._normals[v].clone(),g=this._binormals[v].clone(),S=o.PT.RotationQuaternionFromAxis(E,C,b),y=o.PT.RotationQuaternionFromAxis(f,g,T);o.PT.Slerp(S,y,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}},p}(),h=function(){function p(m){this._length=0,this._points=m,this._length=this._computeLength(m)}return p.CreateQuadraticBezier=function(m,v,b,E){E=E>2?E:3;for(var C=[],T=function(g,S,y,x){return(1-g)*(1-g)*S+2*g*(1-g)*y+g*g*x},f=0;f<=E;f++)C.push(new o.Pq(T(f/E,m.x,v.x,b.x),T(f/E,m.y,v.y,b.y),T(f/E,m.z,v.z,b.z)));return new p(C)},p.CreateCubicBezier=function(m,v,b,E,C){C=C>3?C:4;for(var T=[],f=function(S,y,x,R,I){return(1-S)*(1-S)*(1-S)*y+3*S*(1-S)*(1-S)*x+3*S*S*(1-S)*R+S*S*S*I},g=0;g<=C;g++)T.push(new o.Pq(f(g/C,m.x,v.x,b.x,E.x),f(g/C,m.y,v.y,b.y,E.y),f(g/C,m.z,v.z,b.z,E.z)));return new p(T)},p.CreateHermiteSpline=function(m,v,b,E,C){for(var T=[],f=1/C,g=0;g<=C;g++)T.push(o.Pq.Hermite(m,v,b,E,g*f));return new p(T)},p.CreateCatmullRomSpline=function(m,v,b){var E=[],C=1/v,T=0;if(b){for(var f=m.length,g=0;g<f;g++){T=0;for(var S=0;S<v;S++)E.push(o.Pq.CatmullRom(m[g%f],m[(g+1)%f],m[(g+2)%f],m[(g+3)%f],T)),T+=C}E.push(E[0])}else{var y=[];for(y.push(m[0].clone()),Array.prototype.push.apply(y,m),y.push(m[m.length-1].clone()),g=0;g<y.length-3;g++)for(T=0,S=0;S<v;S++)E.push(o.Pq.CatmullRom(y[g],y[g+1],y[g+2],y[g+3],T)),T+=C;g--,E.push(o.Pq.CatmullRom(y[g],y[g+1],y[g+2],y[g+3],T))}return new p(E)},p.ArcThru3Points=function(m,v,b,E,C,T){E===void 0&&(E=32),C===void 0&&(C=!1),T===void 0&&(T=!1);var f=[],g=v.subtract(m),S=b.subtract(v),y=m.subtract(b),x=o.Pq.Cross(g,S),R=x.length();if(R<Math.pow(10,-8))return new p(f);var I=g.lengthSquared(),M=S.lengthSquared(),D=y.lengthSquared(),B=x.lengthSquared(),F=.5*g.length()*S.length()*y.length()/R,X=-.5*M*o.Pq.Dot(g,y)/B,$=-.5*D*o.Pq.Dot(g,S)/B,Q=-.5*I*o.Pq.Dot(S,y)/B,ie=m.scale(X).add(v.scale($)).add(b.scale(Q)),q=m.subtract(ie).normalize(),ee=o.Pq.Cross(x,q).normalize();if(T){for(var te=2*Math.PI/E,ce=0;ce<=2*Math.PI;ce+=te)f.push(ie.add(q.scale(F*Math.cos(ce)).add(ee.scale(F*Math.sin(ce)))));f.push(m)}else{te=1/E,ce=0;var fe=o.Pq.Zero();do fe=ie.add(q.scale(F*Math.cos(ce)).add(ee.scale(F*Math.sin(ce)))),f.push(fe),ce+=te;while(!fe.equalsWithEpsilon(b,F*te*1.1));f.push(b),C&&f.push(m)}return new p(f)},p.prototype.getPoints=function(){return this._points},p.prototype.length=function(){return this._length},p.prototype.continue=function(m){for(var v=this._points[this._points.length-1],b=this._points.slice(),E=m.getPoints(),C=1;C<E.length;C++)b.push(E[C].subtract(E[0]).add(v));return new p(b)},p.prototype._computeLength=function(m){for(var v=0,b=1;b<m.length;b++)v+=m[b].subtract(m[b-1]).length();return v},p}()},43939:(r,t,e)=>{e.d(t,{Z:()=>i});var n=e(8046),i=function(){function o(a,s,l,c){this.normal=new n.Pq(a,s,l),this.d=c}return o.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},o.prototype.clone=function(){return new o(this.normal.x,this.normal.y,this.normal.z,this.d)},o.prototype.getClassName=function(){return"Plane"},o.prototype.getHashCode=function(){var a=this.normal.getHashCode();return 397*a^this.d},o.prototype.normalize=function(){var a=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),s=0;return a!==0&&(s=1/a),this.normal.x*=s,this.normal.y*=s,this.normal.z*=s,this.d*=s,this},o.prototype.transform=function(a){var s=o._TmpMatrix;a.invertToRef(s);var l=s.m,c=this.normal.x,u=this.normal.y,d=this.normal.z,h=this.d;return new o(c*l[0]+u*l[1]+d*l[2]+h*l[3],c*l[4]+u*l[5]+d*l[6]+h*l[7],c*l[8]+u*l[9]+d*l[10]+h*l[11],c*l[12]+u*l[13]+d*l[14]+h*l[15])},o.prototype.dotCoordinate=function(a){return this.normal.x*a.x+this.normal.y*a.y+this.normal.z*a.z+this.d},o.prototype.copyFromPoints=function(a,s,l){var c,u=s.x-a.x,d=s.y-a.y,h=s.z-a.z,p=l.x-a.x,m=l.y-a.y,v=l.z-a.z,b=d*v-h*m,E=h*p-u*v,C=u*m-d*p,T=Math.sqrt(b*b+E*E+C*C);return c=T!==0?1/T:0,this.normal.x=b*c,this.normal.y=E*c,this.normal.z=C*c,this.d=-(this.normal.x*a.x+this.normal.y*a.y+this.normal.z*a.z),this},o.prototype.isFrontFacingTo=function(a,s){return n.Pq.Dot(this.normal,a)<=s},o.prototype.signedDistanceTo=function(a){return n.Pq.Dot(a,this.normal)+this.d},o.FromArray=function(a){return new o(a[0],a[1],a[2],a[3])},o.FromPoints=function(a,s,l){var c=new o(0,0,0,0);return c.copyFromPoints(a,s,l),c},o.FromPositionAndNormal=function(a,s){var l=new o(0,0,0,0);return this.FromPositionAndNormalToRef(a,s,l)},o.FromPositionAndNormalToRef=function(a,s,l){return l.normal.copyFrom(s),l.normal.normalize(),l.d=-a.dot(l.normal),l},o.SignedDistanceToPlaneFromPositionAndNormal=function(a,s,l){var c=-(s.x*a.x+s.y*a.y+s.z*a.z);return n.Pq.Dot(l,s)+c},o._TmpMatrix=n.uq.Identity(),o}()},48810:(r,t,e)=>{function n(I){return parseInt(I.toString().replace(/\W/g,""))}function i(I,M,D){return D===void 0&&(D=1401298e-51),Math.abs(I-M)<=D}function o(I,M){return I===M?I:Math.random()*(M-I)+I}function a(I,M,D){return I+(M-I)*D}function s(I,M,D){var B=v(M-I,360);return B>180&&(B-=360),I+B*d(D)}function l(I,M,D){return I!=M?d((D-I)/(M-I)):0}function c(I,M,D,B,F){var X=F*F,$=F*X;return I*(2*$-3*X+1)+D*(-2*$+3*X)+M*($-2*X+F)+B*($-X)}function u(I,M,D,B,F){var X=F*F;return 6*(X-F)*I+(3*X-4*F+1)*M+6*(-X+F)*D+(3*X-2*F)*B}function d(I,M,D){return M===void 0&&(M=0),D===void 0&&(D=1),Math.min(D,Math.max(M,I))}function h(I){return I-2*Math.PI*Math.floor((I+Math.PI)/(2*Math.PI))}function p(I){var M=I.toString(16);return I<=15?("0"+M).toUpperCase():M.toUpperCase()}function m(I){if(Math.log2)return Math.floor(Math.log2(I));if(I<0)return NaN;if(I===0)return-1/0;var M=0;if(I<1){for(;I<1;)M++,I*=2;M=-M}else if(I>1)for(;I>1;)M++,I=Math.floor(I/2);return M}function v(I,M){return I-Math.floor(I/M)*M}function b(I,M,D){return(I-M)/(D-M)}function E(I,M,D){return I*(D-M)+M}function C(I,M){var D=v(M-I,360);return D>180&&(D-=360),D}function T(I,M){var D=v(I,2*M);return M-Math.abs(D-M)}function f(I,M,D){var B=d(D);return M*(B=-2*B*B*B+3*B*B)+I*(1-B)}function g(I,M,D){return Math.abs(M-I)<=D?M:I+Math.sign(M-I)*D}function S(I,M,D){var B=C(I,M);return-D<B&&B<D?M:g(I,M=I+B,D)}function y(I,M,D){return(I-M)/(D-M)}function x(I,M,D){return(D-M)*I+M}function R(I,M){var D=I%M;return D===0?M:R(M,D)}e.r(t),e.d(t,{Clamp:()=>d,DeltaAngle:()=>C,Denormalize:()=>E,ExtractAsInt:()=>n,Hermite:()=>c,Hermite1stDerivative:()=>u,HighestCommonFactor:()=>R,ILog2:()=>m,InverseLerp:()=>l,Lerp:()=>a,LerpAngle:()=>s,MoveTowards:()=>g,MoveTowardsAngle:()=>S,Normalize:()=>b,NormalizeRadians:()=>h,PercentToRange:()=>x,PingPong:()=>T,RandomRange:()=>o,RangeToPercent:()=>y,Repeat:()=>v,SmoothStep:()=>f,ToHex:()=>p,WithinEpsilon:()=>i})},73152:(r,t,e)=>{e.d(t,{o:()=>n});var n=function(){function i(o,a){this.width=o,this.height=a}return i.prototype.toString=function(){return"{W: ".concat(this.width,", H: ").concat(this.height,"}")},i.prototype.getClassName=function(){return"Size"},i.prototype.getHashCode=function(){var o=0|this.width;return 397*o^this.height},i.prototype.copyFrom=function(o){this.width=o.width,this.height=o.height},i.prototype.copyFromFloats=function(o,a){return this.width=o,this.height=a,this},i.prototype.set=function(o,a){return this.copyFromFloats(o,a)},i.prototype.multiplyByFloats=function(o,a){return new i(this.width*o,this.height*a)},i.prototype.clone=function(){return new i(this.width,this.height)},i.prototype.equals=function(o){return!!o&&this.width===o.width&&this.height===o.height},Object.defineProperty(i.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),i.Zero=function(){return new i(0,0)},i.prototype.add=function(o){return new i(this.width+o.width,this.height+o.height)},i.prototype.subtract=function(o){return new i(this.width-o.width,this.height-o.height)},i.prototype.scale=function(o){return new i(this.width*o,this.height*o)},i.Lerp=function(o,a,s){return new i(o.width+(a.width-o.width)*s,o.height+(a.height-o.height)*s)},i}()},51322:(r,t,e)=>{e.d(t,{uM:()=>s.uM,Xy:()=>s.Xy,_0:()=>n._0,vr:()=>s.vr,v9:()=>i.v9,ov:()=>i.ov,xp:()=>n.xp,jj:()=>s.jj,bH:()=>o.bH,PP:()=>a.P,uq:()=>u.uq,t4:()=>s.t4,a6:()=>o.a6,Cu:()=>s.Cu,tO:()=>s.tO,Zc:()=>l.Z,k0:()=>h,B5:()=>d,PT:()=>u.PT,or:()=>c.o,$x:()=>n.$x,IG:()=>i.IG,AA:()=>u.AA,rv:()=>o.rv,tk:()=>o.tk,I9:()=>u.I9,Pq:()=>u.Pq,IU:()=>u.IU,LM:()=>p.L});var n=e(13424),i=e(64726),o=e(56740),a=e(36359),s=e(95318),l=e(43939),c=e(73152),u=e(8046),d=function(){function m(v,b){v===void 0&&(v=u.Pq.Zero()),b===void 0&&(b=u.Pq.Up()),this.position=v,this.normal=b}return m.prototype.clone=function(){return new m(this.position.clone(),this.normal.clone())},m}(),h=function(){function m(v,b,E){v===void 0&&(v=u.Pq.Zero()),b===void 0&&(b=u.Pq.Up()),E===void 0&&(E=u.I9.Zero()),this.position=v,this.normal=b,this.uv=E}return m.prototype.clone=function(){return new m(this.position.clone(),this.normal.clone(),this.uv.clone())},m}(),p=e(25187)},8046:(r,t,e)=>{e.d(t,{AA:()=>E,I9:()=>d,IU:()=>p,PT:()=>m,Pq:()=>h,uq:()=>v});var n=e(78322),i=e(56740),o=e(11296),a=e(34623),s=e(16106),l=e(66614),c=e(48810),u=function(T){return parseInt(T.toString().replace(/\W/g,""))},d=function(){function T(f,g){f===void 0&&(f=0),g===void 0&&(g=0),this.x=f,this.y=g}return T.prototype.toString=function(){return"{X: ".concat(this.x," Y: ").concat(this.y,"}")},T.prototype.getClassName=function(){return"Vector2"},T.prototype.getHashCode=function(){var f=u(this.x);return 397*f^u(this.y)},T.prototype.toArray=function(f,g){return g===void 0&&(g=0),f[g]=this.x,f[g+1]=this.y,this},T.prototype.fromArray=function(f,g){return g===void 0&&(g=0),T.FromArrayToRef(f,g,this),this},T.prototype.asArray=function(){return[this.x,this.y]},T.prototype.copyFrom=function(f){return this.x=f.x,this.y=f.y,this},T.prototype.copyFromFloats=function(f,g){return this.x=f,this.y=g,this},T.prototype.set=function(f,g){return this.copyFromFloats(f,g)},T.prototype.setAll=function(f){return this.copyFromFloats(f,f)},T.prototype.add=function(f){return new T(this.x+f.x,this.y+f.y)},T.prototype.addToRef=function(f,g){return g.x=this.x+f.x,g.y=this.y+f.y,g},T.prototype.addInPlace=function(f){return this.x+=f.x,this.y+=f.y,this},T.prototype.addInPlaceFromFloats=function(f,g){return this.x+=f,this.y+=g,this},T.prototype.addVector3=function(f){return new T(this.x+f.x,this.y+f.y)},T.prototype.subtract=function(f){return new T(this.x-f.x,this.y-f.y)},T.prototype.subtractToRef=function(f,g){return g.x=this.x-f.x,g.y=this.y-f.y,g},T.prototype.subtractInPlace=function(f){return this.x-=f.x,this.y-=f.y,this},T.prototype.multiplyInPlace=function(f){return this.x*=f.x,this.y*=f.y,this},T.prototype.multiply=function(f){return new T(this.x*f.x,this.y*f.y)},T.prototype.multiplyToRef=function(f,g){return g.x=this.x*f.x,g.y=this.y*f.y,g},T.prototype.multiplyByFloats=function(f,g){return new T(this.x*f,this.y*g)},T.prototype.divide=function(f){return new T(this.x/f.x,this.y/f.y)},T.prototype.divideToRef=function(f,g){return g.x=this.x/f.x,g.y=this.y/f.y,g},T.prototype.divideInPlace=function(f){return this.x=this.x/f.x,this.y=this.y/f.y,this},T.prototype.minimizeInPlace=function(f){return this.minimizeInPlaceFromFloats(f.x,f.y)},T.prototype.maximizeInPlace=function(f){return this.maximizeInPlaceFromFloats(f.x,f.y)},T.prototype.minimizeInPlaceFromFloats=function(f,g){return this.x=Math.min(f,this.x),this.y=Math.min(g,this.y),this},T.prototype.maximizeInPlaceFromFloats=function(f,g){return this.x=Math.max(f,this.x),this.y=Math.max(g,this.y),this},T.prototype.subtractFromFloats=function(f,g){return new T(this.x-f,this.y-g)},T.prototype.subtractFromFloatsToRef=function(f,g,S){return S.x=this.x-f,S.y=this.y-g,S},T.prototype.negate=function(){return new T(-this.x,-this.y)},T.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},T.prototype.negateToRef=function(f){return f.x=-this.x,f.y=-this.y,f},T.prototype.scaleInPlace=function(f){return this.x*=f,this.y*=f,this},T.prototype.scale=function(f){return new T(this.x*f,this.y*f)},T.prototype.scaleToRef=function(f,g){return g.x=this.x*f,g.y=this.y*f,g},T.prototype.scaleAndAddToRef=function(f,g){return g.x+=this.x*f,g.y+=this.y*f,g},T.prototype.equals=function(f){return f&&this.x===f.x&&this.y===f.y},T.prototype.equalsWithEpsilon=function(f,g){return g===void 0&&(g=i.bH),f&&(0,c.WithinEpsilon)(this.x,f.x,g)&&(0,c.WithinEpsilon)(this.y,f.y,g)},T.prototype.equalsToFloats=function(f,g){return this.x===f&&this.y===g},T.prototype.floor=function(){return new T(Math.floor(this.x),Math.floor(this.y))},T.prototype.floorToRef=function(f){return f.x=Math.floor(this.x),f.y=Math.floor(this.y),f},T.prototype.fract=function(){return new T(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},T.prototype.fractToRef=function(f){return f.x=this.x-Math.floor(this.x),f.y=this.y-Math.floor(this.y),f},T.prototype.rotateToRef=function(f,g){var S=Math.cos(f),y=Math.sin(f),x=S*this.x-y*this.y,R=y*this.x+S*this.y;return g.x=x,g.y=R,g},T.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},T.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},T.prototype.normalize=function(){return this.normalizeFromLength(this.length())},T.prototype.normalizeFromLength=function(f){return f===0||f===1?this:this.scaleInPlace(1/f)},T.prototype.normalizeToNew=function(){var f=new T;return this.normalizeToRef(f),f},T.prototype.normalizeToRef=function(f){var g=this.length();return g===0&&(f.x=this.x,f.y=this.y),this.scaleToRef(1/g,f)},T.prototype.clone=function(){return new T(this.x,this.y)},T.prototype.dot=function(f){return this.x*f.x+this.y*f.y},T.Zero=function(){return new T(0,0)},T.One=function(){return new T(1,1)},T.Random=function(f,g){return f===void 0&&(f=0),g===void 0&&(g=1),new T((0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g))},T.RandomToRef=function(f,g,S){return f===void 0&&(f=0),g===void 0&&(g=1),S.copyFromFloats((0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g))},Object.defineProperty(T,"ZeroReadOnly",{get:function(){return T._ZeroReadOnly},enumerable:!1,configurable:!0}),T.FromArray=function(f,g){return g===void 0&&(g=0),new T(f[g],f[g+1])},T.FromArrayToRef=function(f,g,S){return S.x=f[g],S.y=f[g+1],S},T.FromFloatsToRef=function(f,g,S){return S.copyFromFloats(f,g),S},T.CatmullRom=function(f,g,S,y,x){var R=x*x,I=x*R;return new T(.5*(2*g.x+(-f.x+S.x)*x+(2*f.x-5*g.x+4*S.x-y.x)*R+(-f.x+3*g.x-3*S.x+y.x)*I),.5*(2*g.y+(-f.y+S.y)*x+(2*f.y-5*g.y+4*S.y-y.y)*R+(-f.y+3*g.y-3*S.y+y.y)*I))},T.ClampToRef=function(f,g,S,y){return y.x=(0,c.Clamp)(f.x,g.x,S.x),y.y=(0,c.Clamp)(f.y,g.y,S.y),y},T.Clamp=function(f,g,S){return new T((0,c.Clamp)(f.x,g.x,S.x),(0,c.Clamp)(f.y,g.y,S.y))},T.Hermite=function(f,g,S,y,x){var R=x*x,I=x*R,M=2*I-3*R+1,D=-2*I+3*R,B=I-2*R+x,F=I-R;return new T(f.x*M+S.x*D+g.x*B+y.x*F,f.y*M+S.y*D+g.y*B+y.y*F)},T.Hermite1stDerivative=function(f,g,S,y,x){return this.Hermite1stDerivativeToRef(f,g,S,y,x,new T)},T.Hermite1stDerivativeToRef=function(f,g,S,y,x,R){var I=x*x;return R.x=6*(I-x)*f.x+(3*I-4*x+1)*g.x+6*(-I+x)*S.x+(3*I-2*x)*y.x,R.y=6*(I-x)*f.y+(3*I-4*x+1)*g.y+6*(-I+x)*S.y+(3*I-2*x)*y.y,R},T.Lerp=function(f,g,S){return T.LerpToRef(f,g,S,new T)},T.LerpToRef=function(f,g,S,y){return y.x=f.x+(g.x-f.x)*S,y.y=f.y+(g.y-f.y)*S,y},T.Dot=function(f,g){return f.x*g.x+f.y*g.y},T.Normalize=function(f){return T.NormalizeToRef(f,new T)},T.NormalizeToRef=function(f,g){return f.normalizeToRef(g),g},T.Minimize=function(f,g){return new T(f.x<g.x?f.x:g.x,f.y<g.y?f.y:g.y)},T.Maximize=function(f,g){return new T(f.x>g.x?f.x:g.x,f.y>g.y?f.y:g.y)},T.Transform=function(f,g){return T.TransformToRef(f,g,new T)},T.TransformToRef=function(f,g,S){var y=g.m,x=f.x*y[0]+f.y*y[4]+y[12],R=f.x*y[1]+f.y*y[5]+y[13];return S.x=x,S.y=R,S},T.PointInTriangle=function(f,g,S,y){var x=.5*(-S.y*y.x+g.y*(-S.x+y.x)+g.x*(S.y-y.y)+S.x*y.y),R=x<0?-1:1,I=(g.y*y.x-g.x*y.y+(y.y-g.y)*f.x+(g.x-y.x)*f.y)*R,M=(g.x*S.y-g.y*S.x+(g.y-S.y)*f.x+(S.x-g.x)*f.y)*R;return I>0&&M>0&&I+M<2*x*R},T.Distance=function(f,g){return Math.sqrt(T.DistanceSquared(f,g))},T.DistanceSquared=function(f,g){var S=f.x-g.x,y=f.y-g.y;return S*S+y*y},T.Center=function(f,g){return T.CenterToRef(f,g,new T)},T.CenterToRef=function(f,g,S){return S.copyFromFloats((f.x+g.x)/2,(f.y+g.y)/2)},T.DistanceOfPointFromSegment=function(f,g,S){var y=T.DistanceSquared(g,S);if(y===0)return T.Distance(f,g);var x=S.subtract(g),R=Math.max(0,Math.min(1,T.Dot(f.subtract(g),x)/y)),I=g.add(x.multiplyByFloats(R,R));return T.Distance(f,I)},T._ZeroReadOnly=T.Zero(),T}();Object.defineProperties(d.prototype,{dimension:{value:[2]},rank:{value:1}});var h=function(){function T(f,g,S){f===void 0&&(f=0),g===void 0&&(g=0),S===void 0&&(S=0),this._isDirty=!0,this._x=f,this._y=g,this._z=S}return Object.defineProperty(T.prototype,"x",{get:function(){return this._x},set:function(f){this._x=f,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"y",{get:function(){return this._y},set:function(f){this._y=f,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"z",{get:function(){return this._z},set:function(f){this._z=f,this._isDirty=!0},enumerable:!1,configurable:!0}),T.prototype.toString=function(){return"{X: ".concat(this._x," Y: ").concat(this._y," Z: ").concat(this._z,"}")},T.prototype.getClassName=function(){return"Vector3"},T.prototype.getHashCode=function(){var f=u(this._x);return 397*(f=397*f^u(this._y))^u(this._z)},T.prototype.asArray=function(){return[this._x,this._y,this._z]},T.prototype.toArray=function(f,g){return g===void 0&&(g=0),f[g]=this._x,f[g+1]=this._y,f[g+2]=this._z,this},T.prototype.fromArray=function(f,g){return g===void 0&&(g=0),T.FromArrayToRef(f,g,this),this},T.prototype.toQuaternion=function(){return m.RotationYawPitchRoll(this._y,this._x,this._z)},T.prototype.addInPlace=function(f){return this._x+=f._x,this._y+=f._y,this._z+=f._z,this._isDirty=!0,this},T.prototype.addInPlaceFromFloats=function(f,g,S){return this._x+=f,this._y+=g,this._z+=S,this._isDirty=!0,this},T.prototype.add=function(f){return new T(this._x+f._x,this._y+f._y,this._z+f._z)},T.prototype.addToRef=function(f,g){return g._x=this._x+f._x,g._y=this._y+f._y,g._z=this._z+f._z,g._isDirty=!0,g},T.prototype.subtractInPlace=function(f){return this._x-=f._x,this._y-=f._y,this._z-=f._z,this._isDirty=!0,this},T.prototype.subtract=function(f){return new T(this._x-f._x,this._y-f._y,this._z-f._z)},T.prototype.subtractToRef=function(f,g){return this.subtractFromFloatsToRef(f._x,f._y,f._z,g)},T.prototype.subtractFromFloats=function(f,g,S){return new T(this._x-f,this._y-g,this._z-S)},T.prototype.subtractFromFloatsToRef=function(f,g,S,y){return y._x=this._x-f,y._y=this._y-g,y._z=this._z-S,y._isDirty=!0,y},T.prototype.negate=function(){return new T(-this._x,-this._y,-this._z)},T.prototype.negateInPlace=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this},T.prototype.negateToRef=function(f){return f._x=-1*this._x,f._y=-1*this._y,f._z=-1*this._z,f._isDirty=!0,f},T.prototype.scaleInPlace=function(f){return this._x*=f,this._y*=f,this._z*=f,this._isDirty=!0,this},T.prototype.scale=function(f){return new T(this._x*f,this._y*f,this._z*f)},T.prototype.scaleToRef=function(f,g){return g._x=this._x*f,g._y=this._y*f,g._z=this._z*f,g._isDirty=!0,g},T.prototype.getNormalToRef=function(f){var g=this.length(),S=Math.acos(this.y/g),y=Math.atan2(this.z,this.x);S>Math.PI/2?S-=Math.PI/2:S+=Math.PI/2;var x=g*Math.sin(S)*Math.cos(y),R=g*Math.cos(S),I=g*Math.sin(S)*Math.sin(y);return f.set(x,R,I),f},T.prototype.applyRotationQuaternionToRef=function(f,g){var S=this._x,y=this._y,x=this._z,R=f._x,I=f._y,M=f._z,D=f._w,B=2*(I*x-M*y),F=2*(M*S-R*x),X=2*(R*y-I*S);return g._x=S+D*B+I*X-M*F,g._y=y+D*F+M*B-R*X,g._z=x+D*X+R*F-I*B,g._isDirty=!0,g},T.prototype.applyRotationQuaternionInPlace=function(f){return this.applyRotationQuaternionToRef(f,this)},T.prototype.applyRotationQuaternion=function(f){return this.applyRotationQuaternionToRef(f,new T)},T.prototype.scaleAndAddToRef=function(f,g){return g._x+=this._x*f,g._y+=this._y*f,g._z+=this._z*f,g._isDirty=!0,g},T.prototype.projectOnPlane=function(f,g){return this.projectOnPlaneToRef(f,g,new T)},T.prototype.projectOnPlaneToRef=function(f,g,S){var y=f.normal,x=f.d,R=b.Vector3[0];this.subtractToRef(g,R),R.normalize();var I=T.Dot(R,y);if(Math.abs(I)<1e-10)S.setAll(1/0);else{var M=-(T.Dot(g,y)+x)/I,D=R.scaleInPlace(M);g.addToRef(D,S)}return S},T.prototype.equals=function(f){return f&&this._x===f._x&&this._y===f._y&&this._z===f._z},T.prototype.equalsWithEpsilon=function(f,g){return g===void 0&&(g=i.bH),f&&(0,c.WithinEpsilon)(this._x,f._x,g)&&(0,c.WithinEpsilon)(this._y,f._y,g)&&(0,c.WithinEpsilon)(this._z,f._z,g)},T.prototype.equalsToFloats=function(f,g,S){return this._x===f&&this._y===g&&this._z===S},T.prototype.multiplyInPlace=function(f){return this._x*=f._x,this._y*=f._y,this._z*=f._z,this._isDirty=!0,this},T.prototype.multiply=function(f){return this.multiplyByFloats(f._x,f._y,f._z)},T.prototype.multiplyToRef=function(f,g){return g._x=this._x*f._x,g._y=this._y*f._y,g._z=this._z*f._z,g._isDirty=!0,g},T.prototype.multiplyByFloats=function(f,g,S){return new T(this._x*f,this._y*g,this._z*S)},T.prototype.divide=function(f){return new T(this._x/f._x,this._y/f._y,this._z/f._z)},T.prototype.divideToRef=function(f,g){return g._x=this._x/f._x,g._y=this._y/f._y,g._z=this._z/f._z,g._isDirty=!0,g},T.prototype.divideInPlace=function(f){return this._x=this._x/f._x,this._y=this._y/f._y,this._z=this._z/f._z,this._isDirty=!0,this},T.prototype.minimizeInPlace=function(f){return this.minimizeInPlaceFromFloats(f._x,f._y,f._z)},T.prototype.maximizeInPlace=function(f){return this.maximizeInPlaceFromFloats(f._x,f._y,f._z)},T.prototype.minimizeInPlaceFromFloats=function(f,g,S){return f<this._x&&(this.x=f),g<this._y&&(this.y=g),S<this._z&&(this.z=S),this},T.prototype.maximizeInPlaceFromFloats=function(f,g,S){return f>this._x&&(this.x=f),g>this._y&&(this.y=g),S>this._z&&(this.z=S),this},T.prototype.isNonUniformWithinEpsilon=function(f){var g=Math.abs(this._x),S=Math.abs(this._y);if(!(0,c.WithinEpsilon)(g,S,f))return!0;var y=Math.abs(this._z);return!(0,c.WithinEpsilon)(g,y,f)||!(0,c.WithinEpsilon)(S,y,f)},Object.defineProperty(T.prototype,"isNonUniform",{get:function(){var f=Math.abs(this._x);return f!==Math.abs(this._y)||f!==Math.abs(this._z)},enumerable:!1,configurable:!0}),T.prototype.floorToRef=function(f){return f._x=Math.floor(this._x),f._y=Math.floor(this._y),f._z=Math.floor(this._z),f._isDirty=!0,f},T.prototype.floor=function(){return new T(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},T.prototype.fractToRef=function(f){return f._x=this.x-Math.floor(this._x),f._y=this.y-Math.floor(this._y),f._z=this.z-Math.floor(this._z),f._isDirty=!0,f},T.prototype.fract=function(){return new T(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))},T.prototype.length=function(){return Math.sqrt(this.lengthSquared())},T.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},Object.defineProperty(T.prototype,"hasAZeroComponent",{get:function(){return this._x*this._y*this._z==0},enumerable:!1,configurable:!0}),T.prototype.normalize=function(){return this.normalizeFromLength(this.length())},T.prototype.reorderInPlace=function(f){if((f=f.toLowerCase())==="xyz")return this;var g=b.Vector3[0].copyFrom(this);return this.x=g[f[0]],this.y=g[f[1]],this.z=g[f[2]],this},T.prototype.rotateByQuaternionToRef=function(f,g){return f.toRotationMatrix(b.Matrix[0]),T.TransformCoordinatesToRef(this,b.Matrix[0],g),g},T.prototype.rotateByQuaternionAroundPointToRef=function(f,g,S){return this.subtractToRef(g,b.Vector3[0]),b.Vector3[0].rotateByQuaternionToRef(f,b.Vector3[0]),g.addToRef(b.Vector3[0],S),S},T.prototype.cross=function(f){return T.CrossToRef(this,f,new T)},T.prototype.normalizeFromLength=function(f){return f===0||f===1?this:this.scaleInPlace(1/f)},T.prototype.normalizeToNew=function(){return this.normalizeToRef(new T)},T.prototype.normalizeToRef=function(f){var g=this.length();return g===0||g===1?(f._x=this._x,f._y=this._y,f._z=this._z,f._isDirty=!0,f):this.scaleToRef(1/g,f)},T.prototype.clone=function(){return new T(this._x,this._y,this._z)},T.prototype.copyFrom=function(f){return this.copyFromFloats(f._x,f._y,f._z)},T.prototype.copyFromFloats=function(f,g,S){return this._x=f,this._y=g,this._z=S,this._isDirty=!0,this},T.prototype.set=function(f,g,S){return this.copyFromFloats(f,g,S)},T.prototype.setAll=function(f){return this._x=this._y=this._z=f,this._isDirty=!0,this},T.GetClipFactor=function(f,g,S,y){var x=T.Dot(f,S);return(x-y)/(x-T.Dot(g,S))},T.GetAngleBetweenVectors=function(f,g,S){var y=f.normalizeToRef(b.Vector3[1]),x=g.normalizeToRef(b.Vector3[2]),R=T.Dot(y,x);R=(0,c.Clamp)(R,-1,1);var I=Math.acos(R),M=b.Vector3[3];return T.CrossToRef(y,x,M),T.Dot(M,S)>0?isNaN(I)?0:I:isNaN(I)?-Math.PI:-Math.acos(R)},T.GetAngleBetweenVectorsOnPlane=function(f,g,S){b.Vector3[0].copyFrom(f);var y=b.Vector3[0];b.Vector3[1].copyFrom(g);var x=b.Vector3[1];b.Vector3[2].copyFrom(S);var R=b.Vector3[2],I=b.Vector3[3],M=b.Vector3[4];y.normalize(),x.normalize(),R.normalize(),T.CrossToRef(R,y,I),T.CrossToRef(I,R,M);var D=Math.atan2(T.Dot(x,I),T.Dot(x,M));return(0,c.NormalizeRadians)(D)},T.PitchYawRollToMoveBetweenPointsToRef=function(f,g,S){var y=E.Vector3[0];return g.subtractToRef(f,y),S._y=Math.atan2(y.x,y.z)||0,S._x=Math.atan2(Math.sqrt(Math.pow(y.x,2)+Math.pow(y.z,2)),y.y)||0,S._z=0,S._isDirty=!0,S},T.PitchYawRollToMoveBetweenPoints=function(f,g){var S=T.Zero();return T.PitchYawRollToMoveBetweenPointsToRef(f,g,S)},T.SlerpToRef=function(f,g,S,y){S=(0,c.Clamp)(S,0,1);var x=b.Vector3[0],R=b.Vector3[1];x.copyFrom(f);var I=x.length();x.normalizeFromLength(I),R.copyFrom(g);var M=R.length();R.normalizeFromLength(M);var D,B,F=T.Dot(x,R);if(F<1-i.bH){var X=Math.acos(F),$=1/Math.sin(X);D=Math.sin((1-S)*X)*$,B=Math.sin(S*X)*$}else D=1-S,B=S;return x.scaleInPlace(D),R.scaleInPlace(B),y.copyFrom(x).addInPlace(R),y.scaleInPlace((0,c.Lerp)(I,M,S)),y},T.SmoothToRef=function(f,g,S,y,x){return T.SlerpToRef(f,g,y===0?1:S/y,x),x},T.FromArray=function(f,g){return g===void 0&&(g=0),new T(f[g],f[g+1],f[g+2])},T.FromFloatArray=function(f,g){return T.FromArray(f,g)},T.FromArrayToRef=function(f,g,S){return S._x=f[g],S._y=f[g+1],S._z=f[g+2],S._isDirty=!0,S},T.FromFloatArrayToRef=function(f,g,S){return T.FromArrayToRef(f,g,S)},T.FromFloatsToRef=function(f,g,S,y){return y.copyFromFloats(f,g,S),y},T.Zero=function(){return new T(0,0,0)},T.One=function(){return new T(1,1,1)},T.Up=function(){return new T(0,1,0)},Object.defineProperty(T,"UpReadOnly",{get:function(){return T._UpReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(T,"DownReadOnly",{get:function(){return T._DownReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(T,"RightReadOnly",{get:function(){return T._RightReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(T,"LeftReadOnly",{get:function(){return T._LeftReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(T,"LeftHandedForwardReadOnly",{get:function(){return T._LeftHandedForwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(T,"RightHandedForwardReadOnly",{get:function(){return T._RightHandedForwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(T,"LeftHandedBackwardReadOnly",{get:function(){return T._LeftHandedBackwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(T,"RightHandedBackwardReadOnly",{get:function(){return T._RightHandedBackwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(T,"ZeroReadOnly",{get:function(){return T._ZeroReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(T,"OneReadOnly",{get:function(){return T._OneReadOnly},enumerable:!1,configurable:!0}),T.Down=function(){return new T(0,-1,0)},T.Forward=function(f){return f===void 0&&(f=!1),new T(0,0,f?-1:1)},T.Backward=function(f){return f===void 0&&(f=!1),new T(0,0,f?1:-1)},T.Right=function(){return new T(1,0,0)},T.Left=function(){return new T(-1,0,0)},T.Random=function(f,g){return f===void 0&&(f=0),g===void 0&&(g=1),new T((0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g))},T.RandomToRef=function(f,g,S){return f===void 0&&(f=0),g===void 0&&(g=1),S.copyFromFloats((0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g))},T.TransformCoordinates=function(f,g){var S=T.Zero();return T.TransformCoordinatesToRef(f,g,S),S},T.TransformCoordinatesToRef=function(f,g,S){return T.TransformCoordinatesFromFloatsToRef(f._x,f._y,f._z,g,S),S},T.TransformCoordinatesFromFloatsToRef=function(f,g,S,y,x){var R=y.m,I=f*R[0]+g*R[4]+S*R[8]+R[12],M=f*R[1]+g*R[5]+S*R[9]+R[13],D=f*R[2]+g*R[6]+S*R[10]+R[14],B=1/(f*R[3]+g*R[7]+S*R[11]+R[15]);return x._x=I*B,x._y=M*B,x._z=D*B,x._isDirty=!0,x},T.TransformNormal=function(f,g){var S=T.Zero();return T.TransformNormalToRef(f,g,S),S},T.TransformNormalToRef=function(f,g,S){return this.TransformNormalFromFloatsToRef(f._x,f._y,f._z,g,S),S},T.TransformNormalFromFloatsToRef=function(f,g,S,y,x){var R=y.m;return x._x=f*R[0]+g*R[4]+S*R[8],x._y=f*R[1]+g*R[5]+S*R[9],x._z=f*R[2]+g*R[6]+S*R[10],x._isDirty=!0,x},T.CatmullRom=function(f,g,S,y,x){var R=x*x,I=x*R;return new T(.5*(2*g._x+(-f._x+S._x)*x+(2*f._x-5*g._x+4*S._x-y._x)*R+(-f._x+3*g._x-3*S._x+y._x)*I),.5*(2*g._y+(-f._y+S._y)*x+(2*f._y-5*g._y+4*S._y-y._y)*R+(-f._y+3*g._y-3*S._y+y._y)*I),.5*(2*g._z+(-f._z+S._z)*x+(2*f._z-5*g._z+4*S._z-y._z)*R+(-f._z+3*g._z-3*S._z+y._z)*I))},T.Clamp=function(f,g,S){var y=new T;return T.ClampToRef(f,g,S,y),y},T.ClampToRef=function(f,g,S,y){var x=f._x;x=(x=x>S._x?S._x:x)<g._x?g._x:x;var R=f._y;R=(R=R>S._y?S._y:R)<g._y?g._y:R;var I=f._z;return I=(I=I>S._z?S._z:I)<g._z?g._z:I,y.copyFromFloats(x,R,I),y},T.CheckExtends=function(f,g,S){g.minimizeInPlace(f),S.maximizeInPlace(f)},T.Hermite=function(f,g,S,y,x){var R=x*x,I=x*R,M=2*I-3*R+1,D=-2*I+3*R,B=I-2*R+x,F=I-R;return new T(f._x*M+S._x*D+g._x*B+y._x*F,f._y*M+S._y*D+g._y*B+y._y*F,f._z*M+S._z*D+g._z*B+y._z*F)},T.Hermite1stDerivative=function(f,g,S,y,x){var R=new T;return this.Hermite1stDerivativeToRef(f,g,S,y,x,R),R},T.Hermite1stDerivativeToRef=function(f,g,S,y,x,R){var I=x*x;return R._x=6*(I-x)*f._x+(3*I-4*x+1)*g._x+6*(-I+x)*S._x+(3*I-2*x)*y._x,R._y=6*(I-x)*f._y+(3*I-4*x+1)*g._y+6*(-I+x)*S._y+(3*I-2*x)*y._y,R._z=6*(I-x)*f._z+(3*I-4*x+1)*g._z+6*(-I+x)*S._z+(3*I-2*x)*y._z,R._isDirty=!0,R},T.Lerp=function(f,g,S){var y=new T(0,0,0);return T.LerpToRef(f,g,S,y),y},T.LerpToRef=function(f,g,S,y){return y._x=f._x+(g._x-f._x)*S,y._y=f._y+(g._y-f._y)*S,y._z=f._z+(g._z-f._z)*S,y._isDirty=!0,y},T.Dot=function(f,g){return f._x*g._x+f._y*g._y+f._z*g._z},T.prototype.dot=function(f){return this._x*f._x+this._y*f._y+this._z*f._z},T.Cross=function(f,g){var S=new T;return T.CrossToRef(f,g,S),S},T.CrossToRef=function(f,g,S){var y=f._y*g._z-f._z*g._y,x=f._z*g._x-f._x*g._z,R=f._x*g._y-f._y*g._x;return S.copyFromFloats(y,x,R),S},T.Normalize=function(f){var g=T.Zero();return T.NormalizeToRef(f,g),g},T.NormalizeToRef=function(f,g){return f.normalizeToRef(g),g},T.Project=function(f,g,S,y){var x=new T;return T.ProjectToRef(f,g,S,y,x),x},T.ProjectToRef=function(f,g,S,y,x){var R,I=y.width,M=y.height,D=y.x,B=y.y,F=b.Matrix[1],X=(R=l.q.LastCreatedEngine)===null||R===void 0?void 0:R.isNDCHalfZRange,$=X?1:.5,Q=X?0:.5;v.FromValuesToRef(I/2,0,0,0,0,-M/2,0,0,0,0,$,0,D+I/2,M/2+B,Q,1,F);var ie=b.Matrix[0];return g.multiplyToRef(S,ie),ie.multiplyToRef(F,ie),T.TransformCoordinatesToRef(f,ie,x),x},T.Reflect=function(f,g){return this.ReflectToRef(f,g,new T)},T.ReflectToRef=function(f,g,S){var y=E.Vector3[0];return y.copyFrom(g).scaleInPlace(2*T.Dot(f,g)),S.copyFrom(f).subtractInPlace(y)},T._UnprojectFromInvertedMatrixToRef=function(f,g,S){T.TransformCoordinatesToRef(f,g,S);var y=g.m,x=f._x*y[3]+f._y*y[7]+f._z*y[11]+y[15];return(0,c.WithinEpsilon)(x,1)&&S.scaleInPlace(1/x),S},T.UnprojectFromTransform=function(f,g,S,y,x){return this.Unproject(f,g,S,y,x,v.IdentityReadOnly)},T.Unproject=function(f,g,S,y,x,R){var I=new T;return T.UnprojectToRef(f,g,S,y,x,R,I),I},T.UnprojectToRef=function(f,g,S,y,x,R,I){return T.UnprojectFloatsToRef(f._x,f._y,f._z,g,S,y,x,R,I),I},T.UnprojectFloatsToRef=function(f,g,S,y,x,R,I,M,D){var B,F=b.Matrix[0];R.multiplyToRef(I,F),F.multiplyToRef(M,F),F.invert();var X=b.Vector3[0];return X.x=f/y*2-1,X.y=-(g/x*2-1),!((B=l.q.LastCreatedEngine)===null||B===void 0)&&B.isNDCHalfZRange?X.z=S:X.z=2*S-1,T._UnprojectFromInvertedMatrixToRef(X,F,D),D},T.Minimize=function(f,g){var S=new T;return S.copyFrom(f),S.minimizeInPlace(g),S},T.Maximize=function(f,g){var S=new T;return S.copyFrom(f),S.maximizeInPlace(g),S},T.Distance=function(f,g){return Math.sqrt(T.DistanceSquared(f,g))},T.DistanceSquared=function(f,g){var S=f._x-g._x,y=f._y-g._y,x=f._z-g._z;return S*S+y*y+x*x},T.ProjectOnTriangleToRef=function(f,g,S,y,x){var R=b.Vector3[0],I=b.Vector3[1],M=b.Vector3[2],D=b.Vector3[3],B=b.Vector3[4];S.subtractToRef(g,R),y.subtractToRef(g,I),y.subtractToRef(S,M);var F=R.length(),X=I.length(),$=M.length();if(F<i.bH||X<i.bH||$<i.bH)return x.copyFrom(g),T.Distance(f,g);f.subtractToRef(g,B),T.CrossToRef(R,I,D);var Q=D.length();if(Q<i.bH)return x.copyFrom(g),T.Distance(f,g);D.normalizeFromLength(Q);var ie=B.length();if(ie<i.bH)return x.copyFrom(g),0;B.normalizeFromLength(ie);var q=T.Dot(D,B),ee=b.Vector3[5],te=b.Vector3[6];ee.copyFrom(D).scaleInPlace(-ie*q),te.copyFrom(f).addInPlace(ee);var ce=b.Vector3[4],fe=b.Vector3[5],de=b.Vector3[7],Te=b.Vector3[8];ce.copyFrom(R).scaleInPlace(1/F),Te.copyFrom(I).scaleInPlace(1/X),ce.addInPlace(Te).scaleInPlace(-1),fe.copyFrom(R).scaleInPlace(-1/F),Te.copyFrom(M).scaleInPlace(1/$),fe.addInPlace(Te).scaleInPlace(-1),de.copyFrom(M).scaleInPlace(-1/$),Te.copyFrom(I).scaleInPlace(-1/X),de.addInPlace(Te).scaleInPlace(-1);var ue=b.Vector3[9];ue.copyFrom(te).subtractInPlace(g),T.CrossToRef(ce,ue,Te);var U=T.Dot(Te,D);ue.copyFrom(te).subtractInPlace(S),T.CrossToRef(fe,ue,Te);var N=T.Dot(Te,D);ue.copyFrom(te).subtractInPlace(y),T.CrossToRef(de,ue,Te);var w,k,J=T.Dot(Te,D),le=b.Vector3[10];U>0&&N<0?(le.copyFrom(R),w=g,k=S):N>0&&J<0?(le.copyFrom(M),w=S,k=y):(le.copyFrom(I).scaleInPlace(-1),w=y,k=g);var be=b.Vector3[9],ve=b.Vector3[4];if(w.subtractToRef(te,Te),k.subtractToRef(te,be),T.CrossToRef(Te,be,ve),!(T.Dot(ve,D)<0))return x.copyFrom(te),Math.abs(ie*q);var ye=b.Vector3[5];T.CrossToRef(le,ve,ye),ye.normalize();var Me=b.Vector3[9];Me.copyFrom(w).subtractInPlace(te);var we=Me.length();if(we<i.bH)return x.copyFrom(w),T.Distance(f,w);Me.normalizeFromLength(we);var He=T.Dot(ye,Me),Ke=b.Vector3[7];Ke.copyFrom(te).addInPlace(ye.scaleInPlace(we*He)),Te.copyFrom(Ke).subtractInPlace(w),ie=le.length(),le.normalizeFromLength(ie);var Qe=T.Dot(Te,le)/Math.max(ie,i.bH);return Qe=(0,c.Clamp)(Qe,0,1),Ke.copyFrom(w).addInPlace(le.scaleInPlace(Qe*ie)),x.copyFrom(Ke),T.Distance(f,Ke)},T.Center=function(f,g){return T.CenterToRef(f,g,T.Zero())},T.CenterToRef=function(f,g,S){return S.copyFromFloats((f._x+g._x)/2,(f._y+g._y)/2,(f._z+g._z)/2)},T.RotationFromAxis=function(f,g,S){var y=new T;return T.RotationFromAxisToRef(f,g,S,y),y},T.RotationFromAxisToRef=function(f,g,S,y){var x=b.Quaternion[0];return m.RotationQuaternionFromAxisToRef(f,g,S,x),x.toEulerAnglesToRef(y),y},T._UpReadOnly=T.Up(),T._DownReadOnly=T.Down(),T._LeftHandedForwardReadOnly=T.Forward(!1),T._RightHandedForwardReadOnly=T.Forward(!0),T._LeftHandedBackwardReadOnly=T.Backward(!1),T._RightHandedBackwardReadOnly=T.Backward(!0),T._RightReadOnly=T.Right(),T._LeftReadOnly=T.Left(),T._ZeroReadOnly=T.Zero(),T._OneReadOnly=T.One(),T}();Object.defineProperties(h.prototype,{dimension:{value:[3]},rank:{value:1}});var p=function(){function T(f,g,S,y){f===void 0&&(f=0),g===void 0&&(g=0),S===void 0&&(S=0),y===void 0&&(y=0),this.x=f,this.y=g,this.z=S,this.w=y}return T.prototype.toString=function(){return"{X: ".concat(this.x," Y: ").concat(this.y," Z: ").concat(this.z," W: ").concat(this.w,"}")},T.prototype.getClassName=function(){return"Vector4"},T.prototype.getHashCode=function(){var f=u(this.x);return 397*(f=397*(f=397*f^u(this.y))^u(this.z))^u(this.w)},T.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},T.prototype.toArray=function(f,g){return g===void 0&&(g=0),f[g]=this.x,f[g+1]=this.y,f[g+2]=this.z,f[g+3]=this.w,this},T.prototype.fromArray=function(f,g){return g===void 0&&(g=0),T.FromArrayToRef(f,g,this),this},T.prototype.addInPlace=function(f){return this.x+=f.x,this.y+=f.y,this.z+=f.z,this.w+=f.w,this},T.prototype.addInPlaceFromFloats=function(f,g,S,y){return this.x+=f,this.y+=g,this.z+=S,this.w+=y,this},T.prototype.add=function(f){return new T(this.x+f.x,this.y+f.y,this.z+f.z,this.w+f.w)},T.prototype.addToRef=function(f,g){return g.x=this.x+f.x,g.y=this.y+f.y,g.z=this.z+f.z,g.w=this.w+f.w,g},T.prototype.subtractInPlace=function(f){return this.x-=f.x,this.y-=f.y,this.z-=f.z,this.w-=f.w,this},T.prototype.subtract=function(f){return new T(this.x-f.x,this.y-f.y,this.z-f.z,this.w-f.w)},T.prototype.subtractToRef=function(f,g){return g.x=this.x-f.x,g.y=this.y-f.y,g.z=this.z-f.z,g.w=this.w-f.w,g},T.prototype.subtractFromFloats=function(f,g,S,y){return new T(this.x-f,this.y-g,this.z-S,this.w-y)},T.prototype.subtractFromFloatsToRef=function(f,g,S,y,x){return x.x=this.x-f,x.y=this.y-g,x.z=this.z-S,x.w=this.w-y,x},T.prototype.negate=function(){return new T(-this.x,-this.y,-this.z,-this.w)},T.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},T.prototype.negateToRef=function(f){return f.x=-this.x,f.y=-this.y,f.z=-this.z,f.w=-this.w,f},T.prototype.scaleInPlace=function(f){return this.x*=f,this.y*=f,this.z*=f,this.w*=f,this},T.prototype.scale=function(f){return new T(this.x*f,this.y*f,this.z*f,this.w*f)},T.prototype.scaleToRef=function(f,g){return g.x=this.x*f,g.y=this.y*f,g.z=this.z*f,g.w=this.w*f,g},T.prototype.scaleAndAddToRef=function(f,g){return g.x+=this.x*f,g.y+=this.y*f,g.z+=this.z*f,g.w+=this.w*f,g},T.prototype.equals=function(f){return f&&this.x===f.x&&this.y===f.y&&this.z===f.z&&this.w===f.w},T.prototype.equalsWithEpsilon=function(f,g){return g===void 0&&(g=i.bH),f&&(0,c.WithinEpsilon)(this.x,f.x,g)&&(0,c.WithinEpsilon)(this.y,f.y,g)&&(0,c.WithinEpsilon)(this.z,f.z,g)&&(0,c.WithinEpsilon)(this.w,f.w,g)},T.prototype.equalsToFloats=function(f,g,S,y){return this.x===f&&this.y===g&&this.z===S&&this.w===y},T.prototype.multiplyInPlace=function(f){return this.x*=f.x,this.y*=f.y,this.z*=f.z,this.w*=f.w,this},T.prototype.multiply=function(f){return new T(this.x*f.x,this.y*f.y,this.z*f.z,this.w*f.w)},T.prototype.multiplyToRef=function(f,g){return g.x=this.x*f.x,g.y=this.y*f.y,g.z=this.z*f.z,g.w=this.w*f.w,g},T.prototype.multiplyByFloats=function(f,g,S,y){return new T(this.x*f,this.y*g,this.z*S,this.w*y)},T.prototype.divide=function(f){return new T(this.x/f.x,this.y/f.y,this.z/f.z,this.w/f.w)},T.prototype.divideToRef=function(f,g){return g.x=this.x/f.x,g.y=this.y/f.y,g.z=this.z/f.z,g.w=this.w/f.w,g},T.prototype.divideInPlace=function(f){return this.divideToRef(f,this)},T.prototype.minimizeInPlace=function(f){return f.x<this.x&&(this.x=f.x),f.y<this.y&&(this.y=f.y),f.z<this.z&&(this.z=f.z),f.w<this.w&&(this.w=f.w),this},T.prototype.maximizeInPlace=function(f){return f.x>this.x&&(this.x=f.x),f.y>this.y&&(this.y=f.y),f.z>this.z&&(this.z=f.z),f.w>this.w&&(this.w=f.w),this},T.prototype.minimizeInPlaceFromFloats=function(f,g,S,y){return this.x=Math.min(f,this.x),this.y=Math.min(g,this.y),this.z=Math.min(S,this.z),this.w=Math.min(y,this.w),this},T.prototype.maximizeInPlaceFromFloats=function(f,g,S,y){return this.x=Math.max(f,this.x),this.y=Math.max(g,this.y),this.z=Math.max(S,this.z),this.w=Math.max(y,this.w),this},T.prototype.floorToRef=function(f){return f.x=Math.floor(this.x),f.y=Math.floor(this.y),f.z=Math.floor(this.z),f.w=Math.floor(this.w),f},T.prototype.floor=function(){return new T(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},T.prototype.fractToRef=function(f){return f.x=this.x-Math.floor(this.x),f.y=this.y-Math.floor(this.y),f.z=this.z-Math.floor(this.z),f.w=this.w-Math.floor(this.w),f},T.prototype.fract=function(){return new T(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},T.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},T.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},T.prototype.normalize=function(){return this.normalizeFromLength(this.length())},T.prototype.normalizeFromLength=function(f){return f===0||f===1?this:this.scaleInPlace(1/f)},T.prototype.normalizeToNew=function(){return this.normalizeToRef(new T)},T.prototype.normalizeToRef=function(f){var g=this.length();return g===0||g===1?(f.x=this.x,f.y=this.y,f.z=this.z,f.w=this.w,f):this.scaleToRef(1/g,f)},T.prototype.toVector3=function(){return new h(this.x,this.y,this.z)},T.prototype.clone=function(){return new T(this.x,this.y,this.z,this.w)},T.prototype.copyFrom=function(f){return this.x=f.x,this.y=f.y,this.z=f.z,this.w=f.w,this},T.prototype.copyFromFloats=function(f,g,S,y){return this.x=f,this.y=g,this.z=S,this.w=y,this},T.prototype.set=function(f,g,S,y){return this.copyFromFloats(f,g,S,y)},T.prototype.setAll=function(f){return this.x=this.y=this.z=this.w=f,this},T.prototype.dot=function(f){return this.x*f.x+this.y*f.y+this.z*f.z+this.w*f.w},T.FromArray=function(f,g){return g||(g=0),new T(f[g],f[g+1],f[g+2],f[g+3])},T.FromArrayToRef=function(f,g,S){return S.x=f[g],S.y=f[g+1],S.z=f[g+2],S.w=f[g+3],S},T.FromFloatArrayToRef=function(f,g,S){return T.FromArrayToRef(f,g,S),S},T.FromFloatsToRef=function(f,g,S,y,x){return x.x=f,x.y=g,x.z=S,x.w=y,x},T.Zero=function(){return new T(0,0,0,0)},T.One=function(){return new T(1,1,1,1)},T.Random=function(f,g){return f===void 0&&(f=0),g===void 0&&(g=1),new T((0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g))},T.RandomToRef=function(f,g,S){return f===void 0&&(f=0),g===void 0&&(g=1),S.x=(0,c.RandomRange)(f,g),S.y=(0,c.RandomRange)(f,g),S.z=(0,c.RandomRange)(f,g),S.w=(0,c.RandomRange)(f,g),S},T.Clamp=function(f,g,S){return T.ClampToRef(f,g,S,new T)},T.ClampToRef=function(f,g,S,y){return y.x=(0,c.Clamp)(f.x,g.x,S.x),y.y=(0,c.Clamp)(f.y,g.y,S.y),y.z=(0,c.Clamp)(f.z,g.z,S.z),y.w=(0,c.Clamp)(f.w,g.w,S.w),y},T.CheckExtends=function(f,g,S){g.minimizeInPlace(f),S.maximizeInPlace(f)},Object.defineProperty(T,"ZeroReadOnly",{get:function(){return T._ZeroReadOnly},enumerable:!1,configurable:!0}),T.Normalize=function(f){return T.NormalizeToRef(f,new T)},T.NormalizeToRef=function(f,g){return f.normalizeToRef(g),g},T.Minimize=function(f,g){var S=new T;return S.copyFrom(f),S.minimizeInPlace(g),S},T.Maximize=function(f,g){var S=new T;return S.copyFrom(f),S.maximizeInPlace(g),S},T.Distance=function(f,g){return Math.sqrt(T.DistanceSquared(f,g))},T.DistanceSquared=function(f,g){var S=f.x-g.x,y=f.y-g.y,x=f.z-g.z,R=f.w-g.w;return S*S+y*y+x*x+R*R},T.Center=function(f,g){return T.CenterToRef(f,g,new T)},T.CenterToRef=function(f,g,S){return S.x=(f.x+g.x)/2,S.y=(f.y+g.y)/2,S.z=(f.z+g.z)/2,S.w=(f.w+g.w)/2,S},T.TransformCoordinates=function(f,g){return T.TransformCoordinatesToRef(f,g,new T)},T.TransformCoordinatesToRef=function(f,g,S){return T.TransformCoordinatesFromFloatsToRef(f._x,f._y,f._z,g,S),S},T.TransformCoordinatesFromFloatsToRef=function(f,g,S,y,x){var R=y.m,I=f*R[0]+g*R[4]+S*R[8]+R[12],M=f*R[1]+g*R[5]+S*R[9]+R[13],D=f*R[2]+g*R[6]+S*R[10]+R[14],B=f*R[3]+g*R[7]+S*R[11]+R[15];return x.x=I,x.y=M,x.z=D,x.w=B,x},T.TransformNormal=function(f,g){return T.TransformNormalToRef(f,g,new T)},T.TransformNormalToRef=function(f,g,S){var y=g.m,x=f.x*y[0]+f.y*y[4]+f.z*y[8],R=f.x*y[1]+f.y*y[5]+f.z*y[9],I=f.x*y[2]+f.y*y[6]+f.z*y[10];return S.x=x,S.y=R,S.z=I,S.w=f.w,S},T.TransformNormalFromFloatsToRef=function(f,g,S,y,x,R){var I=x.m;return R.x=f*I[0]+g*I[4]+S*I[8],R.y=f*I[1]+g*I[5]+S*I[9],R.z=f*I[2]+g*I[6]+S*I[10],R.w=y,R},T.FromVector3=function(f,g){return g===void 0&&(g=0),new T(f._x,f._y,f._z,g)},T.Dot=function(f,g){return f.x*g.x+f.y*g.y+f.z*g.z+f.w*g.w},T._ZeroReadOnly=T.Zero(),T}();Object.defineProperties(p.prototype,{dimension:{value:[4]},rank:{value:1}});var m=function(){function T(f,g,S,y){f===void 0&&(f=0),g===void 0&&(g=0),S===void 0&&(S=0),y===void 0&&(y=1),this._isDirty=!0,this._x=f,this._y=g,this._z=S,this._w=y}return Object.defineProperty(T.prototype,"x",{get:function(){return this._x},set:function(f){this._x=f,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"y",{get:function(){return this._y},set:function(f){this._y=f,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"z",{get:function(){return this._z},set:function(f){this._z=f,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"w",{get:function(){return this._w},set:function(f){this._w=f,this._isDirty=!0},enumerable:!1,configurable:!0}),T.prototype.toString=function(){return"{X: ".concat(this._x," Y: ").concat(this._y," Z: ").concat(this._z," W: ").concat(this._w,"}")},T.prototype.getClassName=function(){return"Quaternion"},T.prototype.getHashCode=function(){var f=u(this._x);return 397*(f=397*(f=397*f^u(this._y))^u(this._z))^u(this._w)},T.prototype.asArray=function(){return[this._x,this._y,this._z,this._w]},T.prototype.toArray=function(f,g){return g===void 0&&(g=0),f[g]=this._x,f[g+1]=this._y,f[g+2]=this._z,f[g+3]=this._w,this},T.prototype.fromArray=function(f,g){return g===void 0&&(g=0),T.FromArrayToRef(f,g,this)},T.prototype.equals=function(f){return f&&this._x===f._x&&this._y===f._y&&this._z===f._z&&this._w===f._w},T.prototype.equalsWithEpsilon=function(f,g){return g===void 0&&(g=i.bH),f&&(0,c.WithinEpsilon)(this._x,f._x,g)&&(0,c.WithinEpsilon)(this._y,f._y,g)&&(0,c.WithinEpsilon)(this._z,f._z,g)&&(0,c.WithinEpsilon)(this._w,f._w,g)},T.prototype.clone=function(){return new T(this._x,this._y,this._z,this._w)},T.prototype.copyFrom=function(f){return this._x=f._x,this._y=f._y,this._z=f._z,this._w=f._w,this._isDirty=!0,this},T.prototype.copyFromFloats=function(f,g,S,y){return this._x=f,this._y=g,this._z=S,this._w=y,this._isDirty=!0,this},T.prototype.set=function(f,g,S,y){return this.copyFromFloats(f,g,S,y)},T.prototype.setAll=function(f){return this.copyFromFloats(f,f,f,f)},T.prototype.add=function(f){return new T(this._x+f._x,this._y+f._y,this._z+f._z,this._w+f._w)},T.prototype.addInPlace=function(f){return this._x+=f._x,this._y+=f._y,this._z+=f._z,this._w+=f._w,this._isDirty=!0,this},T.prototype.addToRef=function(f,g){return g._x=this._x+f._x,g._y=this._y+f._y,g._z=this._z+f._z,g._w=this._w+f._w,g._isDirty=!0,g},T.prototype.addInPlaceFromFloats=function(f,g,S,y){return this._x+=f,this._y+=g,this._z+=S,this._w+=y,this._isDirty=!0,this},T.prototype.subtractToRef=function(f,g){return g._x=this._x-f._x,g._y=this._y-f._y,g._z=this._z-f._z,g._w=this._w-f._w,g._isDirty=!0,g},T.prototype.subtractFromFloats=function(f,g,S,y){return this.subtractFromFloatsToRef(f,g,S,y,new T)},T.prototype.subtractFromFloatsToRef=function(f,g,S,y,x){return x._x=this._x-f,x._y=this._y-g,x._z=this._z-S,x._w=this._w-y,x._isDirty=!0,x},T.prototype.subtract=function(f){return new T(this._x-f._x,this._y-f._y,this._z-f._z,this._w-f._w)},T.prototype.subtractInPlace=function(f){return this._x-=f._x,this._y-=f._y,this._z-=f._z,this._w-=f._w,this._isDirty=!0,this},T.prototype.scale=function(f){return new T(this._x*f,this._y*f,this._z*f,this._w*f)},T.prototype.scaleToRef=function(f,g){return g._x=this._x*f,g._y=this._y*f,g._z=this._z*f,g._w=this._w*f,g._isDirty=!0,g},T.prototype.scaleInPlace=function(f){return this._x*=f,this._y*=f,this._z*=f,this._w*=f,this._isDirty=!0,this},T.prototype.scaleAndAddToRef=function(f,g){return g._x+=this._x*f,g._y+=this._y*f,g._z+=this._z*f,g._w+=this._w*f,g._isDirty=!0,g},T.prototype.multiply=function(f){var g=new T(0,0,0,1);return this.multiplyToRef(f,g),g},T.prototype.multiplyToRef=function(f,g){var S=this._x*f._w+this._y*f._z-this._z*f._y+this._w*f._x,y=-this._x*f._z+this._y*f._w+this._z*f._x+this._w*f._y,x=this._x*f._y-this._y*f._x+this._z*f._w+this._w*f._z,R=-this._x*f._x-this._y*f._y-this._z*f._z+this._w*f._w;return g.copyFromFloats(S,y,x,R),g},T.prototype.multiplyInPlace=function(f){return this.multiplyToRef(f,this)},T.prototype.multiplyByFloats=function(f,g,S,y){return this._x*=f,this._y*=g,this._z*=S,this._w*=y,this._isDirty=!0,this},T.prototype.divide=function(f){throw new ReferenceError("Can not divide a quaternion")},T.prototype.divideToRef=function(f,g){throw new ReferenceError("Can not divide a quaternion")},T.prototype.divideInPlace=function(f){throw new ReferenceError("Can not divide a quaternion")},T.prototype.minimizeInPlace=function(){throw new ReferenceError("Can not minimize a quaternion")},T.prototype.minimizeInPlaceFromFloats=function(){throw new ReferenceError("Can not minimize a quaternion")},T.prototype.maximizeInPlace=function(){throw new ReferenceError("Can not maximize a quaternion")},T.prototype.maximizeInPlaceFromFloats=function(){throw new ReferenceError("Can not maximize a quaternion")},T.prototype.negate=function(){return this.negateToRef(new T)},T.prototype.negateInPlace=function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this},T.prototype.negateToRef=function(f){return f._x=-this._x,f._y=-this._y,f._z=-this._z,f._w=-this._w,f._isDirty=!0,f},T.prototype.equalsToFloats=function(f,g,S,y){return this._x===f&&this._y===g&&this._z===S&&this._w===y},T.prototype.floorToRef=function(f){throw new ReferenceError("Can not floor a quaternion")},T.prototype.floor=function(){throw new ReferenceError("Can not floor a quaternion")},T.prototype.fractToRef=function(f){throw new ReferenceError("Can not fract a quaternion")},T.prototype.fract=function(){throw new ReferenceError("Can not fract a quaternion")},T.prototype.conjugateToRef=function(f){return f.copyFromFloats(-this._x,-this._y,-this._z,this._w),f},T.prototype.conjugateInPlace=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this},T.prototype.conjugate=function(){return new T(-this._x,-this._y,-this._z,this._w)},T.prototype.invert=function(){var f=this.conjugate(),g=this.lengthSquared();return g==0||g==1||f.scaleInPlace(1/g),f},T.prototype.invertInPlace=function(){this.conjugateInPlace();var f=this.lengthSquared();return f==0||f==1||this.scaleInPlace(1/f),this},T.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},T.prototype.length=function(){return Math.sqrt(this.lengthSquared())},T.prototype.normalize=function(){return this.normalizeFromLength(this.length())},T.prototype.normalizeFromLength=function(f){return f===0||f===1?this:this.scaleInPlace(1/f)},T.prototype.normalizeToNew=function(){var f=new T(0,0,0,1);return this.normalizeToRef(f),f},T.prototype.normalizeToRef=function(f){var g=this.length();return g===0||g===1?f.copyFromFloats(this._x,this._y,this._z,this._w):this.scaleToRef(1/g,f)},T.prototype.toEulerAngles=function(){var f=h.Zero();return this.toEulerAnglesToRef(f),f},T.prototype.toEulerAnglesToRef=function(f){var g=this._z,S=this._x,y=this._y,x=this._w,R=y*g-S*x,I=.4999999;if(R<-I)f._y=2*Math.atan2(y,x),f._x=Math.PI/2,f._z=0,f._isDirty=!0;else if(R>I)f._y=2*Math.atan2(y,x),f._x=-Math.PI/2,f._z=0,f._isDirty=!0;else{var M=x*x,D=g*g,B=S*S,F=y*y;f._z=Math.atan2(2*(S*y+g*x),-D-B+F+M),f._x=Math.asin(-2*R),f._y=Math.atan2(2*(g*S+y*x),D-B-F+M),f._isDirty=!0}return f},T.prototype.toAlphaBetaGammaToRef=function(f){var g=this._z,S=this._x,y=this._y,x=this._w,R=Math.sqrt(S*S+y*y),I=Math.sqrt(g*g+x*x),M=2*Math.atan2(R,I),D=2*Math.atan2(g,x),B=2*Math.atan2(y,S),F=(D+B)/2,X=(D-B)/2;return f.set(X,M,F),f},T.prototype.toRotationMatrix=function(f){return v.FromQuaternionToRef(this,f),f},T.prototype.fromRotationMatrix=function(f){return T.FromRotationMatrixToRef(f,this),this},T.prototype.dot=function(f){return this._x*f._x+this._y*f._y+this._z*f._z+this._w*f._w},T.FromRotationMatrix=function(f){var g=new T;return T.FromRotationMatrixToRef(f,g),g},T.FromRotationMatrixToRef=function(f,g){var S,y=f.m,x=y[0],R=y[4],I=y[8],M=y[1],D=y[5],B=y[9],F=y[2],X=y[6],$=y[10],Q=x+D+$;return Q>0?(S=.5/Math.sqrt(Q+1),g._w=.25/S,g._x=(X-B)*S,g._y=(I-F)*S,g._z=(M-R)*S,g._isDirty=!0):x>D&&x>$?(S=2*Math.sqrt(1+x-D-$),g._w=(X-B)/S,g._x=.25*S,g._y=(R+M)/S,g._z=(I+F)/S,g._isDirty=!0):D>$?(S=2*Math.sqrt(1+D-x-$),g._w=(I-F)/S,g._x=(R+M)/S,g._y=.25*S,g._z=(B+X)/S,g._isDirty=!0):(S=2*Math.sqrt(1+$-x-D),g._w=(M-R)/S,g._x=(I+F)/S,g._y=(B+X)/S,g._z=.25*S,g._isDirty=!0),g},T.Dot=function(f,g){return f._x*g._x+f._y*g._y+f._z*g._z+f._w*g._w},T.AreClose=function(f,g,S){S===void 0&&(S=.1);var y=T.Dot(f,g);return 1-y*y<=S},T.SmoothToRef=function(f,g,S,y,x){var R=y===0?1:S/y;return R=(0,c.Clamp)(R,0,1),T.SlerpToRef(f,g,R,x),x},T.Zero=function(){return new T(0,0,0,0)},T.Inverse=function(f){return new T(-f._x,-f._y,-f._z,f._w)},T.InverseToRef=function(f,g){return g.set(-f._x,-f._y,-f._z,f._w),g},T.Identity=function(){return new T(0,0,0,1)},T.IsIdentity=function(f){return f&&f._x===0&&f._y===0&&f._z===0&&f._w===1},T.RotationAxis=function(f,g){return T.RotationAxisToRef(f,g,new T)},T.RotationAxisToRef=function(f,g,S){S._w=Math.cos(g/2);var y=Math.sin(g/2)/f.length();return S._x=f._x*y,S._y=f._y*y,S._z=f._z*y,S._isDirty=!0,S},T.FromArray=function(f,g){return g||(g=0),new T(f[g],f[g+1],f[g+2],f[g+3])},T.FromArrayToRef=function(f,g,S){return S._x=f[g],S._y=f[g+1],S._z=f[g+2],S._w=f[g+3],S._isDirty=!0,S},T.FromFloatsToRef=function(f,g,S,y,x){return x.copyFromFloats(f,g,S,y),x},T.FromEulerAngles=function(f,g,S){var y=new T;return T.RotationYawPitchRollToRef(g,f,S,y),y},T.FromEulerAnglesToRef=function(f,g,S,y){return T.RotationYawPitchRollToRef(g,f,S,y),y},T.FromEulerVector=function(f){var g=new T;return T.RotationYawPitchRollToRef(f._y,f._x,f._z,g),g},T.FromEulerVectorToRef=function(f,g){return T.RotationYawPitchRollToRef(f._y,f._x,f._z,g),g},T.FromUnitVectorsToRef=function(f,g,S,y){y===void 0&&(y=i.bH);var x=h.Dot(f,g)+1;return x<y?Math.abs(f.x)>Math.abs(f.z)?S.set(-f.y,f.x,0,0):S.set(0,-f.z,f.y,0):(h.CrossToRef(f,g,E.Vector3[0]),S.set(E.Vector3[0].x,E.Vector3[0].y,E.Vector3[0].z,x)),S.normalize()},T.RotationYawPitchRoll=function(f,g,S){var y=new T;return T.RotationYawPitchRollToRef(f,g,S,y),y},T.RotationYawPitchRollToRef=function(f,g,S,y){var x=.5*S,R=.5*g,I=.5*f,M=Math.sin(x),D=Math.cos(x),B=Math.sin(R),F=Math.cos(R),X=Math.sin(I),$=Math.cos(I);return y._x=$*B*D+X*F*M,y._y=X*F*D-$*B*M,y._z=$*F*M-X*B*D,y._w=$*F*D+X*B*M,y._isDirty=!0,y},T.RotationAlphaBetaGamma=function(f,g,S){var y=new T;return T.RotationAlphaBetaGammaToRef(f,g,S,y),y},T.RotationAlphaBetaGammaToRef=function(f,g,S,y){var x=.5*(S+f),R=.5*(S-f),I=.5*g;return y._x=Math.cos(R)*Math.sin(I),y._y=Math.sin(R)*Math.sin(I),y._z=Math.sin(x)*Math.cos(I),y._w=Math.cos(x)*Math.cos(I),y._isDirty=!0,y},T.RotationQuaternionFromAxis=function(f,g,S){var y=new T(0,0,0,0);return T.RotationQuaternionFromAxisToRef(f,g,S,y),y},T.RotationQuaternionFromAxisToRef=function(f,g,S,y){var x=b.Matrix[0];return f=f.normalizeToRef(b.Vector3[0]),g=g.normalizeToRef(b.Vector3[1]),S=S.normalizeToRef(b.Vector3[2]),v.FromXYZAxesToRef(f,g,S,x),T.FromRotationMatrixToRef(x,y),y},T.FromLookDirectionLH=function(f,g){var S=new T;return T.FromLookDirectionLHToRef(f,g,S),S},T.FromLookDirectionLHToRef=function(f,g,S){var y=b.Matrix[0];return v.LookDirectionLHToRef(f,g,y),T.FromRotationMatrixToRef(y,S),S},T.FromLookDirectionRH=function(f,g){var S=new T;return T.FromLookDirectionRHToRef(f,g,S),S},T.FromLookDirectionRHToRef=function(f,g,S){var y=b.Matrix[0];return v.LookDirectionRHToRef(f,g,y),T.FromRotationMatrixToRef(y,S)},T.Slerp=function(f,g,S){var y=T.Identity();return T.SlerpToRef(f,g,S,y),y},T.SlerpToRef=function(f,g,S,y){var x,R,I=f._x*g._x+f._y*g._y+f._z*g._z+f._w*g._w,M=!1;if(I<0&&(M=!0,I=-I),I>.999999)R=1-S,x=M?-S:S;else{var D=Math.acos(I),B=1/Math.sin(D);R=Math.sin((1-S)*D)*B,x=M?-Math.sin(S*D)*B:Math.sin(S*D)*B}return y._x=R*f._x+x*g._x,y._y=R*f._y+x*g._y,y._z=R*f._z+x*g._z,y._w=R*f._w+x*g._w,y._isDirty=!0,y},T.Hermite=function(f,g,S,y,x){var R=x*x,I=x*R,M=2*I-3*R+1,D=-2*I+3*R,B=I-2*R+x,F=I-R;return new T(f._x*M+S._x*D+g._x*B+y._x*F,f._y*M+S._y*D+g._y*B+y._y*F,f._z*M+S._z*D+g._z*B+y._z*F,f._w*M+S._w*D+g._w*B+y._w*F)},T.Hermite1stDerivative=function(f,g,S,y,x){var R=new T;return this.Hermite1stDerivativeToRef(f,g,S,y,x,R),R},T.Hermite1stDerivativeToRef=function(f,g,S,y,x,R){var I=x*x;return R._x=6*(I-x)*f._x+(3*I-4*x+1)*g._x+6*(-I+x)*S._x+(3*I-2*x)*y._x,R._y=6*(I-x)*f._y+(3*I-4*x+1)*g._y+6*(-I+x)*S._y+(3*I-2*x)*y._y,R._z=6*(I-x)*f._z+(3*I-4*x+1)*g._z+6*(-I+x)*S._z+(3*I-2*x)*y._z,R._w=6*(I-x)*f._w+(3*I-4*x+1)*g._w+6*(-I+x)*S._w+(3*I-2*x)*y._w,R._isDirty=!0,R},T.Normalize=function(f){var g=T.Zero();return T.NormalizeToRef(f,g),g},T.NormalizeToRef=function(f,g){return f.normalizeToRef(g),g},T.Clamp=function(f,g,S){var y=new T;return T.ClampToRef(f,g,S,y),y},T.ClampToRef=function(f,g,S,y){return y.copyFromFloats((0,c.Clamp)(f.x,g.x,S.x),(0,c.Clamp)(f.y,g.y,S.y),(0,c.Clamp)(f.z,g.z,S.z),(0,c.Clamp)(f.w,g.w,S.w))},T.Random=function(f,g){return f===void 0&&(f=0),g===void 0&&(g=1),new T((0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g))},T.RandomToRef=function(f,g,S){return f===void 0&&(f=0),g===void 0&&(g=1),S.copyFromFloats((0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g),(0,c.RandomRange)(f,g))},T.Minimize=function(){throw new ReferenceError("Quaternion.Minimize does not make sense")},T.Maximize=function(){throw new ReferenceError("Quaternion.Maximize does not make sense")},T.Distance=function(f,g){return Math.sqrt(T.DistanceSquared(f,g))},T.DistanceSquared=function(f,g){var S=f.x-g.x,y=f.y-g.y,x=f.z-g.z,R=f.w-g.w;return S*S+y*y+x*x+R*R},T.Center=function(f,g){return T.CenterToRef(f,g,T.Zero())},T.CenterToRef=function(f,g,S){return S.copyFromFloats((f.x+g.x)/2,(f.y+g.y)/2,(f.z+g.z)/2,(f.w+g.w)/2)},T}();Object.defineProperties(m.prototype,{dimension:{value:[4]},rank:{value:1}});var v=function(){function T(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,s.I.MatrixTrackPrecisionChange&&s.I.MatrixTrackedMatrices.push(this),this._m=new s.I.MatrixCurrentType(16),this.markAsUpdated()}return Object.defineProperty(T,"Use64Bits",{get:function(){return s.I.MatrixUse64Bits},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),T.prototype.markAsUpdated=function(){this.updateFlag=T._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},T.prototype._updateIdentityStatus=function(f,g,S,y){g===void 0&&(g=!1),S===void 0&&(S=!1),y===void 0&&(y=!0),this._isIdentity=f,this._isIdentity3x2=f||S,this._isIdentityDirty=!this._isIdentity&&g,this._isIdentity3x2Dirty=!this._isIdentity3x2&&y},T.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var f=this._m;this._isIdentity=f[0]===1&&f[1]===0&&f[2]===0&&f[3]===0&&f[4]===0&&f[5]===1&&f[6]===0&&f[7]===0&&f[8]===0&&f[9]===0&&f[10]===1&&f[11]===0&&f[12]===0&&f[13]===0&&f[14]===0&&f[15]===1}return this._isIdentity},T.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,this._m[0]!==1||this._m[5]!==1||this._m[15]!==1||this._m[1]!==0||this._m[2]!==0||this._m[3]!==0||this._m[4]!==0||this._m[6]!==0||this._m[7]!==0||this._m[8]!==0||this._m[9]!==0||this._m[10]!==0||this._m[11]!==0||this._m[12]!==0||this._m[13]!==0||this._m[14]!==0?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},T.prototype.determinant=function(){if(this._isIdentity===!0)return 1;var f=this._m,g=f[0],S=f[1],y=f[2],x=f[3],R=f[4],I=f[5],M=f[6],D=f[7],B=f[8],F=f[9],X=f[10],$=f[11],Q=f[12],ie=f[13],q=f[14],ee=f[15],te=X*ee-q*$,ce=F*ee-ie*$,fe=F*q-ie*X,de=B*ee-Q*$,Te=B*q-X*Q,ue=B*ie-Q*F;return g*+(I*te-M*ce+D*fe)+S*-(R*te-M*de+D*Te)+y*+(R*ce-I*de+D*ue)+x*-(R*fe-I*Te+M*ue)},T.prototype.toString=function(){return"{".concat(this.m[0],", ").concat(this.m[1],", ").concat(this.m[2],", ").concat(this.m[3],`
`).concat(this.m[4],", ").concat(this.m[5],", ").concat(this.m[6],", ").concat(this.m[7],`
`).concat(this.m[8],", ").concat(this.m[9],", ").concat(this.m[10],", ").concat(this.m[11],`
`).concat(this.m[12],", ").concat(this.m[13],", ").concat(this.m[14],", ").concat(this.m[15],"}")},T.prototype.toArray=function(f,g){if(f===void 0&&(f=null),g===void 0&&(g=0),!f)return this._m;for(var S=this._m,y=0;y<16;y++)f[g+y]=S[y];return this},T.prototype.asArray=function(){return this._m},T.prototype.fromArray=function(f,g){return g===void 0&&(g=0),T.FromArrayToRef(f,g,this)},T.prototype.copyFromFloats=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];return T.FromArrayToRef(f,0,this)},T.prototype.set=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];for(var S=this._m,y=0;y<16;y++)S[y]=f[y];return this.markAsUpdated(),this},T.prototype.setAll=function(f){for(var g=this._m,S=0;S<16;S++)g[S]=f;return this.markAsUpdated(),this},T.prototype.invert=function(){return this.invertToRef(this),this},T.prototype.reset=function(){return T.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},T.prototype.add=function(f){var g=new T;return this.addToRef(f,g),g},T.prototype.addToRef=function(f,g){for(var S=this._m,y=g._m,x=f.m,R=0;R<16;R++)y[R]=S[R]+x[R];return g.markAsUpdated(),g},T.prototype.addToSelf=function(f){var g=this._m,S=f.m;return g[0]+=S[0],g[1]+=S[1],g[2]+=S[2],g[3]+=S[3],g[4]+=S[4],g[5]+=S[5],g[6]+=S[6],g[7]+=S[7],g[8]+=S[8],g[9]+=S[9],g[10]+=S[10],g[11]+=S[11],g[12]+=S[12],g[13]+=S[13],g[14]+=S[14],g[15]+=S[15],this.markAsUpdated(),this},T.prototype.addInPlace=function(f){for(var g=this._m,S=f.m,y=0;y<16;y++)g[y]+=S[y];return this.markAsUpdated(),this},T.prototype.addInPlaceFromFloats=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];for(var S=this._m,y=0;y<16;y++)S[y]+=f[y];return this.markAsUpdated(),this},T.prototype.subtract=function(f){for(var g=this._m,S=f.m,y=0;y<16;y++)g[y]-=S[y];return this.markAsUpdated(),this},T.prototype.subtractToRef=function(f,g){for(var S=this._m,y=f.m,x=g._m,R=0;R<16;R++)x[R]=S[R]-y[R];return g.markAsUpdated(),g},T.prototype.subtractInPlace=function(f){for(var g=this._m,S=f.m,y=0;y<16;y++)g[y]-=S[y];return this.markAsUpdated(),this},T.prototype.subtractFromFloats=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];return this.subtractFromFloatsToRef.apply(this,(0,n.fX)((0,n.fX)([],f,!1),[new T],!1))},T.prototype.subtractFromFloatsToRef=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];for(var S=f.pop(),y=this._m,x=S._m,R=f,I=0;I<16;I++)x[I]=y[I]-R[I];return S.markAsUpdated(),S},T.prototype.invertToRef=function(f){if(this._isIdentity===!0)return T.IdentityToRef(f),f;var g=this._m,S=g[0],y=g[1],x=g[2],R=g[3],I=g[4],M=g[5],D=g[6],B=g[7],F=g[8],X=g[9],$=g[10],Q=g[11],ie=g[12],q=g[13],ee=g[14],te=g[15],ce=$*te-ee*Q,fe=X*te-q*Q,de=X*ee-q*$,Te=F*te-ie*Q,ue=F*ee-$*ie,U=F*q-ie*X,N=+(M*ce-D*fe+B*de),w=-(I*ce-D*Te+B*ue),k=+(I*fe-M*Te+B*U),J=-(I*de-M*ue+D*U),le=S*N+y*w+x*k+R*J;if(le===0)return f.copyFrom(this),f;var be=1/le,ve=D*te-ee*B,ye=M*te-q*B,Me=M*ee-q*D,we=I*te-ie*B,He=I*ee-ie*D,Ke=I*q-ie*M,Qe=D*Q-$*B,Je=M*Q-X*B,ht=M*$-X*D,mt=I*Q-F*B,yt=I*$-F*D,zt=I*X-F*M,$t=-(y*ce-x*fe+R*de),St=+(S*ce-x*Te+R*ue),Ot=-(S*fe-y*Te+R*U),Et=+(S*de-y*ue+x*U),Vt=+(y*ve-x*ye+R*Me),ln=-(S*ve-x*we+R*He),Yt=+(S*ye-y*we+R*Ke),Un=-(S*Me-y*He+x*Ke),lr=-(y*Qe-x*Je+R*ht),ii=+(S*Qe-x*mt+R*yt),Li=-(S*Je-y*mt+R*zt),$r=+(S*ht-y*yt+x*zt);return T.FromValuesToRef(N*be,$t*be,Vt*be,lr*be,w*be,St*be,ln*be,ii*be,k*be,Ot*be,Yt*be,Li*be,J*be,Et*be,Un*be,$r*be,f),f},T.prototype.addAtIndex=function(f,g){return this._m[f]+=g,this.markAsUpdated(),this},T.prototype.multiplyAtIndex=function(f,g){return this._m[f]*=g,this.markAsUpdated(),this},T.prototype.setTranslationFromFloats=function(f,g,S){return this._m[12]=f,this._m[13]=g,this._m[14]=S,this.markAsUpdated(),this},T.prototype.addTranslationFromFloats=function(f,g,S){return this._m[12]+=f,this._m[13]+=g,this._m[14]+=S,this.markAsUpdated(),this},T.prototype.setTranslation=function(f){return this.setTranslationFromFloats(f._x,f._y,f._z)},T.prototype.getTranslation=function(){return new h(this._m[12],this._m[13],this._m[14])},T.prototype.getTranslationToRef=function(f){return f.x=this._m[12],f.y=this._m[13],f.z=this._m[14],f},T.prototype.removeRotationAndScaling=function(){var f=this.m;return T.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,f[12],f[13],f[14],f[15],this),this._updateIdentityStatus(f[12]===0&&f[13]===0&&f[14]===0&&f[15]===1),this},T.prototype.copyFrom=function(f){f.copyToArray(this._m);var g=f;return this.updateFlag=g.updateFlag,this._updateIdentityStatus(g._isIdentity,g._isIdentityDirty,g._isIdentity3x2,g._isIdentity3x2Dirty),this},T.prototype.copyToArray=function(f,g){g===void 0&&(g=0);var S=this._m;return f[g]=S[0],f[g+1]=S[1],f[g+2]=S[2],f[g+3]=S[3],f[g+4]=S[4],f[g+5]=S[5],f[g+6]=S[6],f[g+7]=S[7],f[g+8]=S[8],f[g+9]=S[9],f[g+10]=S[10],f[g+11]=S[11],f[g+12]=S[12],f[g+13]=S[13],f[g+14]=S[14],f[g+15]=S[15],this},T.prototype.multiply=function(f){var g=new T;return this.multiplyToRef(f,g),g},T.prototype.multiplyInPlace=function(f){for(var g=this._m,S=f.m,y=0;y<16;y++)g[y]*=S[y];return this.markAsUpdated(),this},T.prototype.multiplyByFloats=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];for(var S=this._m,y=0;y<16;y++)S[y]*=f[y];return this.markAsUpdated(),this},T.prototype.multiplyByFloatsToRef=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];for(var S=f.pop(),y=this._m,x=S._m,R=f,I=0;I<16;I++)x[I]=y[I]*R[I];return S.markAsUpdated(),S},T.prototype.multiplyToRef=function(f,g){return this._isIdentity?(g.copyFrom(f),g):f._isIdentity?(g.copyFrom(this),g):(this.multiplyToArray(f,g._m,0),g.markAsUpdated(),g)},T.prototype.multiplyToArray=function(f,g,S){var y=this._m,x=f.m,R=y[0],I=y[1],M=y[2],D=y[3],B=y[4],F=y[5],X=y[6],$=y[7],Q=y[8],ie=y[9],q=y[10],ee=y[11],te=y[12],ce=y[13],fe=y[14],de=y[15],Te=x[0],ue=x[1],U=x[2],N=x[3],w=x[4],k=x[5],J=x[6],le=x[7],be=x[8],ve=x[9],ye=x[10],Me=x[11],we=x[12],He=x[13],Ke=x[14],Qe=x[15];return g[S]=R*Te+I*w+M*be+D*we,g[S+1]=R*ue+I*k+M*ve+D*He,g[S+2]=R*U+I*J+M*ye+D*Ke,g[S+3]=R*N+I*le+M*Me+D*Qe,g[S+4]=B*Te+F*w+X*be+$*we,g[S+5]=B*ue+F*k+X*ve+$*He,g[S+6]=B*U+F*J+X*ye+$*Ke,g[S+7]=B*N+F*le+X*Me+$*Qe,g[S+8]=Q*Te+ie*w+q*be+ee*we,g[S+9]=Q*ue+ie*k+q*ve+ee*He,g[S+10]=Q*U+ie*J+q*ye+ee*Ke,g[S+11]=Q*N+ie*le+q*Me+ee*Qe,g[S+12]=te*Te+ce*w+fe*be+de*we,g[S+13]=te*ue+ce*k+fe*ve+de*He,g[S+14]=te*U+ce*J+fe*ye+de*Ke,g[S+15]=te*N+ce*le+fe*Me+de*Qe,this},T.prototype.divide=function(f){return this.divideToRef(f,new T)},T.prototype.divideToRef=function(f,g){for(var S=this._m,y=f.m,x=g._m,R=0;R<16;R++)x[R]=S[R]/y[R];return g.markAsUpdated(),g},T.prototype.divideInPlace=function(f){for(var g=this._m,S=f.m,y=0;y<16;y++)g[y]/=S[y];return this.markAsUpdated(),this},T.prototype.minimizeInPlace=function(f){for(var g=this._m,S=f.m,y=0;y<16;y++)g[y]=Math.min(g[y],S[y]);return this.markAsUpdated(),this},T.prototype.minimizeInPlaceFromFloats=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];for(var S=this._m,y=0;y<16;y++)S[y]=Math.min(S[y],f[y]);return this.markAsUpdated(),this},T.prototype.maximizeInPlace=function(f){for(var g=this._m,S=f.m,y=0;y<16;y++)g[y]=Math.min(g[y],S[y]);return this.markAsUpdated(),this},T.prototype.maximizeInPlaceFromFloats=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];for(var S=this._m,y=0;y<16;y++)S[y]=Math.min(S[y],f[y]);return this.markAsUpdated(),this},T.prototype.negate=function(){return this.negateToRef(new T)},T.prototype.negateInPlace=function(){for(var f=this._m,g=0;g<16;g++)f[g]=-f[g];return this.markAsUpdated(),this},T.prototype.negateToRef=function(f){for(var g=this._m,S=f._m,y=0;y<16;y++)S[y]=-g[y];return f.markAsUpdated(),f},T.prototype.equals=function(f){var g=f;if(!g)return!1;if((this._isIdentity||g._isIdentity)&&!this._isIdentityDirty&&!g._isIdentityDirty)return this._isIdentity&&g._isIdentity;var S=this.m,y=g.m;return S[0]===y[0]&&S[1]===y[1]&&S[2]===y[2]&&S[3]===y[3]&&S[4]===y[4]&&S[5]===y[5]&&S[6]===y[6]&&S[7]===y[7]&&S[8]===y[8]&&S[9]===y[9]&&S[10]===y[10]&&S[11]===y[11]&&S[12]===y[12]&&S[13]===y[13]&&S[14]===y[14]&&S[15]===y[15]},T.prototype.equalsWithEpsilon=function(f,g){g===void 0&&(g=0);for(var S=this._m,y=f.m,x=0;x<16;x++)if(!(0,c.WithinEpsilon)(S[x],y[x],g))return!1;return!0},T.prototype.equalsToFloats=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];for(var S=this._m,y=0;y<16;y++)if(S[y]!=f[y])return!1;return!0},T.prototype.floor=function(){return this.floorToRef(new T)},T.prototype.floorToRef=function(f){for(var g=this._m,S=f._m,y=0;y<16;y++)S[y]=Math.floor(g[y]);return f.markAsUpdated(),f},T.prototype.fract=function(){return this.fractToRef(new T)},T.prototype.fractToRef=function(f){for(var g=this._m,S=f._m,y=0;y<16;y++)S[y]=g[y]-Math.floor(g[y]);return f.markAsUpdated(),f},T.prototype.clone=function(){var f=new T;return f.copyFrom(this),f},T.prototype.getClassName=function(){return"Matrix"},T.prototype.getHashCode=function(){for(var f=u(this._m[0]),g=1;g<16;g++)f=397*f^u(this._m[g]);return f},T.prototype.decomposeToTransformNode=function(f){return f.rotationQuaternion=f.rotationQuaternion||new m,this.decompose(f.scaling,f.rotationQuaternion,f.position)},T.prototype.decompose=function(f,g,S,y,x){if(x===void 0&&(x=!0),this._isIdentity)return S&&S.setAll(0),f&&f.setAll(1),g&&g.copyFromFloats(0,0,0,1),!0;var R=this._m;if(S&&S.copyFromFloats(R[12],R[13],R[14]),(f=f||b.Vector3[0]).x=Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2]),f.y=Math.sqrt(R[4]*R[4]+R[5]*R[5]+R[6]*R[6]),f.z=Math.sqrt(R[8]*R[8]+R[9]*R[9]+R[10]*R[10]),y){var I=(x?y.absoluteScaling.x:y.scaling.x)<0?-1:1,M=(x?y.absoluteScaling.y:y.scaling.y)<0?-1:1,D=(x?y.absoluteScaling.z:y.scaling.z)<0?-1:1;f.x*=I,f.y*=M,f.z*=D}else this.determinant()<=0&&(f.y*=-1);if(f._x===0||f._y===0||f._z===0)return g&&g.copyFromFloats(0,0,0,1),!1;if(g){var B=1/f._x,F=1/f._y,X=1/f._z;T.FromValuesToRef(R[0]*B,R[1]*B,R[2]*B,0,R[4]*F,R[5]*F,R[6]*F,0,R[8]*X,R[9]*X,R[10]*X,0,0,0,0,1,b.Matrix[0]),m.FromRotationMatrixToRef(b.Matrix[0],g)}return!0},T.prototype.getRow=function(f){if(f<0||f>3)return null;var g=4*f;return new p(this._m[g+0],this._m[g+1],this._m[g+2],this._m[g+3])},T.prototype.getRowToRef=function(f,g){if(f>=0&&f<=3){var S=4*f;g.x=this._m[S+0],g.y=this._m[S+1],g.z=this._m[S+2],g.w=this._m[S+3]}return g},T.prototype.setRow=function(f,g){return this.setRowFromFloats(f,g.x,g.y,g.z,g.w)},T.prototype.transpose=function(){var f=new T;return T.TransposeToRef(this,f),f},T.prototype.transposeToRef=function(f){return T.TransposeToRef(this,f),f},T.prototype.setRowFromFloats=function(f,g,S,y,x){if(f<0||f>3)return this;var R=4*f;return this._m[R+0]=g,this._m[R+1]=S,this._m[R+2]=y,this._m[R+3]=x,this.markAsUpdated(),this},T.prototype.scale=function(f){var g=new T;return this.scaleToRef(f,g),g},T.prototype.scaleToRef=function(f,g){for(var S=0;S<16;S++)g._m[S]=this._m[S]*f;return g.markAsUpdated(),g},T.prototype.scaleAndAddToRef=function(f,g){for(var S=0;S<16;S++)g._m[S]+=this._m[S]*f;return g.markAsUpdated(),g},T.prototype.scaleInPlace=function(f){for(var g=this._m,S=0;S<16;S++)g[S]*=f;return this.markAsUpdated(),this},T.prototype.toNormalMatrix=function(f){var g=b.Matrix[0];this.invertToRef(g),g.transposeToRef(f);var S=f._m;return T.FromValuesToRef(S[0],S[1],S[2],0,S[4],S[5],S[6],0,S[8],S[9],S[10],0,0,0,0,1,f),f},T.prototype.getRotationMatrix=function(){var f=new T;return this.getRotationMatrixToRef(f),f},T.prototype.getRotationMatrixToRef=function(f){var g=b.Vector3[0];if(!this.decompose(g))return T.IdentityToRef(f),f;var S=this._m,y=1/g._x,x=1/g._y,R=1/g._z;return T.FromValuesToRef(S[0]*y,S[1]*y,S[2]*y,0,S[4]*x,S[5]*x,S[6]*x,0,S[8]*R,S[9]*R,S[10]*R,0,0,0,0,1,f),f},T.prototype.toggleModelMatrixHandInPlace=function(){var f=this._m;return f[2]*=-1,f[6]*=-1,f[8]*=-1,f[9]*=-1,f[14]*=-1,this.markAsUpdated(),this},T.prototype.toggleProjectionMatrixHandInPlace=function(){var f=this._m;return f[8]*=-1,f[9]*=-1,f[10]*=-1,f[11]*=-1,this.markAsUpdated(),this},T.FromArray=function(f,g){g===void 0&&(g=0);var S=new T;return T.FromArrayToRef(f,g,S),S},T.FromArrayToRef=function(f,g,S){for(var y=0;y<16;y++)S._m[y]=f[y+g];return S.markAsUpdated(),S},T.FromFloat32ArrayToRefScaled=function(f,g,S,y){return y._m[0]=f[0+g]*S,y._m[1]=f[1+g]*S,y._m[2]=f[2+g]*S,y._m[3]=f[3+g]*S,y._m[4]=f[4+g]*S,y._m[5]=f[5+g]*S,y._m[6]=f[6+g]*S,y._m[7]=f[7+g]*S,y._m[8]=f[8+g]*S,y._m[9]=f[9+g]*S,y._m[10]=f[10+g]*S,y._m[11]=f[11+g]*S,y._m[12]=f[12+g]*S,y._m[13]=f[13+g]*S,y._m[14]=f[14+g]*S,y._m[15]=f[15+g]*S,y.markAsUpdated(),y},Object.defineProperty(T,"IdentityReadOnly",{get:function(){return T._IdentityReadOnly},enumerable:!1,configurable:!0}),T.FromValuesToRef=function(f,g,S,y,x,R,I,M,D,B,F,X,$,Q,ie,q,ee){var te=ee._m;te[0]=f,te[1]=g,te[2]=S,te[3]=y,te[4]=x,te[5]=R,te[6]=I,te[7]=M,te[8]=D,te[9]=B,te[10]=F,te[11]=X,te[12]=$,te[13]=Q,te[14]=ie,te[15]=q,ee.markAsUpdated()},T.FromValues=function(f,g,S,y,x,R,I,M,D,B,F,X,$,Q,ie,q){var ee=new T,te=ee._m;return te[0]=f,te[1]=g,te[2]=S,te[3]=y,te[4]=x,te[5]=R,te[6]=I,te[7]=M,te[8]=D,te[9]=B,te[10]=F,te[11]=X,te[12]=$,te[13]=Q,te[14]=ie,te[15]=q,ee.markAsUpdated(),ee},T.Compose=function(f,g,S){var y=new T;return T.ComposeToRef(f,g,S,y),y},T.ComposeToRef=function(f,g,S,y){var x=y._m,R=g._x,I=g._y,M=g._z,D=g._w,B=R+R,F=I+I,X=M+M,$=R*B,Q=R*F,ie=R*X,q=I*F,ee=I*X,te=M*X,ce=D*B,fe=D*F,de=D*X,Te=f._x,ue=f._y,U=f._z;return x[0]=(1-(q+te))*Te,x[1]=(Q+de)*Te,x[2]=(ie-fe)*Te,x[3]=0,x[4]=(Q-de)*ue,x[5]=(1-($+te))*ue,x[6]=(ee+ce)*ue,x[7]=0,x[8]=(ie+fe)*U,x[9]=(ee-ce)*U,x[10]=(1-($+q))*U,x[11]=0,x[12]=S._x,x[13]=S._y,x[14]=S._z,x[15]=1,y.markAsUpdated(),y},T.Identity=function(){var f=T.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return f._updateIdentityStatus(!0),f},T.IdentityToRef=function(f){return T.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,f),f._updateIdentityStatus(!0),f},T.Zero=function(){var f=T.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return f._updateIdentityStatus(!1),f},T.RotationX=function(f){var g=new T;return T.RotationXToRef(f,g),g},T.Invert=function(f){var g=new T;return f.invertToRef(g),g},T.RotationXToRef=function(f,g){var S=Math.sin(f),y=Math.cos(f);return T.FromValuesToRef(1,0,0,0,0,y,S,0,0,-S,y,0,0,0,0,1,g),g._updateIdentityStatus(y===1&&S===0),g},T.RotationY=function(f){var g=new T;return T.RotationYToRef(f,g),g},T.RotationYToRef=function(f,g){var S=Math.sin(f),y=Math.cos(f);return T.FromValuesToRef(y,0,-S,0,0,1,0,0,S,0,y,0,0,0,0,1,g),g._updateIdentityStatus(y===1&&S===0),g},T.RotationZ=function(f){var g=new T;return T.RotationZToRef(f,g),g},T.RotationZToRef=function(f,g){var S=Math.sin(f),y=Math.cos(f);return T.FromValuesToRef(y,S,0,0,-S,y,0,0,0,0,1,0,0,0,0,1,g),g._updateIdentityStatus(y===1&&S===0),g},T.RotationAxis=function(f,g){var S=new T;return T.RotationAxisToRef(f,g,S),S},T.RotationAxisToRef=function(f,g,S){var y=Math.sin(-g),x=Math.cos(-g),R=1-x;f=f.normalizeToRef(b.Vector3[0]);var I=S._m;return I[0]=f._x*f._x*R+x,I[1]=f._x*f._y*R-f._z*y,I[2]=f._x*f._z*R+f._y*y,I[3]=0,I[4]=f._y*f._x*R+f._z*y,I[5]=f._y*f._y*R+x,I[6]=f._y*f._z*R-f._x*y,I[7]=0,I[8]=f._z*f._x*R-f._y*y,I[9]=f._z*f._y*R+f._x*y,I[10]=f._z*f._z*R+x,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,S.markAsUpdated(),S},T.RotationAlignToRef=function(f,g,S,y){y===void 0&&(y=!1);var x=h.Dot(g,f),R=S._m;if(x<-1+i.bH)R[0]=-1,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=y?1:-1,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=y?-1:1,R[11]=0;else{var I=h.Cross(g,f),M=1/(1+x);R[0]=I._x*I._x*M+x,R[1]=I._y*I._x*M-I._z,R[2]=I._z*I._x*M+I._y,R[3]=0,R[4]=I._x*I._y*M+I._z,R[5]=I._y*I._y*M+x,R[6]=I._z*I._y*M-I._x,R[7]=0,R[8]=I._x*I._z*M-I._y,R[9]=I._y*I._z*M+I._x,R[10]=I._z*I._z*M+x,R[11]=0}return R[12]=0,R[13]=0,R[14]=0,R[15]=1,S.markAsUpdated(),S},T.RotationYawPitchRoll=function(f,g,S){var y=new T;return T.RotationYawPitchRollToRef(f,g,S,y),y},T.RotationYawPitchRollToRef=function(f,g,S,y){return m.RotationYawPitchRollToRef(f,g,S,b.Quaternion[0]),b.Quaternion[0].toRotationMatrix(y),y},T.Scaling=function(f,g,S){var y=new T;return T.ScalingToRef(f,g,S,y),y},T.ScalingToRef=function(f,g,S,y){return T.FromValuesToRef(f,0,0,0,0,g,0,0,0,0,S,0,0,0,0,1,y),y._updateIdentityStatus(f===1&&g===1&&S===1),y},T.Translation=function(f,g,S){var y=new T;return T.TranslationToRef(f,g,S,y),y},T.TranslationToRef=function(f,g,S,y){return T.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,f,g,S,1,y),y._updateIdentityStatus(f===0&&g===0&&S===0),y},T.Lerp=function(f,g,S){var y=new T;return T.LerpToRef(f,g,S,y),y},T.LerpToRef=function(f,g,S,y){for(var x=y._m,R=f.m,I=g.m,M=0;M<16;M++)x[M]=R[M]*(1-S)+I[M]*S;return y.markAsUpdated(),y},T.DecomposeLerp=function(f,g,S){var y=new T;return T.DecomposeLerpToRef(f,g,S,y),y},T.DecomposeLerpToRef=function(f,g,S,y){var x=b.Vector3[0],R=b.Quaternion[0],I=b.Vector3[1];f.decompose(x,R,I);var M=b.Vector3[2],D=b.Quaternion[1],B=b.Vector3[3];g.decompose(M,D,B);var F=b.Vector3[4];h.LerpToRef(x,M,S,F);var X=b.Quaternion[2];m.SlerpToRef(R,D,S,X);var $=b.Vector3[5];return h.LerpToRef(I,B,S,$),T.ComposeToRef(F,X,$,y),y},T.LookAtLH=function(f,g,S){var y=new T;return T.LookAtLHToRef(f,g,S,y),y},T.LookAtLHToRef=function(f,g,S,y){var x=b.Vector3[0],R=b.Vector3[1],I=b.Vector3[2];g.subtractToRef(f,I),I.normalize(),h.CrossToRef(S,I,x);var M=x.lengthSquared();M===0?x.x=1:x.normalizeFromLength(Math.sqrt(M)),h.CrossToRef(I,x,R),R.normalize();var D=-h.Dot(x,f),B=-h.Dot(R,f),F=-h.Dot(I,f);return T.FromValuesToRef(x._x,R._x,I._x,0,x._y,R._y,I._y,0,x._z,R._z,I._z,0,D,B,F,1,y),y},T.LookAtRH=function(f,g,S){var y=new T;return T.LookAtRHToRef(f,g,S,y),y},T.LookAtRHToRef=function(f,g,S,y){var x=b.Vector3[0],R=b.Vector3[1],I=b.Vector3[2];f.subtractToRef(g,I),I.normalize(),h.CrossToRef(S,I,x);var M=x.lengthSquared();M===0?x.x=1:x.normalizeFromLength(Math.sqrt(M)),h.CrossToRef(I,x,R),R.normalize();var D=-h.Dot(x,f),B=-h.Dot(R,f),F=-h.Dot(I,f);return T.FromValuesToRef(x._x,R._x,I._x,0,x._y,R._y,I._y,0,x._z,R._z,I._z,0,D,B,F,1,y),y},T.LookDirectionLH=function(f,g){var S=new T;return T.LookDirectionLHToRef(f,g,S),S},T.LookDirectionLHToRef=function(f,g,S){var y=b.Vector3[0];y.copyFrom(f),y.scaleInPlace(-1);var x=b.Vector3[1];return h.CrossToRef(g,y,x),T.FromValuesToRef(x._x,x._y,x._z,0,g._x,g._y,g._z,0,y._x,y._y,y._z,0,0,0,0,1,S),S},T.LookDirectionRH=function(f,g){var S=new T;return T.LookDirectionRHToRef(f,g,S),S},T.LookDirectionRHToRef=function(f,g,S){var y=b.Vector3[2];return h.CrossToRef(g,f,y),T.FromValuesToRef(y._x,y._y,y._z,0,g._x,g._y,g._z,0,f._x,f._y,f._z,0,0,0,0,1,S),S},T.OrthoLH=function(f,g,S,y,x){var R=new T;return T.OrthoLHToRef(f,g,S,y,R,x),R},T.OrthoLHToRef=function(f,g,S,y,x,R){var I=2/f,M=2/g,D=2/(y-S),B=-(y+S)/(y-S);return T.FromValuesToRef(I,0,0,0,0,M,0,0,0,0,D,0,0,0,B,1,x),R&&x.multiplyToRef(C,x),x._updateIdentityStatus(I===1&&M===1&&D===1&&B===0),x},T.OrthoOffCenterLH=function(f,g,S,y,x,R,I){var M=new T;return T.OrthoOffCenterLHToRef(f,g,S,y,x,R,M,I),M},T.OrthoOffCenterLHToRef=function(f,g,S,y,x,R,I,M){var D=2/(g-f),B=2/(y-S),F=2/(R-x),X=-(R+x)/(R-x),$=(f+g)/(f-g),Q=(y+S)/(S-y);return T.FromValuesToRef(D,0,0,0,0,B,0,0,0,0,F,0,$,Q,X,1,I),M&&I.multiplyToRef(C,I),I.markAsUpdated(),I},T.ObliqueOffCenterLHToRef=function(f,g,S,y,x,R,I,M,D,B,F){var X=-I*Math.cos(M),$=-I*Math.sin(M);return T.TranslationToRef(0,0,-D,b.Matrix[1]),T.FromValuesToRef(1,0,0,0,0,1,0,0,X,$,1,0,0,0,0,1,b.Matrix[0]),b.Matrix[1].multiplyToRef(b.Matrix[0],b.Matrix[0]),T.TranslationToRef(0,0,D,b.Matrix[1]),b.Matrix[0].multiplyToRef(b.Matrix[1],b.Matrix[0]),T.OrthoOffCenterLHToRef(f,g,S,y,x,R,B,F),b.Matrix[0].multiplyToRef(B,B),B},T.OrthoOffCenterRH=function(f,g,S,y,x,R,I){var M=new T;return T.OrthoOffCenterRHToRef(f,g,S,y,x,R,M,I),M},T.OrthoOffCenterRHToRef=function(f,g,S,y,x,R,I,M){return T.OrthoOffCenterLHToRef(f,g,S,y,x,R,I,M),I._m[10]*=-1,I},T.ObliqueOffCenterRHToRef=function(f,g,S,y,x,R,I,M,D,B,F){var X=I*Math.cos(M),$=I*Math.sin(M);return T.TranslationToRef(0,0,D,b.Matrix[1]),T.FromValuesToRef(1,0,0,0,0,1,0,0,X,$,1,0,0,0,0,1,b.Matrix[0]),b.Matrix[1].multiplyToRef(b.Matrix[0],b.Matrix[0]),T.TranslationToRef(0,0,-D,b.Matrix[1]),b.Matrix[0].multiplyToRef(b.Matrix[1],b.Matrix[0]),T.OrthoOffCenterRHToRef(f,g,S,y,x,R,B,F),b.Matrix[0].multiplyToRef(B,B),B},T.PerspectiveLH=function(f,g,S,y,x,R){R===void 0&&(R=0);var I=new T,M=2*S/f,D=2*S/g,B=(y+S)/(y-S),F=-2*y*S/(y-S),X=Math.tan(R);return T.FromValuesToRef(M,0,0,0,0,D,0,X,0,0,B,1,0,0,F,0,I),x&&I.multiplyToRef(C,I),I._updateIdentityStatus(!1),I},T.PerspectiveFovLH=function(f,g,S,y,x,R,I){R===void 0&&(R=0),I===void 0&&(I=!1);var M=new T;return T.PerspectiveFovLHToRef(f,g,S,y,M,!0,x,R,I),M},T.PerspectiveFovLHToRef=function(f,g,S,y,x,R,I,M,D){R===void 0&&(R=!0),M===void 0&&(M=0),D===void 0&&(D=!1);var B=S,F=y,X=1/Math.tan(.5*f),$=R?X/g:X,Q=R?X:X*g,ie=D&&B===0?-1:F!==0?(F+B)/(F-B):1,q=D&&B===0?2*F:F!==0?-2*F*B/(F-B):-2*B,ee=Math.tan(M);return T.FromValuesToRef($,0,0,0,0,Q,0,ee,0,0,ie,1,0,0,q,0,x),I&&x.multiplyToRef(C,x),x._updateIdentityStatus(!1),x},T.PerspectiveFovReverseLHToRef=function(f,g,S,y,x,R,I,M){R===void 0&&(R=!0),M===void 0&&(M=0);var D=1/Math.tan(.5*f),B=R?D/g:D,F=R?D:D*g,X=Math.tan(M);return T.FromValuesToRef(B,0,0,0,0,F,0,X,0,0,-S,1,0,0,1,0,x),I&&x.multiplyToRef(C,x),x._updateIdentityStatus(!1),x},T.PerspectiveFovRH=function(f,g,S,y,x,R,I){R===void 0&&(R=0),I===void 0&&(I=!1);var M=new T;return T.PerspectiveFovRHToRef(f,g,S,y,M,!0,x,R,I),M},T.PerspectiveFovRHToRef=function(f,g,S,y,x,R,I,M,D){R===void 0&&(R=!0),M===void 0&&(M=0),D===void 0&&(D=!1);var B=S,F=y,X=1/Math.tan(.5*f),$=R?X/g:X,Q=R?X:X*g,ie=D&&B===0?1:F!==0?-(F+B)/(F-B):-1,q=D&&B===0?2*F:F!==0?-2*F*B/(F-B):-2*B,ee=Math.tan(M);return T.FromValuesToRef($,0,0,0,0,Q,0,ee,0,0,ie,-1,0,0,q,0,x),I&&x.multiplyToRef(C,x),x._updateIdentityStatus(!1),x},T.PerspectiveFovReverseRHToRef=function(f,g,S,y,x,R,I,M){R===void 0&&(R=!0),M===void 0&&(M=0);var D=1/Math.tan(.5*f),B=R?D/g:D,F=R?D:D*g,X=Math.tan(M);return T.FromValuesToRef(B,0,0,0,0,F,0,X,0,0,-S,-1,0,0,-1,0,x),I&&x.multiplyToRef(C,x),x._updateIdentityStatus(!1),x},T.GetFinalMatrix=function(f,g,S,y,x,R){var I=f.width,M=f.height,D=f.x,B=f.y,F=T.FromValues(I/2,0,0,0,0,-M/2,0,0,0,0,R-x,0,D+I/2,M/2+B,x,1),X=new T;return g.multiplyToRef(S,X),X.multiplyToRef(y,X),X.multiplyToRef(F,X)},T.GetAsMatrix2x2=function(f){var g=f.m,S=[g[0],g[1],g[4],g[5]];return s.I.MatrixUse64Bits?S:new Float32Array(S)},T.GetAsMatrix3x3=function(f){var g=f.m,S=[g[0],g[1],g[2],g[4],g[5],g[6],g[8],g[9],g[10]];return s.I.MatrixUse64Bits?S:new Float32Array(S)},T.Transpose=function(f){var g=new T;return T.TransposeToRef(f,g),g},T.TransposeToRef=function(f,g){var S=f.m,y=S[0],x=S[4],R=S[8],I=S[12],M=S[1],D=S[5],B=S[9],F=S[13],X=S[2],$=S[6],Q=S[10],ie=S[14],q=S[3],ee=S[7],te=S[11],ce=S[15],fe=g._m;return fe[0]=y,fe[1]=x,fe[2]=R,fe[3]=I,fe[4]=M,fe[5]=D,fe[6]=B,fe[7]=F,fe[8]=X,fe[9]=$,fe[10]=Q,fe[11]=ie,fe[12]=q,fe[13]=ee,fe[14]=te,fe[15]=ce,g.markAsUpdated(),g._updateIdentityStatus(f._isIdentity,f._isIdentityDirty),g},T.Reflection=function(f){var g=new T;return T.ReflectionToRef(f,g),g},T.ReflectionToRef=function(f,g){f.normalize();var S=f.normal.x,y=f.normal.y,x=f.normal.z,R=-2*S,I=-2*y,M=-2*x;return T.FromValuesToRef(R*S+1,I*S,M*S,0,R*y,I*y+1,M*y,0,R*x,I*x,M*x+1,0,R*f.d,I*f.d,M*f.d,1,g),g},T.FromXYZAxesToRef=function(f,g,S,y){return T.FromValuesToRef(f._x,f._y,f._z,0,g._x,g._y,g._z,0,S._x,S._y,S._z,0,0,0,0,1,y),y},T.FromQuaternionToRef=function(f,g){var S=f._x*f._x,y=f._y*f._y,x=f._z*f._z,R=f._x*f._y,I=f._z*f._w,M=f._z*f._x,D=f._y*f._w,B=f._y*f._z,F=f._x*f._w;return g._m[0]=1-2*(y+x),g._m[1]=2*(R+I),g._m[2]=2*(M-D),g._m[3]=0,g._m[4]=2*(R-I),g._m[5]=1-2*(x+S),g._m[6]=2*(B+F),g._m[7]=0,g._m[8]=2*(M+D),g._m[9]=2*(B-F),g._m[10]=1-2*(y+S),g._m[11]=0,g._m[12]=0,g._m[13]=0,g._m[14]=0,g._m[15]=1,g.markAsUpdated(),g},T._UpdateFlagSeed=0,T._IdentityReadOnly=T.Identity(),T}();Object.defineProperties(v.prototype,{dimension:{value:[4,4]},rank:{value:2}});var b=function(){function T(){}return T.Vector3=(0,o.ln)(11,h.Zero),T.Matrix=(0,o.ln)(2,v.Identity),T.Quaternion=(0,o.ln)(3,m.Zero),T}(),E=function(){function T(){}return T.Vector2=(0,o.ln)(3,d.Zero),T.Vector3=(0,o.ln)(13,h.Zero),T.Vector4=(0,o.ln)(3,p.Zero),T.Quaternion=(0,o.ln)(3,m.Zero),T.Matrix=(0,o.ln)(8,v.Identity),T}();(0,a.Y5)("BABYLON.Vector2",d),(0,a.Y5)("BABYLON.Vector3",h),(0,a.Y5)("BABYLON.Vector4",p),(0,a.Y5)("BABYLON.Matrix",v);var C=v.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},25187:(r,t,e)=>{e.d(t,{L:()=>n});var n=function(){function i(o,a,s,l){this.x=o,this.y=a,this.width=s,this.height=l}return i.prototype.toGlobal=function(o,a){return new i(this.x*o,this.y*a,this.width*o,this.height*a)},i.prototype.toGlobalToRef=function(o,a,s){return s.x=this.x*o,s.y=this.y*a,s.width=this.width*o,s.height=this.height*a,this},i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height)},i}()},51428:(r,t,e)=>{e.d(t,{O:()=>c,Q:()=>u});var n=e(8046),i=e(51322),o=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],a=[function(){return 1},function(d){return d.y},function(d){return d.z},function(d){return d.x},function(d){return d.x*d.y},function(d){return d.y*d.z},function(d){return 3*d.z*d.z-1},function(d){return d.x*d.z},function(d){return d.x*d.x-d.y*d.y}],s=function(d,h){return o[d]*a[d](h)},l=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],c=function(){function d(){this.preScaled=!1,this.l00=n.Pq.Zero(),this.l1_1=n.Pq.Zero(),this.l10=n.Pq.Zero(),this.l11=n.Pq.Zero(),this.l2_2=n.Pq.Zero(),this.l2_1=n.Pq.Zero(),this.l20=n.Pq.Zero(),this.l21=n.Pq.Zero(),this.l22=n.Pq.Zero()}return d.prototype.addLight=function(h,p,m){i.AA.Vector3[0].set(p.r,p.g,p.b);var v=i.AA.Vector3[0],b=i.AA.Vector3[1];v.scaleToRef(m,b),b.scaleToRef(s(0,h),i.AA.Vector3[2]),this.l00.addInPlace(i.AA.Vector3[2]),b.scaleToRef(s(1,h),i.AA.Vector3[2]),this.l1_1.addInPlace(i.AA.Vector3[2]),b.scaleToRef(s(2,h),i.AA.Vector3[2]),this.l10.addInPlace(i.AA.Vector3[2]),b.scaleToRef(s(3,h),i.AA.Vector3[2]),this.l11.addInPlace(i.AA.Vector3[2]),b.scaleToRef(s(4,h),i.AA.Vector3[2]),this.l2_2.addInPlace(i.AA.Vector3[2]),b.scaleToRef(s(5,h),i.AA.Vector3[2]),this.l2_1.addInPlace(i.AA.Vector3[2]),b.scaleToRef(s(6,h),i.AA.Vector3[2]),this.l20.addInPlace(i.AA.Vector3[2]),b.scaleToRef(s(7,h),i.AA.Vector3[2]),this.l21.addInPlace(i.AA.Vector3[2]),b.scaleToRef(s(8,h),i.AA.Vector3[2]),this.l22.addInPlace(i.AA.Vector3[2])},d.prototype.scaleInPlace=function(h){this.l00.scaleInPlace(h),this.l1_1.scaleInPlace(h),this.l10.scaleInPlace(h),this.l11.scaleInPlace(h),this.l2_2.scaleInPlace(h),this.l2_1.scaleInPlace(h),this.l20.scaleInPlace(h),this.l21.scaleInPlace(h),this.l22.scaleInPlace(h)},d.prototype.convertIncidentRadianceToIrradiance=function(){this.l00.scaleInPlace(l[0]),this.l1_1.scaleInPlace(l[1]),this.l10.scaleInPlace(l[2]),this.l11.scaleInPlace(l[3]),this.l2_2.scaleInPlace(l[4]),this.l2_1.scaleInPlace(l[5]),this.l20.scaleInPlace(l[6]),this.l21.scaleInPlace(l[7]),this.l22.scaleInPlace(l[8])},d.prototype.convertIrradianceToLambertianRadiance=function(){this.scaleInPlace(1/Math.PI)},d.prototype.preScaleForRendering=function(){this.preScaled=!0,this.l00.scaleInPlace(o[0]),this.l1_1.scaleInPlace(o[1]),this.l10.scaleInPlace(o[2]),this.l11.scaleInPlace(o[3]),this.l2_2.scaleInPlace(o[4]),this.l2_1.scaleInPlace(o[5]),this.l20.scaleInPlace(o[6]),this.l21.scaleInPlace(o[7]),this.l22.scaleInPlace(o[8])},d.prototype.updateFromArray=function(h){return n.Pq.FromArrayToRef(h[0],0,this.l00),n.Pq.FromArrayToRef(h[1],0,this.l1_1),n.Pq.FromArrayToRef(h[2],0,this.l10),n.Pq.FromArrayToRef(h[3],0,this.l11),n.Pq.FromArrayToRef(h[4],0,this.l2_2),n.Pq.FromArrayToRef(h[5],0,this.l2_1),n.Pq.FromArrayToRef(h[6],0,this.l20),n.Pq.FromArrayToRef(h[7],0,this.l21),n.Pq.FromArrayToRef(h[8],0,this.l22),this},d.prototype.updateFromFloatsArray=function(h){return n.Pq.FromFloatsToRef(h[0],h[1],h[2],this.l00),n.Pq.FromFloatsToRef(h[3],h[4],h[5],this.l1_1),n.Pq.FromFloatsToRef(h[6],h[7],h[8],this.l10),n.Pq.FromFloatsToRef(h[9],h[10],h[11],this.l11),n.Pq.FromFloatsToRef(h[12],h[13],h[14],this.l2_2),n.Pq.FromFloatsToRef(h[15],h[16],h[17],this.l2_1),n.Pq.FromFloatsToRef(h[18],h[19],h[20],this.l20),n.Pq.FromFloatsToRef(h[21],h[22],h[23],this.l21),n.Pq.FromFloatsToRef(h[24],h[25],h[26],this.l22),this},d.FromArray=function(h){return new d().updateFromArray(h)},d.FromPolynomial=function(h){var p=new d;return p.l00=h.xx.scale(.376127).add(h.yy.scale(.376127)).add(h.zz.scale(.376126)),p.l1_1=h.y.scale(.977204),p.l10=h.z.scale(.977204),p.l11=h.x.scale(.977204),p.l2_2=h.xy.scale(1.16538),p.l2_1=h.yz.scale(1.16538),p.l20=h.zz.scale(1.34567).subtract(h.xx.scale(.672834)).subtract(h.yy.scale(.672834)),p.l21=h.zx.scale(1.16538),p.l22=h.xx.scale(1.16538).subtract(h.yy.scale(1.16538)),p.l1_1.scaleInPlace(-1),p.l11.scaleInPlace(-1),p.l2_1.scaleInPlace(-1),p.l21.scaleInPlace(-1),p.scaleInPlace(Math.PI),p},d}(),u=function(){function d(){this.x=n.Pq.Zero(),this.y=n.Pq.Zero(),this.z=n.Pq.Zero(),this.xx=n.Pq.Zero(),this.yy=n.Pq.Zero(),this.zz=n.Pq.Zero(),this.xy=n.Pq.Zero(),this.yz=n.Pq.Zero(),this.zx=n.Pq.Zero()}return Object.defineProperty(d.prototype,"preScaledHarmonics",{get:function(){return this._harmonics||(this._harmonics=c.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics},enumerable:!1,configurable:!0}),d.prototype.addAmbient=function(h){i.AA.Vector3[0].copyFromFloats(h.r,h.g,h.b);var p=i.AA.Vector3[0];this.xx.addInPlace(p),this.yy.addInPlace(p),this.zz.addInPlace(p)},d.prototype.scaleInPlace=function(h){this.x.scaleInPlace(h),this.y.scaleInPlace(h),this.z.scaleInPlace(h),this.xx.scaleInPlace(h),this.yy.scaleInPlace(h),this.zz.scaleInPlace(h),this.yz.scaleInPlace(h),this.zx.scaleInPlace(h),this.xy.scaleInPlace(h)},d.prototype.updateFromHarmonics=function(h){return this._harmonics=h,this.x.copyFrom(h.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(h.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(h.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(h.l00),i.AA.Vector3[0].copyFrom(h.l20).scaleInPlace(.247708),i.AA.Vector3[1].copyFrom(h.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(i.AA.Vector3[0]).addInPlace(i.AA.Vector3[1]),this.yy.copyFrom(h.l00),this.yy.scaleInPlace(.886277).subtractInPlace(i.AA.Vector3[0]).subtractInPlace(i.AA.Vector3[1]),this.zz.copyFrom(h.l00),i.AA.Vector3[0].copyFrom(h.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(i.AA.Vector3[0]),this.yz.copyFrom(h.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(h.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(h.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this},d.FromHarmonics=function(h){return new d().updateFromHarmonics(h)},d.FromArray=function(h){var p=new d;return n.Pq.FromArrayToRef(h[0],0,p.x),n.Pq.FromArrayToRef(h[1],0,p.y),n.Pq.FromArrayToRef(h[2],0,p.z),n.Pq.FromArrayToRef(h[3],0,p.xx),n.Pq.FromArrayToRef(h[4],0,p.yy),n.Pq.FromArrayToRef(h[5],0,p.zz),n.Pq.FromArrayToRef(h[6],0,p.yz),n.Pq.FromArrayToRef(h[7],0,p.zx),n.Pq.FromArrayToRef(h[8],0,p.xy),p},d}()},26218:(r,t,e)=>{e.d(t,{A:()=>i});var n=e(78322),i=function(o){function a(s){var l=o.call(this)||this;return l._buffer=s,l}return(0,n.C6)(a,o),Object.defineProperty(a.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),a}(e(37943).n)},75768:(r,t,e)=>{e.d(t,{d:()=>u});var n=e(8046),i=e(48810),o=e(51428),a=e(81152),s=e(56740),l=e(64726),c=function(d,h,p,m){this.name=d,this.worldAxisForNormal=h,this.worldAxisForFileX=p,this.worldAxisForFileY=m},u=function(){function d(){}return d.ConvertCubeMapTextureToSphericalPolynomial=function(h){var p,m=this;if(!h.isCube)return null;(p=h.getScene())===null||p===void 0||p.getEngine().flushFramebuffer();var v,b,E=h.getSize().width,C=h.readPixels(0,void 0,void 0,!1),T=h.readPixels(1,void 0,void 0,!1);h.isRenderTarget?(v=h.readPixels(3,void 0,void 0,!1),b=h.readPixels(2,void 0,void 0,!1)):(v=h.readPixels(2,void 0,void 0,!1),b=h.readPixels(3,void 0,void 0,!1));var f=h.readPixels(4,void 0,void 0,!1),g=h.readPixels(5,void 0,void 0,!1),S=h.gammaSpace,y=a.Y.TEXTUREFORMAT_RGBA,x=a.Y.TEXTURETYPE_UNSIGNED_INT;return h.textureType!=a.Y.TEXTURETYPE_FLOAT&&h.textureType!=a.Y.TEXTURETYPE_HALF_FLOAT||(x=a.Y.TEXTURETYPE_FLOAT),new Promise(function(R){Promise.all([T,C,v,b,f,g]).then(function(I){var M=I[0],D=I[1],B=I[2],F=I[3],X=I[4],$=I[5],Q={size:E,right:D,left:M,up:B,down:F,front:X,back:$,format:y,type:x,gammaSpace:S};R(m.ConvertCubeMapToSphericalPolynomial(Q))})})},d._AreaElement=function(h,p){return Math.atan2(h*p,Math.sqrt(h*h+p*p+1))},d.ConvertCubeMapToSphericalPolynomial=function(h){for(var p=new o.O,m=0,v=2/h.size,b=v,E=.5*v,C=E-1,T=0;T<6;T++)for(var f=this._FileFaces[T],g=h[f.name],S=C,y=h.format===a.Y.TEXTUREFORMAT_RGBA?4:3,x=0;x<h.size;x++){for(var R=C,I=0;I<h.size;I++){var M=f.worldAxisForFileX.scale(R).add(f.worldAxisForFileY.scale(S)).add(f.worldAxisForNormal);M.normalize();var D=this._AreaElement(R-E,S-E)-this._AreaElement(R-E,S+E)-this._AreaElement(R+E,S-E)+this._AreaElement(R+E,S+E),B=g[x*h.size*y+I*y+0],F=g[x*h.size*y+I*y+1],X=g[x*h.size*y+I*y+2];isNaN(B)&&(B=0),isNaN(F)&&(F=0),isNaN(X)&&(X=0),h.type===a.Y.TEXTURETYPE_UNSIGNED_INT&&(B/=255,F/=255,X/=255),h.gammaSpace&&(B=Math.pow((0,i.Clamp)(B),s.tk),F=Math.pow((0,i.Clamp)(F),s.tk),X=Math.pow((0,i.Clamp)(X),s.tk));var $=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){var Q=Math.max(B,F,X);if(Q>$){var ie=$/Q;B*=ie,F*=ie,X*=ie}}else B=(0,i.Clamp)(B,0,$),F=(0,i.Clamp)(F,0,$),X=(0,i.Clamp)(X,0,$);var q=new l.v9(B,F,X);p.addLight(M,q,D),m+=D,R+=v}S+=b}var ee=4*Math.PI*6/6/m;return p.scaleInPlace(ee),p.convertIncidentRadianceToIrradiance(),p.convertIrradianceToLambertianRadiance(),o.Q.FromHarmonics(p)},d._FileFaces=[new c("right",new n.Pq(1,0,0),new n.Pq(0,0,-1),new n.Pq(0,-1,0)),new c("left",new n.Pq(-1,0,0),new n.Pq(0,0,1),new n.Pq(0,-1,0)),new c("up",new n.Pq(0,1,0),new n.Pq(1,0,0),new n.Pq(0,0,1)),new c("down",new n.Pq(0,-1,0),new n.Pq(1,0,0),new n.Pq(0,0,-1)),new c("front",new n.Pq(0,0,1),new n.Pq(1,0,0),new n.Pq(0,-1,0)),new c("back",new n.Pq(0,0,-1),new n.Pq(-1,0,0),new n.Pq(0,-1,0))],d.MAX_HDRI_VALUE=4096,d.PRESERVE_CLAMPED_COLORS=!1,d}()},51967:(r,t,e)=>{e.d(t,{I9:()=>u,LT:()=>l,NK:()=>a,VH:()=>s});var n=e(16814);function i(d,h,p,m,v,b){v>0?(v=function(E,C){return C>1023?1*Math.pow(2,1023)*Math.pow(2,C-1023):C<-1074?1*Math.pow(2,-1074)*Math.pow(2,C+1074):1*Math.pow(2,C)}(0,v-136),d[b+0]=h*v,d[b+1]=p*v,d[b+2]=m*v):(d[b+0]=0,d[b+1]=0,d[b+2]=0)}function o(d,h){for(var p="",m="",v=h;v<d.length-h&&(m=String.fromCharCode(d[v]))!=`
`;v++)p+=m;return p}function a(d){var h,p,m=o(d,0);if(m[0]!="#"||m[1]!="?")throw"Bad HDR Format.";var v=!1,b=!1,E=0;do(m=o(d,E+=m.length+1))=="FORMAT=32-bit_rle_rgbe"?b=!0:m.length==0&&(v=!0);while(!v);if(!b)throw"HDR Bad header format, unsupported FORMAT";m=o(d,E+=m.length+1);var C=/^-Y (.*) \+X (.*)$/g.exec(m);if(!C||C.length<3)throw"HDR Bad header format, no size";if(p=parseInt(C[2]),h=parseInt(C[1]),p<8||p>32767)throw"HDR Bad header format, unsupported size";return{height:h,width:p,dataPosition:E+=m.length+1}}function s(d,h,p){p===void 0&&(p=!1);var m=new Uint8Array(d),v=a(m),b=l(m,v);return n.D.ConvertPanoramaToCubemap(b,v.width,v.height,h,p)}function l(d,h){return function(p,m){for(var v,b,E,C,T,f=m.height,g=m.width,S=m.dataPosition,y=0,x=0,R=0,I=new ArrayBuffer(4*g),M=new Uint8Array(I),D=new ArrayBuffer(m.width*m.height*4*3),B=new Float32Array(D);f>0;){if(v=p[S++],b=p[S++],E=p[S++],C=p[S++],v!=2||b!=2||128&E||m.width<8||m.width>32767)return c(p,m);if((E<<8|C)!=g)throw"HDR Bad header format, wrong scan line width";for(y=0,R=0;R<4;R++)for(x=(R+1)*g;y<x;)if(v=p[S++],b=p[S++],v>128){if((T=v-128)==0||T>x-y)throw"HDR Bad Format, bad scanline data (run)";for(;T-- >0;)M[y++]=b}else{if((T=v)==0||T>x-y)throw"HDR Bad Format, bad scanline data (non-run)";if(M[y++]=b,--T>0)for(var F=0;F<T;F++)M[y++]=p[S++]}for(R=0;R<g;R++)i(B,v=M[R],b=M[R+g],E=M[R+2*g],C=M[R+3*g],(m.height-f)*g*3+3*R);f--}return B}(d,h)}function c(d,h){for(var p,m=h.height,v=h.width,b=h.dataPosition,E=new ArrayBuffer(h.width*h.height*4*3),C=new Float32Array(E);m>0;){for(p=0;p<h.width;p++)i(C,d[b++],d[b++],d[b++],d[b++],(h.height-m)*v*3+3*p);m--}return C}var u={RGBE_ReadHeader:a,GetCubeMapTextureData:s,RGBE_ReadPixels:l}},16814:(r,t,e)=>{e.d(t,{D:()=>o});var n=e(8046),i=e(81152),o=function(){function a(){}return a.ConvertPanoramaToCubemap=function(s,l,c,u,d){if(d===void 0&&(d=!1),!s)throw"ConvertPanoramaToCubemap: input cannot be null";if(s.length!=l*c*3)throw"ConvertPanoramaToCubemap: input size is wrong";return{front:this.CreateCubemapTexture(u,this.FACE_FRONT,s,l,c,d),back:this.CreateCubemapTexture(u,this.FACE_BACK,s,l,c,d),left:this.CreateCubemapTexture(u,this.FACE_LEFT,s,l,c,d),right:this.CreateCubemapTexture(u,this.FACE_RIGHT,s,l,c,d),up:this.CreateCubemapTexture(u,this.FACE_UP,s,l,c,d),down:this.CreateCubemapTexture(u,this.FACE_DOWN,s,l,c,d),size:u,type:i.Y.TEXTURETYPE_FLOAT,format:i.Y.TEXTUREFORMAT_RGB,gammaSpace:!1}},a.CreateCubemapTexture=function(s,l,c,u,d,h){h===void 0&&(h=!1);for(var p=new ArrayBuffer(s*s*4*3),m=new Float32Array(p),v=h?Math.max(1,Math.round(u/4/s)):1,b=1/v,E=b*b,C=l[1].subtract(l[0]).scale(b/s),T=l[3].subtract(l[2]).scale(b/s),f=1/s,g=0,S=0;S<s;S++)for(var y=0;y<v;y++){for(var x=l[0],R=l[2],I=0;I<s;I++)for(var M=0;M<v;M++){var D=R.subtract(x).scale(g).add(x);D.normalize();var B=this.CalcProjectionSpherical(D,c,u,d);m[S*s*3+3*I+0]+=B.r*E,m[S*s*3+3*I+1]+=B.g*E,m[S*s*3+3*I+2]+=B.b*E,x=x.add(C),R=R.add(T)}g+=f*b}return m},a.CalcProjectionSpherical=function(s,l,c,u){for(var d=Math.atan2(s.z,s.x),h=Math.acos(s.y);d<-Math.PI;)d+=2*Math.PI;for(;d>Math.PI;)d-=2*Math.PI;var p=d/Math.PI,m=h/Math.PI;p=.5*p+.5;var v=Math.round(p*c);v<0?v=0:v>=c&&(v=c-1);var b=Math.round(m*u);b<0?b=0:b>=u&&(b=u-1);var E=u-b-1;return{r:l[E*c*3+3*v+0],g:l[E*c*3+3*v+1],b:l[E*c*3+3*v+2]}},a.FACE_LEFT=[new n.Pq(-1,-1,-1),new n.Pq(1,-1,-1),new n.Pq(-1,1,-1),new n.Pq(1,1,-1)],a.FACE_RIGHT=[new n.Pq(1,-1,1),new n.Pq(-1,-1,1),new n.Pq(1,1,1),new n.Pq(-1,1,1)],a.FACE_FRONT=[new n.Pq(1,-1,-1),new n.Pq(1,-1,1),new n.Pq(1,1,-1),new n.Pq(1,1,1)],a.FACE_BACK=[new n.Pq(-1,-1,1),new n.Pq(-1,-1,-1),new n.Pq(-1,1,1),new n.Pq(-1,1,-1)],a.FACE_DOWN=[new n.Pq(1,1,-1),new n.Pq(1,1,1),new n.Pq(-1,1,-1),new n.Pq(-1,1,1)],a.FACE_UP=[new n.Pq(-1,-1,-1),new n.Pq(-1,-1,1),new n.Pq(1,-1,-1),new n.Pq(1,-1,1)],a}()},92548:(r,t,e)=>{e.d(t,{Z:()=>n});var n=function(){function i(){}return i.Eval=function(o,a){return(o=o.match(/\([^()]*\)/g)?o.replace(/\([^()]*\)/g,function(s){return s=s.slice(1,s.length-1),i._HandleParenthesisContent(s,a)}):i._HandleParenthesisContent(o,a))==="true"||o!=="false"&&i.Eval(o,a)},i._HandleParenthesisContent=function(o,a){var s;a=a||function(m){return m==="true"};var l=o.split("||");for(var c in l)if(Object.prototype.hasOwnProperty.call(l,c)){var u=i._SimplifyNegation(l[c].trim()),d=u.split("&&");if(d.length>1)for(var h=0;h<d.length;++h){var p=i._SimplifyNegation(d[h].trim());if(!(s=p!=="true"&&p!=="false"?p[0]==="!"?!a(p.substring(1)):a(p):p==="true")){u="false";break}}if(s||u==="true"){s=!0;break}s=u!=="true"&&u!=="false"?u[0]==="!"?!a(u.substring(1)):a(u):u==="true"}return s?"true":"false"},i._SimplifyNegation=function(o){return(o=(o=o.replace(/^[\s!]+/,function(a){return(a=a.replace(/[\s]/g,function(){return""})).length%2?"!":""})).trim())==="!true"?o="false":o==="!false"&&(o="true"),o},i}()},11296:(r,t,e)=>{function n(s,l){for(var c=[],u=0;u<s;++u)c.push(l());return c}function i(s,l){return n(s,l)}e.d(t,{lL:()=>a,ln:()=>i,mI:()=>n});var o=["push","splice","pop","shift","unshift"];function a(s,l){var c=o.map(function(u){return function(d,h,p){var m=d[h];if(typeof m!="function")return null;var v=function(){var b=d.length,E=v.previous.apply(d,arguments);return p(h,b),E};return m.next=v,v.previous=m,d[h]=v,function(){var b=v.previous;if(b){var E=v.next;E?(b.next=E,E.previous=b):(b.next=void 0,d[h]=b),v.next=void 0,v.previous=void 0}}}(s,u,l)});return function(){c.forEach(function(u){u?.()})}}},82941:(r,t,e)=>{e.d(t,{$e:()=>c,ED:()=>f,Sl:()=>d,SV:()=>u,yT:()=>h,aB:()=>T,af:()=>b,yk:()=>E});var n=e(44957),i=e(50582),o=e(19133),a=e(81152);function s(){var g=null;function S(y,x,R,I,M){var D=y.getImageTranscodedSizeInBytes(x,R,I),B=new Uint8Array(D);return y.transcodeImage(B,x,R,I,1,0)?(M&&(B=function(F,X,$,Q){for(var ie=new Uint16Array(4),q=new Uint16Array($*Q),ee=$/4,te=Q/4,ce=0;ce<te;ce++)for(var fe=0;fe<ee;fe++){var de=0+8*(ce*ee+fe);ie[0]=F[de]|F[de+1]<<8,ie[1]=F[de+2]|F[de+3]<<8,ie[2]=(2*(31&ie[0])+1*(31&ie[1]))/3|(2*(2016&ie[0])+1*(2016&ie[1]))/3&2016|(2*(63488&ie[0])+1*(63488&ie[1]))/3&63488,ie[3]=(2*(31&ie[1])+1*(31&ie[0]))/3|(2*(2016&ie[1])+1*(2016&ie[0]))/3&2016|(2*(63488&ie[1])+1*(63488&ie[0]))/3&63488;for(var Te=0;Te<4;Te++){var ue=F[de+4+Te],U=(4*ce+Te)*$+4*fe;q[U++]=ie[3&ue],q[U++]=ie[ue>>2&3],q[U++]=ie[ue>>4&3],q[U++]=ie[ue>>6&3]}}return q}(B,0,y.getImageWidth(x,R)+3&-4,y.getImageHeight(x,R)+3&-4)),B):null}onmessage=function(y){if(y.data.action==="init"){if(y.data.url)try{importScripts(y.data.url)}catch(ce){postMessage({action:"error",error:ce})}g||(g=BASIS({wasmBinary:y.data.wasmBinary})),g!==null&&g.then(function(ce){BASIS=ce,ce.initializeBasis(),postMessage({action:"init"})})}else if(y.data.action==="transcode"){var x=y.data.config,R=y.data.imageData,I=new BASIS.BasisFile(R),M=function(ce){for(var fe=ce.getHasAlpha(),de=ce.getNumImages(),Te=[],ue=0;ue<de;ue++){for(var U={levels:[]},N=ce.getNumLevels(ue),w=0;w<N;w++){var k={width:ce.getImageWidth(ue,w),height:ce.getImageHeight(ue,w)};U.levels.push(k)}Te.push(U)}return{hasAlpha:fe,images:Te}}(I),D=y.data.ignoreSupportedFormats?null:function(ce,fe){var de=null;return ce.supportedCompressionFormats&&(de=ce.supportedCompressionFormats.astc?10:ce.supportedCompressionFormats.bc7?6:ce.supportedCompressionFormats.s3tc?fe.hasAlpha?3:2:ce.supportedCompressionFormats.pvrtc?fe.hasAlpha?9:8:ce.supportedCompressionFormats.etc2?1:ce.supportedCompressionFormats.etc1?0:14),de}(y.data.config,M),B=!1;D===null&&(B=!0,D=M.hasAlpha?3:2);var F=!0;I.startTranscoding()||(F=!1);for(var X=[],$=0;$<M.images.length&&F;$++){var Q=M.images[$];if(x.loadSingleImage===void 0||x.loadSingleImage===$){var ie=Q.levels.length;x.loadMipmapLevels===!1&&(ie=1);for(var q=0;q<ie;q++){var ee=Q.levels[q],te=S(I,$,q,D,B);if(!te){F=!1;break}ee.transcodedPixels=te,X.push(ee.transcodedPixels.buffer)}}}I.close(),I.delete(),B&&(D=-1),F?postMessage({action:"transcode",success:F,id:y.data.id,fileInfo:M,format:D},X):postMessage({action:"transcode",success:F,id:y.data.id})}}}var l,c=function(){},u=function(){};(function(g){g[g.cTFETC1=0]="cTFETC1",g[g.cTFETC2=1]="cTFETC2",g[g.cTFBC1=2]="cTFBC1",g[g.cTFBC3=3]="cTFBC3",g[g.cTFBC4=4]="cTFBC4",g[g.cTFBC5=5]="cTFBC5",g[g.cTFBC7=6]="cTFBC7",g[g.cTFPVRTC1_4_RGB=8]="cTFPVRTC1_4_RGB",g[g.cTFPVRTC1_4_RGBA=9]="cTFPVRTC1_4_RGBA",g[g.cTFASTC_4x4=10]="cTFASTC_4x4",g[g.cTFATC_RGB=11]="cTFATC_RGB",g[g.cTFATC_RGBA_INTERPOLATED_ALPHA=12]="cTFATC_RGBA_INTERPOLATED_ALPHA",g[g.cTFRGBA32=13]="cTFRGBA32",g[g.cTFRGB565=14]="cTFRGB565",g[g.cTFBGR565=15]="cTFBGR565",g[g.cTFRGBA4444=16]="cTFRGBA4444",g[g.cTFFXT1_RGB=17]="cTFFXT1_RGB",g[g.cTFPVRTC2_4_RGB=18]="cTFPVRTC2_4_RGB",g[g.cTFPVRTC2_4_RGBA=19]="cTFPVRTC2_4_RGBA",g[g.cTFETC2_EAC_R11=20]="cTFETC2_EAC_R11",g[g.cTFETC2_EAC_RG11=21]="cTFETC2_EAC_RG11"})(l||(l={}));var d={JSModuleURL:"".concat(n.S0._DefaultCdnUrl,"/basisTranscoder/1/basis_transcoder.js"),WasmModuleURL:"".concat(n.S0._DefaultCdnUrl,"/basisTranscoder/1/basis_transcoder.wasm")},h=function(g,S){var y;switch(g){case l.cTFETC1:y=a.Y.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL;break;case l.cTFBC1:y=a.Y.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1;break;case l.cTFBC4:y=a.Y.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5;break;case l.cTFASTC_4x4:y=a.Y.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4;break;case l.cTFETC2:y=a.Y.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC;break;case l.cTFBC7:y=a.Y.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM}if(y===void 0)throw"The chosen Basis transcoder format is not currently supported";return y},p=null,m=null,v=0,b=function(g){m=g},E=function(g,S){var y=g instanceof ArrayBuffer?new Uint8Array(g):g;return new Promise(function(x,R){(p||(p=new Promise(function(I,M){m?I(m):n.S0.LoadFileAsync(n.S0.GetBabylonScriptURL(d.WasmModuleURL)).then(function(D){if(typeof URL!="function")return M("Basis transcoder requires an environment with a URL constructor");var B=URL.createObjectURL(new Blob(["(".concat(s,")()")],{type:"application/javascript"}));(function(F,X,$){return new Promise(function(Q,ie){var q=function(ee){ee.data.action==="init"?(F.removeEventListener("message",q),Q(F)):ee.data.action==="error"&&ie(ee.data.error||"error initializing worker")};F.addEventListener("message",q),F.postMessage({action:"init",url:$?n.S0.GetBabylonScriptURL($):void 0,wasmBinary:X},[X])})})(m=new Worker(B),D,d.JSModuleURL).then(I,M)}).catch(M)})),p).then(function(){var I=v++,M=function(B){B.data.action==="transcode"&&B.data.id===I&&(m.removeEventListener("message",M),B.data.success?x(B.data):R("Transcode is not supported on this device"))};m.addEventListener("message",M);var D=new Uint8Array(y.byteLength);D.set(new Uint8Array(y.buffer,y.byteOffset,y.byteLength)),m.postMessage({action:"transcode",id:I,imageData:D,config:S,ignoreSupportedFormats:!1},[D.buffer])},function(I){R(I)})})},C=function(g,S){var y,x,R=(y=S._gl)===null||y===void 0?void 0:y.TEXTURE_2D;g.isCube&&(R=(x=S._gl)===null||x===void 0?void 0:x.TEXTURE_CUBE_MAP),S._bindTextureDirectly(R,g,!0)},T=function(g,S){for(var y=g.getEngine(),x=function(I){var M=S.fileInfo.images[I].levels[0];if(g._invertVScale=g.invertY,S.format===-1||S.format===l.cTFRGB565)if(g.type=a.Y.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,g.format=a.Y.TEXTUREFORMAT_RGB,!y._features.basisNeedsPOT||Math.log2(M.width)%1==0&&Math.log2(M.height)%1==0)g._invertVScale=!g.invertY,g.width=M.width+3&-4,g.height=M.height+3&-4,g.samplingMode=a.Y.TEXTURE_LINEAR_LINEAR,C(g,y),y._uploadDataToTextureDirectly(g,new Uint16Array(M.transcodedPixels.buffer),I,0,a.Y.TEXTUREFORMAT_RGB,!0);else{var D=new o.h(y,2);g._invertVScale=g.invertY,D.type=a.Y.TEXTURETYPE_UNSIGNED_SHORT_5_6_5,D.format=a.Y.TEXTUREFORMAT_RGB,D.width=M.width+3&-4,D.height=M.height+3&-4,C(D,y),y._uploadDataToTextureDirectly(D,new Uint16Array(M.transcodedPixels.buffer),I,0,a.Y.TEXTUREFORMAT_RGB,!0),y._rescaleTexture(D,g,y.scenes[0],y._getInternalFormat(a.Y.TEXTUREFORMAT_RGB),function(){y._releaseTexture(D),C(g,y)})}else{g.width=M.width,g.height=M.height,g.generateMipMaps=S.fileInfo.images[I].levels.length>1;var B=f.GetInternalFormatFromBasisFormat(S.format,y);g.format=B,C(g,y),S.fileInfo.images[I].levels.forEach(function(F,X){y._uploadCompressedDataToTextureDirectly(g,B,F.width,F.height,F.transcodedPixels,I,X)}),!y._features.basisNeedsPOT||Math.log2(g.width)%1==0&&Math.log2(g.height)%1==0||(n.S0.Warn("Loaded .basis texture width and height are not a power of two. Texture wrapping will be set to Texture.CLAMP_ADDRESSMODE as other modes are not supported with non power of two dimensions in webGL 1."),g._cachedWrapU=i.g.CLAMP_ADDRESSMODE,g._cachedWrapV=i.g.CLAMP_ADDRESSMODE)}},R=0;R<S.fileInfo.images.length;R++)x(R)},f={JSModuleURL:d.JSModuleURL,WasmModuleURL:d.WasmModuleURL,GetInternalFormatFromBasisFormat:h,TranscodeAsync:E,LoadTextureFromTranscodeResult:T};Object.defineProperty(f,"JSModuleURL",{get:function(){return d.JSModuleURL},set:function(g){d.JSModuleURL=g}}),Object.defineProperty(f,"WasmModuleURL",{get:function(){return d.WasmModuleURL},set:function(g){d.WasmModuleURL=g}})},75838:(r,t,e)=>{e.d(t,{D8:()=>s,c9:()=>i,lP:()=>o,nh:()=>a});var n=e(78322);function i(l,c,u){u===void 0&&(u=!1);var d=c.width,h=c.height;if(l instanceof Float32Array){for(var p=l.byteLength/l.BYTES_PER_ELEMENT,m=new Uint8Array(p);--p>=0;){var v=l[p];v<0?v=0:v>1&&(v=1),m[p]=255*v}l=m}var b=document.createElement("canvas");b.width=d,b.height=h;var E=b.getContext("2d");if(!E)return null;var C=E.createImageData(d,h);if(C.data.set(l),E.putImageData(C,0,0),u){var T=document.createElement("canvas");T.width=d,T.height=h;var f=T.getContext("2d");return f?(f.translate(0,h),f.scale(1,-1),f.drawImage(b,0,0),T.toDataURL("image/png")):null}return b.toDataURL("image/png")}function o(l,c,u){c===void 0&&(c=0),u===void 0&&(u=0);var d=l.getInternalTexture();if(!d)return null;var h=l._readPixelsSync(c,u);return h?i(h,l.getSize(),d.invertY):null}function a(l,c,u){return c===void 0&&(c=0),u===void 0&&(u=0),(0,n.sH)(this,void 0,void 0,function(){var d,h;return(0,n.YH)(this,function(p){switch(p.label){case 0:return(d=l.getInternalTexture())?[4,l.readPixels(c,u)]:[2,null];case 1:return(h=p.sent())?[2,i(h,l.getSize(),d.invertY)]:[2,null]}})})}var s={GenerateBase64StringFromPixelData:i,GenerateBase64StringFromTexture:o,GenerateBase64StringFromTextureAsync:a}},49611:(r,t,e)=>{e.d(t,{D:()=>v});var n=e(48810),i=e(81152),o=e(7164),a=e(75768),s=e(35877),l=(e(19966),e(71974),131072),c=131072;function u(b){return b.charCodeAt(0)+(b.charCodeAt(1)<<8)+(b.charCodeAt(2)<<16)+(b.charCodeAt(3)<<24)}var d=u("DXT1"),h=u("DXT3"),p=u("DXT5"),m=u("DX10"),v=function(){function b(){}return b.GetDDSInfo=function(E){var C=new Int32Array(E.buffer,E.byteOffset,31),T=new Int32Array(E.buffer,E.byteOffset,35),f=1;C[2]&l&&(f=Math.max(1,C[7]));var g=C[21],S=g===m?T[32]:0,y=i.Y.TEXTURETYPE_UNSIGNED_INT;switch(g){case 113:y=i.Y.TEXTURETYPE_HALF_FLOAT;break;case 116:y=i.Y.TEXTURETYPE_FLOAT;break;case m:if(S===10){y=i.Y.TEXTURETYPE_HALF_FLOAT;break}if(S===2){y=i.Y.TEXTURETYPE_FLOAT;break}}return{width:C[4],height:C[3],mipmapCount:f,isFourCC:!(4&~C[20]),isRGB:!(64&~C[20]),isLuminance:(C[20]&c)===c,isCube:!(512&~C[28]),isCompressed:g===d||g===h||g===p,dxgiFormat:S,textureType:y}},b._GetHalfFloatAsFloatRGBAArrayBuffer=function(E,C,T,f,g,S){for(var y=new Float32Array(f),x=new Uint16Array(g,T),R=0,I=0;I<C;I++)for(var M=0;M<E;M++){var D=4*(M+I*E);y[R]=(0,s.SX)(x[D]),y[R+1]=(0,s.SX)(x[D+1]),y[R+2]=(0,s.SX)(x[D+2]),b.StoreLODInAlphaChannel?y[R+3]=S:y[R+3]=(0,s.SX)(x[D+3]),R+=4}return y},b._GetHalfFloatRGBAArrayBuffer=function(E,C,T,f,g,S){if(b.StoreLODInAlphaChannel){for(var y=new Uint16Array(f),x=new Uint16Array(g,T),R=0,I=0;I<C;I++)for(var M=0;M<E;M++){var D=4*(M+I*E);y[R]=x[D],y[R+1]=x[D+1],y[R+2]=x[D+2],y[R+3]=(0,s.LZ)(S),R+=4}return y}return new Uint16Array(g,T,f)},b._GetFloatRGBAArrayBuffer=function(E,C,T,f,g,S){if(b.StoreLODInAlphaChannel){for(var y=new Float32Array(f),x=new Float32Array(g,T),R=0,I=0;I<C;I++)for(var M=0;M<E;M++){var D=4*(M+I*E);y[R]=x[D],y[R+1]=x[D+1],y[R+2]=x[D+2],y[R+3]=S,R+=4}return y}return new Float32Array(g,T,f)},b._GetFloatAsHalfFloatRGBAArrayBuffer=function(E,C,T,f,g,S){for(var y=new Uint16Array(f),x=new Float32Array(g,T),R=0,I=0;I<C;I++)for(var M=0;M<E;M++)y[R]=(0,s.LZ)(x[R]),y[R+1]=(0,s.LZ)(x[R+1]),y[R+2]=(0,s.LZ)(x[R+2]),b.StoreLODInAlphaChannel?y[R+3]=(0,s.LZ)(S):y[R+3]=(0,s.LZ)(x[R+3]),R+=4;return y},b._GetFloatAsUIntRGBAArrayBuffer=function(E,C,T,f,g,S){for(var y=new Uint8Array(f),x=new Float32Array(g,T),R=0,I=0;I<C;I++)for(var M=0;M<E;M++){var D=4*(M+I*E);y[R]=255*(0,n.Clamp)(x[D]),y[R+1]=255*(0,n.Clamp)(x[D+1]),y[R+2]=255*(0,n.Clamp)(x[D+2]),b.StoreLODInAlphaChannel?y[R+3]=S:y[R+3]=255*(0,n.Clamp)(x[D+3]),R+=4}return y},b._GetHalfFloatAsUIntRGBAArrayBuffer=function(E,C,T,f,g,S){for(var y=new Uint8Array(f),x=new Uint16Array(g,T),R=0,I=0;I<C;I++)for(var M=0;M<E;M++){var D=4*(M+I*E);y[R]=255*(0,n.Clamp)((0,s.SX)(x[D])),y[R+1]=255*(0,n.Clamp)((0,s.SX)(x[D+1])),y[R+2]=255*(0,n.Clamp)((0,s.SX)(x[D+2])),b.StoreLODInAlphaChannel?y[R+3]=S:y[R+3]=255*(0,n.Clamp)((0,s.SX)(x[D+3])),R+=4}return y},b._GetRGBAArrayBuffer=function(E,C,T,f,g,S,y,x,R){for(var I=new Uint8Array(f),M=new Uint8Array(g,T),D=0,B=0;B<C;B++)for(var F=0;F<E;F++){var X=4*(F+B*E);I[D]=M[X+S],I[D+1]=M[X+y],I[D+2]=M[X+x],I[D+3]=M[X+R],D+=4}return I},b._ExtractLongWordOrder=function(E){return E===0||E===255||E===-16777216?0:1+b._ExtractLongWordOrder(E>>8)},b._GetRGBArrayBuffer=function(E,C,T,f,g,S,y,x){for(var R=new Uint8Array(f),I=new Uint8Array(g,T),M=0,D=0;D<C;D++)for(var B=0;B<E;B++){var F=3*(B+D*E);R[M]=I[F+S],R[M+1]=I[F+y],R[M+2]=I[F+x],M+=3}return R},b._GetLuminanceArrayBuffer=function(E,C,T,f,g){for(var S=new Uint8Array(f),y=new Uint8Array(g,T),x=0,R=0;R<C;R++)for(var I=0;I<E;I++){var M=I+R*E;S[x]=y[M],x++}return S},b.UploadDDSLevels=function(E,C,T,f,g,S,y,x,R){y===void 0&&(y=-1),R===void 0&&(R=!0);var I=null;f.sphericalPolynomial&&(I=[]);var M=!!E.getCaps().s3tc;C.generateMipMaps=g;var D,B,F,X,$,Q,ie,q=new Int32Array(T.buffer,T.byteOffset,31),ee=0,te=0,ce=1;if(q[0]===542327876)if(f.isFourCC||f.isRGB||f.isLuminance)if(!f.isCompressed||M){var fe=q[22];X=q[1]+4;var de,Te=!1;if(f.isFourCC)switch(D=q[21]){case d:ce=8,te=i.Y.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1;break;case h:ce=16,te=i.Y.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3;break;case p:ce=16,te=i.Y.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5;break;case 113:Te=!0,fe=64;break;case 116:Te=!0,fe=128;break;case m:X+=20;var ue=!1;switch(f.dxgiFormat){case 10:Te=!0,fe=64,ue=!0;break;case 2:Te=!0,fe=128,ue=!0;break;case 88:f.isRGB=!0,f.isFourCC=!1,fe=32,ue=!0}if(ue)break;default:return void o.V.Error(["Unsupported FourCC code:",(de=D,String.fromCharCode(255&de,de>>8&255,de>>16&255,de>>24&255))])}var U=b._ExtractLongWordOrder(q[23]),N=b._ExtractLongWordOrder(q[24]),w=b._ExtractLongWordOrder(q[25]),k=b._ExtractLongWordOrder(q[26]);Te&&(te=E._getRGBABufferInternalSizedFormat(f.textureType)),Q=1,q[2]&l&&g!==!1&&(Q=Math.max(1,q[7]));for(var J=x||0,le=E.getCaps(),be=J;be<S;be++){for(B=q[4],F=q[3],ie=0;ie<Q;++ie){if(y===-1||y===ie){var ve=y===-1?ie:0;if(!f.isCompressed&&f.isFourCC){C.format=i.Y.TEXTUREFORMAT_RGBA,ee=B*F*4;var ye=null;if(E._badOS||E._badDesktopOS||!le.textureHalfFloat&&!le.textureFloat)fe===128?(ye=b._GetFloatAsUIntRGBAArrayBuffer(B,F,T.byteOffset+X,ee,T.buffer,ve),I&&ve==0&&I.push(b._GetFloatRGBAArrayBuffer(B,F,T.byteOffset+X,ee,T.buffer,ve))):fe===64&&(ye=b._GetHalfFloatAsUIntRGBAArrayBuffer(B,F,T.byteOffset+X,ee,T.buffer,ve),I&&ve==0&&I.push(b._GetHalfFloatAsFloatRGBAArrayBuffer(B,F,T.byteOffset+X,ee,T.buffer,ve))),C.type=i.Y.TEXTURETYPE_UNSIGNED_INT;else{var Me=le.textureFloat&&(R&&le.textureFloatLinearFiltering||!R),we=le.textureHalfFloat&&(R&&le.textureHalfFloatLinearFiltering||!R),He=(fe===128||fe===64&&!we)&&Me?i.Y.TEXTURETYPE_FLOAT:(fe===64||fe===128&&!Me)&&we?i.Y.TEXTURETYPE_HALF_FLOAT:i.Y.TEXTURETYPE_UNSIGNED_BYTE,Ke=void 0,Qe=null;if(fe===128)switch(He){case i.Y.TEXTURETYPE_FLOAT:Ke=b._GetFloatRGBAArrayBuffer,Qe=null;break;case i.Y.TEXTURETYPE_HALF_FLOAT:Ke=b._GetFloatAsHalfFloatRGBAArrayBuffer,Qe=b._GetFloatRGBAArrayBuffer;break;case i.Y.TEXTURETYPE_UNSIGNED_BYTE:Ke=b._GetFloatAsUIntRGBAArrayBuffer,Qe=b._GetFloatRGBAArrayBuffer}else switch(He){case i.Y.TEXTURETYPE_FLOAT:Ke=b._GetHalfFloatAsFloatRGBAArrayBuffer,Qe=null;break;case i.Y.TEXTURETYPE_HALF_FLOAT:Ke=b._GetHalfFloatRGBAArrayBuffer,Qe=b._GetHalfFloatAsFloatRGBAArrayBuffer;break;case i.Y.TEXTURETYPE_UNSIGNED_BYTE:Ke=b._GetHalfFloatAsUIntRGBAArrayBuffer,Qe=b._GetHalfFloatAsFloatRGBAArrayBuffer}C.type=He,ye=Ke(B,F,T.byteOffset+X,ee,T.buffer,ve),I&&ve==0&&I.push(Qe?Qe(B,F,T.byteOffset+X,ee,T.buffer,ve):ye)}ye&&E._uploadDataToTextureDirectly(C,ye,be,ve)}else if(f.isRGB)C.type=i.Y.TEXTURETYPE_UNSIGNED_INT,fe===24?(C.format=i.Y.TEXTUREFORMAT_RGB,ee=B*F*3,$=b._GetRGBArrayBuffer(B,F,T.byteOffset+X,ee,T.buffer,U,N,w),E._uploadDataToTextureDirectly(C,$,be,ve)):(C.format=i.Y.TEXTUREFORMAT_RGBA,ee=B*F*4,$=b._GetRGBAArrayBuffer(B,F,T.byteOffset+X,ee,T.buffer,U,N,w,k),E._uploadDataToTextureDirectly(C,$,be,ve));else if(f.isLuminance){var Je=E._getUnpackAlignement(),ht=B;ee=Math.floor((B+Je-1)/Je)*Je*(F-1)+ht,$=b._GetLuminanceArrayBuffer(B,F,T.byteOffset+X,ee,T.buffer),C.format=i.Y.TEXTUREFORMAT_LUMINANCE,C.type=i.Y.TEXTURETYPE_UNSIGNED_INT,E._uploadDataToTextureDirectly(C,$,be,ve)}else ee=Math.max(4,B)/4*Math.max(4,F)/4*ce,$=new Uint8Array(T.buffer,T.byteOffset+X,ee),C.type=i.Y.TEXTURETYPE_UNSIGNED_INT,E._uploadCompressedDataToTextureDirectly(C,te,B,F,$,be,ve)}X+=fe?B*F*(fe/8):ee,B*=.5,F*=.5,B=Math.max(1,B),F=Math.max(1,F)}if(x!==void 0)break}I&&I.length>0?f.sphericalPolynomial=a.d.ConvertCubeMapToSphericalPolynomial({size:q[4],right:I[0],left:I[1],up:I[2],down:I[3],front:I[4],back:I[5],format:i.Y.TEXTUREFORMAT_RGBA,type:i.Y.TEXTURETYPE_FLOAT,gammaSpace:!1}):f.sphericalPolynomial=void 0}else o.V.Error("Compressed textures are not supported on this platform.");else o.V.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");else o.V.Error("Invalid magic number in DDS header")},b.StoreLODInAlphaChannel=!1,b}()},36729:(r,t,e)=>{e.d(t,{B:()=>o,K:()=>a});var n={},i={};function o(s){var l=s.getClassName();return i[l]||(i[l]={}),i[l]}function a(s){var l=s.getClassName();if(n[l])return n[l];n[l]={};for(var c=n[l],u=s,d=l;d;){var h=i[d];for(var p in h)c[p]=h[p];var m=void 0,v=!1;do{if(!(m=Object.getPrototypeOf(u)).getClassName){v=!0;break}if(m.getClassName()!==d)break;u=m}while(m);if(v)break;d=m.getClassName(),u=m}return c}},12028:(r,t,e)=>{e.d(t,{p:()=>c});var n=e(41190),i=e(31985),o=e(64726),a=e(8046),s=e(36729),l=function(u,d,h,p){p===void 0&&(p={});var m=u();i.Y&&i.Y.HasTags(d)&&i.Y.AddTagsTo(m,i.Y.GetTags(d,!0));var v=(0,s.K)(m),b={};for(var E in v){var C=v[E],T=d[E],f=C.type;if(T!=null&&(E!=="uniqueId"||c.AllowLoadingUniqueId))switch(f){case 0:case 6:case 11:m[E]=T;break;case 1:p.cloneTexturesOnlyOnce&&b[T.uniqueId]?m[E]=b[T.uniqueId]:(m[E]=h||T.isRenderTarget?T:T.clone(),b[T.uniqueId]=m[E]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:m[E]=h?T:T.clone()}}return m},c=function(){function u(){}return u.AppendSerializedAnimations=function(d,h){if(d.animations){h.animations=[];for(var p=0;p<d.animations.length;p++){var m=d.animations[p];h.animations.push(m.serialize())}}},u.Serialize=function(d,h){h||(h={}),i.Y&&(h.tags=i.Y.GetTags(d));var p=(0,s.K)(d);for(var m in p){var v=p[m],b=v.sourceName||m,E=v.type,C=d[m];if(C!=null&&(m!=="uniqueId"||u.AllowLoadingUniqueId))switch(E){case 0:h[b]=C;break;case 1:case 3:case 7:case 9:h[b]=C.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:h[b]=C.asArray();break;case 6:case 11:h[b]=C.id}}return h},u.ParseProperties=function(d,h,p,m){m||(m="");var v=(0,s.K)(h);for(var b in v){var E=v[b],C=d[E.sourceName||b],T=E.type;if(C!=null&&(b!=="uniqueId"||u.AllowLoadingUniqueId)){var f=h;switch(T){case 0:f[b]=C;break;case 1:p&&(f[b]=u._TextureParser(C,p,m));break;case 2:f[b]=o.v9.FromArray(C);break;case 3:f[b]=u._FresnelParametersParser(C);break;case 4:f[b]=a.I9.FromArray(C);break;case 5:f[b]=a.Pq.FromArray(C);break;case 6:p&&(f[b]=p.getLastMeshById(C));break;case 7:f[b]=u._ColorCurvesParser(C);break;case 8:f[b]=o.ov.FromArray(C);break;case 9:f[b]=u._ImageProcessingConfigurationParser(C);break;case 10:f[b]=a.PT.FromArray(C);break;case 11:p&&(f[b]=p.getCameraById(C));break;case 12:f[b]=a.uq.FromArray(C)}}}},u.Parse=function(d,h,p,m){m===void 0&&(m=null);var v=d();return i.Y&&i.Y.AddTagsTo(v,h.tags),u.ParseProperties(h,v,p,m),v},u.Clone=function(d,h,p){return p===void 0&&(p={}),l(d,h,!1,p)},u.Instanciate=function(d,h){return l(d,h,!0)},u.AllowLoadingUniqueId=!1,u._ImageProcessingConfigurationParser=function(d){throw(0,n.n)("ImageProcessingConfiguration")},u._FresnelParametersParser=function(d){throw(0,n.n)("FresnelParameters")},u._ColorCurvesParser=function(d){throw(0,n.n)("ColorCurves")},u._TextureParser=function(d,h,p){throw(0,n.n)("Texture")},u}()},6174:(r,t,e)=>{e.d(t,{$z:()=>o,Cx:()=>T,GG:()=>E,P_:()=>d,WM:()=>u,Y9:()=>c,bR:()=>b,fW:()=>C,jT:()=>l,lK:()=>a,n1:()=>v,qK:()=>m,uM:()=>s,wL:()=>p,xG:()=>h});var n=e(36729);function i(f,g){return function(S,y){var x=(0,n.B)(S);x[y]||(x[y]={type:f,sourceName:g})}}function o(f,g){return g===void 0&&(g=null),function(S,y){return y===void 0&&(y=null),function(x,R){var I=y||"_"+R;Object.defineProperty(x,R,{get:function(){return this[I]},set:function(M){typeof this.equals=="function"&&this.equals(M)||this[I]!==M&&(this[I]=M,x[S].apply(this))},enumerable:!0,configurable:!0})}}(f,g)}function a(f){return i(0,f)}function s(f){return i(1,f)}function l(f){return i(2,f)}function c(f){return i(3,f)}function u(f){return i(4,f)}function d(f){return i(5,f)}function h(f){return i(6,f)}function p(f){return i(7,f)}function m(f){return i(8,f)}function v(f){return i(9,f)}function b(f){return i(10,f)}function E(f){return i(12,f)}function C(f){return i(11,f)}function T(f,g,S,y){var x=S.value;S.value=function(){for(var R=[],I=0;I<arguments.length;I++)R[I]=arguments[I];var M=x;if(typeof _native<"u"&&_native[g]){var D=_native[g];M=y?function(){for(var B=[],F=0;F<arguments.length;F++)B[F]=arguments[F];return y.apply(void 0,B)?D.apply(void 0,B):x.apply(void 0,B)}:D}return f[g]=M,M.apply(void 0,R)}}T.filter=function(f){return function(g,S,y){return T(g,S,y,f)}}},44576:(r,t,e)=>{e.d(t,{r:()=>a});var n=e(78322),i=e(7164),o=function(s,l,c){return s?s.getClassName&&s.getClassName()==="Mesh"?null:!s.getClassName||s.getClassName()!=="SubMesh"&&s.getClassName()!=="PhysicsBody"?s.clone?s.clone():Array.isArray(s)?s.slice():c&&typeof s=="object"?(0,n.Cl)({},s):null:s.clone(l):null},a=function(){function s(){}return s.DeepCopy=function(l,c,u,d,h){h===void 0&&(h=!1);for(var p=function(g){var S=[];do Object.getOwnPropertyNames(g).forEach(function(y){S.indexOf(y)===-1&&S.push(y)});while(g=Object.getPrototypeOf(g));return S}(l),m=0,v=p;m<v.length;m++){var b=v[m];if((b[0]!=="_"||d&&d.indexOf(b)!==-1)&&!(b.endsWith("Observable")||u&&u.indexOf(b)!==-1)){var E=l[b],C=typeof E;if(C!=="function")try{if(C==="object")if(E instanceof Uint8Array)c[b]=Uint8Array.from(E);else if(E instanceof Array){if(c[b]=[],E.length>0)if(typeof E[0]=="object")for(var T=0;T<E.length;T++){var f=o(E[T],c,h);c[b].indexOf(f)===-1&&c[b].push(f)}else c[b]=E.slice(0)}else c[b]=o(E,c,h);else c[b]=E}catch(g){i.V.Warn(g.message)}}}},s}()},41190:(r,t,e)=>{e.d(t,{n:()=>i});var n={};function i(o,a){if(a===void 0&&(a=!1),!a||!n[o])return n[o]=!0,"".concat(o," needs to be imported before as it contains a side-effect required by your code.")}},5153:(r,t,e)=>{function n(){return typeof window<"u"}function i(){return typeof navigator<"u"}function o(){return typeof document<"u"}function a(l){for(var c="",u=l.firstChild;u;)u.nodeType===3&&(c+=u.textContent),u=u.nextSibling;return c}e.d(t,{Az:()=>s,BA:()=>n,Nf:()=>o,XD:()=>i,Zl:()=>a});var s={IsWindowObjectExist:n,IsNavigatorAvailable:i,IsDocumentAvailable:o,GetDOMTextContent:a}},24687:(r,t,e)=>{e.d(t,{RJ:()=>m,dq:()=>p,e9:()=>b,yp:()=>h});var n,i=e(78322),o=e(96352),a=e(81152),s=e(93540),l=e(44957),c=e(56017),u=e(48810),d=e(66614);function h(E,C,T,f,g,S,y){return g===void 0&&(g="image/png"),(0,i.sH)(this,void 0,void 0,function(){var x,R;return(0,i.YH)(this,function(I){switch(I.label){case 0:return[4,T.readPixels(0,0,E,C)];case 1:return x=I.sent(),R=new Uint8Array(x.buffer),m(E,C,R,f,g,S,!0,void 0,y),[2]}})})}function p(E,C,T,f,g,S,y,x){return f===void 0&&(f="image/png"),S===void 0&&(S=!1),y===void 0&&(y=!1),new Promise(function(R){m(E,C,T,function(I){return R(I)},f,g,S,y,x)})}function m(E,C,T,f,g,S,y,x,R){g===void 0&&(g="image/png"),y===void 0&&(y=!1),x===void 0&&(x=!1);var I=function(){if(!n){var X=void 0,$=null,Q={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};try{X=new OffscreenCanvas(100,100),$=new o.w(X,!1,Q)}catch{X=document.createElement("canvas"),$=new o.w(X,!1,Q)}d.q.Instances.pop(),d.q.OnEnginesDisposedObservable.add(function(ee){$&&ee!==$&&!$.isDisposed&&d.q.Instances.length===0&&v()}),$.getCaps().parallelShaderCompile=void 0;var ie=new s.J($),q=new s.$({engine:$,name:c.passPixelShader.name,fragmentShader:c.passPixelShader.shader,samplerNames:["textureSampler"]});n={canvas:X,engine:$,renderer:ie,wrapper:q}}return n}();if(I.engine.setSize(E,C,!0),T instanceof Float32Array){for(var M=new Uint8Array(T.length),D=T.length;D--;){var B=T[D];M[D]=Math.round(255*(0,u.Clamp)(B))}T=M}var F=I.engine.createRawTexture(T,E,C,a.Y.TEXTUREFORMAT_RGBA,!1,!y,a.Y.TEXTURE_NEAREST_NEAREST);I.renderer.setViewport(),I.renderer.applyEffectWrapper(I.wrapper),I.wrapper.effect._bindTexture("textureSampler",F),I.renderer.draw(),x?l.S0.ToBlob(I.canvas,function(X){var $=new FileReader;$.onload=function(Q){var ie=Q.target.result;f&&f(ie)},$.readAsArrayBuffer(X)},g,R):l.S0.EncodeScreenshotCanvasData(I.canvas,f,g,S,R),F.dispose()}function v(){n&&(n.wrapper.dispose(),n.renderer.dispose(),n.engine.dispose()),n=null}var b={DumpData:m,DumpDataAsync:p,DumpFramebuffer:h,Dispose:v};l.S0.DumpData=m,l.S0.DumpDataAsync=p,l.S0.DumpFramebuffer=h},88309:(r,t,e)=>{e.d(t,{$h:()=>y,Hx:()=>g,RZ:()=>f,bv:()=>I,cU:()=>T,gW:()=>D,o5:()=>x,ow:()=>M,qY:()=>B});var n=e(78322),i=e(44957),o=e(8046),a=e(48810),s=e(51428),l=e(19133),c=e(28081),u=e(81152),d=e(76170),h=e(30622),p=e(7164),m=e(97411),v=(e(8864),e(82345),e(39813),e(24687)),b="image/png",E=2,C=[134,22,135,150,246,214,150,54];function T(F){for(var X=new DataView(F.buffer,F.byteOffset,F.byteLength),$=0,Q=0;Q<C.length;Q++)if(X.getUint8($++)!==C[Q])return p.V.Error("Not a babylon environment map"),null;for(var ie="",q=0;q=X.getUint8($++);)ie+=String.fromCharCode(q);var ee=JSON.parse(ie);return(ee=f(ee)).specular&&(ee.specular.specularDataPosition=$,ee.specular.lodGenerationScale=ee.specular.lodGenerationScale||.8),ee}function f(F){if(F.version>E)throw new Error('Unsupported babylon environment map version "'.concat(F.version,'". Latest supported version is "').concat(E,'".'));return F.version===2?F:F=(0,n.Cl)((0,n.Cl)({},F),{version:2,imageType:b})}function g(F,X){var $,Q;return X===void 0&&(X={}),(0,n.sH)(this,void 0,void 0,function(){var ie,q,ee,te,ce,fe,de,Te,ue,U,N,w,k,J,le,be,ve,ye,Me,we,He,Ke,Qe,Je,ht,mt,yt,zt,$t,St,Ot,Et,Vt;return(0,n.YH)(this,function(ln){switch(ln.label){case 0:if(!(ie=F.getInternalTexture()))return[2,Promise.reject("The cube texture is invalid.")];if(q=($=X.imageType)!==null&&$!==void 0?$:b,ee=ie.getEngine(),F.textureType!==u.Y.TEXTURETYPE_HALF_FLOAT&&F.textureType!==u.Y.TEXTURETYPE_FLOAT&&F.textureType!==u.Y.TEXTURETYPE_UNSIGNED_BYTE&&F.textureType!==u.Y.TEXTURETYPE_UNSIGNED_INT&&F.textureType!==u.Y.TEXTURETYPE_UNSIGNED_INTEGER&&F.textureType!==-1)return[2,Promise.reject("The cube texture should allow HDR (Full Float or Half Float).")];if(te=u.Y.TEXTURETYPE_FLOAT,!ee.getCaps().textureFloatRender&&(te=u.Y.TEXTURETYPE_HALF_FLOAT,!ee.getCaps().textureHalfFloatRender))return[2,Promise.reject("Env texture can only be created when the browser supports half float or full float rendering.")];F.sphericalPolynomial,ce=(Q=F.getInternalTexture())===null||Q===void 0?void 0:Q._sphericalPolynomialPromise,fe=ie.width,de=new d.Z(ee),Te={},ee.flushFramebuffer(),ue=(0,a.ILog2)(ie.width),Ot=0,ln.label=1;case 1:if(!(Ot<=ue))return[3,9];U=Math.pow(2,ue-Ot),Et=0,ln.label=2;case 2:return Et<6?[4,F.readPixels(Et,Ot,void 0,!1)]:[3,8];case 3:if((N=ln.sent())&&N.byteLength===N.length){for(w=new Float32Array(4*N.byteLength),k=0;k<N.byteLength;k++)w[k]=N[k]/255,w[k]=Math.pow(w[k],2.2);N=w}else if(N&&F.gammaSpace)for(J=N,le=0;le<J.length;le++)J[le]=Math.pow(J[le],2.2);return be=ee.createRawTexture(N,U,U,u.Y.TEXTUREFORMAT_RGBA,!1,!0,u.Y.TEXTURE_NEAREST_SAMPLINGMODE,null,te),[4,m.G.EncodeTextureToRGBD(be,de,te)];case 4:return ln.sent(),[4,ee._readTexturePixels(be,U,U)];case 5:return ve=ln.sent(),[4,(0,v.dq)(U,U,ve,q,void 0,!1,!0,X.imageQuality)];case 6:ye=ln.sent(),Te[6*Ot+Et]=ye,be.dispose(),ln.label=7;case 7:return Et++,[3,2];case 8:return Ot++,[3,1];case 9:return de.dispose(),ce?[4,ce]:[3,11];case 10:ln.sent(),ln.label=11;case 11:for(Me={version:E,width:fe,imageType:q,irradiance:S(F),specular:{mipmaps:[],lodGenerationScale:F.lodGenerationScale}},we=0,Ot=0;Ot<=ue;Ot++)for(Et=0;Et<6;Et++)He=Te[6*Ot+Et].byteLength,Me.specular.mipmaps.push({length:He,position:we}),we+=He;for(Ke=JSON.stringify(Me),Qe=new ArrayBuffer(Ke.length+1),Je=new Uint8Array(Qe),Ot=0,ht=Ke.length;Ot<ht;Ot++)Je[Ot]=Ke.charCodeAt(Ot);for(Je[Ke.length]=0,mt=C.length+we+Qe.byteLength,yt=new ArrayBuffer(mt),zt=new Uint8Array(yt),$t=new DataView(yt),St=0,Ot=0;Ot<C.length;Ot++)$t.setUint8(St++,C[Ot]);for(zt.set(new Uint8Array(Qe),St),St+=Qe.byteLength,Ot=0;Ot<=ue;Ot++)for(Et=0;Et<6;Et++)Vt=Te[6*Ot+Et],zt.set(new Uint8Array(Vt),St),St+=Vt.byteLength;return[2,yt]}})})}function S(F){var X=F.sphericalPolynomial;return X==null?null:{x:[X.x.x,X.x.y,X.x.z],y:[X.y.x,X.y.y,X.y.z],z:[X.z.x,X.z.y,X.z.z],xx:[X.xx.x,X.xx.y,X.xx.z],yy:[X.yy.x,X.yy.y,X.yy.z],zz:[X.zz.x,X.zz.y,X.zz.z],yz:[X.yz.x,X.yz.y,X.yz.z],zx:[X.zx.x,X.zx.y,X.zx.z],xy:[X.xy.x,X.xy.y,X.xy.z]}}function y(F,X){var $=(X=f(X)).specular,Q=Math.log2(X.width);if(Q=Math.round(Q)+1,$.mipmaps.length!==6*Q)throw new Error('Unsupported specular mipmaps number "'.concat($.mipmaps.length,'"'));for(var ie=new Array(Q),q=0;q<Q;q++){ie[q]=new Array(6);for(var ee=0;ee<6;ee++){var te=$.mipmaps[6*q+ee];ie[q][ee]=new Uint8Array(F.buffer,F.byteOffset+$.specularDataPosition+te.position,te.length)}}return ie}function x(F,X,$){var Q=($=f($)).specular;return Q?(F._lodGenerationScale=Q.lodGenerationScale,I(F,y(X,$),$.imageType)):Promise.resolve()}function R(F,X,$,Q,ie,q,ee,te,ce,fe,de){return new Promise(function(Te,ue){if($){var U=X.createTexture(null,!0,!0,null,u.Y.TEXTURE_NEAREST_SAMPLINGMODE,null,function(w){ue(w)},F);Q?.onEffectCreatedObservable.addOnce(function(w){w.executeWhenCompiled(function(){Q.externalTextureSamplerBinding=!0,Q.onApply=function(k){k._bindTexture("textureSampler",U),k.setFloat2("scale",1,X._features.needsInvertingBitmap&&F instanceof ImageBitmap?-1:1)},X.scenes.length&&(X.scenes[0].postProcessManager.directRender([Q],fe,!0,q,ee),X.restoreDefaultFramebuffer(),U.dispose(),URL.revokeObjectURL(ie),Te())})})}else{if(X._uploadImageToTexture(de,F,q,ee),te){var N=ce[ee];N&&X._uploadImageToTexture(N._texture,F,q,0)}Te()}})}function I(F,X,$){return $===void 0&&($=b),(0,n.sH)(this,void 0,void 0,function(){var Q,ie,q,ee,te,ce,fe,de,Te,ue,U,N,w,k,J,le,be,ve,ye,Me,we,He,Ke,Qe;return(0,n.YH)(this,function(Je){switch(Je.label){case 0:if(!i.S0.IsExponentOfTwo(F.width))throw new Error("Texture size must be a power of two");return Q=(0,a.ILog2)(F.width)+1,ie=F.getEngine(),q=!1,ee=!1,te=null,ce=null,fe=null,de=ie.getCaps(),F.format=u.Y.TEXTUREFORMAT_RGBA,F.type=u.Y.TEXTURETYPE_UNSIGNED_INT,F.generateMipMaps=!0,F._cachedAnisotropicFilteringLevel=null,ie.updateTextureSamplingMode(u.Y.TEXTURE_TRILINEAR_SAMPLINGMODE,F),de.textureLOD?ie._features.supportRenderAndCopyToLodForFloatTextures?de.textureHalfFloatRender&&de.textureHalfFloatLinearFiltering?(q=!0,F.type=u.Y.TEXTURETYPE_HALF_FLOAT):de.textureFloatRender&&de.textureFloatLinearFiltering&&(q=!0,F.type=u.Y.TEXTURETYPE_FLOAT):q=!1:(q=!1,ee=!0,fe={}),Te=0,q?ie.isWebGPU?(Te=1,[4,Promise.resolve().then(e.bind(e,37494))]):[3,2]:[3,5];case 1:return Je.sent(),[3,4];case 2:return[4,Promise.resolve().then(e.bind(e,32407))];case 3:Je.sent(),Je.label=4;case 4:return te=new h.w("rgbdDecode","rgbdDecode",null,null,1,null,u.Y.TEXTURE_TRILINEAR_SAMPLINGMODE,ie,!1,void 0,F.type,void 0,null,!1,void 0,Te),F._isRGBD=!1,F.invertY=!1,ce=ie.createRenderTargetCubeTexture(F.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:u.Y.TEXTURE_TRILINEAR_SAMPLINGMODE,type:F.type,format:u.Y.TEXTUREFORMAT_RGBA}),[3,6];case 5:if(F._isRGBD=!0,F.invertY=!0,ee)for(ue=F._lodGenerationScale,U=F._lodGenerationOffset,Ke=0;Ke<3;Ke++)switch(k=(N=U)+((w=(Q-1)*ue+U)-N)*(1-Ke/2),J=Math.round(Math.min(Math.max(k,0),w)),(le=new l.h(ie,2)).isCube=!0,le.invertY=!0,le.generateMipMaps=!1,ie.updateTextureSamplingMode(u.Y.TEXTURE_LINEAR_LINEAR,le),(be=new c.t(null))._isCube=!0,be._texture=le,fe[J]=be,Ke){case 0:F._lodTextureLow=be;break;case 1:F._lodTextureMid=be;break;case 2:F._lodTextureHigh=be}Je.label=6;case 6:for(ve=[],ye=function(ht){for(var mt=function(zt){var $t=X[ht][zt],St=new Blob([$t],{type:$}),Ot=URL.createObjectURL(St),Et=void 0;if(ie._features.forceBitmapOverHTMLImageElement)Et=ie.createImageBitmap(St,{premultiplyAlpha:"none"}).then(function(ln){return R(ln,ie,q,te,Ot,zt,ht,ee,fe,ce,F)});else{var Vt=new Image;Vt.src=Ot,Et=new Promise(function(ln,Yt){Vt.onload=function(){R(Vt,ie,q,te,Ot,zt,ht,ee,fe,ce,F).then(function(){return ln()}).catch(function(Un){Yt(Un)})},Vt.onerror=function(Un){Yt(Un)}})}ve.push(Et)},yt=0;yt<6;yt++)mt(yt)},Ke=0;Ke<X.length;Ke++)ye(Ke);if(X.length<Q){switch(Me=void 0,we=Math.pow(2,Q-1-X.length),He=we*we*4,F.type){case u.Y.TEXTURETYPE_UNSIGNED_INT:Me=new Uint8Array(He);break;case u.Y.TEXTURETYPE_HALF_FLOAT:Me=new Uint16Array(He);break;case u.Y.TEXTURETYPE_FLOAT:Me=new Float32Array(He)}for(Ke=X.length;Ke<Q;Ke++)for(Qe=0;Qe<6;Qe++)ie._uploadArrayBufferViewToTexture(F,Me,Qe,Ke)}return[2,Promise.all(ve).then(function(){ce&&(ie._releaseTexture(F),ce._swapAndDie(F)),te&&te.dispose(),ee&&(F._lodTextureHigh&&F._lodTextureHigh._texture&&(F._lodTextureHigh._texture.isReady=!0),F._lodTextureMid&&F._lodTextureMid._texture&&(F._lodTextureMid._texture.isReady=!0),F._lodTextureLow&&F._lodTextureLow._texture&&(F._lodTextureLow._texture.isReady=!0))})]}})})}function M(F,X){var $=(X=f(X)).irradiance;if($){var Q=new s.Q;o.Pq.FromArrayToRef($.x,0,Q.x),o.Pq.FromArrayToRef($.y,0,Q.y),o.Pq.FromArrayToRef($.z,0,Q.z),o.Pq.FromArrayToRef($.xx,0,Q.xx),o.Pq.FromArrayToRef($.yy,0,Q.yy),o.Pq.FromArrayToRef($.zz,0,Q.zz),o.Pq.FromArrayToRef($.yz,0,Q.yz),o.Pq.FromArrayToRef($.zx,0,Q.zx),o.Pq.FromArrayToRef($.xy,0,Q.xy),F._sphericalPolynomial=Q}}function D(F,X,$,Q,ie){var q=I(F.getEngine().createRawCubeTexture(null,F.width,F.format,F.type,F.generateMipMaps,F.invertY,F.samplingMode,F._compression),X).then(function(){return F});return F.onRebuildCallback=function(ee){return{proxy:q,isReady:!0,isAsync:!0}},F._source=13,F._bufferViewArrayArray=X,F._lodGenerationScale=Q,F._lodGenerationOffset=ie,F._sphericalPolynomial=$,I(F,X).then(function(){return F.isReady=!0,F})}var B={GetEnvInfo:T,CreateEnvTextureAsync:g,CreateImageDataArrayBufferViews:y,UploadEnvLevelsAsync:x,UploadLevelsAsync:I,UploadEnvSpherical:M}},91016:(r,t,e)=>{e.d(t,{Cf:()=>i,bu:()=>a,tG:()=>o});var n=e(78322),i=function(s){function l(){return s!==null&&s.apply(this,arguments)||this}return(0,n.C6)(l,s),l._setPrototypeOf=Object.setPrototypeOf||function(c,u){return c.__proto__=u,c},l}(Error),o={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002},a=function(s){function l(c,u,d){var h=s.call(this,c)||this;return h.errorCode=u,h.innerError=d,h.name="RuntimeError",i._setPrototypeOf(h,l.prototype),h}return(0,n.C6)(l,s),l}(i)},17347:(r,t,e)=>{e.d(t,{M1:()=>S,Mi:()=>T,NJ:()=>R,VB:()=>f,W$:()=>x,ZP:()=>F,dy:()=>Q,eC:()=>g,f2:()=>B,hX:()=>C,my:()=>D,qc:()=>y,rh:()=>ie,rz:()=>X,sh:()=>M,wS:()=>$,zU:()=>I});var n=e(78322),i=e(46799),o=e(5153),a=e(66377),s=e(23148),l=e(49449),c=e(91016),u=e(37530),d=e(35930),h=e(66614),p=e(7164),m=e(53695),v=e(24894),b=e(82673),E=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i),C=function(q){function ee(te,ce){var fe=q.call(this,te,c.tG.LoadFileError)||this;return fe.name="LoadFileError",c.Cf._setPrototypeOf(fe,ee.prototype),ce instanceof i.u?fe.request=ce:fe.file=ce,fe}return(0,n.C6)(ee,q),ee}(c.bu),T=function(q){function ee(te,ce){var fe=q.call(this,te,c.tG.RequestFileError)||this;return fe.request=ce,fe.name="RequestFileError",c.Cf._setPrototypeOf(fe,ee.prototype),fe}return(0,n.C6)(ee,q),ee}(c.bu),f=function(q){function ee(te,ce){var fe=q.call(this,te,c.tG.ReadFileError)||this;return fe.file=ce,fe.name="ReadFileError",c.Cf._setPrototypeOf(fe,ee.prototype),fe}return(0,n.C6)(ee,q),ee}(c.bu),g={DefaultRetryStrategy:l.a.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:function(q){return q},ScriptBaseUrl:"",ScriptPreprocessUrl:function(q){return q},CleanUrl:function(q){return q.replace(/#/gm,"%23")}},S=function(q,ee){if((!q||q.indexOf("data:")!==0)&&g.CorsBehavior)if(typeof g.CorsBehavior=="string"||g.CorsBehavior instanceof String)ee.crossOrigin=g.CorsBehavior;else{var te=g.CorsBehavior(q);te&&(ee.crossOrigin=te)}},y={getRequiredSize:null},x=function(q,ee,te,ce,fe,de){fe===void 0&&(fe="");var Te,ue=h.q.LastCreatedEngine;if(typeof HTMLImageElement>"u"&&!ue?._features.forceBitmapOverHTMLImageElement)return te("LoadImage is only supported in web or BabylonNative environments."),null;var U=!1;q instanceof ArrayBuffer||ArrayBuffer.isView(q)?typeof Blob<"u"&&typeof URL<"u"?(Te=URL.createObjectURL(new Blob([q],{type:fe})),U=!0):Te="data:".concat(fe,";base64,")+(0,u.EL)(q):q instanceof Blob?(Te=URL.createObjectURL(q),U=!0):(Te=g.CleanUrl(q),Te=g.PreprocessUrl(Te));var N=function(He){if(te){var Ke=Te||q.toString();te("Error while trying to load image: ".concat(Ke.indexOf("http")===0||Ke.length<=128?Ke:Ke.slice(0,128)+"..."),He)}};if(ue?._features.forceBitmapOverHTMLImageElement)return I(Te,function(He){ue.createImageBitmap(new Blob([He],{type:fe}),(0,n.Cl)({premultiplyAlpha:"none"},de)).then(function(Ke){ee(Ke),U&&URL.revokeObjectURL(Te)}).catch(function(Ke){te&&te("Error while trying to load image: "+q,Ke)})},void 0,ce||void 0,!0,function(He,Ke){N(Ke)}),null;var w=new Image;if(y.getRequiredSize){var k=y.getRequiredSize(q);k.width&&(w.width=k.width),k.height&&(w.height=k.height)}S(Te,w);var J=[],le=function(){J.forEach(function(He){He.target.removeEventListener(He.name,He.handler)}),J.length=0};J.push({target:w,name:"load",handler:function(){le(),ee(w),U&&w.src&&URL.revokeObjectURL(w.src)}}),J.push({target:w,name:"error",handler:function(He){le(),N(He),U&&w.src&&URL.revokeObjectURL(w.src)}}),J.push({target:document,name:"securitypolicyviolation",handler:function(He){if(He.blockedURI===w.src&&He.disposition!=="report"){le();var Ke=new Error("CSP violation of policy ".concat(He.effectiveDirective," ").concat(He.blockedURI,". Current policy is ").concat(He.originalPolicy));h.q.UseFallbackTexture=!1,N(Ke),U&&w.src&&URL.revokeObjectURL(w.src),w.src=""}}}),J.forEach(function(He){He.target.addEventListener(He.name,He.handler)});var be=Te.substring(0,5)==="blob:",ve=Te.substring(0,5)==="data:",ye=function(){be||ve||!i.u.IsCustomRequestAvailable?w.src=Te:I(Te,function(He,Ke,Qe){var Je=new Blob([He],{type:!fe&&Qe?Qe:fe}),ht=URL.createObjectURL(Je);U=!0,w.src=ht},void 0,ce||void 0,!0,function(He,Ke){N(Ke)})};if(!be&&!ve&&ce&&ce.enableTexturesOffline)ce.open(function(){ce&&ce.loadImage(Te,w)},ye);else{if(Te.indexOf("file:")!==-1){var Me=decodeURIComponent(Te.substring(5).toLowerCase());if(s.T.FilesToLoad[Me]&&typeof URL<"u"){try{var we=void 0;try{we=URL.createObjectURL(s.T.FilesToLoad[Me])}catch{we=URL.createObjectURL(s.T.FilesToLoad[Me])}w.src=we,U=!0}catch{w.src=""}return w}}ye()}return w},R=function(q,ee,te,ce,fe){var de=new FileReader,Te={onCompleteObservable:new a.cP,abort:function(){return de.abort()}};return de.onloadend=function(){return Te.onCompleteObservable.notifyObservers(Te)},fe&&(de.onerror=function(){fe(new f("Unable to read ".concat(q.name),q))}),de.onload=function(ue){ee(ue.target.result)},te&&(de.onprogress=te),ce?de.readAsArrayBuffer(q):de.readAsText(q),Te},I=function(q,ee,te,ce,fe,de,Te){if(q.name)return R(q,ee,te,fe,de?function(ve){de(void 0,ve)}:void 0);var ue=q;if(ue.indexOf("file:")!==-1){var U=decodeURIComponent(ue.substring(5).toLowerCase());U.indexOf("./")===0&&(U=U.substring(2));var N=s.T.FilesToLoad[U];if(N)return R(N,ee,te,fe,de?function(ve){return de(void 0,new C(ve.message,ve.file))}:void 0)}var w=F(ue),k=w.match,J=w.type;if(k){var le={onCompleteObservable:new a.cP,abort:function(){return function(){}}};try{var be=fe?X(ue):Q(ue);ee(be,void 0,J)}catch(ve){de?de(void 0,ve):p.V.Error(ve.message||"Failed to parse the Data URL")}return m._.SetImmediate(function(){le.onCompleteObservable.notifyObservers(le)}),le}return M(ue,function(ve,ye){ee(ve,ye?.responseURL,ye?.getResponseHeader("content-type"))},te,ce,fe,de?function(ve){de(ve.request,new C(ve.message,ve.request))}:void 0,Te)},M=function(q,ee,te,ce,fe,de,Te){q=g.CleanUrl(q),q=g.PreprocessUrl(q);var ue=g.BaseUrl+q,U=!1,N={onCompleteObservable:new a.cP,abort:function(){return U=!0}},w=function(){var J,le=new i.u,be=null,ve=function(){le&&(te&&le.removeEventListener("progress",te),J&&le.removeEventListener("readystatechange",J),le.removeEventListener("loadend",ye))},ye=function(){ve(),N.onCompleteObservable.notifyObservers(N),N.onCompleteObservable.clear(),te=void 0,J=null,ye=null,de=void 0,Te=void 0,ee=void 0};N.abort=function(){U=!0,ye&&ye(),le&&le.readyState!==(XMLHttpRequest.DONE||4)&&le.abort(),be!==null&&(clearTimeout(be),be=null),le=null};var Me=function(He){var Ke=He.message||"Unknown error";de&&le?de(new T(Ke,le)):p.V.Error(Ke)},we=function(He){if(le){if(le.open("GET",ue),Te)try{Te(le)}catch(Ke){return void Me(Ke)}fe&&(le.responseType="arraybuffer"),te&&le.addEventListener("progress",te),ye&&le.addEventListener("loadend",ye),J=function(){if(!U&&le&&le.readyState===(XMLHttpRequest.DONE||4)){if(J&&le.removeEventListener("readystatechange",J),le.status>=200&&le.status<300||le.status===0&&(!(0,o.BA)()||D())){try{ee&&ee(fe?le.response:le.responseText,le)}catch(ht){Me(ht)}return}var Ke=g.DefaultRetryStrategy;if(Ke){var Qe=Ke(ue,le,He);if(Qe!==-1)return ve(),le=new i.u,void(be=setTimeout(function(){return we(He+1)},Qe))}var Je=new T("Error status: "+le.status+" "+le.statusText+" - Unable to load "+ue,le);de&&de(Je)}},le.addEventListener("readystatechange",J),le.send()}};we(0)};if(ce&&ce.enableSceneOffline){var k=function(J){J&&J.status>400?de&&de(J):w()};ce.open(function(){ce&&ce.loadFile(g.BaseUrl+q,function(J){!U&&ee&&ee(J),N.onCompleteObservable.notifyObservers(N)},te?function(J){!U&&te&&te(J)}:void 0,k,fe)},k)}else w();return N},D=function(){return typeof location<"u"&&location.protocol==="file:"},B=function(q){return E.test(q)},F=function(q){var ee=E.exec(q);return ee===null||ee.length===0?{match:!1,type:""}:{match:!0,type:ee[0].replace("data:","").replace("base64,","")}};function X(q){return(0,u.yS)(q.split(",")[1])}var $,Q=function(q){return(0,u.AV)(q.split(",")[1])};b.$._FileToolsLoadImage=x,v.sg.loadFile=I,d.J.loadFile=I;var ie=function(q,ee,te,ce,fe,de,Te,ue,U,N){$={DecodeBase64UrlToBinary:q,DecodeBase64UrlToString:ee,DefaultRetryStrategy:te.DefaultRetryStrategy,BaseUrl:te.BaseUrl,CorsBehavior:te.CorsBehavior,PreprocessUrl:te.PreprocessUrl,IsBase64DataUrl:ce,IsFileURL:fe,LoadFile:de,LoadImage:Te,ReadFile:ue,RequestFile:U,SetCorsBehavior:N},Object.defineProperty($,"DefaultRetryStrategy",{get:function(){return te.DefaultRetryStrategy},set:function(w){te.DefaultRetryStrategy=w}}),Object.defineProperty($,"BaseUrl",{get:function(){return te.BaseUrl},set:function(w){te.BaseUrl=w}}),Object.defineProperty($,"PreprocessUrl",{get:function(){return te.PreprocessUrl},set:function(w){te.PreprocessUrl=w}}),Object.defineProperty($,"CorsBehavior",{get:function(){return te.CorsBehavior},set:function(w){te.CorsBehavior=w}})};ie(X,Q,g,B,D,I,x,R,M,S)},23148:(r,t,e)=>{e.d(t,{T:()=>n});var n=function(){function i(){}return i.FilesToLoad={},i}()},23885:(r,t,e)=>{function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){var a=16*Math.random()|0;return(o==="x"?a:3&a|8).toString(16)})}e.d(t,{S:()=>i,z:()=>n});var i={RandomId:n}},252:(r,t,e)=>{e.d(t,{n:()=>o});var n=e(7164),i=e(34623),o=function(){function a(){}return a.Instantiate=function(s){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[s])return this.RegisteredExternalClasses[s];var l=(0,i.n9)(s);if(l)return l;n.V.Warn(s+" not found, you may have missed an import.");for(var c=s.split("."),u=window||this,d=0,h=c.length;d<h;d++)u=u[c[d]];return typeof u!="function"?null:u},a.RegisteredExternalClasses={},a}()},88188:(r,t,e)=>{e.d(t,{H:()=>i});var n=e(7164),i=function(){function o(a,s){if(this.data=a,this.isInvalid=!1,!o.IsValid(a))return this.isInvalid=!0,void n.V.Error("texture missing KTX identifier");var l=Uint32Array.BYTES_PER_ELEMENT,c=new DataView(this.data.buffer,this.data.byteOffset+12,13*l),u=c.getUint32(0,!0)===67305985;return this.glType=c.getUint32(1*l,u),this.glTypeSize=c.getUint32(2*l,u),this.glFormat=c.getUint32(3*l,u),this.glInternalFormat=c.getUint32(4*l,u),this.glBaseInternalFormat=c.getUint32(5*l,u),this.pixelWidth=c.getUint32(6*l,u),this.pixelHeight=c.getUint32(7*l,u),this.pixelDepth=c.getUint32(8*l,u),this.numberOfArrayElements=c.getUint32(9*l,u),this.numberOfFaces=c.getUint32(10*l,u),this.numberOfMipmapLevels=c.getUint32(11*l,u),this.bytesOfKeyValueData=c.getUint32(12*l,u),this.glType!==0?(n.V.Error("only compressed formats currently supported"),void(this.isInvalid=!0)):(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight===0||this.pixelDepth!==0?(n.V.Error("only 2D textures currently supported"),void(this.isInvalid=!0)):this.numberOfArrayElements!==0?(n.V.Error("texture arrays not currently supported"),void(this.isInvalid=!0)):this.numberOfFaces!==s?(n.V.Error("number of faces expected"+s+", but found "+this.numberOfFaces),void(this.isInvalid=!0)):void(this.loadType=o.COMPRESSED_2D))}return o.prototype.uploadLevels=function(a,s){switch(this.loadType){case o.COMPRESSED_2D:this._upload2DCompressedLevels(a,s);case o.TEX_2D:case o.COMPRESSED_3D:case o.TEX_3D:}},o.prototype._upload2DCompressedLevels=function(a,s){for(var l=o.HEADER_LEN+this.bytesOfKeyValueData,c=this.pixelWidth,u=this.pixelHeight,d=s?this.numberOfMipmapLevels:1,h=0;h<d;h++){var p=new Int32Array(this.data.buffer,this.data.byteOffset+l,1)[0];l+=4;for(var m=0;m<this.numberOfFaces;m++){var v=new Uint8Array(this.data.buffer,this.data.byteOffset+l,p);a.getEngine()._uploadCompressedDataToTextureDirectly(a,a.format,c,u,v,m,h),l+=p,l+=3-(p+3)%4}c=Math.max(1,.5*c),u=Math.max(1,.5*u)}},o.IsValid=function(a){if(a.byteLength>=12){var s=new Uint8Array(a.buffer,a.byteOffset,12);if(s[0]===171&&s[1]===75&&s[2]===84&&s[3]===88&&s[4]===32&&s[5]===49&&s[6]===49&&s[7]===187&&s[8]===13&&s[9]===10&&s[10]===26&&s[11]===10)return!0}return!1},o.HEADER_LEN=64,o.COMPRESSED_2D=0,o.COMPRESSED_3D=1,o.TEX_2D=2,o.TEX_3D=3,o}()},47347:(r,t,e)=>{e.d(t,{$:()=>u,Z:()=>d});var n=e(81152),i=e(80244),o=e(44957),a=e(54665),s=e(78322);function l(h,p){var m=p?.jsDecoderModule||KTX2DECODER;h&&(h.wasmUASTCToASTC&&(m.LiteTranscoder_UASTC_ASTC.WasmModuleURL=h.wasmUASTCToASTC),h.wasmUASTCToBC7&&(m.LiteTranscoder_UASTC_BC7.WasmModuleURL=h.wasmUASTCToBC7),h.wasmUASTCToRGBA_UNORM&&(m.LiteTranscoder_UASTC_RGBA_UNORM.WasmModuleURL=h.wasmUASTCToRGBA_UNORM),h.wasmUASTCToRGBA_SRGB&&(m.LiteTranscoder_UASTC_RGBA_SRGB.WasmModuleURL=h.wasmUASTCToRGBA_SRGB),h.wasmUASTCToR8_UNORM&&(m.LiteTranscoder_UASTC_R8_UNORM.WasmModuleURL=h.wasmUASTCToR8_UNORM),h.wasmUASTCToRG8_UNORM&&(m.LiteTranscoder_UASTC_RG8_UNORM.WasmModuleURL=h.wasmUASTCToRG8_UNORM),h.jsMSCTranscoder&&(m.MSCTranscoder.JSModuleURL=h.jsMSCTranscoder),h.wasmMSCTranscoder&&(m.MSCTranscoder.WasmModuleURL=h.wasmMSCTranscoder),h.wasmZSTDDecoder&&(m.ZSTDDecoder.WasmModuleURL=h.wasmZSTDDecoder)),p&&(p.wasmUASTCToASTC&&(m.LiteTranscoder_UASTC_ASTC.WasmBinary=p.wasmUASTCToASTC),p.wasmUASTCToBC7&&(m.LiteTranscoder_UASTC_BC7.WasmBinary=p.wasmUASTCToBC7),p.wasmUASTCToRGBA_UNORM&&(m.LiteTranscoder_UASTC_RGBA_UNORM.WasmBinary=p.wasmUASTCToRGBA_UNORM),p.wasmUASTCToRGBA_SRGB&&(m.LiteTranscoder_UASTC_RGBA_SRGB.WasmBinary=p.wasmUASTCToRGBA_SRGB),p.wasmUASTCToR8_UNORM&&(m.LiteTranscoder_UASTC_R8_UNORM.WasmBinary=p.wasmUASTCToR8_UNORM),p.wasmUASTCToRG8_UNORM&&(m.LiteTranscoder_UASTC_RG8_UNORM.WasmBinary=p.wasmUASTCToRG8_UNORM),p.jsMSCTranscoder&&(m.MSCTranscoder.JSModule=p.jsMSCTranscoder),p.wasmMSCTranscoder&&(m.MSCTranscoder.WasmBinary=p.wasmMSCTranscoder),p.wasmZSTDDecoder&&(m.ZSTDDecoder.WasmBinary=p.wasmZSTDDecoder))}function c(h){var p;h===void 0&&typeof KTX2DECODER<"u"&&(h=KTX2DECODER),onmessage=function(m){if(m.data)switch(m.data.action){case"init":var v=m.data.urls;v&&(v.jsDecoderModule&&h===void 0&&(importScripts(v.jsDecoderModule),h=KTX2DECODER),l(v)),m.data.wasmBinaries&&l(void 0,(0,s.Cl)((0,s.Cl)({},m.data.wasmBinaries),{jsDecoderModule:h})),p=new h.KTX2Decoder,postMessage({action:"init"});break;case"setDefaultDecoderOptions":h.KTX2Decoder.DefaultDecoderOptions=m.data.options;break;case"decode":p.decode(m.data.data,m.data.caps,m.data.options).then(function(b){for(var E=[],C=0;C<b.mipmaps.length;++C){var T=b.mipmaps[C];T&&T.data&&E.push(T.data.buffer)}postMessage({action:"decoded",success:!0,decodedData:b},E)}).catch(function(b){postMessage({action:"decoded",success:!1,msg:b})})}}}var u=function(){function h(){this._isDirty=!0,this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC=!0,this._ktx2DecoderOptions={}}return Object.defineProperty(h.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"useRGBAIfASTCBC7NotAvailableWhenUASTC",{get:function(){return this._useRGBAIfASTCBC7NotAvailableWhenUASTC},set:function(p){this._useRGBAIfASTCBC7NotAvailableWhenUASTC!==p&&(this._useRGBAIfASTCBC7NotAvailableWhenUASTC=p,this._isDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"useRGBAIfOnlyBC1BC3AvailableWhenUASTC",{get:function(){return this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC},set:function(p){this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC!==p&&(this._useRGBAIfOnlyBC1BC3AvailableWhenUASTC=p,this._isDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"forceRGBA",{get:function(){return this._forceRGBA},set:function(p){this._forceRGBA!==p&&(this._forceRGBA=p,this._isDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"forceR8",{get:function(){return this._forceR8},set:function(p){this._forceR8!==p&&(this._forceR8=p,this._isDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"forceRG8",{get:function(){return this._forceRG8},set:function(p){this._forceRG8!==p&&(this._forceRG8=p,this._isDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"bypassTranscoders",{get:function(){return this._bypassTranscoders},set:function(p){this._bypassTranscoders!==p&&(this._bypassTranscoders=p,this._isDirty=!0)},enumerable:!1,configurable:!0}),h.prototype._getKTX2DecoderOptions=function(){if(!this._isDirty)return this._ktx2DecoderOptions;this._isDirty=!1;var p={useRGBAIfASTCBC7NotAvailableWhenUASTC:this._useRGBAIfASTCBC7NotAvailableWhenUASTC,forceRGBA:this._forceRGBA,forceR8:this._forceR8,forceRG8:this._forceRG8,bypassTranscoders:this._bypassTranscoders};return this.useRGBAIfOnlyBC1BC3AvailableWhenUASTC&&(p.transcodeFormatDecisionTree={UASTC:{transcodeFormat:[a.Xl.BC1_RGB,a.Xl.BC3_RGBA],yes:{transcodeFormat:a.Xl.RGBA32,engineFormat:32856,roundToMultiple4:!1}}}),this._ktx2DecoderOptions=p,p},h}(),d=function(){function h(p,m){var v,b;m===void 0&&(m=h.DefaultNumWorkers),this._engine=p;var E=typeof m=="object"&&m.workerPool||h.WorkerPool;if(E)h._WorkerPoolPromise=Promise.resolve(E);else{typeof m=="object"?h._KTX2DecoderModule=(v=m?.binariesAndModulesContainer)===null||v===void 0?void 0:v.jsDecoderModule:typeof KTX2DECODER<"u"&&(h._KTX2DecoderModule=KTX2DECODER);var C=typeof m=="number"?m:(b=m.numWorkers)!==null&&b!==void 0?b:h.DefaultNumWorkers;h._Initialize(C)}}return h.GetDefaultNumWorkers=function(){return typeof navigator=="object"&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1},h._Initialize=function(p){if(!h._WorkerPoolPromise&&!h._DecoderModulePromise){var m={jsDecoderModule:o.S0.GetBabylonScriptURL(this.URLConfig.jsDecoderModule,!0),wasmUASTCToASTC:o.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToASTC,!0),wasmUASTCToBC7:o.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToBC7,!0),wasmUASTCToRGBA_UNORM:o.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRGBA_UNORM,!0),wasmUASTCToRGBA_SRGB:o.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRGBA_SRGB,!0),wasmUASTCToR8_UNORM:o.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToR8_UNORM,!0),wasmUASTCToRG8_UNORM:o.S0.GetBabylonScriptURL(this.URLConfig.wasmUASTCToRG8_UNORM,!0),jsMSCTranscoder:o.S0.GetBabylonScriptURL(this.URLConfig.jsMSCTranscoder,!0),wasmMSCTranscoder:o.S0.GetBabylonScriptURL(this.URLConfig.wasmMSCTranscoder,!0),wasmZSTDDecoder:o.S0.GetBabylonScriptURL(this.URLConfig.wasmZSTDDecoder,!0)};p&&typeof Worker=="function"&&typeof URL<"u"?h._WorkerPoolPromise=new Promise(function(v){var b="".concat(l,"(").concat(c,")()"),E=URL.createObjectURL(new Blob([b],{type:"application/javascript"}));v(new i.h(p,function(){return function(C,T,f){return new Promise(function(g,S){var y=function(R){C.removeEventListener("error",y),C.removeEventListener("message",x),S(R)},x=function(R){R.data.action==="init"&&(C.removeEventListener("error",y),C.removeEventListener("message",x),g(C))};C.addEventListener("error",y),C.addEventListener("message",x),C.postMessage({action:"init",urls:f,wasmBinaries:void 0})})}(new Worker(E),0,m)}))}):h._KTX2DecoderModule===void 0?h._DecoderModulePromise=o.S0.LoadBabylonScriptAsync(m.jsDecoderModule).then(function(){return h._KTX2DecoderModule=KTX2DECODER,h._KTX2DecoderModule.MSCTranscoder.UseFromWorkerThread=!1,h._KTX2DecoderModule.WASMMemoryManager.LoadBinariesFromCurrentThread=!0,l(m,h._KTX2DecoderModule),new h._KTX2DecoderModule.KTX2Decoder}):(h._KTX2DecoderModule.MSCTranscoder.UseFromWorkerThread=!1,h._KTX2DecoderModule.WASMMemoryManager.LoadBinariesFromCurrentThread=!0,h._DecoderModulePromise=Promise.resolve(new h._KTX2DecoderModule.KTX2Decoder))}},h.prototype._uploadAsync=function(p,m,v){var b=this,E=this._engine.getCaps(),C={astc:!!E.astc,bptc:!!E.bptc,s3tc:!!E.s3tc,pvrtc:!!E.pvrtc,etc2:!!E.etc2,etc1:!!E.etc1};if(h._WorkerPoolPromise)return h._WorkerPoolPromise.then(function(T){return new Promise(function(f,g){T.push(function(S,y){var x=function(M){S.removeEventListener("error",x),S.removeEventListener("message",R),g(M),y()},R=function(M){if(M.data.action==="decoded"){if(S.removeEventListener("error",x),S.removeEventListener("message",R),M.data.success)try{b._createTexture(M.data.decodedData,m,v),f()}catch(D){g({message:D})}else g({message:M.data.msg});y()}};S.addEventListener("error",x),S.addEventListener("message",R),S.postMessage({action:"setDefaultDecoderOptions",options:h.DefaultDecoderOptions._getKTX2DecoderOptions()});var I=new Uint8Array(p.byteLength);I.set(new Uint8Array(p.buffer,p.byteOffset,p.byteLength)),S.postMessage({action:"decode",data:I,caps:C,options:v},[I.buffer])})})});if(h._DecoderModulePromise)return h._DecoderModulePromise.then(function(T){return h.DefaultDecoderOptions.isDirty&&(h._KTX2DecoderModule.KTX2Decoder.DefaultDecoderOptions=h.DefaultDecoderOptions._getKTX2DecoderOptions()),new Promise(function(f,g){T.decode(p,E).then(function(S){b._createTexture(S,m),f()}).catch(function(S){g({message:S})})})});throw new Error("KTX2 decoder module is not available")},h.prototype._createTexture=function(p,m,v){this._engine._bindTextureDirectly(3553,m),v&&(v.transcodedFormat=p.transcodedFormat,v.isInGammaSpace=p.isInGammaSpace,v.hasAlpha=p.hasAlpha,v.transcoderName=p.transcoderName);var b=!0;switch(p.transcodedFormat){case 32856:m.type=n.Y.TEXTURETYPE_UNSIGNED_BYTE,m.format=n.Y.TEXTUREFORMAT_RGBA;break;case 33321:m.type=n.Y.TEXTURETYPE_UNSIGNED_BYTE,m.format=n.Y.TEXTUREFORMAT_R;break;case 33323:m.type=n.Y.TEXTURETYPE_UNSIGNED_BYTE,m.format=n.Y.TEXTUREFORMAT_RG;break;default:m.format=p.transcodedFormat,b=!1}if(m._gammaSpace=p.isInGammaSpace,m.generateMipMaps=p.mipmaps.length>1,p.errors)throw new Error("KTX2 container - could not transcode the data. "+p.errors);for(var E=0;E<p.mipmaps.length;++E){var C=p.mipmaps[E];if(!C||!C.data)throw new Error("KTX2 container - could not transcode one of the image");b?(m.width=C.width,m.height=C.height,this._engine._uploadDataToTextureDirectly(m,C.data,0,E,void 0,!0)):this._engine._uploadCompressedDataToTextureDirectly(m,p.transcodedFormat,C.width,C.height,C.data,0,E)}m._extension=".ktx2",m.width=p.mipmaps[0].width,m.height=p.mipmaps[0].height,m.isReady=!0,this._engine._bindTextureDirectly(3553,null)},h.IsValid=function(p){if(p.byteLength>=12){var m=new Uint8Array(p.buffer,p.byteOffset,12);if(m[0]===171&&m[1]===75&&m[2]===84&&m[3]===88&&m[4]===32&&m[5]===50&&m[6]===48&&m[7]===187&&m[8]===13&&m[9]===10&&m[10]===26&&m[11]===10)return!0}return!1},h.URLConfig={jsDecoderModule:"https://cdn.babylonjs.com/babylon.ktx2Decoder.js",wasmUASTCToASTC:null,wasmUASTCToBC7:null,wasmUASTCToRGBA_UNORM:null,wasmUASTCToRGBA_SRGB:null,wasmUASTCToR8_UNORM:null,wasmUASTCToRG8_UNORM:null,jsMSCTranscoder:null,wasmMSCTranscoder:null,wasmZSTDDecoder:null},h.DefaultNumWorkers=h.GetDefaultNumWorkers(),h.DefaultDecoderOptions=new u,h}()},7164:(r,t,e)=>{e.d(t,{V:()=>i});var n=e(78322),i=function(){function o(){}return o._CheckLimit=function(a,s){var l=o._LogLimitOutputs[a];return l?l.current++:(l={limit:s,current:1},o._LogLimitOutputs[a]=l),l.current<=l.limit},o._GenerateLimitMessage=function(a,s){var l;s===void 0&&(s=1);var c=o._LogLimitOutputs[a];if(c&&o.MessageLimitReached){var u=this._Levels[s];c.current===c.limit&&o[u.name](o.MessageLimitReached.replace(/%LIMIT%/g,""+c.limit).replace(/%TYPE%/g,(l=u.name)!==null&&l!==void 0?l:""))}},o._AddLogEntry=function(a){o._LogCache=a+o._LogCache,o.OnNewCacheEntry&&o.OnNewCacheEntry(a)},o._FormatMessage=function(a){var s=function(c){return c<10?"0"+c:""+c},l=new Date;return"["+s(l.getHours())+":"+s(l.getMinutes())+":"+s(l.getSeconds())+"]: "+a},o._LogDisabled=function(a,s){},o._LogEnabled=function(a,s,l){a===void 0&&(a=1);var c=Array.isArray(s)?s[0]:s;if(l===void 0||o._CheckLimit(c,l)){var u=o._FormatMessage(c),d=this._Levels[a],h=Array.isArray(s)?s.slice(1):[];d.logFunc&&d.logFunc.apply(d,(0,n.fX)(["BJS - "+u],h,!1));var p="<div style='color:".concat(d.color,"'>").concat(u,"</div><br>");o._AddLogEntry(p),o._GenerateLimitMessage(c,a)}},Object.defineProperty(o,"LogCache",{get:function(){return o._LogCache},enumerable:!1,configurable:!0}),o.ClearLogCache=function(){o._LogCache="",o._LogLimitOutputs={},o.errorsCount=0},Object.defineProperty(o,"LogLevels",{set:function(a){var s=this;o.Log=o._LogDisabled,o.Warn=o._LogDisabled,o.Error=o._LogDisabled,[o.MessageLogLevel,o.WarningLogLevel,o.ErrorLogLevel].forEach(function(l){(a&l)===l&&(o[s._Levels[l].name]=o._LogEnabled.bind(o,l))})},enumerable:!1,configurable:!0}),o.NoneLogLevel=0,o.MessageLogLevel=1,o.WarningLogLevel=2,o.ErrorLogLevel=4,o.AllLogLevel=7,o.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",o._LogCache="",o._LogLimitOutputs={},o._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],o.errorsCount=0,o.Log=o._LogEnabled.bind(o,o.MessageLogLevel),o.Warn=o._LogEnabled.bind(o,o.WarningLogLevel),o.Error=o._LogEnabled.bind(o,o.ErrorLogLevel),o}()},66377:(r,t,e)=>{e.d(t,{cP:()=>o,nu:()=>i,qO:()=>n});var n=function(){function a(s,l,c,u){l===void 0&&(l=!1),this.initialize(s,l,c,u)}return a.prototype.initialize=function(s,l,c,u){return l===void 0&&(l=!1),this.mask=s,this.skipNextObservers=l,this.target=c,this.currentTarget=u,this},a}(),i=function(){function a(s,l,c){c===void 0&&(c=null),this.callback=s,this.mask=l,this.scope=c,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}return a.prototype.remove=function(){this._remove&&this._remove()},a}(),o=function(){function a(s,l){l===void 0&&(l=!1),this.notifyIfTriggered=l,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new n(0),s&&(this._onObserverAdded=s)}return a.FromPromise=function(s,l){var c=new a;return s.then(function(u){c.notifyObservers(u)}).catch(function(u){if(!l)throw u;l.notifyObservers(u)}),c},Object.defineProperty(a.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),a.prototype.add=function(s,l,c,u,d){var h=this;if(l===void 0&&(l=-1),c===void 0&&(c=!1),u===void 0&&(u=null),d===void 0&&(d=!1),!s)return null;var p=new i(s,l,u);return p.unregisterOnNextCall=d,c?this._observers.unshift(p):this._observers.push(p),this._onObserverAdded&&this._onObserverAdded(p),this._hasNotified&&this.notifyIfTriggered&&this._lastNotifiedValue!==void 0&&this.notifyObserver(p,this._lastNotifiedValue),p._remove=function(){h.remove(p)},p},a.prototype.addOnce=function(s){return this.add(s,void 0,void 0,void 0,!0)},a.prototype.remove=function(s){return!!s&&(s._remove=null,this._observers.indexOf(s)!==-1&&(this._deferUnregister(s),!0))},a.prototype.removeCallback=function(s,l){for(var c=0;c<this._observers.length;c++){var u=this._observers[c];if(!(u._willBeUnregistered||u.callback!==s||l&&l!==u.scope))return this._deferUnregister(u),!0}return!1},a.prototype._deferUnregister=function(s){var l=this;s._willBeUnregistered||(this._numObserversMarkedAsDeleted++,s.unregisterOnNextCall=!1,s._willBeUnregistered=!0,setTimeout(function(){l._remove(s)},0))},a.prototype._remove=function(s,l){if(l===void 0&&(l=!0),!s)return!1;var c=this._observers.indexOf(s);return c!==-1&&(l&&this._numObserversMarkedAsDeleted--,this._observers.splice(c,1),!0)},a.prototype.makeObserverTopPriority=function(s){this._remove(s,!1),this._observers.unshift(s)},a.prototype.makeObserverBottomPriority=function(s){this._remove(s,!1),this._observers.push(s)},a.prototype.notifyObservers=function(s,l,c,u,d){if(l===void 0&&(l=-1),this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=s),!this._observers.length)return!0;var h=this._eventState;h.mask=l,h.target=c,h.currentTarget=u,h.skipNextObservers=!1,h.lastReturnValue=s,h.userInfo=d;for(var p=0,m=this._observers;p<m.length;p++){var v=m[p];if(!v._willBeUnregistered&&(v.mask&l&&(v.unregisterOnNextCall&&this._deferUnregister(v),v.scope?h.lastReturnValue=v.callback.apply(v.scope,[s,h]):h.lastReturnValue=v.callback(s,h)),h.skipNextObservers))return!1}return!0},a.prototype.notifyObserver=function(s,l,c){if(c===void 0&&(c=-1),this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=l),!s._willBeUnregistered){var u=this._eventState;u.mask=c,u.skipNextObservers=!1,s.unregisterOnNextCall&&this._deferUnregister(s),s.callback(l,u)}},a.prototype.hasObservers=function(){return this._observers.length-this._numObserversMarkedAsDeleted>0},a.prototype.clear=function(){for(;this._observers.length;){var s=this._observers.pop();s&&(s._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()},a.prototype.cleanLastNotifiedState=function(){this._hasNotified=!1,this._lastNotifiedValue=void 0},a.prototype.clone=function(){var s=new a;return s._observers=this._observers.slice(0),s},a.prototype.hasSpecificMask=function(s){s===void 0&&(s=-1);for(var l=0,c=this._observers;l<c.length;l++){var u=c[l];if(u.mask&s||u.mask===s)return!0}return!1},a}()},70511:(r,t,e)=>{e.d(t,{A:()=>i});var n=e(85258),i=function(){function o(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(o.prototype,"min",{get:function(){return this._min},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"average",{get:function(){return this._average},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!1,configurable:!0}),o.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},o.prototype.addCount=function(a,s){o.Enabled&&(this._current+=a,s&&this._fetchResult())},o.prototype.beginMonitoring=function(){o.Enabled&&(this._startMonitoringTime=n.j.Now)},o.prototype.endMonitoring=function(a){if(a===void 0&&(a=!0),o.Enabled){a&&this.fetchNewFrame();var s=n.j.Now;this._current=s-this._startMonitoringTime,a&&this._fetchResult()}},o.prototype.endFrame=function(){this._fetchResult()},o.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var a=n.j.Now;a-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=a,this._lastSecAccumulated=0,this._lastSecValueCount=0)},o.Enabled=!0,o}()},85258:(r,t,e)=>{e.d(t,{j:()=>i});var n=e(5153),i=function(){function o(){}return Object.defineProperty(o,"Now",{get:function(){return(0,n.BA)()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!1,configurable:!0}),o}()},49449:(r,t,e)=>{e.d(t,{a:()=>n});var n=function(){function i(){}return i.ExponentialBackoff=function(o,a){return o===void 0&&(o=3),a===void 0&&(a=500),function(s,l,c){return l.status!==0||c>=o||s.indexOf("file:")!==-1?-1:Math.pow(2,c)*a}},i}()},97411:(r,t,e)=>{e.d(t,{G:()=>s});var n=e(78322),i=e(81152),o=e(30622),a=(e(71073),e(35877)),s=function(){function l(){}return l.ExpandRGBDTexture=function(c){var u=this,d=c._texture;if(d&&c.isRGBD){var h=d.getEngine(),p=h.getCaps(),m=d.isReady,v=!1;p.textureHalfFloatRender&&p.textureHalfFloatLinearFiltering?(v=!0,d.type=i.Y.TEXTURETYPE_HALF_FLOAT):p.textureFloatRender&&p.textureFloatLinearFiltering&&(v=!0,d.type=i.Y.TEXTURETYPE_FLOAT),v&&(d.isReady=!1,d._isRGBD=!1,d.invertY=!1);var b=function(){return(0,n.sH)(u,void 0,void 0,function(){var E,C,T,f;return(0,n.YH)(this,function(g){switch(g.label){case 0:return E=h.isWebGPU,C=E?1:0,d.isReady=!1,this._ShaderImported?[3,4]:(this._ShaderImported=!0,E?[4,Promise.all([Promise.resolve().then(e.bind(e,37494)),Promise.resolve().then(e.bind(e,86558))])]:[3,2]);case 1:return g.sent(),[3,4];case 2:return[4,Promise.all([Promise.resolve().then(e.bind(e,32407)),Promise.resolve().then(e.bind(e,22955))])];case 3:g.sent(),g.label=4;case 4:return(T=new o.w("rgbdDecode","rgbdDecode",null,null,1,null,i.Y.TEXTURE_TRILINEAR_SAMPLINGMODE,h,!1,void 0,d.type,void 0,null,!1,void 0,C)).externalTextureSamplerBinding=!0,f=h.createRenderTargetTexture(d.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:d.samplingMode,type:d.type,format:i.Y.TEXTUREFORMAT_RGBA}),T.onEffectCreatedObservable.addOnce(function(S){S.executeWhenCompiled(function(){T.onApply=function(y){y._bindTexture("textureSampler",d),y.setFloat2("scale",1,1)},c.getScene().postProcessManager.directRender([T],f,!0),h.restoreDefaultFramebuffer(),h._releaseTexture(d),T&&T.dispose(),f._swapAndDie(d),d.isReady=!0})}),[2]}})})};v&&(m?b():c.onLoadObservable.addOnce(b))}},l.EncodeTextureToRGBD=function(c,u,d){return d===void 0&&(d=i.Y.TEXTURETYPE_UNSIGNED_BYTE),(0,a.Qs)("rgbdEncode",c,u,d,i.Y.TEXTURE_NEAREST_SAMPLINGMODE,i.Y.TEXTUREFORMAT_RGBA)},l._ShaderImported=!1,l}()},53770:(r,t,e)=>{e.d(t,{L:()=>i,b:()=>o});var n=e(78322),i=function(){function a(s){this.length=0,this.data=new Array(s),this._id=a._GlobalId++}return a.prototype.push=function(s){this.data[this.length++]=s,this.length>this.data.length&&(this.data.length*=2)},a.prototype.forEach=function(s){for(var l=0;l<this.length;l++)s(this.data[l])},a.prototype.sort=function(s){this.data.sort(s)},a.prototype.reset=function(){this.length=0},a.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0)},a.prototype.concat=function(s){if(s.length!==0){this.length+s.length>this.data.length&&(this.data.length=2*(this.length+s.length));for(var l=0;l<s.length;l++)this.data[this.length++]=(s.data||s)[l]}},a.prototype.indexOf=function(s){var l=this.data.indexOf(s);return l>=this.length?-1:l},a.prototype.contains=function(s){return this.indexOf(s)!==-1},a._GlobalId=0,a}(),o=function(a){function s(){var l=a!==null&&a.apply(this,arguments)||this;return l._duplicateId=0,l}return(0,n.C6)(s,a),s.prototype.push=function(l){a.prototype.push.call(this,l),l.__smartArrayFlags||(l.__smartArrayFlags={}),l.__smartArrayFlags[this._id]=this._duplicateId},s.prototype.pushNoDuplicate=function(l){return!(l.__smartArrayFlags&&l.__smartArrayFlags[this._id]===this._duplicateId||(this.push(l),0))},s.prototype.reset=function(){a.prototype.reset.call(this),this._duplicateId++},s.prototype.concatWithNoDuplicate=function(l){if(l.length!==0){this.length+l.length>this.data.length&&(this.data.length=2*(this.length+l.length));for(var c=0;c<l.length;c++){var u=(l.data||l)[c];this.pushNoDuplicate(u)}}},s}(i)},59437:(r,t,e)=>{e.d(t,{w:()=>n});var n=function(){function i(){this._count=0,this._data={}}return i.prototype.copyFrom=function(o){var a=this;this.clear(),o.forEach(function(s,l){return a.add(s,l)})},i.prototype.get=function(o){var a=this._data[o];if(a!==void 0)return a},i.prototype.getOrAddWithFactory=function(o,a){var s=this.get(o);return s!==void 0||(s=a(o))&&this.add(o,s),s},i.prototype.getOrAdd=function(o,a){var s=this.get(o);return s!==void 0?s:(this.add(o,a),a)},i.prototype.contains=function(o){return this._data[o]!==void 0},i.prototype.add=function(o,a){return this._data[o]===void 0&&(this._data[o]=a,++this._count,!0)},i.prototype.set=function(o,a){return this._data[o]!==void 0&&(this._data[o]=a,!0)},i.prototype.getAndRemove=function(o){var a=this.get(o);return a!==void 0?(delete this._data[o],--this._count,a):null},i.prototype.remove=function(o){return!!this.contains(o)&&(delete this._data[o],--this._count,!0)},i.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(i.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),i.prototype.forEach=function(o){for(var a in this._data)o(a,this._data[a])},i.prototype.first=function(o){for(var a in this._data){var s=o(a,this._data[a]);if(s)return s}return null},i}()},37530:(r,t,e)=>{e.d(t,{AV:()=>s,EL:()=>a,LW:()=>c,Tq:()=>o,UH:()=>i,jq:()=>n,nQ:()=>u,yS:()=>l});var n=function(d,h){return d.endsWith(h)},i=function(d,h){return!!d&&d.startsWith(h)},o=function(d){if(typeof TextDecoder<"u")return new TextDecoder().decode(d);for(var h="",p=0;p<d.byteLength;p++)h+=String.fromCharCode(d[p]);return h},a=function(d){for(var h,p,m,v,b,E,C,T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f="",g=0,S=ArrayBuffer.isView(d)?new Uint8Array(d.buffer,d.byteOffset,d.byteLength):new Uint8Array(d);g<S.length;)v=(h=S[g++])>>2,b=(3&h)<<4|(p=g<S.length?S[g++]:Number.NaN)>>4,E=(15&p)<<2|(m=g<S.length?S[g++]:Number.NaN)>>6,C=63&m,isNaN(p)?E=C=64:isNaN(m)&&(C=64),f+=T.charAt(v)+T.charAt(b)+T.charAt(E)+T.charAt(C);return f},s=function(d){return atob(d)},l=function(d){for(var h=s(d),p=h.length,m=new Uint8Array(new ArrayBuffer(p)),v=0;v<p;v++)m[v]=h.charCodeAt(v);return m.buffer},c=function(d,h){for(var p=String(d);p.length<h;)p="0"+p;return p},u={EndsWith:n,StartsWith:i,Decode:o,EncodeArrayBufferToBase64:a,DecodeBase64ToString:s,DecodeBase64ToBinary:l,PadNumber:c}},31985:(r,t,e)=>{e.d(t,{Y:()=>i});var n=e(92548),i=function(){function o(){}return o.EnableFor=function(a){a._tags=a._tags||{},a.hasTags=function(){return o.HasTags(a)},a.addTags=function(s){return o.AddTagsTo(a,s)},a.removeTags=function(s){return o.RemoveTagsFrom(a,s)},a.matchesTagsQuery=function(s){return o.MatchesQuery(a,s)}},o.DisableFor=function(a){delete a._tags,delete a.hasTags,delete a.addTags,delete a.removeTags,delete a.matchesTagsQuery},o.HasTags=function(a){if(!a._tags)return!1;var s=a._tags;for(var l in s)if(Object.prototype.hasOwnProperty.call(s,l))return!0;return!1},o.GetTags=function(a,s){if(s===void 0&&(s=!0),!a._tags)return null;if(s){var l=[];for(var c in a._tags)Object.prototype.hasOwnProperty.call(a._tags,c)&&a._tags[c]===!0&&l.push(c);return l.join(" ")}return a._tags},o.AddTagsTo=function(a,s){s&&typeof s=="string"&&s.split(" ").forEach(function(l){o._AddTagTo(a,l)})},o._AddTagTo=function(a,s){(s=s.trim())!==""&&s!=="true"&&s!=="false"&&(s.match(/[\s]/)||s.match(/^([!]|([|]|[&]){2})/)||(o.EnableFor(a),a._tags[s]=!0))},o.RemoveTagsFrom=function(a,s){if(o.HasTags(a)){var l=s.split(" ");for(var c in l)o._RemoveTagFrom(a,l[c])}},o._RemoveTagFrom=function(a,s){delete a._tags[s]},o.MatchesQuery=function(a,s){return s===void 0||(s===""?o.HasTags(a):n.Z.Eval(s,function(l){return o.HasTags(a)&&a._tags[l]}))},o}()},35877:(r,t,e)=>{e.d(t,{Qs:()=>p,EE:()=>h,SX:()=>v,Oz:()=>E,LO:()=>C,LZ:()=>m});var n=e(78322),i=e(50582),o=e(41085),a=e(73441),s=e(81152),l=e(30622),c=e(98519);c.l.ShadersStore.lodPixelShader=`#extension GL_EXT_shader_texture_lod : enable
precision highp float;const float GammaEncodePowerApprox=1.0/2.2;varying vec2 vUV;uniform sampler2D textureSampler;uniform float lod;uniform vec2 texSize;uniform bool gamma;void main(void)
{gl_FragColor=textureLod(textureSampler,vUV,lod);if (!gamma) {gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(GammaEncodePowerApprox));}}
`;var u,d;function h(T,f,g,S){S===void 0&&(S=!0);var y=T.getScene(),x=y.getEngine(),R=new o.$("resized"+T.name,{width:f,height:g},y,!T.noMipmap,!0,T._texture.type,!1,T.samplingMode,!1);R.wrapU=T.wrapU,R.wrapV=T.wrapV,R.uOffset=T.uOffset,R.vOffset=T.vOffset,R.uScale=T.uScale,R.vScale=T.vScale,R.uAng=T.uAng,R.vAng=T.vAng,R.wAng=T.wAng,R.coordinatesIndex=T.coordinatesIndex,R.level=T.level,R.anisotropicFilteringLevel=T.anisotropicFilteringLevel,R._texture.isReady=!1,T.wrapU=i.g.CLAMP_ADDRESSMODE,T.wrapV=i.g.CLAMP_ADDRESSMODE;var I=new a.v("pass",1,null,S?i.g.BILINEAR_SAMPLINGMODE:i.g.NEAREST_SAMPLINGMODE,x,!1,s.Y.TEXTURETYPE_UNSIGNED_INT);return I.externalTextureSamplerBinding=!0,I.onEffectCreatedObservable.addOnce(function(M){M.executeWhenCompiled(function(){I.onApply=function(B){B.setTexture("textureSampler",T)};var D=R.renderTarget;D&&(y.postProcessManager.directRender([I],D),x.unBindFramebuffer(D),R.disposeFramebufferObjects(),I.dispose(),R.getInternalTexture().isReady=!0)})}),R}function p(T,f,g,S,y,x,R,I){var M=f.getEngine();return f.isReady=!1,y=y??f.samplingMode,S=S??f.type,x=x??f.format,R=R??f.width,I=I??f.height,S===-1&&(S=s.Y.TEXTURETYPE_UNSIGNED_BYTE),new Promise(function(D){var B=new l.w("postprocess",T,null,null,1,null,y,M,!1,void 0,S,void 0,null,!1,x);B.externalTextureSamplerBinding=!0;var F=M.createRenderTargetTexture({width:R,height:I},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:y,type:S,format:x});B.onEffectCreatedObservable.addOnce(function(X){X.executeWhenCompiled(function(){B.onApply=function($){$._bindTexture("textureSampler",f),$.setFloat2("scale",1,1)},g.postProcessManager.directRender([B],F,!0),M.restoreDefaultFramebuffer(),M._releaseTexture(f),B&&B.dispose(),F._swapAndDie(f),f.type=S,f.format=s.Y.TEXTUREFORMAT_RGBA,f.isReady=!0,D(f)})})})}function m(T){u||(u=new Float32Array(1),d=new Int32Array(u.buffer)),u[0]=T;var f=d[0],g=f>>16&32768,S=f>>12&2047,y=f>>23&255;return y<103?g:y>142?(g|=31744,g|=(y==255?0:1)&&8388607&f):y<113?g|=((S|=2048)>>114-y)+(S>>113-y&1):(g|=y-112<<10|S>>1,g+=1&S)}function v(T){var f=(32768&T)>>15,g=(31744&T)>>10,S=1023&T;return g===0?(f?-1:1)*Math.pow(2,-14)*(S/Math.pow(2,10)):g==31?S?NaN:1/0*(f?-1:1):(f?-1:1)*Math.pow(2,g-15)*(1+S/Math.pow(2,10))}c.l.ShadersStore.lodCubePixelShader=`precision highp float;const float GammaEncodePowerApprox=1.0/2.2;varying vec2 vUV;uniform samplerCube textureSampler;uniform float lod;uniform bool gamma;void main(void)
{vec2 uv=vUV*2.0-1.0;
#ifdef POSITIVEX
gl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x),lod);
#endif
#ifdef NEGATIVEX
gl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x),lod);
#endif
#ifdef POSITIVEY
gl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x),lod);
#endif
#ifdef NEGATIVEY
gl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x),lod);
#endif
#ifdef POSITIVEZ
gl_FragColor=textureCube(textureSampler,vec3(uv,1.001),lod);
#endif
#ifdef NEGATIVEZ
gl_FragColor=textureCube(textureSampler,vec3(uv,-1.001),lod);
#endif
if (!gamma) {gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(GammaEncodePowerApprox));}}
`;var b=function(T,f,g,S,y){return(0,n.sH)(void 0,void 0,void 0,function(){var x,R,I,M,D,B,F,X,$;return(0,n.YH)(this,function(Q){switch(Q.label){case 0:return x=T.getScene(),R=x.getEngine(),T.isCube?(M=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"],I=new l.w("lodCube","lodCube",["lod","gamma"],null,1,null,i.g.NEAREST_NEAREST_MIPNEAREST,R,!1,M[S])):I=new l.w("lod","lod",["lod","gamma"],null,1,null,i.g.NEAREST_NEAREST_MIPNEAREST,R),[4,new Promise(function(ie){I.onEffectCreatedObservable.addOnce(function(q){q.executeWhenCompiled(function(){ie(0)})})})];case 1:Q.sent(),D=new o.$("temp",{width:f,height:g},x,!1),I.onApply=function(ie){ie.setTexture("textureSampler",T),ie.setFloat("lod",y),ie.setBool("gamma",T.gammaSpace)},B=T.getInternalTexture(),Q.label=2;case 2:return Q.trys.push([2,,6,7]),D.renderTarget&&B?(F=B.samplingMode,y!==0?T.updateSamplingMode(i.g.NEAREST_NEAREST_MIPNEAREST):T.updateSamplingMode(i.g.NEAREST_NEAREST),x.postProcessManager.directRender([I],D.renderTarget,!0),T.updateSamplingMode(F),[4,R.readPixels(0,0,f,g)]):[3,4];case 3:return X=Q.sent(),$=new Uint8Array(X.buffer,0,X.byteLength),R.unBindFramebuffer(D.renderTarget),[2,$];case 4:throw Error("Render to texture failed.");case 5:return[3,7];case 6:return D.dispose(),I.dispose(),[7];case 7:return[2]}})})};function E(T,f,g,S,y){return S===void 0&&(S=0),y===void 0&&(y=0),(0,n.sH)(this,void 0,void 0,function(){return(0,n.YH)(this,function(x){switch(x.label){case 0:return T.isReady()||!T._texture?[3,2]:[4,new Promise(function(R,I){T._texture!==null?T._texture.onLoadedObservable.addOnce(function(){R(0)}):I(0)})];case 1:x.sent(),x.label=2;case 2:return[4,b(T,f,g,S,y)];case 3:return[2,x.sent()]}})})}var C={CreateResizedCopy:h,ApplyPostProcess:p,ToHalfFloat:m,FromHalfFloat:v,GetTextureDataAsync:E}},65054:(r,t,e)=>{e.d(t,{FA:()=>E,O_:()=>b,uT:()=>C});var n=e(7164),i=1,o=2,a=3,s=9,l=10,c=11,u=48,d=4,h=0,p=1,m=2,v=3;function b(T){var f=0;return{id_length:T[f++],colormap_type:T[f++],image_type:T[f++],colormap_index:T[f++]|T[f++]<<8,colormap_length:T[f++]|T[f++]<<8,colormap_size:T[f++],origin:[T[f++]|T[f++]<<8,T[f++]|T[f++]<<8],width:T[f++]|T[f++]<<8,height:T[f++]|T[f++]<<8,pixel_size:T[f++],flags:T[f++]}}function E(T,f){if(f.length<19)n.V.Error("Unable to load TGA file - Not enough data to contain header");else{var g=18,S=b(f);if(S.id_length+g>f.length)n.V.Error("Unable to load TGA file - Not enough data");else{g+=S.id_length;var y,x=!1,R=!1,I=!1;switch(S.image_type){case s:x=!0;case i:R=!0;break;case l:x=!0;case o:break;case c:x=!0;case a:I=!0}var M,D,B,F,X,$,Q,ie=S.pixel_size>>3,q=S.width*S.height*ie;if(R&&(M=f.subarray(g,g+=S.colormap_length*(S.colormap_size>>3))),x){y=new Uint8Array(q);for(var ee=void 0,te=void 0,ce=void 0,fe=0,de=new Uint8Array(ie);g<q&&fe<q;)if(te=1+(127&(ee=f[g++])),128&ee){for(ce=0;ce<ie;++ce)de[ce]=f[g++];for(ce=0;ce<te;++ce)y.set(de,fe+ce*ie);fe+=ie*te}else{for(te*=ie,ce=0;ce<te;++ce)y[fe+ce]=f[g++];fe+=te}}else y=f.subarray(g,g+=R?S.width*S.height:q);switch((S.flags&u)>>d){default:case m:D=0,F=1,Q=S.width,B=0,X=1,$=S.height;break;case h:D=0,F=1,Q=S.width,B=S.height-1,X=-1,$=-1;break;case v:D=S.width-1,F=-1,Q=-1,B=0,X=1,$=S.height;break;case p:D=S.width-1,F=-1,Q=-1,B=S.height-1,X=-1,$=-1}var Te="_getImageData"+(I?"Grey":"")+S.pixel_size+"bits",ue=C[Te](S,M,y,B,X,$,D,F,Q);T.getEngine()._uploadDataToTextureDirectly(T,ue)}}}var C={GetTGAHeader:b,UploadContent:E,_getImageData8bits:function(T,f,g,S,y,x,R,I,M){var D,B,F,X=g,$=f,Q=T.width,ie=T.height,q=0,ee=new Uint8Array(Q*ie*4);for(F=S;F!==x;F+=y)for(B=R;B!==M;B+=I,q++)D=X[q],ee[4*(B+Q*F)+3]=255,ee[4*(B+Q*F)+2]=$[3*D+0],ee[4*(B+Q*F)+1]=$[3*D+1],ee[4*(B+Q*F)+0]=$[3*D+2];return ee},_getImageData16bits:function(T,f,g,S,y,x,R,I,M){var D,B,F,X=g,$=T.width,Q=T.height,ie=0,q=new Uint8Array($*Q*4);for(F=S;F!==x;F+=y)for(B=R;B!==M;B+=I,ie+=2){var ee=255*((31744&(D=X[ie+0]+(X[ie+1]<<8)))>>10)/31|0,te=255*((992&D)>>5)/31|0,ce=255*(31&D)/31|0;q[4*(B+$*F)+0]=ee,q[4*(B+$*F)+1]=te,q[4*(B+$*F)+2]=ce,q[4*(B+$*F)+3]=32768&D?0:255}return q},_getImageData24bits:function(T,f,g,S,y,x,R,I,M){var D,B,F=g,X=T.width,$=T.height,Q=0,ie=new Uint8Array(X*$*4);for(B=S;B!==x;B+=y)for(D=R;D!==M;D+=I,Q+=3)ie[4*(D+X*B)+3]=255,ie[4*(D+X*B)+2]=F[Q+0],ie[4*(D+X*B)+1]=F[Q+1],ie[4*(D+X*B)+0]=F[Q+2];return ie},_getImageData32bits:function(T,f,g,S,y,x,R,I,M){var D,B,F=g,X=T.width,$=T.height,Q=0,ie=new Uint8Array(X*$*4);for(B=S;B!==x;B+=y)for(D=R;D!==M;D+=I,Q+=4)ie[4*(D+X*B)+2]=F[Q+0],ie[4*(D+X*B)+1]=F[Q+1],ie[4*(D+X*B)+0]=F[Q+2],ie[4*(D+X*B)+3]=F[Q+3];return ie},_getImageDataGrey8bits:function(T,f,g,S,y,x,R,I,M){var D,B,F,X=g,$=T.width,Q=T.height,ie=0,q=new Uint8Array($*Q*4);for(F=S;F!==x;F+=y)for(B=R;B!==M;B+=I,ie++)D=X[ie],q[4*(B+$*F)+0]=D,q[4*(B+$*F)+1]=D,q[4*(B+$*F)+2]=D,q[4*(B+$*F)+3]=255;return q},_getImageDataGrey16bits:function(T,f,g,S,y,x,R,I,M){var D,B,F=g,X=T.width,$=T.height,Q=0,ie=new Uint8Array(X*$*4);for(B=S;B!==x;B+=y)for(D=R;D!==M;D+=I,Q+=2)ie[4*(D+X*B)+0]=F[Q+0],ie[4*(D+X*B)+1]=F[Q+0],ie[4*(D+X*B)+2]=F[Q+0],ie[4*(D+X*B)+3]=F[Q+1];return ie}}},53695:(r,t,e)=>{e.d(t,{_:()=>i});var n=e(5153),i=function(){function o(){}return o.SetImmediate=function(a){(0,n.BA)()&&window.setImmediate?window.setImmediate(a):setTimeout(a,1)},o}()},87074:(r,t,e)=>{e.d(t,{C4:()=>l,L8:()=>i,OG:()=>a,R:()=>c,zF:()=>o});var n=e(81152);function i(u){var d=1;do d*=2;while(d<u);return d===u}function o(u,d,h){return u*(1-h)+d*h}function a(u){var d=s(u),h=l(u);return d-u>u-h?h:d}function s(u){return u--,u|=u>>1,u|=u>>2,u|=u>>4,u|=u>>8,u|=u>>16,++u}function l(u){return u|=u>>1,u|=u>>2,u|=u>>4,u|=u>>8,(u|=u>>16)-(u>>1)}function c(u,d,h){var p;switch(h===void 0&&(h=n.Y.SCALEMODE_NEAREST),h){case n.Y.SCALEMODE_FLOOR:p=l(u);break;case n.Y.SCALEMODE_NEAREST:p=a(u);break;case n.Y.SCALEMODE_CEILING:default:p=s(u)}return Math.min(p,d)}},44957:(r,t,e)=>{e.d(t,{LV:()=>T,S0:()=>E,s7:()=>C});var n=e(78322),i=e(66377),o=e(5153),a=e(7164),s=e(44576),l=e(85258),c=e(41190),u=e(46799),d=e(66614),h=e(17347),p=e(53695),m=e(252),v=e(23885),b=e(87074),E=function(){function f(){}return Object.defineProperty(f,"BaseUrl",{get:function(){return h.eC.BaseUrl},set:function(g){h.eC.BaseUrl=g},enumerable:!1,configurable:!0}),Object.defineProperty(f,"CleanUrl",{get:function(){return h.eC.CleanUrl},set:function(g){h.eC.CleanUrl=g},enumerable:!1,configurable:!0}),f.IsAbsoluteUrl=function(g){return g.indexOf("//")===0||g.indexOf("://")!==-1&&g.indexOf(".")!==-1&&g.indexOf("/")!==-1&&!(g.indexOf(":")>g.indexOf("/"))&&(g.indexOf("://")<g.indexOf(".")||g.indexOf("data:")===0||g.indexOf("blob:")===0)},Object.defineProperty(f,"ScriptBaseUrl",{get:function(){return h.eC.ScriptBaseUrl},set:function(g){h.eC.ScriptBaseUrl=g},enumerable:!1,configurable:!0}),Object.defineProperty(f,"ScriptPreprocessUrl",{get:function(){return h.eC.ScriptPreprocessUrl},set:function(g){h.eC.ScriptPreprocessUrl=g},enumerable:!1,configurable:!0}),Object.defineProperty(f,"DefaultRetryStrategy",{get:function(){return h.eC.DefaultRetryStrategy},set:function(g){h.eC.DefaultRetryStrategy=g},enumerable:!1,configurable:!0}),Object.defineProperty(f,"CorsBehavior",{get:function(){return h.eC.CorsBehavior},set:function(g){h.eC.CorsBehavior=g},enumerable:!1,configurable:!0}),Object.defineProperty(f,"UseFallbackTexture",{get:function(){return d.q.UseFallbackTexture},set:function(g){d.q.UseFallbackTexture=g},enumerable:!1,configurable:!0}),Object.defineProperty(f,"RegisteredExternalClasses",{get:function(){return m.n.RegisteredExternalClasses},set:function(g){m.n.RegisteredExternalClasses=g},enumerable:!1,configurable:!0}),Object.defineProperty(f,"fallbackTexture",{get:function(){return d.q.FallbackTexture},set:function(g){d.q.FallbackTexture=g},enumerable:!1,configurable:!0}),f.FetchToRef=function(g,S,y,x,R,I){var M=4*((Math.abs(g)*y%y|0)+(Math.abs(S)*x%x|0)*y);I.r=R[M]/255,I.g=R[M+1]/255,I.b=R[M+2]/255,I.a=R[M+3]/255},f.Mix=function(g,S,y){return 0},f.Instantiate=function(g){return m.n.Instantiate(g)},f.SetImmediate=function(g){p._.SetImmediate(g)},f.IsExponentOfTwo=function(g){return!0},f.FloatRound=function(g){return Math.fround(g)},f.GetFilename=function(g){var S=g.lastIndexOf("/");return S<0?g:g.substring(S+1)},f.GetFolderPath=function(g,S){S===void 0&&(S=!1);var y=g.lastIndexOf("/");return y<0?S?g:"":g.substring(0,y+1)},f.ToDegrees=function(g){return 180*g/Math.PI},f.ToRadians=function(g){return g*Math.PI/180},f.SmoothAngleChange=function(g,S,y){y===void 0&&(y=.9);var x=this.ToRadians(g),R=this.ToRadians(S);return this.ToDegrees(Math.atan2((1-y)*Math.sin(R)+y*Math.sin(x),(1-y)*Math.cos(R)+y*Math.cos(x)))},f.MakeArray=function(g,S){return S===!0||g!==void 0&&g!=null?Array.isArray(g)?g:[g]:null},f.GetPointerPrefix=function(g){var S="pointer";return(0,o.BA)()&&!window.PointerEvent&&(S="mouse"),!g._badDesktopOS||g._badOS||document&&"ontouchend"in document||(S="mouse"),S},f.SetCorsBehavior=function(g,S){(0,h.M1)(g,S)},f.SetReferrerPolicyBehavior=function(g,S){S.referrerPolicy=g},Object.defineProperty(f,"PreprocessUrl",{get:function(){return h.eC.PreprocessUrl},set:function(g){h.eC.PreprocessUrl=g},enumerable:!1,configurable:!0}),f.LoadImage=function(g,S,y,x,R,I){return(0,h.W$)(g,S,y,x,R,I)},f.LoadFile=function(g,S,y,x,R,I){return(0,h.zU)(g,S,y,x,R,I)},f.LoadFileAsync=function(g,S){return S===void 0&&(S=!0),new Promise(function(y,x){(0,h.zU)(g,function(R){y(R)},void 0,void 0,S,function(R,I){x(I)})})},f.GetBabylonScriptURL=function(g,S){if(!g)return"";if(f.ScriptBaseUrl&&g.startsWith(f._DefaultCdnUrl)){var y=f.ScriptBaseUrl[f.ScriptBaseUrl.length-1]==="/"?f.ScriptBaseUrl.substring(0,f.ScriptBaseUrl.length-1):f.ScriptBaseUrl;g=g.replace(f._DefaultCdnUrl,y)}return g=f.ScriptPreprocessUrl(g),S&&(g=f.GetAbsoluteUrl(g)),g},f.LoadBabylonScript=function(g,S,y,x){g=f.GetBabylonScriptURL(g),f.LoadScript(g,S,y)},f.LoadBabylonScriptAsync=function(g){return g=f.GetBabylonScriptURL(g),f.LoadScriptAsync(g)},f.LoadScript=function(g,S,y,x){if(typeof importScripts!="function")if((0,o.BA)()){var R=document.getElementsByTagName("head")[0],I=document.createElement("script");I.setAttribute("type","text/javascript"),I.setAttribute("src",g),x&&(I.id=x),I.onload=function(){S&&S()},I.onerror=function(M){y&&y("Unable to load script '".concat(g,"'"),M)},R.appendChild(I)}else y?.("Cannot load script '".concat(g,"' outside of a window or a worker"));else try{importScripts(g),S()}catch(M){y?.("Unable to load script '".concat(g,"' in worker"),M)}},f.LoadScriptAsync=function(g,S){var y=this;return new Promise(function(x,R){y.LoadScript(g,function(){x()},function(I,M){R(M||new Error(I))},S)})},f.ReadFileAsDataURL=function(g,S,y){var x=new FileReader,R={onCompleteObservable:new i.cP,abort:function(){return x.abort()}};return x.onloadend=function(){R.onCompleteObservable.notifyObservers(R)},x.onload=function(I){S(I.target.result)},x.onprogress=y,x.readAsDataURL(g),R},f.ReadFile=function(g,S,y,x,R){return(0,h.NJ)(g,S,y,x,R)},f.FileAsURL=function(g){var S=new Blob([g]);return window.URL.createObjectURL(S)},f.Format=function(g,S){return S===void 0&&(S=2),g.toFixed(S)},f.DeepCopy=function(g,S,y,x){s.r.DeepCopy(g,S,y,x)},f.IsEmpty=function(g){for(var S in g)if(Object.prototype.hasOwnProperty.call(g,S))return!1;return!0},f.RegisterTopRootEvents=function(g,S){for(var y=0;y<S.length;y++){var x=S[y];g.addEventListener(x.name,x.handler,!1);try{window.parent&&window.parent.addEventListener(x.name,x.handler,!1)}catch{}}},f.UnregisterTopRootEvents=function(g,S){for(var y=0;y<S.length;y++){var x=S[y];g.removeEventListener(x.name,x.handler);try{g.parent&&g.parent.removeEventListener(x.name,x.handler)}catch{}}},f.DumpFramebuffer=function(g,S,y,x,R,I,M){return(0,n.sH)(this,void 0,void 0,function(){return(0,n.YH)(this,function(D){throw(0,c.n)("DumpTools")})})},f.DumpData=function(g,S,y,x,R,I,M,D,B){throw(0,c.n)("DumpTools")},f.DumpDataAsync=function(g,S,y,x,R,I,M,D){throw(0,c.n)("DumpTools")},f._IsOffScreenCanvas=function(g){return g.convertToBlob!==void 0},f.ToBlob=function(g,S,y,x){y===void 0&&(y="image/png"),f._IsOffScreenCanvas(g)||g.toBlob||(g.toBlob=function(R,I,M){var D=this;setTimeout(function(){for(var B=atob(D.toDataURL(I,M).split(",")[1]),F=B.length,X=new Uint8Array(F),$=0;$<F;$++)X[$]=B.charCodeAt($);R(new Blob([X]))})}),f._IsOffScreenCanvas(g)?g.convertToBlob({type:y,quality:x}).then(function(R){return S(R)}):g.toBlob(function(R){S(R)},y,x)},f.DownloadBlob=function(g,S){if("download"in document.createElement("a")){if(!S){var y=new Date;S="screenshot_"+(y.getFullYear()+"-"+(y.getMonth()+1)).slice(2)+"-"+y.getDate()+"_"+y.getHours()+"-"+("0"+y.getMinutes()).slice(-2)+".png"}f.Download(g,S)}else if(g&&typeof URL<"u"){var x=URL.createObjectURL(g),R=window.open("");if(!R)return;var I=R.document.createElement("img");I.onload=function(){URL.revokeObjectURL(x)},I.src=x,R.document.body.appendChild(I)}},f.EncodeScreenshotCanvasData=function(g,S,y,x,R){if(y===void 0&&(y="image/png"),typeof x!="string"&&S){if(S){if(f._IsOffScreenCanvas(g))return void g.convertToBlob({type:y,quality:R}).then(function(M){var D=new FileReader;D.readAsDataURL(M),D.onloadend=function(){var B=D.result;S(B)}});var I=g.toDataURL(y,R);S(I)}}else this.ToBlob(g,function(M){M&&f.DownloadBlob(M,x),S&&S("")},y,R)},f.Download=function(g,S){if(typeof URL<"u"){var y=window.URL.createObjectURL(g),x=document.createElement("a");document.body.appendChild(x),x.style.display="none",x.href=y,x.download=S,x.addEventListener("click",function(){x.parentElement&&x.parentElement.removeChild(x)}),x.click(),window.URL.revokeObjectURL(y)}},f.BackCompatCameraNoPreventDefault=function(g){return typeof g[0]=="boolean"?g[0]:typeof g[1]=="boolean"&&g[1]},f.CreateScreenshot=function(g,S,y,x,R,I,M){throw(0,c.n)("ScreenshotTools")},f.CreateScreenshotAsync=function(g,S,y,x,R){throw(0,c.n)("ScreenshotTools")},f.CreateScreenshotUsingRenderTarget=function(g,S,y,x,R,I,M,D,B,F,X,$,Q){throw(0,c.n)("ScreenshotTools")},f.CreateScreenshotUsingRenderTargetAsync=function(g,S,y,x,R,I,M,D,B,F,X,$){throw(0,c.n)("ScreenshotTools")},f.RandomId=function(){return(0,v.z)()},f.IsBase64=function(g){return(0,h.f2)(g)},f.DecodeBase64=function(g){return(0,h.rz)(g)},Object.defineProperty(f,"errorsCount",{get:function(){return a.V.errorsCount},enumerable:!1,configurable:!0}),f.Log=function(g){a.V.Log(g)},f.Warn=function(g){a.V.Warn(g)},f.Error=function(g){a.V.Error(g)},Object.defineProperty(f,"LogCache",{get:function(){return a.V.LogCache},enumerable:!1,configurable:!0}),f.ClearLogCache=function(){a.V.ClearLogCache()},Object.defineProperty(f,"LogLevels",{set:function(g){a.V.LogLevels=g},enumerable:!1,configurable:!0}),Object.defineProperty(f,"PerformanceLogLevel",{set:function(g){return(g&f.PerformanceUserMarkLogLevel)===f.PerformanceUserMarkLogLevel?(f.StartPerformanceCounter=f._StartUserMark,void(f.EndPerformanceCounter=f._EndUserMark)):(g&f.PerformanceConsoleLogLevel)===f.PerformanceConsoleLogLevel?(f.StartPerformanceCounter=f._StartPerformanceConsole,void(f.EndPerformanceCounter=f._EndPerformanceConsole)):(f.StartPerformanceCounter=f._StartPerformanceCounterDisabled,void(f.EndPerformanceCounter=f._EndPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),f._StartPerformanceCounterDisabled=function(g,S){},f._EndPerformanceCounterDisabled=function(g,S){},f._StartUserMark=function(g,S){if(S===void 0&&(S=!0),!f._Performance){if(!(0,o.BA)())return;f._Performance=window.performance}S&&f._Performance.mark&&f._Performance.mark(g+"-Begin")},f._EndUserMark=function(g,S){S===void 0&&(S=!0),S&&f._Performance.mark&&(f._Performance.mark(g+"-End"),f._Performance.measure(g,g+"-Begin",g+"-End"))},f._StartPerformanceConsole=function(g,S){S===void 0&&(S=!0),S&&(f._StartUserMark(g,S),console.time&&console.time(g))},f._EndPerformanceConsole=function(g,S){S===void 0&&(S=!0),S&&(f._EndUserMark(g,S),console.timeEnd(g))},Object.defineProperty(f,"Now",{get:function(){return l.j.Now},enumerable:!1,configurable:!0}),f.GetClassName=function(g,S){S===void 0&&(S=!1);var y=null;return!S&&g.getClassName?y=g.getClassName():(g instanceof Object&&(y=(S?g:Object.getPrototypeOf(g)).constructor.__bjsclassName__),y||(y=typeof g)),y},f.First=function(g,S){for(var y=0,x=g;y<x.length;y++){var R=x[y];if(S(R))return R}return null},f.getFullClassName=function(g,S){S===void 0&&(S=!1);var y=null,x=null;if(!S&&g.getClassName)y=g.getClassName();else{if(g instanceof Object){var R=S?g:Object.getPrototypeOf(g);y=R.constructor.__bjsclassName__,x=R.constructor.__bjsmoduleName__}y||(y=typeof g)}return y?(x!=null?x+".":"")+y:null},f.DelayAsync=function(g){return new Promise(function(S){setTimeout(function(){S()},g)})},f.IsSafari=function(){return!!(0,o.XD)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},f.UseCustomRequestHeaders=!1,f.CustomRequestHeaders=u.u.CustomRequestHeaders,f.GetDOMTextContent=o.Zl,f._DefaultCdnUrl="https://cdn.babylonjs.com",f.GetAbsoluteUrl=typeof document=="object"?function(g){var S=document.createElement("a");return S.href=g,S.href}:typeof URL=="function"&&typeof location=="object"?function(g){return new URL(g,location.origin).href}:function(){throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},f.NoneLogLevel=a.V.NoneLogLevel,f.MessageLogLevel=a.V.MessageLogLevel,f.WarningLogLevel=a.V.WarningLogLevel,f.ErrorLogLevel=a.V.ErrorLogLevel,f.AllLogLevel=a.V.AllLogLevel,f.IsWindowObjectExist=o.BA,f.PerformanceNoneLogLevel=0,f.PerformanceUserMarkLogLevel=1,f.PerformanceConsoleLogLevel=2,f.StartPerformanceCounter=f._StartPerformanceCounterDisabled,f.EndPerformanceCounter=f._EndPerformanceCounterDisabled,f}();function C(f,g){return function(S){S.__bjsclassName__=f,S.__bjsmoduleName__=g??null}}var T=function(){function f(g,S,y,x){x===void 0&&(x=0),this.iterations=g,this.index=x-1,this._done=!1,this._fn=S,this._successCallback=y}return f.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},f.prototype.breakLoop=function(){this._done=!0,this._successCallback()},f.Run=function(g,S,y,x){x===void 0&&(x=0);var R=new f(g,S,y,x);return R.executeNext(),R},f.SyncAsyncForLoop=function(g,S,y,x,R,I){return I===void 0&&(I=0),f.Run(Math.ceil(g/S),function(M){R&&R()?M.breakLoop():setTimeout(function(){for(var D=0;D<S;++D){var B=M.index*S+D;if(B>=g)break;if(y(B),R&&R()){M.breakLoop();break}}M.executeNext()},I)},x)},f}();E.Mix=b.zF,E.IsExponentOfTwo=b.L8,d.q.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},34623:(r,t,e)=>{e.d(t,{Uu:()=>a,Y5:()=>i,n9:()=>o});var n={};function i(s,l){n[s]=l}function o(s){return n[s]}function a(s){for(var l in n)if(s instanceof n[l]&&!l.includes("Abstract"))return l;return"Unknown"}},62273:(r,t,e)=>{e.d(t,{K:()=>n});var n=function(){function i(){}return Object.defineProperty(i,"UniqueId",{get:function(){var o=this._UniqueIdCounter;return this._UniqueIdCounter++,o},enumerable:!1,configurable:!0}),i._UniqueIdCounter=1,i}()},46799:(r,t,e)=>{e.d(t,{u:()=>n});var n=function(){function i(){this._xhr=typeof _native<"u"&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}return Object.defineProperty(i,"IsCustomRequestAvailable",{get:function(){return Object.keys(i.CustomRequestHeaders).length>0||i.CustomRequestModifiers.length>0},enumerable:!1,configurable:!0}),i.prototype._injectCustomRequestHeaders=function(){if(!this._shouldSkipRequestModifications(this._requestURL))for(var o in i.CustomRequestHeaders){var a=i.CustomRequestHeaders[o];a&&this._xhr.setRequestHeader(o,a)}},i.prototype._shouldSkipRequestModifications=function(o){return i.SkipRequestModificationForBabylonCDN&&(o.includes("preview.babylonjs.com")||o.includes("cdn.babylonjs.com"))},Object.defineProperty(i.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(o){this._xhr.onprogress=o},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(o){this._xhr.responseType=o},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"timeout",{get:function(){return this._xhr.timeout},set:function(o){this._xhr.timeout=o},enumerable:!1,configurable:!0}),i.prototype.addEventListener=function(o,a,s){this._xhr.addEventListener(o,a,s)},i.prototype.removeEventListener=function(o,a,s){this._xhr.removeEventListener(o,a,s)},i.prototype.abort=function(){this._xhr.abort()},i.prototype.send=function(o){i.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(o)},i.prototype.open=function(o,a){for(var s=0,l=i.CustomRequestModifiers;s<l.length;s++){var c=l[s];if(this._shouldSkipRequestModifications(a))return;c(this._xhr,a)}a=(a=a.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=a,this._xhr.open(o,a,!0)},i.prototype.setRequestHeader=function(o,a){this._xhr.setRequestHeader(o,a)},i.prototype.getResponseHeader=function(o){return this._xhr.getResponseHeader(o)},i.CustomRequestHeaders={},i.CustomRequestModifiers=new Array,i.SkipRequestModificationForBabylonCDN=!0,i}()},80244:(r,t,e)=>{e.d(t,{T:()=>i,h:()=>o});var n=e(78322),i=function(){function a(s){this._pendingActions=new Array,this._workerInfos=s.map(function(l){return{workerPromise:Promise.resolve(l),idle:!0}})}return a.prototype.dispose=function(){for(var s=0,l=this._workerInfos;s<l.length;s++)l[s].workerPromise.then(function(c){c.terminate()});this._workerInfos.length=0,this._pendingActions.length=0},a.prototype.push=function(s){this._executeOnIdleWorker(s)||this._pendingActions.push(s)},a.prototype._executeOnIdleWorker=function(s){for(var l=0,c=this._workerInfos;l<c.length;l++){var u=c[l];if(u.idle)return this._execute(u,s),!0}return!1},a.prototype._execute=function(s,l){var c=this;s.idle=!1,s.workerPromise.then(function(u){l(u,function(){var d=c._pendingActions.shift();d?c._execute(s,d):s.idle=!0})})},a}(),o=function(a){function s(l,c,u){u===void 0&&(u=s.DefaultOptions);var d=a.call(this,[])||this;return d._maxWorkers=l,d._createWorkerAsync=c,d._options=u,d}return(0,n.C6)(s,a),s.prototype.push=function(l){if(!this._executeOnIdleWorker(l))if(this._workerInfos.length<this._maxWorkers){var c={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(c),this._execute(c,l)}else this._pendingActions.push(l)},s.prototype._execute=function(l,c){var u=this;l.timeoutId&&(clearTimeout(l.timeoutId),delete l.timeoutId),a.prototype._execute.call(this,l,function(d,h){c(d,function(){h(),l.idle&&(l.timeoutId=setTimeout(function(){l.workerPromise.then(function(m){m.terminate()});var p=u._workerInfos.indexOf(l);p!==-1&&u._workerInfos.splice(p,1)},u._options.idleTimeElapsedBeforeRelease))})})},s.DefaultOptions={idleTimeElapsedBeforeRelease:1e3},s}(i)},73441:(r,t,e)=>{e.d(t,{s:()=>u,v:()=>c});var n=e(78322),i=e(81152),o=e(30622),a=e(82673),s=e(34623),l=e(12028),c=function(d){function h(p,m,v,b,E,C,T,f){return v===void 0&&(v=null),T===void 0&&(T=i.Y.TEXTURETYPE_UNSIGNED_INT),f===void 0&&(f=!1),d.call(this,p,"pass",null,null,m,v,b,E,C,void 0,T,void 0,null,f)||this}return(0,n.C6)(h,d),h.prototype.getClassName=function(){return"PassPostProcess"},h.prototype._gatherImports=function(p,m){p?(this._webGPUReady=!0,m.push(Promise.all([Promise.resolve().then(e.bind(e,59448))]))):m.push(Promise.all([Promise.resolve().then(e.bind(e,56017))])),d.prototype._gatherImports.call(this,p,m)},h._Parse=function(p,m,v,b){return l.p.Parse(function(){return new h(p.name,p.options,m,p.renderTargetSamplingMode,p._engine,p.reusable)},p,v,b)},h}(o.w);(0,s.Y5)("BABYLON.PassPostProcess",c);var u=function(d){function h(p,m,v,b,E,C,T,f){v===void 0&&(v=null),T===void 0&&(T=i.Y.TEXTURETYPE_UNSIGNED_INT),f===void 0&&(f=!1);var g=d.call(this,p,"passCube",null,null,m,v,b,E,C,"#define POSITIVEX",T,void 0,null,f)||this;return g._face=0,g}return(0,n.C6)(h,d),Object.defineProperty(h.prototype,"face",{get:function(){return this._face},set:function(p){if(!(p<0||p>5))switch(this._face=p,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!1,configurable:!0}),h.prototype.getClassName=function(){return"PassCubePostProcess"},h.prototype._gatherImports=function(p,m){p?(this._webGPUReady=!0,m.push(Promise.all([Promise.resolve().then(e.bind(e,33739))]))):m.push(Promise.all([Promise.resolve().then(e.bind(e,25750))])),d.prototype._gatherImports.call(this,p,m)},h._Parse=function(p,m,v,b){return l.p.Parse(function(){return new h(p.name,p.options,m,p.renderTargetSamplingMode,p._engine,p.reusable)},p,v,b)},h}(o.w);a.$._RescalePostProcessFactory=function(d){return new c("rescale",1,null,i.Y.TEXTURE_BILINEAR_SAMPLINGMODE,d,!1,i.Y.TEXTURETYPE_UNSIGNED_INT)}},30622:(r,t,e)=>{e.d(t,{w:()=>v});var n=e(78322),i=e(53770),o=e(66377),a=e(8046),s=e(74239),l=e(81152),c=(e(96795),e(71073),e(6174)),u=e(12028),d=e(34623),h=e(14777),p=e(82673),m=e(87074);p.$.prototype.setTextureFromPostProcess=function(b,E,C){var T,f=null;E&&(E._forcedOutputTexture?f=E._forcedOutputTexture:E._textures.data[E._currentRenderTextureInd]&&(f=E._textures.data[E._currentRenderTextureInd])),this._bindTexture(b,(T=f?.texture)!==null&&T!==void 0?T:null,C)},p.$.prototype.setTextureFromPostProcessOutput=function(b,E,C){var T,f;this._bindTexture(b,(f=(T=E?._outputTexture)===null||T===void 0?void 0:T.texture)!==null&&f!==void 0?f:null,C)},s.M.prototype.setTextureFromPostProcess=function(b,E){this._engine.setTextureFromPostProcess(this._samplers[b],E,b)},s.M.prototype.setTextureFromPostProcessOutput=function(b,E){this._engine.setTextureFromPostProcessOutput(this._samplers[b],E,b)};var v=function(){function b(E,C,T,f,g,S,y,x,R,I,M,D,B,F,X,$,Q){var ie,q,ee,te,ce,fe,de,Te,ue,U,N,w;y===void 0&&(y=l.Y.TEXTURE_NEAREST_SAMPLINGMODE),I===void 0&&(I=null),M===void 0&&(M=l.Y.TEXTURETYPE_UNSIGNED_INT),D===void 0&&(D="postprocess"),F===void 0&&(F=!1),X===void 0&&(X=l.Y.TEXTUREFORMAT_RGBA),this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.forceAutoClearInAlphaMode=!1,this.alphaMode=l.Y.ALPHA_DISABLE,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=l.Y.SCALEMODE_FLOOR,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._shadersLoaded=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new i.L(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new a.I9(1,1),this._texelSize=a.I9.Zero(),this.onEffectCreatedObservable=new o.cP(void 0,!0),this.onActivateObservable=new o.cP,this.onSizeChangedObservable=new o.cP,this.onApplyObservable=new o.cP,this.onBeforeRenderObservable=new o.cP,this.onAfterRenderObservable=new o.cP,this._importPromises=[],this.name=E;var k=1,J=null;if(T&&!Array.isArray(T)){var le=T;T=(ie=le.uniforms)!==null&&ie!==void 0?ie:null,f=(q=le.samplers)!==null&&q!==void 0?q:null,k=(ee=le.size)!==null&&ee!==void 0?ee:1,S=(te=le.camera)!==null&&te!==void 0?te:null,y=(ce=le.samplingMode)!==null&&ce!==void 0?ce:l.Y.TEXTURE_NEAREST_SAMPLINGMODE,x=le.engine,R=le.reusable,I=(fe=le.defines)!==null&&fe!==void 0?fe:null,M=(de=le.textureType)!==null&&de!==void 0?de:l.Y.TEXTURETYPE_UNSIGNED_INT,D=(Te=le.vertexUrl)!==null&&Te!==void 0?Te:"postprocess",B=le.indexParameters,F=(ue=le.blockCompilation)!==null&&ue!==void 0&&ue,X=(U=le.textureFormat)!==null&&U!==void 0?U:l.Y.TEXTUREFORMAT_RGBA,$=(N=le.shaderLanguage)!==null&&N!==void 0?N:0,J=(w=le.uniformBuffers)!==null&&w!==void 0?w:null,Q=le.extraInitializations}else g&&(k=typeof g=="number"?g:{width:g.width,height:g.height});S!=null?(this._camera=S,this._scene=S.getScene(),S.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):x&&(this._engine=x,this._engine.postProcesses.push(this)),this._options=k,this.renderTargetSamplingMode=y||l.Y.TEXTURE_NEAREST_SAMPLINGMODE,this._reusable=R||!1,this._textureType=M,this._textureFormat=X,this._shaderLanguage=$||0,this._samplers=f||[],this._samplers.push("textureSampler"),this._fragmentUrl=C,this._vertexUrl=D,this._parameters=T||[],this._parameters.push("scale"),this._uniformBuffers=J||[],this._indexParameters=B,this._drawWrapper=new h.E(this._engine),this._webGPUReady=this._shaderLanguage===1,this._postConstructor(F,I,Q)}return b.RegisterShaderCodeProcessing=function(E,C){C?b._CustomShaderCodeProcessing[E??""]=C:delete b._CustomShaderCodeProcessing[E??""]},b._GetShaderCodeProcessing=function(E){var C;return(C=b._CustomShaderCodeProcessing[E])!==null&&C!==void 0?C:b._CustomShaderCodeProcessing[""]},Object.defineProperty(b.prototype,"samples",{get:function(){return this._samples},set:function(E){var C=this;this._samples=Math.min(E,this._engine.getCaps().maxMSAASamples),this._textures.forEach(function(T){T.setSamples(C._samples)})},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"shaderLanguage",{get:function(){return this._shaderLanguage},enumerable:!1,configurable:!0}),b.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(b.prototype,"onActivate",{set:function(E){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),E&&(this._onActivateObserver=this.onActivateObservable.add(E))},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onSizeChanged",{set:function(E){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(E)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onApply",{set:function(E){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(E)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onBeforeRender",{set:function(E){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(E)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"onAfterRender",{set:function(E){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(E)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(E){this._forcedOutputTexture=E},enumerable:!1,configurable:!0}),b.prototype.restoreDefaultInputTexture=function(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())},b.prototype.getCamera=function(){return this._camera},Object.defineProperty(b.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!1,configurable:!0}),b.prototype._gatherImports=function(E,C){E===void 0&&(E=!1),E&&this._webGPUReady?C.push(Promise.all([Promise.resolve().then(e.bind(e,3072))])):C.push(Promise.all([Promise.resolve().then(e.bind(e,96795))]))},b.prototype._postConstructor=function(E,C,T){C===void 0&&(C=null);var f=this.getEngine().isWebGPU&&!b.ForceGLSL;this._gatherImports(f,this._importPromises),T&&T(f,this._importPromises),f&&this._webGPUReady&&(this._shaderLanguage=1),E||this.updateEffect(C)},b.prototype.getClassName=function(){return"PostProcess"},b.prototype.getEngine=function(){return this._engine},b.prototype.getEffect=function(){return this._drawWrapper.effect},b.prototype.shareOutputWith=function(E){return this._disposeTextures(),this._shareOutputWithPostProcess=E,this},b.prototype.useOwnOutput=function(){this._textures.length==0&&(this._textures=new i.L(2)),this._shareOutputWithPostProcess=null},b.prototype.updateEffect=function(E,C,T,f,g,S,y,x){var R,I,M=this;E===void 0&&(E=null),C===void 0&&(C=null),T===void 0&&(T=null);var D=b._GetShaderCodeProcessing(this.name);if(D?.defineCustomBindings){var B=(R=C?.slice())!==null&&R!==void 0?R:[];B.push.apply(B,this._parameters);var F=(I=T?.slice())!==null&&I!==void 0?I:[];F.push.apply(F,this._samplers),E=D.defineCustomBindings(this.name,E,B,F),C=B,T=F}this._postProcessDefines=E,this._drawWrapper.effect=this._engine.createEffect({vertex:y??this._vertexUrl,fragment:x??this._fragmentUrl},{attributes:["position"],uniformsNames:C||this._parameters,uniformBuffersNames:this._uniformBuffers,samplers:T||this._samplers,defines:E!==null?E:"",fallbacks:null,onCompiled:g??null,onError:S??null,indexParameters:f||this._indexParameters,processCodeAfterIncludes:D?.processCodeAfterIncludes?function(X,$){return D.processCodeAfterIncludes(M.name,X,$)}:null,processFinalCode:D?.processFinalCode?function(X,$){return D.processFinalCode(M.name,X,$)}:null,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:function(){return(0,n.sH)(M,void 0,void 0,function(){return(0,n.YH)(this,function(X){switch(X.label){case 0:return[4,Promise.all(this._importPromises)];case 1:return X.sent(),this._shadersLoaded=!0,[2]}})})}},this._engine),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)},b.prototype.isReusable=function(){return this._reusable},b.prototype.markTextureDirty=function(){this.width=-1},b.prototype._createRenderTargetTexture=function(E,C,T){T===void 0&&(T=0);for(var f=0;f<this._textureCache.length;f++)if(this._textureCache[f].texture.width===E.width&&this._textureCache[f].texture.height===E.height&&this._textureCache[f].postProcessChannel===T&&this._textureCache[f].texture._generateDepthBuffer===C.generateDepthBuffer&&this._textureCache[f].texture.samples===C.samples)return this._textureCache[f].texture;var g=this._engine.createRenderTargetTexture(E,C);return this._textureCache.push({texture:g,postProcessChannel:T,lastUsedRenderId:-1}),g},b.prototype._flushTextureCache=function(){for(var E=this._renderId,C=this._textureCache.length-1;C>=0;C--)if(E-this._textureCache[C].lastUsedRenderId>100){for(var T=!1,f=0;f<this._textures.length;f++)if(this._textures.data[f]===this._textureCache[C].texture){T=!0;break}T||(this._textureCache[C].texture.dispose(),this._textureCache.splice(C,1))}},b.prototype.resize=function(E,C,T,f,g){T===void 0&&(T=null),f===void 0&&(f=!1),g===void 0&&(g=!1),this._textures.length>0&&this._textures.reset(),this.width=E,this.height=C;var S=null;if(T){for(var y=0;y<T._postProcesses.length;y++)if(T._postProcesses[y]!==null){S=T._postProcesses[y];break}}var x={width:this.width,height:this.height},R={generateMipMaps:f,generateDepthBuffer:g||S===this,generateStencilBuffer:(g||S===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(x,R,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(x,R,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)},b.prototype._getTarget=function(){var E;if(this._shareOutputWithPostProcess)E=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)E=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{E=this.inputTexture;for(var C=void 0,T=0;T<this._textureCache.length;T++)if(this._textureCache[T].texture===E){C=this._textureCache[T];break}C&&(C.lastUsedRenderId=this._renderId)}return E},b.prototype.activate=function(E,C,T){var f,g,S=this;C===void 0&&(C=null);var y=(E=E||this._camera).getScene(),x=y.getEngine(),R=x.getCaps().maxTextureSize,I=(C?C.width:this._engine.getRenderWidth(!0))*this._options|0,M=(C?C.height:this._engine.getRenderHeight(!0))*this._options|0,D=this._options.width||I,B=this._options.height||M,F=this.renderTargetSamplingMode!==l.Y.TEXTURE_NEAREST_LINEAR&&this.renderTargetSamplingMode!==l.Y.TEXTURE_NEAREST_NEAREST&&this.renderTargetSamplingMode!==l.Y.TEXTURE_LINEAR_LINEAR,X=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var $=x.currentViewport;$&&(D*=$.width,B*=$.height)}(F||this.alwaysForcePOT)&&(this._options.width||(D=x.needPOTTextures?(0,m.R)(D,R,this.scaleMode):D),this._options.height||(B=x.needPOTTextures?(0,m.R)(B,R,this.scaleMode):B)),this.width===D&&this.height===B&&(X=this._getTarget())||this.resize(D,B,E,F,T),this._textures.forEach(function(Q){Q.samples!==S.samples&&S._engine.updateRenderTargetTextureSampleCount(Q,S.samples)}),this._flushTextureCache(),this._renderId++}return X||(X=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(I/D,M/B),this._engine.bindFramebuffer(X,0,I,M,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(X,0,void 0,void 0,this.forceFullscreenViewport)),(g=(f=this._engine)._debugInsertMarker)===null||g===void 0||g.call(f,"post process ".concat(this.name," input")),this.onActivateObservable.notifyObservers(E),this.autoClear&&(this.alphaMode===l.Y.ALPHA_DISABLE||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:y.clearColor,y._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),X},Object.defineProperty(b.prototype,"isSupported",{get:function(){return this._drawWrapper.effect.isSupported},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!1,configurable:!0}),b.prototype.isReady=function(){var E,C;return(C=(E=this._drawWrapper.effect)===null||E===void 0?void 0:E.isReady())!==null&&C!==void 0&&C},b.prototype.apply=function(){var E,C,T,f;return!((E=this._drawWrapper.effect)===null||E===void 0)&&E.isReady()?(this._engine.enableEffect(this._drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),f=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding||this._drawWrapper.effect._bindTexture("textureSampler",f?.texture),this._drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._drawWrapper.effect),(T=(C=b._GetShaderCodeProcessing(this.name))===null||C===void 0?void 0:C.bindCustomBindings)===null||T===void 0||T.call(C,this.name,this._drawWrapper.effect),this._drawWrapper.effect):null},b.prototype._disposeTextures=function(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())},b.prototype._disposeTextureCache=function(){for(var E=this._textureCache.length-1;E>=0;E--)this._textureCache[E].texture.dispose();this._textureCache.length=0},b.prototype.setPrePassRenderer=function(E){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=E.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)},b.prototype.dispose=function(E){var C;if(E=E||this._camera,this._disposeTextures(),this._scene&&(C=this._scene.postProcesses.indexOf(this))!==-1&&this._scene.postProcesses.splice(C,1),this._parentContainer){var T=this._parentContainer.postProcesses.indexOf(this);T>-1&&this._parentContainer.postProcesses.splice(T,1),this._parentContainer=null}if((C=this._engine.postProcesses.indexOf(this))!==-1&&this._engine.postProcesses.splice(C,1),E){if(E.detachPostProcess(this),(C=E._postProcesses.indexOf(this))===0&&E._postProcesses.length>0){var f=this._camera._getFirstPostProcess();f&&f.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}},b.prototype.serialize=function(){var E=u.p.Serialize(this),C=this.getCamera()||this._scene&&this._scene.activeCamera;return E.customType="BABYLON."+this.getClassName(),E.cameraId=C?C.id:null,E.reusable=this._reusable,E.textureType=this._textureType,E.fragmentUrl=this._fragmentUrl,E.parameters=this._parameters,E.samplers=this._samplers,E.options=this._options,E.defines=this._postProcessDefines,E.textureFormat=this._textureFormat,E.vertexUrl=this._vertexUrl,E.indexParameters=this._indexParameters,E},b.prototype.clone=function(){var E=this.serialize();E._engine=this._engine,E.cameraId=null;var C=b.Parse(E,this._scene,"");return C?(C.onActivateObservable=this.onActivateObservable.clone(),C.onSizeChangedObservable=this.onSizeChangedObservable.clone(),C.onApplyObservable=this.onApplyObservable.clone(),C.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),C.onAfterRenderObservable=this.onAfterRenderObservable.clone(),C._prePassEffectConfiguration=this._prePassEffectConfiguration,C):null},b.Parse=function(E,C,T){var f=(0,d.n9)(E.customType);if(!f||!f._Parse)return null;var g=C?C.getCameraById(E.cameraId):null;return f._Parse(E,g,C,T)},b._Parse=function(E,C,T,f){return u.p.Parse(function(){return new b(E.name,E.fragmentUrl,E.parameters,E.samplers,E.options,C,E.renderTargetSamplingMode,E._engine,E.reusable,E.defines,E.textureType,E.vertexUrl,E.indexParameters,!1,E.textureFormat)},E,T,f)},b.ForceGLSL=!1,b._CustomShaderCodeProcessing={},(0,n.Cg)([(0,c.lK)()],b.prototype,"uniqueId",void 0),(0,n.Cg)([(0,c.lK)()],b.prototype,"name",void 0),(0,n.Cg)([(0,c.lK)()],b.prototype,"width",void 0),(0,n.Cg)([(0,c.lK)()],b.prototype,"height",void 0),(0,n.Cg)([(0,c.lK)()],b.prototype,"renderTargetSamplingMode",void 0),(0,n.Cg)([(0,c.qK)()],b.prototype,"clearColor",void 0),(0,n.Cg)([(0,c.lK)()],b.prototype,"autoClear",void 0),(0,n.Cg)([(0,c.lK)()],b.prototype,"forceAutoClearInAlphaMode",void 0),(0,n.Cg)([(0,c.lK)()],b.prototype,"alphaMode",void 0),(0,n.Cg)([(0,c.lK)()],b.prototype,"alphaConstants",void 0),(0,n.Cg)([(0,c.lK)()],b.prototype,"enablePixelPerfectMode",void 0),(0,n.Cg)([(0,c.lK)()],b.prototype,"forceFullscreenViewport",void 0),(0,n.Cg)([(0,c.lK)()],b.prototype,"scaleMode",void 0),(0,n.Cg)([(0,c.lK)()],b.prototype,"alwaysForcePOT",void 0),(0,n.Cg)([(0,c.lK)("samples")],b.prototype,"_samples",void 0),(0,n.Cg)([(0,c.lK)()],b.prototype,"adaptScaleToCurrentViewport",void 0),b}();(0,d.Y5)("BABYLON.PostProcess",v)},63639:(r,t,e)=>{e.d(t,{X:()=>a});var n=e(62623),i=e(81152),o=e(66377),a=function(){function s(l){this._vertexBuffers={},this.onBeforeRenderObservable=new o.cP,this._scene=l}return s.prototype._prepareBuffers=function(){if(!this._vertexBuffers[n.R.PositionKind]){var l=[];l.push(1,1),l.push(-1,1),l.push(-1,-1),l.push(1,-1),this._vertexBuffers[n.R.PositionKind]=new n.R(this._scene.getEngine(),l,n.R.PositionKind,!1,!1,2),this._buildIndexBuffer()}},s.prototype._buildIndexBuffer=function(){var l=[];l.push(0),l.push(1),l.push(2),l.push(0),l.push(2),l.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(l)},s.prototype._rebuild=function(){var l=this._vertexBuffers[n.R.PositionKind];l&&(l._rebuild(),this._buildIndexBuffer())},s.prototype._prepareFrame=function(l,c){l===void 0&&(l=null),c===void 0&&(c=null);var u=this._scene.activeCamera;return!(!u||!(c=c||u._postProcesses.filter(function(d){return d!=null}))||c.length===0||!this._scene.postProcessesEnabled||(c[0].activate(u,l,c!=null),0))},s.prototype.directRender=function(l,c,u,d,h,p){var m;c===void 0&&(c=null),u===void 0&&(u=!1),d===void 0&&(d=0),h===void 0&&(h=0),p===void 0&&(p=!1);for(var v=this._scene.getEngine(),b=0;b<l.length;b++){b<l.length-1?l[b+1].activate(this._scene.activeCamera,c?.texture):(c?v.bindFramebuffer(c,d,void 0,void 0,u,h):p||v.restoreDefaultFramebuffer(),(m=v._debugInsertMarker)===null||m===void 0||m.call(v,"post process ".concat(l[b].name," output")));var E=l[b],C=E.apply();C&&(E.onBeforeRenderObservable.notifyObservers(C),this._prepareBuffers(),v.bindBuffers(this._vertexBuffers,this._indexBuffer,C),v.drawElementsType(i.Y.MATERIAL_TriangleFillMode,0,6),E.onAfterRenderObservable.notifyObservers(C))}v.setDepthBuffer(!0),v.setDepthWrite(!0)},s.prototype._finalizeFrame=function(l,c,u,d,h){var p;h===void 0&&(h=!1);var m=this._scene.activeCamera;if(m&&(this.onBeforeRenderObservable.notifyObservers(this),d=d||m._postProcesses.filter(function(f){return f!=null}),d.length!==0&&this._scene.postProcessesEnabled)){for(var v=this._scene.getEngine(),b=0,E=d.length;b<E;b++){var C=d[b];if(b<E-1?C._outputTexture=d[b+1].activate(m,c?.texture):(c?(v.bindFramebuffer(c,u,void 0,void 0,h),C._outputTexture=c):(v.restoreDefaultFramebuffer(),C._outputTexture=null),(p=v._debugInsertMarker)===null||p===void 0||p.call(v,"post process ".concat(d[b].name," output"))),l)break;var T=C.apply();T&&(C.onBeforeRenderObservable.notifyObservers(T),this._prepareBuffers(),v.bindBuffers(this._vertexBuffers,this._indexBuffer,T),v.drawElementsType(i.Y.MATERIAL_TriangleFillMode,0,6),C.onAfterRenderObservable.notifyObservers(T))}v.setDepthBuffer(!0),v.setDepthWrite(!0),v.setAlphaMode(i.Y.ALPHA_DISABLE)}},s.prototype.dispose=function(){var l=this._vertexBuffers[n.R.PositionKind];l&&(l.dispose(),this._vertexBuffers[n.R.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},s}()},85043:(r,t,e)=>{e.d(t,{U:()=>a});var n=e(53770),i=e(8046),o=e(81152),a=function(){function s(l,c,u,d,h){u===void 0&&(u=null),d===void 0&&(d=null),h===void 0&&(h=null),this.index=l,this._opaqueSubMeshes=new n.L(256),this._transparentSubMeshes=new n.L(256),this._alphaTestSubMeshes=new n.L(256),this._depthOnlySubMeshes=new n.L(256),this._particleSystems=new n.L(256),this._spriteManagers=new n.L(256),this._empty=!0,this._edgesRenderers=new n.b(16),this._scene=c,this.opaqueSortCompareFn=u,this.alphaTestSortCompareFn=d,this.transparentSortCompareFn=h}return Object.defineProperty(s.prototype,"opaqueSortCompareFn",{set:function(l){this._opaqueSortCompareFn=l||s.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"alphaTestSortCompareFn",{set:function(l){this._alphaTestSortCompareFn=l||s.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"transparentSortCompareFn",{set:function(l){this._transparentSortCompareFn=l||s.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted},enumerable:!1,configurable:!0}),s.prototype.render=function(l,c,u,d){if(l)l(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var h=this._scene.getEngine();this._depthOnlySubMeshes.length!==0&&(h.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),h.setColorWrite(!0)),this._opaqueSubMeshes.length!==0&&this._renderOpaque(this._opaqueSubMeshes),this._alphaTestSubMeshes.length!==0&&this._renderAlphaTest(this._alphaTestSubMeshes);var p=h.getStencilBuffer();if(h.setStencilBuffer(!1),c&&this._renderSprites(),u&&this._renderParticles(d),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length!==0||this._scene.useOrderIndependentTransparency){if(h.setStencilBuffer(p),this._scene.useOrderIndependentTransparency){var m=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);m.length&&this._renderTransparent(m)}else this._renderTransparent(this._transparentSubMeshes);h.setAlphaMode(o.Y.ALPHA_DISABLE)}if(h.setStencilBuffer(!1),this._edgesRenderers.length){for(var v=0;v<this._edgesRenderers.length;v++)this._edgesRenderers.data[v].render();h.setAlphaMode(o.Y.ALPHA_DISABLE)}h.setStencilBuffer(p)}},s.prototype._renderOpaqueSorted=function(l){s._RenderSorted(l,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},s.prototype._renderAlphaTestSorted=function(l){s._RenderSorted(l,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},s.prototype._renderTransparentSorted=function(l){s._RenderSorted(l,this._transparentSortCompareFn,this._scene.activeCamera,!0)},s._RenderSorted=function(l,c,u,d){var h,p=0,m=u?u.globalPosition:s._ZeroVector;if(d)for(;p<l.length;p++)(h=l.data[p])._alphaIndex=h.getMesh().alphaIndex,h._distanceToCamera=i.Pq.Distance(h.getBoundingInfo().boundingSphere.centerWorld,m);var v=l.length===l.data.length?l.data:l.data.slice(0,l.length);c&&v.sort(c);var b=v[0].getMesh().getScene();for(p=0;p<v.length;p++)if(h=v[p],!b._activeMeshesFrozenButKeepClipping||h.isInFrustum(b._frustumPlanes)){if(d){var E=h.getMaterial();if(E&&E.needDepthPrePass){var C=E.getScene().getEngine();C.setColorWrite(!1),C.setAlphaMode(o.Y.ALPHA_DISABLE),h.render(!1),C.setColorWrite(!0)}}h.render(d)}},s.defaultTransparentSortCompare=function(l,c){return l._alphaIndex>c._alphaIndex?1:l._alphaIndex<c._alphaIndex?-1:s.backToFrontSortCompare(l,c)},s.backToFrontSortCompare=function(l,c){return l._distanceToCamera<c._distanceToCamera?1:l._distanceToCamera>c._distanceToCamera?-1:0},s.frontToBackSortCompare=function(l,c){return l._distanceToCamera<c._distanceToCamera?-1:l._distanceToCamera>c._distanceToCamera?1:0},s.PainterSortCompare=function(l,c){var u=l.getMesh(),d=c.getMesh();return u.material&&d.material?u.material.uniqueId-d.material.uniqueId:u.uniqueId-d.uniqueId},s.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0},s.prototype.prepareSprites=function(){this._spriteManagers.reset()},s.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},s.prototype.dispatch=function(l,c,u){c===void 0&&(c=l.getMesh()),u===void 0&&(u=l.getMaterial()),u!=null&&(u.needAlphaBlendingForMesh(c)?this._transparentSubMeshes.push(l):u.needAlphaTesting()?(u.needDepthPrePass&&this._depthOnlySubMeshes.push(l),this._alphaTestSubMeshes.push(l)):(u.needDepthPrePass&&this._depthOnlySubMeshes.push(l),this._opaqueSubMeshes.push(l)),c._renderingGroup=this,c._edgesRenderer&&c.isEnabled()&&c.isVisible&&c._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(c._edgesRenderer),this._empty=!1)},s.prototype.dispatchSprites=function(l){this._spriteManagers.push(l),this._empty=!1},s.prototype.dispatchParticles=function(l){this._particleSystems.push(l),this._empty=!1},s.prototype._renderParticles=function(l){if(this._particleSystems.length!==0){var c=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var u=0;u<this._particleSystems.length;u++){var d=this._particleSystems.data[u];if((c&&c.layerMask&d.layerMask)!==0){var h=d.emitter;h.position&&l&&l.indexOf(h)===-1||this._scene._activeParticles.addCount(d.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},s.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&this._spriteManagers.length!==0){var l=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var c=0;c<this._spriteManagers.length;c++){var u=this._spriteManagers.data[c];(l&&l.layerMask&u.layerMask)!==0&&u.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},s._ZeroVector=i.Pq.Zero(),s}()},7931:(r,t,e)=>{e.d(t,{m:()=>o,o:()=>i});var n=e(85043),i=function(){},o=function(){function a(s){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new i,this._maintainStateBetweenFrames=!1,this._scene=s;for(var l=a.MIN_RENDERINGGROUPS;l<a.MAX_RENDERINGGROUPS;l++)this._autoClearDepthStencil[l]={autoClear:!0,depth:!0,stencil:!0}}return Object.defineProperty(a.prototype,"maintainStateBetweenFrames",{get:function(){return this._maintainStateBetweenFrames},set:function(s){s!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=s,this._maintainStateBetweenFrames||this.restoreDispachedFlags())},enumerable:!1,configurable:!0}),a.prototype.restoreDispachedFlags=function(){for(var s=0,l=this._scene.meshes;s<l.length;s++){var c=l[s];if(c.subMeshes)for(var u=0,d=c.subMeshes;u<d.length;u++)d[u]._wasDispatched=!1}if(this._scene.spriteManagers)for(var h=0,p=this._scene.spriteManagers;h<p.length;h++)p[h]._wasDispatched=!1;for(var m=0,v=this._scene.particleSystems;m<v.length;m++)v[m]._wasDispatched=!1},a.prototype.getRenderingGroup=function(s){var l=s||0;return this._prepareRenderingGroup(l),this._renderingGroups[l]},a.prototype._clearDepthStencilBuffer=function(s,l){s===void 0&&(s=!0),l===void 0&&(l=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,s,l),this._depthStencilBufferAlreadyCleaned=!0)},a.prototype.render=function(s,l,c,u){var d=this._renderingGroupInfo;if(d.scene=this._scene,d.camera=this._scene.activeCamera,this._scene.spriteManagers&&u)for(var h=0;h<this._scene.spriteManagers.length;h++){var p=this._scene.spriteManagers[h];this.dispatchSprites(p)}for(h=a.MIN_RENDERINGGROUPS;h<a.MAX_RENDERINGGROUPS;h++){this._depthStencilBufferAlreadyCleaned=h===a.MIN_RENDERINGGROUPS;var m=this._renderingGroups[h];if(m&&!m._empty){var v=1<<h;if(d.renderingGroupId=h,this._scene.onBeforeRenderingGroupObservable.notifyObservers(d,v),a.AUTOCLEAR){var b=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(h):this._autoClearDepthStencil[h];b&&b.autoClear&&this._clearDepthStencilBuffer(b.depth,b.stencil)}for(var E=0,C=this._scene._beforeRenderingGroupDrawStage;E<C.length;E++)C[E].action(h);m.render(s,u,c,l);for(var T=0,f=this._scene._afterRenderingGroupDrawStage;T<f.length;T++)f[T].action(h);this._scene.onAfterRenderingGroupObservable.notifyObservers(d,v)}}},a.prototype.reset=function(){if(!this.maintainStateBetweenFrames)for(var s=a.MIN_RENDERINGGROUPS;s<a.MAX_RENDERINGGROUPS;s++){var l=this._renderingGroups[s];l&&l.prepare()}},a.prototype.resetSprites=function(){if(!this.maintainStateBetweenFrames)for(var s=a.MIN_RENDERINGGROUPS;s<a.MAX_RENDERINGGROUPS;s++){var l=this._renderingGroups[s];l&&l.prepareSprites()}},a.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},a.prototype.freeRenderingGroups=function(){for(var s=a.MIN_RENDERINGGROUPS;s<a.MAX_RENDERINGGROUPS;s++){var l=this._renderingGroups[s];l&&l.dispose()}},a.prototype._prepareRenderingGroup=function(s){this._renderingGroups[s]===void 0&&(this._renderingGroups[s]=new n.U(s,this._scene,this._customOpaqueSortCompareFn[s],this._customAlphaTestSortCompareFn[s],this._customTransparentSortCompareFn[s]))},a.prototype.dispatchSprites=function(s){this.maintainStateBetweenFrames&&s._wasDispatched||(s._wasDispatched=!0,this.getRenderingGroup(s.renderingGroupId).dispatchSprites(s))},a.prototype.dispatchParticles=function(s){this.maintainStateBetweenFrames&&s._wasDispatched||(s._wasDispatched=!0,this.getRenderingGroup(s.renderingGroupId).dispatchParticles(s))},a.prototype.dispatch=function(s,l,c){l===void 0&&(l=s.getMesh()),this.maintainStateBetweenFrames&&s._wasDispatched||(s._wasDispatched=!0,this.getRenderingGroup(l.renderingGroupId).dispatch(s,l,c))},a.prototype.setRenderingOrder=function(s,l,c,u){if(l===void 0&&(l=null),c===void 0&&(c=null),u===void 0&&(u=null),this._customOpaqueSortCompareFn[s]=l,this._customAlphaTestSortCompareFn[s]=c,this._customTransparentSortCompareFn[s]=u,this._renderingGroups[s]){var d=this._renderingGroups[s];d.opaqueSortCompareFn=this._customOpaqueSortCompareFn[s],d.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[s],d.transparentSortCompareFn=this._customTransparentSortCompareFn[s]}},a.prototype.setRenderingAutoClearDepthStencil=function(s,l,c,u){c===void 0&&(c=!0),u===void 0&&(u=!0),this._autoClearDepthStencil[s]={autoClear:l,depth:c,stencil:u}},a.prototype.getAutoClearDepthStencilSetup=function(s){return this._autoClearDepthStencil[s]},a.MAX_RENDERINGGROUPS=4,a.MIN_RENDERINGGROUPS=0,a.AUTOCLEAR=!0,a}()},27947:(r,t,e)=>{var n=e(98519),i=(e(50851),"backgroundUboDeclaration");n.l.IncludesShadersStore[i]=`layout(std140,column_major) uniform;uniform Material
{uniform vec4 vPrimaryColor;uniform vec4 vPrimaryColorShadow;uniform vec2 vDiffuseInfos;uniform vec2 vReflectionInfos;uniform mat4 diffuseMatrix;uniform mat4 reflectionMatrix;uniform vec3 vReflectionMicrosurfaceInfos;uniform float fFovMultiplier;uniform float pointSize;uniform float shadowLevel;uniform float alpha;uniform vec3 vBackgroundCenter;uniform vec4 vReflectionControl;uniform vec2 projectedGroundInfos;};
#include<sceneUboDeclaration>
`},49334:(r,t,e)=>{e(98519).l.IncludesShadersStore.bakedVertexAnimation=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE
{
#ifdef INSTANCES
#define BVASNAME bakedVertexAnimationSettingsInstanced
#else
#define BVASNAME bakedVertexAnimationSettings
#endif
float VATStartFrame=BVASNAME.x;float VATEndFrame=BVASNAME.y;float VATOffsetFrame=BVASNAME.z;float VATSpeed=BVASNAME.w;float totalFrames=VATEndFrame-VATStartFrame+1.0;float time=bakedVertexAnimationTime*VATSpeed/totalFrames;float frameCorrection=time<1.0 ? 0.0 : 1.0;float numOfFrames=totalFrames-frameCorrection;float VATFrameNum=fract(time)*numOfFrames;VATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);VATFrameNum=floor(VATFrameNum);VATFrameNum+=VATStartFrame+frameCorrection;mat4 VATInfluence;VATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
VATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];
#endif
finalWorld=finalWorld*VATInfluence;}
#endif
`},64400:(r,t,e)=>{e(98519).l.IncludesShadersStore.bakedVertexAnimationDeclaration=`#ifdef BAKED_VERTEX_ANIMATION_TEXTURE
uniform float bakedVertexAnimationTime;uniform vec2 bakedVertexAnimationTextureSizeInverted;uniform vec4 bakedVertexAnimationSettings;uniform sampler2D bakedVertexAnimationTexture;
#ifdef INSTANCES
attribute vec4 bakedVertexAnimationSettingsInstanced;
#endif
#define inline
mat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)
{float offset=index*4.0;float frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;float dx=bakedVertexAnimationTextureSizeInverted.x;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));return mat4(m0,m1,m2,m3);}
#endif
`},36470:(r,t,e)=>{e.r(t),e.d(t,{bonesDeclaration:()=>o});var n="bonesDeclaration",i=`#if NUM_BONE_INFLUENCERS>0
attribute vec4 matricesIndices;attribute vec4 matricesWeights;
#if NUM_BONE_INFLUENCERS>4
attribute vec4 matricesIndicesExtra;attribute vec4 matricesWeightsExtra;
#endif
#ifndef BAKED_VERTEX_ANIMATION_TEXTURE
#ifdef BONETEXTURE
uniform highp sampler2D boneSampler;uniform float boneTextureWidth;
#else
uniform mat4 mBones[BonesPerMesh];
#endif
#ifdef BONES_VELOCITY_ENABLED
uniform mat4 mPreviousBones[BonesPerMesh];
#endif
#ifdef BONETEXTURE
#define inline
mat4 readMatrixFromRawSampler(sampler2D smp,float index)
{float offset=index *4.0;float dx=1.0/boneTextureWidth;vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));return mat4(m0,m1,m2,m3);}
#endif
#endif
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},76898:(r,t,e)=>{e.r(t),e.d(t,{bonesVertex:()=>o});var n="bonesVertex",i=`#ifndef BAKED_VERTEX_ANIMATION_TEXTURE
#if NUM_BONE_INFLUENCERS>0
mat4 influence;
#ifdef BONETEXTURE
influence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];
#endif
#else
influence=mBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=mBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=mBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=mBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
#endif
finalWorld=finalWorld*influence;
#endif
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},90253:(r,t,e)=>{e(98519).l.IncludesShadersStore.boundingBoxRendererUboDeclaration=`#ifdef WEBGL2
uniform vec4 color;uniform mat4 world;uniform mat4 viewProjection;
#ifdef MULTIVIEW
uniform mat4 viewProjectionR;
#endif
#else
layout(std140,column_major) uniform;uniform BoundingBoxRenderer {vec4 color;mat4 world;mat4 viewProjection;mat4 viewProjectionR;};
#endif
`},56159:(r,t,e)=>{e.r(t),e.d(t,{bumpFragment:()=>o});var n="bumpFragment",i=`vec2 uvOffset=vec2(0.0,0.0);
#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)
#ifdef NORMALXYSCALE
float normalScale=1.0;
#elif defined(BUMP)
float normalScale=vBumpInfos.y;
#else
float normalScale=1.0;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#elif defined(BUMP)
vec2 TBNUV=gl_FrontFacing ? vBumpUV : -vBumpUV;mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vTangentSpaceParams);
#else
vec2 TBNUV=gl_FrontFacing ? vDetailUV : -vDetailUV;mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vec2(1.,1.));
#endif
#elif defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#else
vec2 TBNUV=gl_FrontFacing ? vMainUV1 : -vMainUV1;mat3 TBN=cotangent_frame(normalW,vPositionW,TBNUV,vec2(1.,1.));
#endif
#endif
#ifdef PARALLAX
mat3 invTBN=transposeMat3(TBN);
#ifdef PARALLAXOCCLUSION
uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);
#else
uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);
#endif
#endif
#ifdef DETAIL
vec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);vec2 detailNormalRG=detailColor.wy*2.0-1.0;float detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));vec3 detailNormal=vec3(detailNormalRG,detailNormalB);
#endif
#ifdef BUMP
#ifdef OBJECTSPACE_NORMALMAP
#define CUSTOM_FRAGMENT_BUMP_FRAGMENT
normalW=normalize(texture2D(bumpSampler,vBumpUV).xyz *2.0-1.0);normalW=normalize(mat3(normalMatrix)*normalW);
#elif !defined(DETAIL)
normalW=perturbNormal(TBN,texture2D(bumpSampler,vBumpUV+uvOffset).xyz,vBumpInfos.y);
#else
vec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;
#if DETAIL_NORMALBLENDMETHOD==0 
detailNormal.xy*=vDetailInfos.z;vec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));
#elif DETAIL_NORMALBLENDMETHOD==1 
detailNormal.xy*=vDetailInfos.z;bumpNormal+=vec3(0.0,0.0,1.0);detailNormal*=vec3(-1.0,-1.0,1.0);vec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;
#endif
normalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);
#endif
#elif defined(DETAIL)
detailNormal.xy*=vDetailInfos.z;normalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},75394:(r,t,e)=>{e.r(t),e.d(t,{bumpFragmentFunctions:()=>a});var n=e(98519),i=(e(37755),"bumpFragmentFunctions"),o=`#if defined(BUMP)
#include<samplerFragmentDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump)
#endif
#if defined(DETAIL)
#include<samplerFragmentDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_SAMPLERNAME_,detail)
#endif
#if defined(BUMP) && defined(PARALLAX)
const float minSamples=4.;const float maxSamples=15.;const int iMaxSamples=15;vec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {float parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;parallaxLimit*=parallaxScale;vec2 vOffsetDir=normalize(vViewDirCoT.xy);vec2 vMaxOffset=vOffsetDir*parallaxLimit;float numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));float stepSize=1.0/numSamples;float currRayHeight=1.0;vec2 vCurrOffset=vec2(0,0);vec2 vLastOffset=vec2(0,0);float lastSampledHeight=1.0;float currSampledHeight=1.0;bool keepWorking=true;for (int i=0; i<iMaxSamples; i++)
{currSampledHeight=texture2D(bumpSampler,texCoord+vCurrOffset).w;if (!keepWorking)
{}
else if (currSampledHeight>currRayHeight)
{float delta1=currSampledHeight-currRayHeight;float delta2=(currRayHeight+stepSize)-lastSampledHeight;float ratio=delta1/(delta1+delta2);vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;keepWorking=false;}
else
{currRayHeight-=stepSize;vLastOffset=vCurrOffset;
#ifdef PARALLAX_RHS
vCurrOffset-=stepSize*vMaxOffset;
#else
vCurrOffset+=stepSize*vMaxOffset;
#endif
lastSampledHeight=currSampledHeight;}}
return vCurrOffset;}
vec2 parallaxOffset(vec3 viewDir,float heightScale)
{float height=texture2D(bumpSampler,vBumpUV).w;vec2 texCoordOffset=heightScale*viewDir.xy*height;
#ifdef PARALLAX_RHS
return texCoordOffset;
#else
return -texCoordOffset;
#endif
}
#endif
`;n.l.IncludesShadersStore[i]=o;var a={name:i,shader:o}},48661:(r,t,e)=>{e.r(t),e.d(t,{bumpFragmentMainFunctions:()=>o});var n="bumpFragmentMainFunctions",i=`#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)
#if defined(TANGENT) && defined(NORMAL) 
varying mat3 vTBN;
#endif
#ifdef OBJECTSPACE_NORMALMAP
uniform mat4 normalMatrix;
#if defined(WEBGL2) || defined(WEBGPU)
mat4 toNormalMatrix(mat4 wMatrix)
{mat4 ret=inverse(wMatrix);ret=transpose(ret);ret[0][3]=0.;ret[1][3]=0.;ret[2][3]=0.;ret[3]=vec4(0.,0.,0.,1.);return ret;}
#else
mat4 toNormalMatrix(mat4 m)
{float
a00=m[0][0],a01=m[0][1],a02=m[0][2],a03=m[0][3],
a10=m[1][0],a11=m[1][1],a12=m[1][2],a13=m[1][3],
a20=m[2][0],a21=m[2][1],a22=m[2][2],a23=m[2][3],
a30=m[3][0],a31=m[3][1],a32=m[3][2],a33=m[3][3],
b00=a00*a11-a01*a10,
b01=a00*a12-a02*a10,
b02=a00*a13-a03*a10,
b03=a01*a12-a02*a11,
b04=a01*a13-a03*a11,
b05=a02*a13-a03*a12,
b06=a20*a31-a21*a30,
b07=a20*a32-a22*a30,
b08=a20*a33-a23*a30,
b09=a21*a32-a22*a31,
b10=a21*a33-a23*a31,
b11=a22*a33-a23*a32,
det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;mat4 mi=mat4(
a11*b11-a12*b10+a13*b09,
a02*b10-a01*b11-a03*b09,
a31*b05-a32*b04+a33*b03,
a22*b04-a21*b05-a23*b03,
a12*b08-a10*b11-a13*b07,
a00*b11-a02*b08+a03*b07,
a32*b02-a30*b05-a33*b01,
a20*b05-a22*b02+a23*b01,
a10*b10-a11*b08+a13*b06,
a01*b08-a00*b10-a03*b06,
a30*b04-a31*b02+a33*b00,
a21*b02-a20*b04-a23*b00,
a11*b07-a10*b09-a12*b06,
a00*b09-a01*b07+a02*b06,
a31*b01-a30*b03-a32*b00,
a20*b03-a21*b01+a22*b00)/det;return mat4(mi[0][0],mi[1][0],mi[2][0],mi[3][0],
mi[0][1],mi[1][1],mi[2][1],mi[3][1],
mi[0][2],mi[1][2],mi[2][2],mi[3][2],
mi[0][3],mi[1][3],mi[2][3],mi[3][3]);}
#endif
#endif
vec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)
{
#ifdef NORMALXYSCALE
normal=normalize(normal*vec3(scale,scale,1.0));
#endif
return normalize(cotangentFrame*normal);}
vec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)
{return perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);}
mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)
{vec3 dp1=dFdx(p);vec3 dp2=dFdy(p);vec2 duv1=dFdx(uv);vec2 duv2=dFdy(uv);vec3 dp2perp=cross(dp2,normal);vec3 dp1perp=cross(normal,dp1);vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;vec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;tangent*=tangentSpaceParams.x;bitangent*=tangentSpaceParams.y;float det=max(dot(tangent,tangent),dot(bitangent,bitangent));float invmax=det==0.0 ? 0.0 : inversesqrt(det);return mat3(tangent*invmax,bitangent*invmax,normal);}
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},35845:(r,t,e)=>{e(98519).l.IncludesShadersStore.bumpVertex=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
vec3 tbnNormal=normalize(normalUpdated);vec3 tbnTangent=normalize(tangentUpdated.xyz);vec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;vTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);
#endif
#endif
`},42513:(r,t,e)=>{e(98519).l.IncludesShadersStore.bumpVertexDeclaration=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL) 
varying mat3 vTBN;
#endif
#endif
`},39643:(r,t,e)=>{e.r(t),e.d(t,{clipPlaneFragment:()=>o});var n="clipPlaneFragment",i=`#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)
if (false) {}
#endif
#ifdef CLIPPLANE
else if (fClipDistance>0.0)
{discard;}
#endif
#ifdef CLIPPLANE2
else if (fClipDistance2>0.0)
{discard;}
#endif
#ifdef CLIPPLANE3
else if (fClipDistance3>0.0)
{discard;}
#endif
#ifdef CLIPPLANE4
else if (fClipDistance4>0.0)
{discard;}
#endif
#ifdef CLIPPLANE5
else if (fClipDistance5>0.0)
{discard;}
#endif
#ifdef CLIPPLANE6
else if (fClipDistance6>0.0)
{discard;}
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},27003:(r,t,e)=>{e.r(t),e.d(t,{clipPlaneFragmentDeclaration:()=>o});var n="clipPlaneFragmentDeclaration",i=`#ifdef CLIPPLANE
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
varying float fClipDistance6;
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},83057:(r,t,e)=>{e.r(t),e.d(t,{clipPlaneVertex:()=>o});var n="clipPlaneVertex",i=`#ifdef CLIPPLANE
fClipDistance=dot(worldPos,vClipPlane);
#endif
#ifdef CLIPPLANE2
fClipDistance2=dot(worldPos,vClipPlane2);
#endif
#ifdef CLIPPLANE3
fClipDistance3=dot(worldPos,vClipPlane3);
#endif
#ifdef CLIPPLANE4
fClipDistance4=dot(worldPos,vClipPlane4);
#endif
#ifdef CLIPPLANE5
fClipDistance5=dot(worldPos,vClipPlane5);
#endif
#ifdef CLIPPLANE6
fClipDistance6=dot(worldPos,vClipPlane6);
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},85637:(r,t,e)=>{e.r(t),e.d(t,{clipPlaneVertexDeclaration:()=>o});var n="clipPlaneVertexDeclaration",i=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;varying float fClipDistance6;
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},93130:(r,t,e)=>{e(98519).l.IncludesShadersStore.decalFragment=`#ifdef DECAL
#ifdef GAMMADECAL
decalColor.rgb=toLinearSpace(decalColor.rgb);
#endif
#ifdef DECAL_SMOOTHALPHA
decalColor.a*=decalColor.a;
#endif
surfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,decalColor.rgb,decalColor.a);
#endif
`},77740:(r,t,e)=>{e(98519).l.IncludesShadersStore.decalFragmentDeclaration=`#ifdef DECAL
uniform vec4 vDecalInfos;
#endif
`},42858:(r,t,e)=>{e(98519).l.IncludesShadersStore.decalVertexDeclaration=`#ifdef DECAL
uniform vec4 vDecalInfos;uniform mat4 decalMatrix;
#endif
`},51578:(r,t,e)=>{var n=e(98519),i=(e(50851),e(56174),"defaultUboDeclaration");n.l.IncludesShadersStore[i]=`layout(std140,column_major) uniform;uniform Material
{vec4 diffuseLeftColor;vec4 diffuseRightColor;vec4 opacityParts;vec4 reflectionLeftColor;vec4 reflectionRightColor;vec4 refractionLeftColor;vec4 refractionRightColor;vec4 emissiveLeftColor;vec4 emissiveRightColor;vec2 vDiffuseInfos;vec2 vAmbientInfos;vec2 vOpacityInfos;vec2 vReflectionInfos;vec3 vReflectionPosition;vec3 vReflectionSize;vec2 vEmissiveInfos;vec2 vLightmapInfos;vec2 vSpecularInfos;vec3 vBumpInfos;mat4 diffuseMatrix;mat4 ambientMatrix;mat4 opacityMatrix;mat4 reflectionMatrix;mat4 emissiveMatrix;mat4 lightmapMatrix;mat4 specularMatrix;mat4 bumpMatrix;vec2 vTangentSpaceParams;float pointSize;float alphaCutOff;mat4 refractionMatrix;vec4 vRefractionInfos;vec3 vRefractionPosition;vec3 vRefractionSize;vec4 vSpecularColor;vec3 vEmissiveColor;vec4 vDiffuseColor;vec3 vAmbientColor;
#define ADDITIONAL_UBO_DECLARATION
};
#include<sceneUboDeclaration>
#include<meshUboDeclaration>
`},15656:(r,t,e)=>{e(98519).l.IncludesShadersStore.depthPrePass=`#ifdef DEPTHPREPASS
gl_FragColor=vec4(0.,0.,0.,1.0);return;
#endif
`},86343:(r,t,e)=>{e(98519).l.IncludesShadersStore.fogFragment=`#ifdef FOG
float fog=CalcFogFactor();
#ifdef PBR
fog=toLinearSpace(fog);
#endif
color.rgb=mix(vFogColor,color.rgb,fog);
#endif
`},52767:(r,t,e)=>{e.r(t),e.d(t,{fogFragmentDeclaration:()=>o});var n="fogFragmentDeclaration",i=`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
#define E 2.71828
uniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()
{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)
{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}
else if (FOGMODE_EXP==vFogInfos.x)
{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}
else if (FOGMODE_EXP2==vFogInfos.x)
{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}
return clamp(fogCoeff,0.0,1.0);}
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},62589:(r,t,e)=>{e(98519).l.IncludesShadersStore.fogVertex=`#ifdef FOG
vFogDistance=(view*worldPos).xyz;
#endif
`},72153:(r,t,e)=>{e(98519).l.IncludesShadersStore.fogVertexDeclaration=`#ifdef FOG
varying vec3 vFogDistance;
#endif
`},18644:(r,t,e)=>{e(98519).l.IncludesShadersStore.fresnelFunction=`#ifdef FRESNEL
float computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)
{float fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);return clamp(fresnelTerm,0.,1.);}
#endif
`},92518:(r,t,e)=>{e(98519).l.IncludesShadersStore.harmonicsFunctions=`#ifdef USESPHERICALFROMREFLECTIONMAP
#ifdef SPHERICAL_HARMONICS
vec3 computeEnvironmentIrradiance(vec3 normal) {return vSphericalL00
+ vSphericalL1_1*(normal.y)
+ vSphericalL10*(normal.z)
+ vSphericalL11*(normal.x)
+ vSphericalL2_2*(normal.y*normal.x)
+ vSphericalL2_1*(normal.y*normal.z)
+ vSphericalL20*((3.0*normal.z*normal.z)-1.0)
+ vSphericalL21*(normal.z*normal.x)
+ vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));}
#else
vec3 computeEnvironmentIrradiance(vec3 normal) {float Nx=normal.x;float Ny=normal.y;float Nz=normal.z;vec3 C1=vSphericalZZ.rgb;vec3 Cx=vSphericalX.rgb;vec3 Cy=vSphericalY.rgb;vec3 Cz=vSphericalZ.rgb;vec3 Cxx_zz=vSphericalXX_ZZ.rgb;vec3 Cyy_zz=vSphericalYY_ZZ.rgb;vec3 Cxy=vSphericalXY.rgb;vec3 Cyz=vSphericalYZ.rgb;vec3 Czx=vSphericalZX.rgb;vec3 a1=Cyy_zz*Ny+Cy;vec3 a2=Cyz*Nz+a1;vec3 b1=Czx*Nz+Cx;vec3 b2=Cxy*Ny+b1;vec3 b3=Cxx_zz*Nx+b2;vec3 t1=Cz *Nz+C1;vec3 t2=a2 *Ny+t1;vec3 t3=b3 *Nx+t2;return t3;}
#endif
#endif
`},10114:(r,t,e)=>{e(98519).l.IncludesShadersStore.hdrFilteringFunctions=`#ifdef NUM_SAMPLES
#if NUM_SAMPLES>0
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
float radicalInverse_VdC(uint bits) 
{bits=(bits<<16u) | (bits>>16u);bits=((bits & 0x55555555u)<<1u) | ((bits & 0xAAAAAAAAu)>>1u);bits=((bits & 0x33333333u)<<2u) | ((bits & 0xCCCCCCCCu)>>2u);bits=((bits & 0x0F0F0F0Fu)<<4u) | ((bits & 0xF0F0F0F0u)>>4u);bits=((bits & 0x00FF00FFu)<<8u) | ((bits & 0xFF00FF00u)>>8u);return float(bits)*2.3283064365386963e-10; }
vec2 hammersley(uint i,uint N)
{return vec2(float(i)/float(N),radicalInverse_VdC(i));}
#else
float vanDerCorpus(int n,int base)
{float invBase=1.0/float(base);float denom =1.0;float result =0.0;for(int i=0; i<32; ++i)
{if(n>0)
{denom =mod(float(n),2.0);result+=denom*invBase;invBase=invBase/2.0;n =int(float(n)/2.0);}}
return result;}
vec2 hammersley(int i,int N)
{return vec2(float(i)/float(N),vanDerCorpus(i,2));}
#endif
float log4(float x) {return log2(x)/2.;}
const float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);const float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;const float K=4.;
#define inline
vec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)
{vec3 n=normalize(inputN);vec3 result=vec3(0.0);vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);tangent=normalize(cross(tangent,n));vec3 bitangent=cross(n,tangent);mat3 tbn=mat3(tangent,bitangent,n);float maxLevel=filteringInfo.y;float dim0=filteringInfo.x;float omegaP=(4.*PI)/(6.*dim0*dim0);
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
for(uint i=0u; i<NUM_SAMPLES; ++i)
#else
for(int i=0; i<NUM_SAMPLES; ++i)
#endif
{vec2 Xi=hammersley(i,NUM_SAMPLES);vec3 Ls=hemisphereCosSample(Xi);Ls=normalize(Ls);vec3 Ns=vec3(0.,0.,1.);float NoL=dot(Ns,Ls);if (NoL>0.) {float pdf_inversed=PI/NoL;float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;float l=log4(omegaS)-log4(omegaP)+log4(K);float mipLevel=clamp(l,0.0,maxLevel);vec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
result+=c;}}
result=result*NUM_SAMPLES_FLOAT_INVERSED;return result;}
#define inline
vec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)
{vec3 n=normalize(inputN);vec3 c=textureCube(inputTexture,n).rgb; 
if (alphaG==0.) {
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
return c;} else {vec3 result=vec3(0.);vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);tangent=normalize(cross(tangent,n));vec3 bitangent=cross(n,tangent);mat3 tbn=mat3(tangent,bitangent,n);float maxLevel=filteringInfo.y;float dim0=filteringInfo.x;float omegaP=(4.*PI)/(6.*dim0*dim0);float weight=0.;
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
for(uint i=0u; i<NUM_SAMPLES; ++i)
#else
for(int i=0; i<NUM_SAMPLES; ++i)
#endif
{vec2 Xi=hammersley(i,NUM_SAMPLES);vec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);float NoV=1.;float NoH=H.z;float NoH2=H.z*H.z;float NoL=2.*NoH2-1.;vec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);L=normalize(L);if (NoL>0.) {float pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;float l=log4(omegaS)-log4(omegaP)+log4(K);float mipLevel=clamp(float(l),0.0,maxLevel);weight+=NoL;vec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
result+=c*NoL;}}
result=result/weight;return result;}}
#endif
#endif
`},75334:(r,t,e)=>{e.r(t),e.d(t,{helperFunctions:()=>o});var n="helperFunctions",i=`const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; 
const float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;
#define saturate(x) clamp(x,0.0,1.0)
#define absEps(x) abs(x)+Epsilon
#define maxEps(x) max(x,Epsilon)
#define saturateEps(x) clamp(x,Epsilon,1.0)
mat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);return outMatrix;}
mat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),
b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),
b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}
#if USE_EXACT_SRGB_CONVERSIONS
vec3 toLinearSpaceExact(vec3 color)
{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));
#else
return
vec3(
color.r<=0.04045 ? nearZeroSection.r : remainingSection.r,
color.g<=0.04045 ? nearZeroSection.g : remainingSection.g,
color.b<=0.04045 ? nearZeroSection.b : remainingSection.b);
#endif
}
vec3 toGammaSpaceExact(vec3 color)
{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));
#else
return
vec3(
color.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,
color.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,
color.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);
#endif
}
#endif
float toLinearSpace(float color)
{
#if USE_EXACT_SRGB_CONVERSIONS
float nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;
#else
return pow(color,LinearEncodePowerApprox);
#endif
}
vec3 toLinearSpace(vec3 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return toLinearSpaceExact(color);
#else
return pow(color,vec3(LinearEncodePowerApprox));
#endif
}
vec4 toLinearSpace(vec4 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return vec4(toLinearSpaceExact(color.rgb),color.a);
#else
return vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);
#endif
}
float toGammaSpace(float color)
{
#if USE_EXACT_SRGB_CONVERSIONS
float nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;
#else
return pow(color,GammaEncodePowerApprox);
#endif
}
vec3 toGammaSpace(vec3 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return toGammaSpaceExact(color);
#else
return pow(color,vec3(GammaEncodePowerApprox));
#endif
}
vec4 toGammaSpace(vec4 color)
{
#if USE_EXACT_SRGB_CONVERSIONS
return vec4(toGammaSpaceExact(color.rgb),color.a);
#else
return vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);
#endif
}
float square(float value)
{return value*value;}
vec3 square(vec3 value)
{return value*value;}
float pow5(float value) {float sq=value*value;return sq*sq*value;}
float getLuminance(vec3 color)
{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}
float getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}
float dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}
const float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }
vec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}
vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},59581:(r,t,e)=>{e.r(t),e.d(t,{imageProcessingDeclaration:()=>o});var n="imageProcessingDeclaration",i=`#ifdef EXPOSURE
uniform float exposureLinear;
#endif
#ifdef CONTRAST
uniform float contrast;
#endif
#if defined(VIGNETTE) || defined(DITHER)
uniform vec2 vInverseScreenSize;
#endif
#ifdef VIGNETTE
uniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;
#endif
#ifdef COLORCURVES
uniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;
#endif
#ifdef COLORGRADING
#ifdef COLORGRADING3D
uniform highp sampler3D txColorTransform;
#else
uniform sampler2D txColorTransform;
#endif
uniform vec4 colorTransformSettings;
#endif
#ifdef DITHER
uniform float ditherIntensity;
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},40688:(r,t,e)=>{e.r(t),e.d(t,{imageProcessingFunctions:()=>o});var n="imageProcessingFunctions",i=`#if defined(COLORGRADING) && !defined(COLORGRADING3D)
/** 
* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.
* sampler3dSetting.x=textureOffset (0.5/textureSize).
* sampler3dSetting.y=textureSize.
*/
#define inline
vec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)
{float sliceSize=2.0*sampler3dSetting.x; 
#ifdef SAMPLER3DGREENDEPTH
float sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;
#else
float sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;
#endif
float sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;
#ifdef SAMPLER3DGREENDEPTH
vec2 sliceUV=color.rb;
#else
vec2 sliceUV=color.rg;
#endif
sliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);
#ifdef SAMPLER3DBGRMAP
color.rgb=result.rgb;
#else
color.rgb=result.bgr;
#endif
return color;}
#endif
#if TONEMAPPING==3
const float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}
#endif
#if TONEMAPPING==2
const mat3 ACESInputMat=mat3(
vec3(0.59719,0.07600,0.02840),
vec3(0.35458,0.90834,0.13383),
vec3(0.04823,0.01566,0.83777)
);const mat3 ACESOutputMat=mat3(
vec3( 1.60475,-0.10208,-0.00327),
vec3(-0.53108, 1.10813,-0.07276),
vec3(-0.07367,-0.00605, 1.07602)
);vec3 RRTAndODTFit(vec3 v)
{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}
vec3 ACESFitted(vec3 color)
{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}
#endif
#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS
vec4 applyImageProcessing(vec4 result) {
#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART
#ifdef EXPOSURE
result.rgb*=exposureLinear;
#endif
#ifdef VIGNETTE
vec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;
#ifdef VIGNETTEBLENDMODEMULTIPLY
vec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;
#endif
#ifdef VIGNETTEBLENDMODEOPAQUE
result.rgb=mix(vignetteColor,result.rgb,vignette);
#endif
#endif
#if TONEMAPPING==3
result.rgb=PBRNeutralToneMapping(result.rgb);
#elif TONEMAPPING==2
result.rgb=ACESFitted(result.rgb);
#elif TONEMAPPING==1
const float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);
#endif
result.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);
#ifdef CONTRAST
vec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}
#endif
#ifdef COLORGRADING
vec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;
#ifdef COLORGRADING3D
vec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;
#else
vec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;
#endif
result.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);
#endif
#ifdef COLORCURVES
float luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);
#endif
#ifdef DITHER
float rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));
#endif
#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND
return result;}`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},19568:(r,t,e)=>{e(98519).l.IncludesShadersStore.importanceSampling=`vec3 hemisphereCosSample(vec2 u) {float phi=2.*PI*u.x;float cosTheta2=1.-u.y;float cosTheta=sqrt(cosTheta2);float sinTheta=sqrt(1.-cosTheta2);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}
vec3 hemisphereImportanceSampleDggx(vec2 u,float a) {float phi=2.*PI*u.x;float cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));float cosTheta=sqrt(cosTheta2);float sinTheta=sqrt(1.-cosTheta2);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}
vec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) { 
float phi=2.*PI*u.x;float sinTheta=pow(u.y,a/(2.*a+1.));float cosTheta=sqrt(1.-sinTheta*sinTheta);return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);}`},38615:(r,t,e)=>{e(98519).l.IncludesShadersStore.instancesDeclaration=`#ifdef INSTANCES
attribute vec4 world0;attribute vec4 world1;attribute vec4 world2;attribute vec4 world3;
#ifdef INSTANCESCOLOR
attribute vec4 instanceColor;
#endif
#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)
uniform mat4 world;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR)
attribute vec4 previousWorld0;attribute vec4 previousWorld1;attribute vec4 previousWorld2;attribute vec4 previousWorld3;
#ifdef THIN_INSTANCES
uniform mat4 previousWorld;
#endif
#endif
#else
#if !defined(WORLD_UBO)
uniform mat4 world;
#endif
#if defined(VELOCITY) || defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR)
uniform mat4 previousWorld;
#endif
#endif
`},35397:(r,t,e)=>{e(98519).l.IncludesShadersStore.instancesVertex=`#ifdef INSTANCES
mat4 finalWorld=mat4(world0,world1,world2,world3);
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR)
mat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,
previousWorld2,previousWorld3);
#endif
#ifdef THIN_INSTANCES
finalWorld=world*finalWorld;
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR)
finalPreviousWorld=previousWorld*finalPreviousWorld;
#endif
#endif
#else
mat4 finalWorld=world;
#if defined(PREPASS_VELOCITY) || defined(VELOCITY) || defined(PREPASS_VELOCITY_LINEAR)
mat4 finalPreviousWorld=previousWorld;
#endif
#endif
`},67303:(r,t,e)=>{e(98519).l.IncludesShadersStore.kernelBlurVaryingDeclaration="varying vec2 sampleCoord{X};"},7363:(r,t,e)=>{e.r(t),e.d(t,{lightFragment:()=>o});var n="lightFragment",i=`#ifdef LIGHT{X}
#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})
#else
vec4 diffuse{X}=light{X}.vLightDiffuse;
#define CUSTOM_LIGHT{X}_COLOR 
#ifdef PBR
#ifdef SPOTLIGHT{X}
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW,vPositionW);
#elif defined(POINTLIGHT{X})
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW,vPositionW);
#elif defined(HEMILIGHT{X})
preInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(DIRLIGHT{X})
preInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#endif
preInfo.NdotV=NdotV;
#ifdef SPOTLIGHT{X}
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);preInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);preInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);preInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);preInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#endif
#elif defined(POINTLIGHT{X})
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
#endif
#else
preInfo.attenuation=1.0;
#endif
#ifdef HEMILIGHT{X}
preInfo.roughness=roughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
#ifdef IRIDESCENCE
preInfo.iridescenceIntensity=iridescenceIntensity;
#endif
#ifdef HEMILIGHT{X}
info.diffuse=computeHemisphericDiffuseLighting(preInfo,diffuse{X}.rgb,light{X}.vLightGround);
#elif defined(SS_TRANSLUCENCY)
info.diffuse=computeDiffuseAndTransmittedLighting(preInfo,diffuse{X}.rgb,subSurfaceOut.transmittance);
#else
info.diffuse=computeDiffuseLighting(preInfo,diffuse{X}.rgb);
#endif
#ifdef SPECULARTERM
#ifdef ANISOTROPIC
info.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,diffuse{X}.rgb);
#else
info.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,diffuse{X}.rgb);
#endif
#endif
#ifdef SHEEN
#ifdef SHEEN_LINKWITHALBEDO
preInfo.roughness=sheenOut.sheenIntensity;
#else
#ifdef HEMILIGHT{X}
preInfo.roughness=sheenOut.sheenRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
#endif
info.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,diffuse{X}.rgb);
#endif
#ifdef CLEARCOAT
#ifdef HEMILIGHT{X}
preInfo.roughness=clearcoatOut.clearCoatRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
info.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,diffuse{X}.rgb);
#ifdef CLEARCOAT_TINT
absorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);info.diffuse*=absorption;
#ifdef SPECULARTERM
info.specular*=absorption;
#endif
#endif
info.diffuse*=info.clearCoat.w;
#ifdef SPECULARTERM
info.specular*=info.clearCoat.w;
#endif
#ifdef SHEEN
info.sheen*=info.clearCoat.w;
#endif
#endif
#else
#ifdef SPOTLIGHT{X}
info=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,diffuse{X}.rgb,light{X}.vLightSpecular.rgb,diffuse{X}.a,glossiness);
#elif defined(HEMILIGHT{X})
info=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,diffuse{X}.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);
#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})
info=computeLighting(viewDirectionW,normalW,light{X}.vLightData,diffuse{X}.rgb,light{X}.vLightSpecular.rgb,diffuse{X}.a,glossiness);
#endif
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
info.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightTexture{X},textureProjectionMatrix{X},vPositionW);
#endif
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) 
{
#ifdef SHADOWCSM_RIGHTHANDED{X}
diff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;
#else
diff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;
#endif
if (diff{X}>=0.) {index{X}=i;break;}}
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
if (index{X}>=0)
#endif
{
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
shadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
shadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];
#endif
#ifndef SHADOWCSMNOBLEND{X}
float frustumLength=frustumLengths{X}[index{X}];float diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};if (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)
{index{X}+=1;float nextShadow=0.;
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
nextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
nextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
nextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
shadow=mix(nextShadow,shadow,diffRatio);
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);
#endif
}
#endif
}
#elif defined(SHADOWCLOSEESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithCloseESMCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithESMCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPOISSON{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithPoissonSamplingCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthTexture{X},shadowTexture{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#else
#if defined(SHADOWCUBE{X})
shadow=computeShadowCube(vPositionW,light{X}.vLightData.xyz,shadowTexture{X},light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowTexture{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#endif
#ifdef SHADOWONLY
#ifndef SHADOWINUSE
#define SHADOWINUSE
#endif
globalShadow+=shadow;shadowLightCount+=1.0;
#endif
#else
shadow=1.;
#endif
aggShadow+=shadow;numLights+=1.0;
#ifndef SHADOWONLY
#ifdef CUSTOMUSERLIGHTING
diffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);
#ifdef SPECULARTERM
specularBase+=computeCustomSpecularLighting(info,specularBase,shadow);
#endif
#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})
diffuseBase+=lightmapColor.rgb*shadow;
#ifdef SPECULARTERM
#ifndef LIGHTMAPNOSPECULAR{X}
specularBase+=info.specular*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef CLEARCOAT
#ifndef LIGHTMAPNOSPECULAR{X}
clearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef SHEEN
#ifndef LIGHTMAPNOSPECULAR{X}
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#else
#ifdef SHADOWCSMDEBUG{X}
diffuseBase+=info.diffuse*shadowDebug{X};
#else 
diffuseBase+=info.diffuse*shadow;
#endif
#ifdef SPECULARTERM
specularBase+=info.specular*shadow;
#endif
#ifdef CLEARCOAT
clearCoatBase+=info.clearCoat.rgb*shadow;
#endif
#ifdef SHEEN
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#endif
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},87283:(r,t,e)=>{e.r(t),e.d(t,{lightFragmentDeclaration:()=>o});var n="lightFragmentDeclaration",i=`#ifdef LIGHT{X}
uniform vec4 vLightData{X};uniform vec4 vLightDiffuse{X};
#ifdef SPECULARTERM
uniform vec4 vLightSpecular{X};
#else
vec4 vLightSpecular{X}=vec4(0.);
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];uniform float cascadeBlendFactor{X};varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowTexture{X};uniform highp sampler2DArray depthTexture{X};uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowTexture{X};
#else
uniform highp sampler2DArray shadowTexture{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowTexture{X};
#else
varying vec4 vPositionFromLight{X};varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowTexture{X};uniform highp sampler2D depthTexture{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowTexture{X};
#else
uniform sampler2D shadowTexture{X};
#endif
uniform mat4 lightMatrix{X};
#endif
uniform vec4 shadowsInfo{X};uniform vec2 depthValues{X};
#endif
#ifdef SPOTLIGHT{X}
uniform vec4 vLightDirection{X};uniform vec4 vLightFalloff{X};
#elif defined(POINTLIGHT{X})
uniform vec4 vLightFalloff{X};
#elif defined(HEMILIGHT{X})
uniform vec3 vLightGround{X};
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};uniform sampler2D projectionLightTexture{X};
#endif
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},32823:(r,t,e)=>{e.r(t),e.d(t,{lightUboDeclaration:()=>o});var n="lightUboDeclaration",i=`#ifdef LIGHT{X}
uniform Light{X}
{vec4 vLightData;vec4 vLightDiffuse;vec4 vLightSpecular;
#ifdef SPOTLIGHT{X}
vec4 vLightDirection;vec4 vLightFalloff;
#elif defined(POINTLIGHT{X})
vec4 vLightFalloff;
#elif defined(HEMILIGHT{X})
vec3 vLightGround;
#endif
vec4 shadowsInfo;vec2 depthValues;} light{X};
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};uniform sampler2D projectionLightTexture{X};
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];uniform float cascadeBlendFactor{X};varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowTexture{X};uniform highp sampler2DArray depthTexture{X};uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowTexture{X};
#else
uniform highp sampler2DArray shadowTexture{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowTexture{X}; 
#else
varying vec4 vPositionFromLight{X};varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowTexture{X};uniform highp sampler2D depthTexture{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowTexture{X};
#else
uniform sampler2D shadowTexture{X};
#endif
uniform mat4 lightMatrix{X};
#endif
#endif
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},94785:(r,t,e)=>{e.r(t),e.d(t,{lightVxFragmentDeclaration:()=>o});var n="lightVxFragmentDeclaration",i=`#ifdef LIGHT{X}
uniform vec4 vLightData{X};uniform vec4 vLightDiffuse{X};
#ifdef SPECULARTERM
uniform vec4 vLightSpecular{X};
#else
vec4 vLightSpecular{X}=vec4(0.);
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};
#elif defined(SHADOWCUBE{X})
#else
varying vec4 vPositionFromLight{X};varying float vDepthMetric{X};uniform mat4 lightMatrix{X};
#endif
uniform vec4 shadowsInfo{X};uniform vec2 depthValues{X};
#endif
#ifdef SPOTLIGHT{X}
uniform vec4 vLightDirection{X};uniform vec4 vLightFalloff{X};
#elif defined(POINTLIGHT{X})
uniform vec4 vLightFalloff{X};
#elif defined(HEMILIGHT{X})
uniform vec3 vLightGround{X};
#endif
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},48961:(r,t,e)=>{e.r(t),e.d(t,{lightVxUboDeclaration:()=>o});var n="lightVxUboDeclaration",i=`#ifdef LIGHT{X}
uniform Light{X}
{vec4 vLightData;vec4 vLightDiffuse;vec4 vLightSpecular;
#ifdef SPOTLIGHT{X}
vec4 vLightDirection;vec4 vLightFalloff;
#elif defined(POINTLIGHT{X})
vec4 vLightFalloff;
#elif defined(HEMILIGHT{X})
vec3 vLightGround;
#endif
vec4 shadowsInfo;vec2 depthValues;} light{X};
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];varying vec4 vPositionFromCamera{X};
#elif defined(SHADOWCUBE{X})
#else
varying vec4 vPositionFromLight{X};varying float vDepthMetric{X};uniform mat4 lightMatrix{X};
#endif
#endif
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},54409:(r,t,e)=>{e.r(t),e.d(t,{lightsFragmentFunctions:()=>o});var n="lightsFragmentFunctions",i=`struct lightingInfo
{vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef NDOTL
float ndl;
#endif
};lightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {lightingInfo result;vec3 lightVectorW;float attenuation=1.0;if (lightData.w==0.)
{vec3 direction=lightData.xyz-vPositionW;attenuation=max(0.,1.0-length(direction)/range);lightVectorW=normalize(direction);}
else
{lightVectorW=normalize(-lightData.xyz);}
float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM
vec3 angleW=normalize(viewDirectionW+lightVectorW);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor*attenuation;
#endif
return result;}
lightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {lightingInfo result;vec3 direction=lightData.xyz-vPositionW;vec3 lightVectorW=normalize(direction);float attenuation=max(0.,1.0-length(direction)/range);float cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));if (cosAngle>=lightDirection.w)
{cosAngle=max(0.,pow(cosAngle,lightData.w));attenuation*=cosAngle;float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM
vec3 angleW=normalize(viewDirectionW+lightVectorW);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor*attenuation;
#endif
return result;}
result.diffuse=vec3(0.);
#ifdef SPECULARTERM
result.specular=vec3(0.);
#endif
#ifdef NDOTL
result.ndl=0.;
#endif
return result;}
lightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {lightingInfo result;float ndl=dot(vNormal,lightData.xyz)*0.5+0.5;
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=mix(groundColor,diffuseColor,ndl);
#ifdef SPECULARTERM
vec3 angleW=normalize(viewDirectionW+lightData.xyz);float specComp=max(0.,dot(vNormal,angleW));specComp=pow(specComp,max(1.,glossiness));result.specular=specComp*specularColor;
#endif
return result;}
#define inline
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix,vec3 posW){vec4 strq=textureProjectionMatrix*vec4(posW,1.0);strq/=strq.w;vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;return textureColor;}`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},59262:(r,t,e)=>{e(98519).l.IncludesShadersStore.logDepthDeclaration=`#ifdef LOGARITHMICDEPTH
uniform float logarithmicDepthConstant;varying float vFragmentDepth;
#endif
`},13088:(r,t,e)=>{e(98519).l.IncludesShadersStore.logDepthFragment=`#ifdef LOGARITHMICDEPTH
gl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;
#endif
`},56458:(r,t,e)=>{e(98519).l.IncludesShadersStore.logDepthVertex=`#ifdef LOGARITHMICDEPTH
vFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;
#endif
`},48493:(r,t,e)=>{e(98519).l.IncludesShadersStore.mainUVVaryingDeclaration=`#ifdef MAINUV{X}
varying vec2 vMainUV{X};
#endif
`},56174:(r,t,e)=>{e(98519).l.IncludesShadersStore.meshUboDeclaration=`#ifdef WEBGL2
uniform mat4 world;uniform float visibility;
#else
layout(std140,column_major) uniform;uniform Mesh
{mat4 world;float visibility;};
#endif
#define WORLD_UBO
`},84589:(r,t,e)=>{e.r(t),e.d(t,{morphTargetsVertex:()=>o});var n="morphTargetsVertex",i=`#ifdef MORPHTARGETS
#ifdef MORPHTARGETS_TEXTURE
#if {X}==0
for (int i=0; i<NUM_MORPH_INFLUENCERS; i++) {if (i>=morphTargetCount) break;vertexID=float(gl_VertexID)*morphTargetTextureInfo.x;positionUpdated+=(readVector3FromRawSampler(i,vertexID)-position)*morphTargetInfluences[i];vertexID+=1.0;
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(readVector3FromRawSampler(i,vertexID) -normal)*morphTargetInfluences[i];vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(readVector3FromRawSampler(i,vertexID).xy-uv)*morphTargetInfluences[i];vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(readVector3FromRawSampler(i,vertexID) -tangent.xyz)*morphTargetInfluences[i];
#endif
}
#endif
#else
positionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];
#endif
#endif
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},67369:(r,t,e)=>{e.r(t),e.d(t,{morphTargetsVertexDeclaration:()=>o});var n="morphTargetsVertexDeclaration",i=`#ifdef MORPHTARGETS
#ifndef MORPHTARGETS_TEXTURE
attribute vec3 position{X};
#ifdef MORPHTARGETS_NORMAL
attribute vec3 normal{X};
#endif
#ifdef MORPHTARGETS_TANGENT
attribute vec3 tangent{X};
#endif
#ifdef MORPHTARGETS_UV
attribute vec2 uv_{X};
#endif
#elif {X}==0
uniform int morphTargetCount;
#endif
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},58266:(r,t,e)=>{e.r(t),e.d(t,{morphTargetsVertexGlobal:()=>o});var n="morphTargetsVertexGlobal",i=`#ifdef MORPHTARGETS
#ifdef MORPHTARGETS_TEXTURE
float vertexID;
#endif
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},24444:(r,t,e)=>{e.r(t),e.d(t,{morphTargetsVertexGlobalDeclaration:()=>o});var n="morphTargetsVertexGlobalDeclaration",i=`#ifdef MORPHTARGETS
uniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];
#ifdef MORPHTARGETS_TEXTURE 
uniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];uniform vec3 morphTargetTextureInfo;uniform highp sampler2DArray morphTargets;vec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)
{ 
float y=floor(vertexIndex/morphTargetTextureInfo.y);float x=vertexIndex-y*morphTargetTextureInfo.y;vec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);return texture(morphTargets,textureUV).xyz;}
#endif
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},81751:(r,t,e)=>{e(98519).l.IncludesShadersStore.oitDeclaration=`#ifdef ORDER_INDEPENDENT_TRANSPARENCY
#extension GL_EXT_draw_buffers : require
layout(location=0) out vec2 depth; 
layout(location=1) out vec4 frontColor;layout(location=2) out vec4 backColor;
#define MAX_DEPTH 99999.0
highp vec4 gl_FragColor;uniform sampler2D oitDepthSampler;uniform sampler2D oitFrontColorSampler;
#endif
`},11135:(r,t,e)=>{e(98519).l.IncludesShadersStore.oitFragment=`#ifdef ORDER_INDEPENDENT_TRANSPARENCY
float fragDepth=gl_FragCoord.z; 
#ifdef ORDER_INDEPENDENT_TRANSPARENCY_16BITS
uint halfFloat=packHalf2x16(vec2(fragDepth));vec2 full=unpackHalf2x16(halfFloat);fragDepth=full.x;
#endif
ivec2 fragCoord=ivec2(gl_FragCoord.xy);vec2 lastDepth=texelFetch(oitDepthSampler,fragCoord,0).rg;vec4 lastFrontColor=texelFetch(oitFrontColorSampler,fragCoord,0);depth.rg=vec2(-MAX_DEPTH);frontColor=lastFrontColor;backColor=vec4(0.0);
#ifdef USE_REVERSE_DEPTHBUFFER
float furthestDepth=-lastDepth.x;float nearestDepth=lastDepth.y;
#else
float nearestDepth=-lastDepth.x;float furthestDepth=lastDepth.y;
#endif
float alphaMultiplier=1.0-lastFrontColor.a;
#ifdef USE_REVERSE_DEPTHBUFFER
if (fragDepth>nearestDepth || fragDepth<furthestDepth) {
#else
if (fragDepth<nearestDepth || fragDepth>furthestDepth) {
#endif
return;}
#ifdef USE_REVERSE_DEPTHBUFFER
if (fragDepth<nearestDepth && fragDepth>furthestDepth) {
#else
if (fragDepth>nearestDepth && fragDepth<furthestDepth) {
#endif
depth.rg=vec2(-fragDepth,fragDepth);return;}
#endif
`},78531:(r,t,e)=>{e.r(t),e.d(t,{packingFunctions:()=>o});var n="packingFunctions",i=`vec4 pack(float depth)
{const vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
float unpack(vec4 color)
{const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},64244:(r,t,e)=>{e(98519).l.IncludesShadersStore.pbrBRDFFunctions=`#define FRESNEL_MAXIMUM_ON_ROUGH 0.25
#ifdef MS_BRDF_ENERGY_CONSERVATION
vec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);}
#endif
#ifdef ENVIRONMENTBRDF
vec3 getBRDFLookup(float NdotV,float perceptualRoughness) {vec2 UV=vec2(NdotV,perceptualRoughness);vec4 brdfLookup=texture2D(environmentBrdfSampler,UV);
#ifdef ENVIRONMENTBRDF_RGBD
brdfLookup.rgb=fromRGBD(brdfLookup.rgba);
#endif
return brdfLookup.rgb;}
vec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {
#ifdef BRDF_V_HEIGHT_CORRELATED
vec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;
#else
vec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;
#endif
return reflectance;}
vec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {
#ifdef BRDF_V_HEIGHT_CORRELATED
vec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);
#else
vec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;
#endif
return reflectance;}
#endif
/* NOT USED
#if defined(SHEEN) && defined(SHEEN_SOFTER)
float getBRDFLookupCharlieSheen(float NdotV,float perceptualRoughness)
{float c=1.0-NdotV;float c3=c*c*c;return 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));}
#endif
*/
#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)
vec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));}
#endif
#if defined(SHEEN) && defined(ENVIRONMENTBRDF)
/**
* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.
* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table
*/
vec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {vec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;return sheenEnvironmentReflectance;}
#endif
vec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)
{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}
float fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)
{return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);}
#ifdef CLEARCOAT
vec3 getR0RemappedForClearCoat(vec3 f0) {
#ifdef CLEARCOAT_DEFAULTIOR
#ifdef MOBILE
return saturate(f0*(f0*0.526868+0.529324)-0.0482256);
#else
return saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);
#endif
#else
vec3 s=sqrt(f0);vec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);return square(t);
#endif
}
#endif
#ifdef IRIDESCENCE
const mat3 XYZ_TO_REC709=mat3(
3.2404542,-0.9692660, 0.0556434,
-1.5371385, 1.8760108,-0.2040259,
-0.4985314, 0.0415560, 1.0572252
);vec3 getIORTfromAirToSurfaceR0(vec3 f0) {vec3 sqrtF0=sqrt(f0);return (1.+sqrtF0)/(1.-sqrtF0);}
vec3 getR0fromIORs(vec3 iorT,float iorI) {return square((iorT-vec3(iorI))/(iorT+vec3(iorI)));}
float getR0fromIORs(float iorT,float iorI) {return square((iorT-iorI)/(iorT+iorI));}
vec3 evalSensitivity(float opd,vec3 shift) {float phase=2.0*PI*opd*1.0e-9;const vec3 val=vec3(5.4856e-13,4.4201e-13,5.2481e-13);const vec3 pos=vec3(1.6810e+06,1.7953e+06,2.2084e+06);const vec3 var=vec3(4.3278e+09,9.3046e+09,6.6121e+09);vec3 xyz=val*sqrt(2.0*PI*var)*cos(pos*phase+shift)*exp(-square(phase)*var);xyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));xyz/=1.0685e-7;vec3 srgb=XYZ_TO_REC709*xyz;return srgb;}
vec3 evalIridescence(float outsideIOR,float eta2,float cosTheta1,float thinFilmThickness,vec3 baseF0) {vec3 I=vec3(1.0);float iridescenceIOR=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));float sinTheta2Sq=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));float cosTheta2Sq=1.0-sinTheta2Sq;if (cosTheta2Sq<0.0) {return I;}
float cosTheta2=sqrt(cosTheta2Sq);float R0=getR0fromIORs(iridescenceIOR,outsideIOR);float R12=fresnelSchlickGGX(cosTheta1,R0,1.);float R21=R12;float T121=1.0-R12;float phi12=0.0;if (iridescenceIOR<outsideIOR) phi12=PI;float phi21=PI-phi12;vec3 baseIOR=getIORTfromAirToSurfaceR0(clamp(baseF0,0.0,0.9999)); 
vec3 R1=getR0fromIORs(baseIOR,iridescenceIOR);vec3 R23=fresnelSchlickGGX(cosTheta2,R1,vec3(1.));vec3 phi23=vec3(0.0);if (baseIOR[0]<iridescenceIOR) phi23[0]=PI;if (baseIOR[1]<iridescenceIOR) phi23[1]=PI;if (baseIOR[2]<iridescenceIOR) phi23[2]=PI;float opd=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;vec3 phi=vec3(phi21)+phi23;vec3 R123=clamp(R12*R23,1e-5,0.9999);vec3 r123=sqrt(R123);vec3 Rs=square(T121)*R23/(vec3(1.0)-R123);vec3 C0=R12+Rs;I=C0;vec3 Cm=Rs-T121;for (int m=1; m<=2; ++m)
{Cm*=r123;vec3 Sm=2.0*evalSensitivity(float(m)*opd,float(m)*phi);I+=Cm*Sm;}
return max(I,vec3(0.0));}
#endif
float normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)
{float a2=square(alphaG);float d=NdotH*NdotH*(a2-1.0)+1.0;return a2/(PI*d*d);}
#ifdef SHEEN
float normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)
{float invR=1./alphaG;float cos2h=NdotH*NdotH;float sin2h=1.-cos2h;return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);}
#endif
#ifdef ANISOTROPIC
float normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {float a2=alphaTB.x*alphaTB.y;vec3 v=vec3(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);float v2=dot(v,v);float w2=a2/v2;return a2*w2*w2*RECIPROCAL_PI;}
#endif
#ifdef BRDF_V_HEIGHT_CORRELATED
float smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {
#ifdef MOBILE
float GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);float GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);return 0.5/(GGXV+GGXL);
#else
float a2=alphaG*alphaG;float GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);float GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);return 0.5/(GGXV+GGXL);
#endif
}
#else
float smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)
{
#ifdef MOBILE
return 1.0/(dot+alphaG+(1.0-alphaG)*dot ));
#else
float alphaSquared=alphaG*alphaG;return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));
#endif
}
float smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)
{float visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);return visibility;}
#endif
#ifdef ANISOTROPIC
float smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {float lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));float lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));float v=0.5/(lambdaV+lambdaL);return v;}
#endif
#ifdef CLEARCOAT
float visibility_Kelemen(float VdotH) {return 0.25/(VdotH*VdotH); }
#endif
#ifdef SHEEN
float visibility_Ashikhmin(float NdotL,float NdotV)
{return 1./(4.*(NdotL+NdotV-NdotL*NdotV));}
/* NOT USED
#ifdef SHEEN_SOFTER
float l(float x,float alphaG)
{float oneMinusAlphaSq=(1.0-alphaG)*(1.0-alphaG);float a=mix(21.5473,25.3245,oneMinusAlphaSq);float b=mix(3.82987,3.32435,oneMinusAlphaSq);float c=mix(0.19823,0.16801,oneMinusAlphaSq);float d=mix(-1.97760,-1.27393,oneMinusAlphaSq);float e=mix(-4.32054,-4.85967,oneMinusAlphaSq);return a/(1.0+b*pow(x,c))+d*x+e;}
float lambdaSheen(float cosTheta,float alphaG)
{return abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));}
float visibility_CharlieSheen(float NdotL,float NdotV,float alphaG)
{float G=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));return G/(4.0*NdotV*NdotL);}
#endif
*/
#endif
float diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {float diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));float diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));float diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;float fresnel =
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);return fresnel/PI;}
#ifdef SS_TRANSLUCENCY
vec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {vec3 S=1./maxEps(diffusionDistance);vec3 temp=exp((-0.333333333*thickness)*S);return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);}
float computeWrappedDiffuseNdotL(float NdotL,float w) {float t=1.0+w;float invt2=1.0/square(t);return saturate((NdotL+w)*invt2);}
#endif
`},48915:(r,t,e)=>{var n=e(98519),i=(e(50851),e(56174),"pbrUboDeclaration");n.l.IncludesShadersStore[i]=`layout(std140,column_major) uniform;uniform Material {vec2 vAlbedoInfos;vec4 vAmbientInfos;vec2 vOpacityInfos;vec2 vEmissiveInfos;vec2 vLightmapInfos;vec3 vReflectivityInfos;vec2 vMicroSurfaceSamplerInfos;vec2 vReflectionInfos;vec2 vReflectionFilteringInfo;vec3 vReflectionPosition;vec3 vReflectionSize;vec3 vBumpInfos;mat4 albedoMatrix;mat4 ambientMatrix;mat4 opacityMatrix;mat4 emissiveMatrix;mat4 lightmapMatrix;mat4 reflectivityMatrix;mat4 microSurfaceSamplerMatrix;mat4 bumpMatrix;vec2 vTangentSpaceParams;mat4 reflectionMatrix;vec3 vReflectionColor;vec4 vAlbedoColor;vec4 vLightingIntensity;vec3 vReflectionMicrosurfaceInfos;float pointSize;vec4 vReflectivityColor;vec3 vEmissiveColor;vec3 vAmbientColor;vec2 vDebugMode;vec4 vMetallicReflectanceFactors;vec2 vMetallicReflectanceInfos;mat4 metallicReflectanceMatrix;vec2 vReflectanceInfos;mat4 reflectanceMatrix;vec3 vSphericalL00;vec3 vSphericalL1_1;vec3 vSphericalL10;vec3 vSphericalL11;vec3 vSphericalL2_2;vec3 vSphericalL2_1;vec3 vSphericalL20;vec3 vSphericalL21;vec3 vSphericalL22;vec3 vSphericalX;vec3 vSphericalY;vec3 vSphericalZ;vec3 vSphericalXX_ZZ;vec3 vSphericalYY_ZZ;vec3 vSphericalZZ;vec3 vSphericalXY;vec3 vSphericalYZ;vec3 vSphericalZX;
#define ADDITIONAL_UBO_DECLARATION
};
#include<sceneUboDeclaration>
#include<meshUboDeclaration>
`},52226:(r,t,e)=>{e(98519).l.IncludesShadersStore.pointCloudVertex=`#if defined(POINTSIZE) && !defined(WEBGPU)
gl_PointSize=pointSize;
#endif
`},42107:(r,t,e)=>{e(98519).l.IncludesShadersStore.prePassDeclaration=`#ifdef PREPASS
#extension GL_EXT_draw_buffers : require
layout(location=0) out highp vec4 glFragData[{X}];highp vec4 gl_FragColor;
#ifdef PREPASS_LOCAL_POSITION
varying highp vec3 vPosition;
#endif
#ifdef PREPASS_DEPTH
varying highp vec3 vViewPos;
#endif
#if defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR)
varying highp vec4 vCurrentPosition;varying highp vec4 vPreviousPosition;
#endif
#endif
`},7761:(r,t,e)=>{e(98519).l.IncludesShadersStore.prePassVertex=`#ifdef PREPASS_DEPTH
vViewPos=(view*worldPos).rgb;
#endif
#ifdef PREPASS_LOCAL_POSITION
vPosition=positionUpdated.xyz;
#endif
#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED) || defined(PREPASS_VELOCITY_LINEAR)
vCurrentPosition=viewProjection*worldPos;
#if NUM_BONE_INFLUENCERS>0
mat4 previousInfluence;previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
previousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];
#endif 
#if NUM_BONE_INFLUENCERS>2
previousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];
#endif 
#if NUM_BONE_INFLUENCERS>3
previousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif 
#if NUM_BONE_INFLUENCERS>5
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif 
#if NUM_BONE_INFLUENCERS>6
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif 
#if NUM_BONE_INFLUENCERS>7
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
vPreviousPosition=previousViewProjection*finalPreviousWorld*previousInfluence*vec4(positionUpdated,1.0);
#else
vPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);
#endif
#endif
`},60965:(r,t,e)=>{e(98519).l.IncludesShadersStore.prePassVertexDeclaration=`#ifdef PREPASS
#ifdef PREPASS_LOCAL_POSITION
varying vec3 vPosition;
#endif
#ifdef PREPASS_DEPTH
varying vec3 vViewPos;
#endif
#if defined(PREPASS_VELOCITY) || defined(PREPASS_VELOCITY_LINEAR)
uniform mat4 previousViewProjection;varying vec4 vCurrentPosition;varying vec4 vPreviousPosition;
#endif
#endif
`},40150:(r,t,e)=>{e.r(t),e.d(t,{reflectionFunction:()=>o});var n="reflectionFunction",i=`vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{float lon=atan(direction.z,direction.x);float lat=acos(direction.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(s,t,0); }
vec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{float lon=atan(direction.z,direction.x);float lat=acos(direction.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(1.0-s,t,0); }
vec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{vec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);vec3 r=normalize(reflect(cameraToVertex,worldNormal));r=vec3(reflectionMatrix*vec4(r,0));float lon=atan(r.z,r.x);float lat=acos(r.y);vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;float s=sphereCoords.x*0.5+0.5;float t=sphereCoords.y;return vec3(s,t,0);}
vec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)
{vec3 viewDir=normalize(vec3(view*worldPos));vec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));vec3 r=reflect(viewDir,viewNormal);r=vec3(reflectionMatrix*vec4(r,0));r.z=r.z-1.0;float m=2.0*length(r);return vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);}
vec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{vec3 viewDir=worldPos.xyz-eyePosition;vec3 coords=normalize(reflect(viewDir,worldNormal));return vec3(reflectionMatrix*vec4(coords,1));}
vec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{vec3 viewDir=normalize(worldPos.xyz-eyePosition);vec3 coords=reflect(viewDir,worldNormal);coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;}
vec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)
{vec3 viewDir=normalize(worldPos.xyz-eyePosition);vec3 coords=reflect(viewDir,worldNormal);coords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;}
vec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)
{return vec3(reflectionMatrix*(view*worldPos));}
vec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)
{return vec3(reflectionMatrix*vec4(positionW,1.));}
#ifdef REFLECTION
vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)
{
#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);return computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);return computeFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR
return computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SPHERICAL
return computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_PLANAR
return computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_CUBIC
#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC
return computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);
#else
return computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#endif
#ifdef REFLECTIONMAP_PROJECTION
return computeProjectionCoords(worldPos,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SKYBOX
return computeSkyBoxCoords(vPositionUVW,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_EXPLICIT
return vec3(0,0,0);
#endif
}
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},37755:(r,t,e)=>{e(98519).l.IncludesShadersStore.samplerFragmentDeclaration=`#ifdef _DEFINENAME_
#if _DEFINENAME_DIRECTUV==1
#define v_VARYINGNAME_UV vMainUV1
#elif _DEFINENAME_DIRECTUV==2
#define v_VARYINGNAME_UV vMainUV2
#elif _DEFINENAME_DIRECTUV==3
#define v_VARYINGNAME_UV vMainUV3
#elif _DEFINENAME_DIRECTUV==4
#define v_VARYINGNAME_UV vMainUV4
#elif _DEFINENAME_DIRECTUV==5
#define v_VARYINGNAME_UV vMainUV5
#elif _DEFINENAME_DIRECTUV==6
#define v_VARYINGNAME_UV vMainUV6
#else
varying vec2 v_VARYINGNAME_UV;
#endif
uniform sampler2D _SAMPLERNAME_Sampler;
#endif
`},60581:(r,t,e)=>{e(98519).l.IncludesShadersStore.samplerVertexDeclaration=`#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0
varying vec2 v_VARYINGNAME_UV;
#endif
`},81067:(r,t,e)=>{e(98519).l.IncludesShadersStore.samplerVertexImplementation=`#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0
if (v_INFONAME_==0.)
{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uvUpdated,1.0,0.0));}
#ifdef UV2
else if (v_INFONAME_==1.)
{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv2,1.0,0.0));}
#endif
#ifdef UV3
else if (v_INFONAME_==2.)
{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv3,1.0,0.0));}
#endif
#ifdef UV4
else if (v_INFONAME_==3.)
{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv4,1.0,0.0));}
#endif
#ifdef UV5
else if (v_INFONAME_==4.)
{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv5,1.0,0.0));}
#endif
#ifdef UV6
else if (v_INFONAME_==5.)
{v_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv6,1.0,0.0));}
#endif
#endif
`},50851:(r,t,e)=>{e(98519).l.IncludesShadersStore.sceneUboDeclaration=`layout(std140,column_major) uniform;uniform Scene {mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif 
mat4 view;mat4 projection;vec4 vEyePosition;};
`},93664:(r,t,e)=>{e(98519).l.IncludesShadersStore.screenSpaceRayTrace=`float distanceSquared(vec2 a,vec2 b) { a-=b; return dot(a,a); }
/**
param csOrigin Camera-space ray origin,which must be 
within the view volume and must have z>0.01 and project within the valid screen rectangle
param csDirection Unit length camera-space ray direction
param projectToPixelMatrix A projection matrix that maps to **pixel** coordinates 
(**not** [-1,+1] normalized device coordinates).
param csZBuffer The camera-space Z buffer
param csZBufferSize Dimensions of csZBuffer
param csZThickness Camera space csZThickness to ascribe to each pixel in the depth buffer
param nearPlaneZ Positive number. Doesn't have to be THE actual near plane,just a reasonable value
for clipping rays headed towards the camera
param stride Step in horizontal or vertical pixels between samples. This is a float
because integer math is slow on GPUs,but should be set to an integer>=1
param jitterFraction Number between 0 and 1 for how far to bump the ray in stride units
to conceal banding artifacts,plus the stride ray offset.
param maxSteps Maximum number of iterations. Higher gives better images but may be slow
param maxRayTraceDistance Maximum camera-space distance to trace before returning a miss
param selfCollisionNumSkip Number of steps to skip at start when raytracing to avoid self collisions.
1 is a reasonable value,depending on the scene you may need to set this value to 2
param hitPixel Pixel coordinates of the first intersection with the scene
param numIterations number of iterations performed
param csHitPoint Camera space location of the ray hit
*/
#define inline
bool traceScreenSpaceRay1(
vec3 csOrigin,
vec3 csDirection,
mat4 projectToPixelMatrix,
sampler2D csZBuffer,
vec2 csZBufferSize,
#ifdef SSRAYTRACE_USE_BACK_DEPTHBUFFER
sampler2D csZBackBuffer,
float csZBackSizeFactor,
#endif
float csZThickness,
float nearPlaneZ,
float stride,
float jitterFraction,
float maxSteps,
float maxRayTraceDistance,
float selfCollisionNumSkip,
out vec2 startPixel,
out vec2 hitPixel,
out vec3 csHitPoint,
out float numIterations
#ifdef SSRAYTRACE_DEBUG
,out vec3 debugColor
#endif
)
{
#ifdef SSRAYTRACE_RIGHT_HANDED_SCENE
float rayLength=(csOrigin.z+csDirection.z*maxRayTraceDistance)>-nearPlaneZ ? (-nearPlaneZ-csOrigin.z)/csDirection.z : maxRayTraceDistance;
#else
float rayLength=(csOrigin.z+csDirection.z*maxRayTraceDistance)<nearPlaneZ ? (nearPlaneZ-csOrigin.z)/csDirection.z : maxRayTraceDistance;
#endif
vec3 csEndPoint=csOrigin+csDirection*rayLength;hitPixel=vec2(-1.0,-1.0);vec4 H0=projectToPixelMatrix*vec4(csOrigin,1.0);vec4 H1=projectToPixelMatrix*vec4(csEndPoint,1.0);float k0=1.0/H0.w;float k1=1.0/H1.w;vec3 Q0=csOrigin*k0;vec3 Q1=csEndPoint*k1;vec2 P0=H0.xy*k0;vec2 P1=H1.xy*k1;
#ifdef SSRAYTRACE_CLIP_TO_FRUSTUM
float xMax=csZBufferSize.x-0.5,xMin=0.5,yMax=csZBufferSize.y-0.5,yMin=0.5;float alpha=0.0;if ((P1.y>yMax) || (P1.y<yMin)) {alpha=(P1.y-((P1.y>yMax) ? yMax : yMin))/(P1.y-P0.y);}
if ((P1.x>xMax) || (P1.x<xMin)) {alpha=max(alpha,(P1.x-((P1.x>xMax) ? xMax : xMin))/(P1.x-P0.x));}
P1=mix(P1,P0,alpha); k1=mix(k1,k0,alpha); Q1=mix(Q1,Q0,alpha);
#endif
P1+=vec2((distanceSquared(P0,P1)<0.0001) ? 0.01 : 0.0);vec2 delta=P1-P0;bool permute=false;if (abs(delta.x)<abs(delta.y)) { 
permute=true;delta=delta.yx;P0=P0.yx;P1=P1.yx; }
float stepDirection=sign(delta.x);float invdx=stepDirection/delta.x;vec2 dP=vec2(stepDirection,delta.y*invdx);vec3 dQ=(Q1-Q0)*invdx;float dk=(k1-k0)*invdx;float zMin=min(csEndPoint.z,csOrigin.z);float zMax=max(csEndPoint.z,csOrigin.z);dP*=stride; dQ*=stride; dk*=stride;P0+=dP*jitterFraction; Q0+=dQ*jitterFraction; k0+=dk*jitterFraction;vec4 pqk=vec4(P0,Q0.z,k0);vec4 dPQK=vec4(dP,dQ.z,dk);startPixel=permute ? P0.yx : P0.xy;float prevZMaxEstimate=csOrigin.z;float rayZMin=prevZMaxEstimate,rayZMax=prevZMaxEstimate;float sceneZMax=rayZMax+1e4;float end=P1.x*stepDirection;bool hit=false;float stepCount;for (stepCount=0.0;stepCount<=selfCollisionNumSkip ||
(pqk.x*stepDirection)<=end &&
stepCount<maxSteps &&
!hit &&
sceneZMax != 0.0; 
pqk+=dPQK,++stepCount)
{hitPixel=permute ? pqk.yx : pqk.xy;rayZMin=prevZMaxEstimate;rayZMax=(dPQK.z*0.5+pqk.z)/(dPQK.w*0.5+pqk.w);rayZMax=clamp(rayZMax,zMin,zMax);prevZMaxEstimate=rayZMax;if (rayZMin>rayZMax) { 
float t=rayZMin; rayZMin=rayZMax; rayZMax=t;}
sceneZMax=texelFetch(csZBuffer,ivec2(hitPixel),0).r;
#ifdef SSRAYTRACE_RIGHT_HANDED_SCENE
#ifdef SSRAYTRACE_USE_BACK_DEPTHBUFFER
float sceneBackZ=texelFetch(csZBackBuffer,ivec2(hitPixel/csZBackSizeFactor),0).r;hit=(rayZMax>=sceneBackZ-csZThickness) && (rayZMin<=sceneZMax);
#else
hit=(rayZMax>=sceneZMax-csZThickness) && (rayZMin<=sceneZMax);
#endif
#else
#ifdef SSRAYTRACE_USE_BACK_DEPTHBUFFER
float sceneBackZ=texelFetch(csZBackBuffer,ivec2(hitPixel/csZBackSizeFactor),0).r;hit=(rayZMin<=sceneBackZ+csZThickness) && (rayZMax>=sceneZMax) && (sceneZMax != 0.0);
#else
hit=(rayZMin<=sceneZMax+csZThickness) && (rayZMax>=sceneZMax);
#endif
#endif
}
pqk-=dPQK;stepCount-=1.0;if (((pqk.x+dPQK.x)*stepDirection)>end || (stepCount+1.0)>=maxSteps || sceneZMax==0.0) {hit=false;}
#ifdef SSRAYTRACE_ENABLE_REFINEMENT
if (stride>1.0 && hit) {pqk-=dPQK;stepCount-=1.0;float invStride=1.0/stride;dPQK*=invStride;float refinementStepCount=0.0;prevZMaxEstimate=pqk.z/pqk.w;rayZMax=prevZMaxEstimate;sceneZMax=rayZMax+1e7;for (;refinementStepCount<=1.0 ||
(refinementStepCount<=stride*1.4) &&
(rayZMax<sceneZMax) && (sceneZMax != 0.0);pqk+=dPQK,refinementStepCount+=1.0)
{rayZMin=prevZMaxEstimate;rayZMax=(dPQK.z*0.5+pqk.z)/(dPQK.w*0.5+pqk.w);rayZMax=clamp(rayZMax,zMin,zMax);prevZMaxEstimate=rayZMax;rayZMax=max(rayZMax,rayZMin);hitPixel=permute ? pqk.yx : pqk.xy;sceneZMax=texelFetch(csZBuffer,ivec2(hitPixel),0).r;}
pqk-=dPQK;refinementStepCount-=1.0;stepCount+=refinementStepCount/stride;}
#endif
Q0.xy+=dQ.xy*stepCount;Q0.z=pqk.z;csHitPoint=Q0/pqk.w;numIterations=stepCount+1.0;
#ifdef SSRAYTRACE_DEBUG
if (((pqk.x+dPQK.x)*stepDirection)>end) {debugColor=vec3(0,0,1);} else if ((stepCount+1.0)>=maxSteps) {debugColor=vec3(1,0,0);} else if (sceneZMax==0.0) {debugColor=vec3(1,1,0);} else {debugColor=vec3(0,stepCount/maxSteps,0);}
#endif
return hit;}
/**
texCoord: in the [0,1] range
depth: depth in view space (range [znear,zfar]])
*/
vec3 computeViewPosFromUVDepth(vec2 texCoord,float depth,mat4 projection,mat4 invProjectionMatrix) {vec4 ndc;ndc.xy=texCoord*2.0-1.0;
#ifdef SSRAYTRACE_RIGHT_HANDED_SCENE
#ifdef ORTHOGRAPHIC_CAMERA
ndc.z=-projection[2].z*depth+projection[3].z;
#else
ndc.z=-projection[2].z-projection[3].z/depth;
#endif
#else
#ifdef ORTHOGRAPHIC_CAMERA
ndc.z=projection[2].z*depth+projection[3].z;
#else
ndc.z=projection[2].z+projection[3].z/depth;
#endif
#endif
ndc.w=1.0;vec4 eyePos=invProjectionMatrix*ndc;eyePos.xyz/=eyePos.w;return eyePos.xyz;}
`},29313:(r,t,e)=>{e.r(t),e.d(t,{shadowMapFragment:()=>o});var n="shadowMapFragment",i=`float depthSM=vDepthMetricSM;
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1
#if SM_USEDISTANCE==1
depthSM=(length(vPositionWSM-lightDataSM)+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;
#else
#ifdef USE_REVERSE_DEPTHBUFFER
depthSM=(-zSM+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;
#else
depthSM=(zSM+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;
#endif
#endif
#ifdef USE_REVERSE_DEPTHBUFFER
gl_FragDepth=clamp(1.0-depthSM,0.0,1.0);
#else
gl_FragDepth=clamp(depthSM,0.0,1.0); 
#endif
#elif SM_USEDISTANCE==1
depthSM=(length(vPositionWSM-lightDataSM)+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;
#endif
#if SM_ESM==1
depthSM=clamp(exp(-min(87.,biasAndScaleSM.z*depthSM)),0.,1.);
#endif
#if SM_FLOAT==1
gl_FragColor=vec4(depthSM,1.0,1.0,1.0);
#else
gl_FragColor=pack(depthSM);
#endif
return;`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},61195:(r,t,e)=>{e.r(t),e.d(t,{shadowMapFragmentSoftTransparentShadow:()=>o});var n="shadowMapFragmentSoftTransparentShadow",i=`#if SM_SOFTTRANSPARENTSHADOW==1
if ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM.x*alpha) discard;
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},62371:(r,t,e)=>{e.r(t),e.d(t,{shadowMapVertexMetric:()=>o});var n="shadowMapVertexMetric",i=`#if SM_USEDISTANCE==1
vPositionWSM=worldPos.xyz;
#endif
#if SM_DEPTHTEXTURE==1
#ifdef IS_NDC_HALF_ZRANGE
#define BIASFACTOR 0.5
#else
#define BIASFACTOR 1.0
#endif
#ifdef USE_REVERSE_DEPTHBUFFER
gl_Position.z-=biasAndScaleSM.x*gl_Position.w*BIASFACTOR;
#else
gl_Position.z+=biasAndScaleSM.x*gl_Position.w*BIASFACTOR;
#endif
#endif
#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1
zSM=gl_Position.z;gl_Position.z=0.0;
#elif SM_USEDISTANCE==0
#ifdef USE_REVERSE_DEPTHBUFFER
vDepthMetricSM=(-gl_Position.z+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;
#else
vDepthMetricSM=(gl_Position.z+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;
#endif
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},46837:(r,t,e)=>{e.r(t),e.d(t,{shadowsFragmentFunctions:()=>o});var n="shadowsFragmentFunctions",i=`#ifdef SHADOWS
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
#define TEXTUREFUNC(s,c,l) texture2DLodEXT(s,c,l)
#else
#define TEXTUREFUNC(s,c,b) texture2D(s,c,b)
#endif
#ifndef SHADOWFLOAT
float unpack(vec4 color)
{const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(color,bit_shift);}
#endif
float computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)
{float mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));return mix(value,1.0,mask);}
#define inline
float computeShadowCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)
{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);depth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadow=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadow=textureCube(shadowSampler,directionToLight).x;
#endif
return depth>shadow ? darkness : 1.0;}
#define inline
float computeShadowWithPoissonSamplingCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)
{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);depth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;float visibility=1.;vec3 poissonDisk[4];poissonDisk[0]=vec3(-1.0,1.0,-1.0);poissonDisk[1]=vec3(1.0,-1.0,-1.0);poissonDisk[2]=vec3(-1.0,-1.0,-1.0);poissonDisk[3]=vec3(1.0,-1.0,1.0);
#ifndef SHADOWFLOAT
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;
#else
if (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;if (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;
#endif
return min(1.0,visibility+darkness);}
#define inline
float computeShadowWithESMCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);float shadowPixelDepth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);return esm;}
#define inline
float computeShadowWithCloseESMCube(vec3 worldPos,vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{vec3 directionToLight=worldPos-lightPosition;float depth=length(directionToLight);depth=(depth+depthValues.x)/(depthValues.y);float shadowPixelDepth=clamp(depth,0.,1.0);directionToLight=normalize(directionToLight);directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);return esm;}
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
#define inline
float computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);vec3 uvLayer=vec3(uv.x,uv.y,layer);float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uvLayer));
#else
float shadow=texture2D(shadowSampler,uvLayer).x;
#endif
return shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;}
#endif
#define inline
float computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{return 1.0;}
else
{float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(TEXTUREFUNC(shadowSampler,uv,0.));
#else
float shadow=TEXTUREFUNC(shadowSampler,uv,0.).x;
#endif
return shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;}}
#define inline
float computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{return 1.0;}
else
{float shadowPixelDepth=clamp(depthMetric,0.,1.0);float visibility=1.;vec2 poissonDisk[4];poissonDisk[0]=vec2(-0.94201624,-0.39906216);poissonDisk[1]=vec2(0.94558609,-0.76890725);poissonDisk[2]=vec2(-0.094184101,-0.92938870);poissonDisk[3]=vec2(0.34495938,0.29387760);
#ifndef SHADOWFLOAT
if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[0]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[1]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[2]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;if (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[3]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;
#else
if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[0]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[1]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[2]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;if (TEXTUREFUNC(shadowSampler,uv+poissonDisk[3]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;
#endif
return computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);}}
#define inline
float computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{return 1.0;}
else
{float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(TEXTUREFUNC(shadowSampler,uv,0.));
#else
float shadowMapSample=TEXTUREFUNC(shadowSampler,uv,0.).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);}}
#define inline
float computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec2 uv=0.5*clipSpace.xy+vec2(0.5);if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{return 1.0;}
else
{float shadowPixelDepth=clamp(depthMetric,0.,1.0); 
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(TEXTUREFUNC(shadowSampler,uv,0.));
#else
float shadowMapSample=TEXTUREFUNC(shadowSampler,uv,0.).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);}}
#ifdef IS_NDC_HALF_ZRANGE
#define ZINCLIP clipSpace.z
#else
#define ZINCLIP uvDepth.z
#endif
#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)
#define GREATEST_LESS_THAN_ONE 0.99999994
#define DISABLE_UNIFORMITY_ANALYSIS
#define inline
float computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);float shadow=texture2D(shadowSampler,uvDepthLayer);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}
#define inline
float computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; 
uv+=0.5; 
vec2 st=fract(uv); 
vec2 base_uv=floor(uv)-0.5; 
base_uv*=shadowMapSizeAndInverse.y; 
vec2 uvw0=3.-2.*st;vec2 uvw1=1.+2.*st;vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));shadow=shadow/16.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}
#define inline
float computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; 
uv+=0.5; 
vec2 st=fract(uv); 
vec2 base_uv=floor(uv)-0.5; 
base_uv*=shadowMapSizeAndInverse.y; 
vec2 uvw0=4.-3.*st;vec2 uvw1=vec2(7.);vec2 uvw2=1.+3.*st;vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));shadow=shadow/144.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}
#define inline
float computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}
else
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;float shadow=TEXTUREFUNC(shadowSampler,uvDepth,0.);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}
#define inline
float computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}
else
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; 
uv+=0.5; 
vec2 st=fract(uv); 
vec2 base_uv=floor(uv)-0.5; 
base_uv*=shadowMapSizeAndInverse.y; 
vec2 uvw0=3.-2.*st;vec2 uvw1=1.+2.*st;vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z),0.);shadow+=uvw1.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z),0.);shadow+=uvw0.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z),0.);shadow+=uvw1.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z),0.);shadow=shadow/16.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}
#define inline
float computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}
else
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; 
uv+=0.5; 
vec2 st=fract(uv); 
vec2 base_uv=floor(uv)-0.5; 
base_uv*=shadowMapSizeAndInverse.y; 
vec2 uvw0=4.-3.*st;vec2 uvw1=vec2(7.);vec2 uvw2=1.+3.*st;vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;float shadow=0.;shadow+=uvw0.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z),0.);shadow+=uvw1.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z),0.);shadow+=uvw2.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z),0.);shadow+=uvw0.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z),0.);shadow+=uvw1.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z),0.);shadow+=uvw2.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z),0.);shadow+=uvw0.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z),0.);shadow+=uvw1.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z),0.);shadow+=uvw2.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z),0.);shadow=shadow/144.;shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}
const vec3 PoissonSamplers32[64]=vec3[64](
vec3(0.06407013,0.05409927,0.),
vec3(0.7366577,0.5789394,0.),
vec3(-0.6270542,-0.5320278,0.),
vec3(-0.4096107,0.8411095,0.),
vec3(0.6849564,-0.4990818,0.),
vec3(-0.874181,-0.04579735,0.),
vec3(0.9989998,0.0009880066,0.),
vec3(-0.004920578,-0.9151649,0.),
vec3(0.1805763,0.9747483,0.),
vec3(-0.2138451,0.2635818,0.),
vec3(0.109845,0.3884785,0.),
vec3(0.06876755,-0.3581074,0.),
vec3(0.374073,-0.7661266,0.),
vec3(0.3079132,-0.1216763,0.),
vec3(-0.3794335,-0.8271583,0.),
vec3(-0.203878,-0.07715034,0.),
vec3(0.5912697,0.1469799,0.),
vec3(-0.88069,0.3031784,0.),
vec3(0.5040108,0.8283722,0.),
vec3(-0.5844124,0.5494877,0.),
vec3(0.6017799,-0.1726654,0.),
vec3(-0.5554981,0.1559997,0.),
vec3(-0.3016369,-0.3900928,0.),
vec3(-0.5550632,-0.1723762,0.),
vec3(0.925029,0.2995041,0.),
vec3(-0.2473137,0.5538505,0.),
vec3(0.9183037,-0.2862392,0.),
vec3(0.2469421,0.6718712,0.),
vec3(0.3916397,-0.4328209,0.),
vec3(-0.03576927,-0.6220032,0.),
vec3(-0.04661255,0.7995201,0.),
vec3(0.4402924,0.3640312,0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.),
vec3(0.)
);const vec3 PoissonSamplers64[64]=vec3[64](
vec3(-0.613392,0.617481,0.),
vec3(0.170019,-0.040254,0.),
vec3(-0.299417,0.791925,0.),
vec3(0.645680,0.493210,0.),
vec3(-0.651784,0.717887,0.),
vec3(0.421003,0.027070,0.),
vec3(-0.817194,-0.271096,0.),
vec3(-0.705374,-0.668203,0.),
vec3(0.977050,-0.108615,0.),
vec3(0.063326,0.142369,0.),
vec3(0.203528,0.214331,0.),
vec3(-0.667531,0.326090,0.),
vec3(-0.098422,-0.295755,0.),
vec3(-0.885922,0.215369,0.),
vec3(0.566637,0.605213,0.),
vec3(0.039766,-0.396100,0.),
vec3(0.751946,0.453352,0.),
vec3(0.078707,-0.715323,0.),
vec3(-0.075838,-0.529344,0.),
vec3(0.724479,-0.580798,0.),
vec3(0.222999,-0.215125,0.),
vec3(-0.467574,-0.405438,0.),
vec3(-0.248268,-0.814753,0.),
vec3(0.354411,-0.887570,0.),
vec3(0.175817,0.382366,0.),
vec3(0.487472,-0.063082,0.),
vec3(-0.084078,0.898312,0.),
vec3(0.488876,-0.783441,0.),
vec3(0.470016,0.217933,0.),
vec3(-0.696890,-0.549791,0.),
vec3(-0.149693,0.605762,0.),
vec3(0.034211,0.979980,0.),
vec3(0.503098,-0.308878,0.),
vec3(-0.016205,-0.872921,0.),
vec3(0.385784,-0.393902,0.),
vec3(-0.146886,-0.859249,0.),
vec3(0.643361,0.164098,0.),
vec3(0.634388,-0.049471,0.),
vec3(-0.688894,0.007843,0.),
vec3(0.464034,-0.188818,0.),
vec3(-0.440840,0.137486,0.),
vec3(0.364483,0.511704,0.),
vec3(0.034028,0.325968,0.),
vec3(0.099094,-0.308023,0.),
vec3(0.693960,-0.366253,0.),
vec3(0.678884,-0.204688,0.),
vec3(0.001801,0.780328,0.),
vec3(0.145177,-0.898984,0.),
vec3(0.062655,-0.611866,0.),
vec3(0.315226,-0.604297,0.),
vec3(-0.780145,0.486251,0.),
vec3(-0.371868,0.882138,0.),
vec3(0.200476,0.494430,0.),
vec3(-0.494552,-0.711051,0.),
vec3(0.612476,0.705252,0.),
vec3(-0.578845,-0.768792,0.),
vec3(-0.772454,-0.090976,0.),
vec3(0.504440,0.372295,0.),
vec3(0.155736,0.065157,0.),
vec3(0.391522,0.849605,0.),
vec3(-0.620106,-0.328104,0.),
vec3(0.789239,-0.419965,0.),
vec3(-0.545396,0.538133,0.),
vec3(-0.178564,-0.596057,0.)
);
#define inline
float computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);float blockerDepth=0.0;float sumBlockerDepth=0.0;float numBlocker=0.0;for (int i=0; i<searchTapCount; i ++) {blockerDepth=texture2D(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;if (blockerDepth<depthMetric) {sumBlockerDepth+=blockerDepth;numBlocker++;}}
float avgBlockerDepth=sumBlockerDepth/numBlocker;float AAOffset=shadowMapSizeInverse*10.;float penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);vec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);float random=getRand(vPositionFromLight.xy);float rotationAngle=random*3.1415926;vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));float shadow=0.;for (int i=0; i<pcfTapCount; i++) {vec4 offset=vec4(poissonSamplers[i],0.);offset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);shadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);}
shadow/=float(pcfTapCount);shadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));shadow=mix(darkness,1.,shadow);if (numBlocker<1.0) {return 1.0;}
else
{return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}
#define inline
float computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)
{if (depthMetric>1.0 || depthMetric<0.0) {return 1.0;}
else
{vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));uvDepth.z=ZINCLIP;float blockerDepth=0.0;float sumBlockerDepth=0.0;float numBlocker=0.0;for (int i=0; i<searchTapCount; i ++) {blockerDepth=TEXTUREFUNC(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy),0.).r;if (blockerDepth<depthMetric) {sumBlockerDepth+=blockerDepth;numBlocker++;}}
if (numBlocker<1.0) {return 1.0;}
else
{float avgBlockerDepth=sumBlockerDepth/numBlocker;float AAOffset=shadowMapSizeInverse*10.;float penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);float filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;float random=getRand(vPositionFromLight.xy);float rotationAngle=random*3.1415926;vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));float shadow=0.;for (int i=0; i<pcfTapCount; i++) {vec3 offset=poissonSamplers[i];offset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);shadow+=TEXTUREFUNC(shadowSampler,uvDepth+offset*filterRadius,0.);}
shadow/=float(pcfTapCount);shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);shadow=mix(darkness,1.,shadow);return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);}}}
#define inline
float computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);}
#define inline
float computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);}
#define inline
float computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);}
#define inline
float computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}
#define inline
float computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}
#define inline
float computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);}
#endif
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},62136:(r,t,e)=>{e.r(t),e.d(t,{shadowsVertex:()=>o});var n="shadowsVertex",i=`#ifdef SHADOWS
#if defined(SHADOWCSM{X})
vPositionFromCamera{X}=view*worldPos;for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {vPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;
#ifdef USE_REVERSE_DEPTHBUFFER
vDepthMetric{X}[i]=(-vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;
#else
vDepthMetric{X}[i]=(vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;
#endif
}
#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})
vPositionFromLight{X}=lightMatrix{X}*worldPos;
#ifdef USE_REVERSE_DEPTHBUFFER
vDepthMetric{X}=(-vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;
#else
vDepthMetric{X}=(vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;
#endif
#endif
#endif
`;e(98519).l.IncludesShadersStore[n]=i;var o={name:n,shader:i}},5447:(r,t,e)=>{e(98519).l.IncludesShadersStore.subSurfaceScatteringFunctions=`bool testLightingForSSS(float diffusionProfile)
{return diffusionProfile<1.;}`},77976:(r,t,e)=>{e(98519).l.IncludesShadersStore.uvAttributeDeclaration=`#ifdef UV{X}
attribute vec2 uv{X};
#endif
`},45858:(r,t,e)=>{e(98519).l.IncludesShadersStore.uvVariableDeclaration=`#if !defined(UV{X}) && defined(MAINUV{X})
vec2 uv{X}=vec2(0.,0.);
#endif
#ifdef MAINUV{X}
vMainUV{X}=uv{X};
#endif
`},45812:(r,t,e)=>{e(98519).l.IncludesShadersStore.vertexColorMixing=`#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)
vColor=vec4(1.0);
#ifdef VERTEXCOLOR
#ifdef VERTEXALPHA
vColor*=color;
#else
vColor.rgb*=color.rgb;
#endif
#endif
#ifdef INSTANCESCOLOR
vColor*=instanceColor;
#endif
#endif
`},10534:(r,t,e)=>{e.r(t),e.d(t,{anaglyphPixelShader:()=>o});var n="anaglyphPixelShader",i=`varying vec2 vUV;uniform sampler2D textureSampler;uniform sampler2D leftSampler;
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void)
{vec4 leftFrag=texture2D(leftSampler,vUV);leftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);vec4 rightFrag=texture2D(textureSampler,vUV);rightFrag=vec4(rightFrag.r,1.0,1.0,1.0);gl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);}`;e(98519).l.ShadersStore[n]=i;var o={name:n,shader:i}},7590:(r,t,e)=>{e.r(t),e.d(t,{backgroundPixelShader:()=>a});var n=e(98519);n.l.IncludesShadersStore.backgroundFragmentDeclaration=`uniform vec4 vEyePosition;uniform vec4 vPrimaryColor;
#ifdef USEHIGHLIGHTANDSHADOWCOLORS
uniform vec4 vPrimaryColorShadow;
#endif
uniform float shadowLevel;uniform float alpha;
#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef REFLECTION
uniform vec2 vReflectionInfos;uniform mat4 reflectionMatrix;uniform vec3 vReflectionMicrosurfaceInfos;
#endif
#if defined(REFLECTIONFRESNEL) || defined(OPACITYFRESNEL)
uniform vec3 vBackgroundCenter;
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 vReflectionControl;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif
#ifdef PROJECTED_GROUND
uniform vec2 projectedGroundInfos;
#endif
`,e(27947),e(75334),e(40150),e(59581),e(87283),e(32823),e(54409),e(46837),e(40688),e(59262),e(27003),e(52767),e(39643),e(7363),e(13088),e(86343);var i="backgroundPixelShader",o=`#ifdef TEXTURELODSUPPORT
#extension GL_EXT_shader_texture_lod : enable
#endif
precision highp float;
#include<__decl__backgroundFragment>
#include<helperFunctions>
varying vec3 vPositionW;
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif 
#ifdef MAINUV2 
varying vec2 vMainUV2; 
#endif 
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef DIFFUSE
#if DIFFUSEDIRECTUV==1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV==2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif
#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
#define sampleReflection(s,c) textureCube(s,c)
uniform samplerCube reflectionSampler;
#ifdef TEXTURELODSUPPORT
#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;uniform samplerCube reflectionSamplerHigh;
#endif
#else
#define sampleReflection(s,c) texture2D(s,c)
uniform sampler2D reflectionSampler;
#ifdef TEXTURELODSUPPORT
#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)
#else
uniform samplerCube reflectionSamplerLow;uniform samplerCube reflectionSamplerHigh;
#endif
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif
#ifndef FROMLINEARSPACE
#define FROMLINEARSPACE;
#endif
#ifndef SHADOWONLY
#define SHADOWONLY;
#endif
#include<imageProcessingDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>
#include<imageProcessingFunctions>
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif
#include<logDepthDeclaration>
#include<clipPlaneFragmentDeclaration>
#include<fogFragmentDeclaration>
#ifdef REFLECTIONFRESNEL
#define FRESNEL_MAXIMUM_ON_ROUGH 0.25
vec3 fresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));}
#endif
#ifdef PROJECTED_GROUND
float diskIntersectWithBackFaceCulling(vec3 ro,vec3 rd,vec3 c,float r) {float d=rd.y;if(d>0.0) { return 1e6; }
vec3 o=ro-c;float t=-o.y/d;vec3 q=o+rd*t;return (dot(q,q)<r*r) ? t : 1e6;}
float sphereIntersect(vec3 ro,vec3 rd,float ra) {float b=dot(ro,rd);float c=dot(ro,ro)-ra*ra;float h=b*b-c;if(h<0.0) { return -1.0; }
h=sqrt(h);return-b+h;}
vec3 project(vec3 viewDirectionW,vec3 eyePosition) {float radius=projectedGroundInfos.x;float height=projectedGroundInfos.y;vec3 camDir=-viewDirectionW;float skySphereDistance=sphereIntersect(eyePosition,camDir,radius);vec3 skySpherePositionW=eyePosition+camDir*skySphereDistance;vec3 p=normalize(skySpherePositionW);eyePosition.y-=height;float sIntersection=sphereIntersect(eyePosition,p,radius);vec3 h=vec3(0.0,-height,0.0);float dIntersection=diskIntersectWithBackFaceCulling(eyePosition,p,h,radius);p=(eyePosition+min(sIntersection,dIntersection)*p);return p;}
#endif
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);
#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=vec3(0.0,1.0,0.0);
#endif
float shadow=1.;float globalShadow=0.;float shadowLightCount=0.;float aggShadow=0.;float numLights=0.;
#include<lightFragment>[0..maxSimultaneousLights]
#ifdef SHADOWINUSE
globalShadow/=shadowLightCount;
#else
globalShadow=1.0;
#endif
#ifndef BACKMAT_SHADOWONLY
vec4 reflectionColor=vec4(1.,1.,1.,1.);
#ifdef REFLECTION
#ifdef PROJECTED_GROUND
vec3 reflectionVector=project(viewDirectionW,vEyePosition.xyz);reflectionVector=vec3(reflectionMatrix*vec4(reflectionVector,1.));
#else
vec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#endif
#ifdef REFLECTIONMAP_OPPOSITEZ
reflectionVector.z*=-1.0;
#endif
#ifdef REFLECTIONMAP_3D
vec3 reflectionCoords=reflectionVector;
#else
vec2 reflectionCoords=reflectionVector.xy;
#ifdef REFLECTIONMAP_PROJECTION
reflectionCoords/=reflectionVector.z;
#endif
reflectionCoords.y=1.0-reflectionCoords.y;
#endif
#ifdef REFLECTIONBLUR
float reflectionLOD=vReflectionInfos.y;
#ifdef TEXTURELODSUPPORT
reflectionLOD=reflectionLOD*log2(vReflectionMicrosurfaceInfos.x)*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;reflectionColor=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);
#else
float lodReflectionNormalized=saturate(reflectionLOD);float lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;vec4 reflectionSpecularMid=sampleReflection(reflectionSampler,reflectionCoords);if(lodReflectionNormalizedDoubled<1.0){reflectionColor=mix(
sampleReflection(reflectionSamplerHigh,reflectionCoords),
reflectionSpecularMid,
lodReflectionNormalizedDoubled
);} else {reflectionColor=mix(
reflectionSpecularMid,
sampleReflection(reflectionSamplerLow,reflectionCoords),
lodReflectionNormalizedDoubled-1.0
);}
#endif
#else
vec4 reflectionSample=sampleReflection(reflectionSampler,reflectionCoords);reflectionColor=reflectionSample;
#endif
#ifdef RGBDREFLECTION
reflectionColor.rgb=fromRGBD(reflectionColor);
#endif
#ifdef GAMMAREFLECTION
reflectionColor.rgb=toLinearSpace(reflectionColor.rgb);
#endif
#ifdef REFLECTIONBGR
reflectionColor.rgb=reflectionColor.bgr;
#endif
reflectionColor.rgb*=vReflectionInfos.x;
#endif
vec3 diffuseColor=vec3(1.,1.,1.);float finalAlpha=alpha;
#ifdef DIFFUSE
vec4 diffuseMap=texture2D(diffuseSampler,vDiffuseUV);
#ifdef GAMMADIFFUSE
diffuseMap.rgb=toLinearSpace(diffuseMap.rgb);
#endif
diffuseMap.rgb*=vDiffuseInfos.y;
#ifdef DIFFUSEHASALPHA
finalAlpha*=diffuseMap.a;
#endif
diffuseColor=diffuseMap.rgb;
#endif
#ifdef REFLECTIONFRESNEL
vec3 colorBase=diffuseColor;
#else
vec3 colorBase=reflectionColor.rgb*diffuseColor;
#endif
colorBase=max(colorBase,0.0);
#ifdef USERGBCOLOR
vec3 finalColor=colorBase;
#else
#ifdef USEHIGHLIGHTANDSHADOWCOLORS
vec3 mainColor=mix(vPrimaryColorShadow.rgb,vPrimaryColor.rgb,colorBase);
#else
vec3 mainColor=vPrimaryColor.rgb;
#endif
vec3 finalColor=colorBase*mainColor;
#endif
#ifdef REFLECTIONFRESNEL
vec3 reflectionAmount=vReflectionControl.xxx;vec3 reflectionReflectance0=vReflectionControl.yyy;vec3 reflectionReflectance90=vReflectionControl.zzz;float VdotN=dot(normalize(vEyePosition.xyz),normalW);vec3 planarReflectionFresnel=fresnelSchlickEnvironmentGGX(saturate(VdotN),reflectionReflectance0,reflectionReflectance90,1.0);reflectionAmount*=planarReflectionFresnel;
#ifdef REFLECTIONFALLOFF
float reflectionDistanceFalloff=1.0-saturate(length(vPositionW.xyz-vBackgroundCenter)*vReflectionControl.w);reflectionDistanceFalloff*=reflectionDistanceFalloff;reflectionAmount*=reflectionDistanceFalloff;
#endif
finalColor=mix(finalColor,reflectionColor.rgb,saturate(reflectionAmount));
#endif
#ifdef OPACITYFRESNEL
float viewAngleToFloor=dot(normalW,normalize(vEyePosition.xyz-vBackgroundCenter));const float startAngle=0.1;float fadeFactor=saturate(viewAngleToFloor/startAngle);finalAlpha*=fadeFactor*fadeFactor;
#endif
#ifdef SHADOWINUSE
finalColor=mix(finalColor*shadowLevel,finalColor,globalShadow);
#endif
vec